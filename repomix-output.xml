This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.
The content has been processed where comments have been removed, empty lines have been removed.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: app/Http/, app/Models/, routes/, resources/, database/
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Code comments have been removed from supported file types
- Empty lines have been removed from all files
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

<additional_info>

</additional_info>

</file_summary>

<directory_structure>
app/Http/Controllers/AdminController.php
app/Http/Controllers/ApprovedMeetingReportController.php
app/Http/Controllers/Auth/AuthenticatedSessionController.php
app/Http/Controllers/Auth/ConfirmablePasswordController.php
app/Http/Controllers/Auth/EmailVerificationNotificationController.php
app/Http/Controllers/Auth/EmailVerificationPromptController.php
app/Http/Controllers/Auth/NewPasswordController.php
app/Http/Controllers/Auth/PasswordController.php
app/Http/Controllers/Auth/PasswordResetLinkController.php
app/Http/Controllers/Auth/RegisteredUserController.php
app/Http/Controllers/Auth/VerifyEmailController.php
app/Http/Controllers/Backend/RoleController.php
app/Http/Controllers/Category/CommitteeCategoryController.php
app/Http/Controllers/Category/MeetingTypeController.php
app/Http/Controllers/Category/RegulationCategoryController.php
app/Http/Controllers/Category/RuleCategoryController.php
app/Http/Controllers/CommitteeOpinionController.php
app/Http/Controllers/Controller.php
app/Http/Controllers/LegalDatabaseController.php
app/Http/Controllers/MainMeetingController.php
app/Http/Controllers/MeetingAgendaController.php
app/Http/Controllers/MeetingApprovalController.php
app/Http/Controllers/MeetingApprovalListController.php
app/Http/Controllers/MeetingController.php
app/Http/Controllers/MeetingFormatController.php
app/Http/Controllers/MeetingReportController.php
app/Http/Controllers/MeetingReportSummaryController.php
app/Http/Controllers/MeetingResolutionController.php
app/Http/Controllers/MeetingResolutionTypeController.php
app/Http/Controllers/PositionController.php
app/Http/Controllers/PrefixNameController.php
app/Http/Controllers/ProfileController.php
app/Http/Controllers/RegulationMeetingController.php
app/Http/Controllers/RuleMeetingController.php
app/Http/Controllers/SettingsController.php
app/Http/Controllers/UserController.php
app/Http/Controllers/UserProfileController.php
app/Http/Kernel.php
app/Http/Middleware/Authenticate.php
app/Http/Middleware/CheckRole.php
app/Http/Middleware/EncryptCookies.php
app/Http/Middleware/PreventRequestsDuringMaintenance.php
app/Http/Middleware/RedirectIfAuthenticated.php
app/Http/Middleware/Role.php
app/Http/Middleware/TrimStrings.php
app/Http/Middleware/TrustHosts.php
app/Http/Middleware/TrustProxies.php
app/Http/Middleware/ValidateSignature.php
app/Http/Middleware/VerifyCsrfToken.php
app/Http/Requests/Auth/LoginRequest.php
app/Http/Requests/ProfileUpdateRequest.php
app/Models/CommitteeCategory.php
app/Models/CommitteeOpinion.php
app/Models/DocumentExport.php
app/Models/MainMeeting.php
app/Models/MeetingAdminEdit.php
app/Models/MeetingAgendaItems.php
app/Models/MeetingAgendaLecture.php
app/Models/MeetingAgenda.php
app/Models/MeetingAgendaSection.php
app/Models/MeetingApprovalDetail.php
app/Models/MeetingApprovalHistory.php
app/Models/MeetingApproval.php
app/Models/MeetingFormat.php
app/Models/MeetingParticipant.php
app/Models/Meeting.php
app/Models/MeetingReport.php
app/Models/MeetingResolution.php
app/Models/MeetingResolutionType.php
app/Models/MeetingType.php
app/Models/MeetingView.php
app/Models/Position.php
app/Models/PrefixName.php
app/Models/RegulationCategory.php
app/Models/RegulationMeeting.php
app/Models/RuleCategory.php
app/Models/RuleofMeeting.php
app/Models/Setting.php
app/Models/User.php
database/factories/UserFactory.php
database/.gitignore
database/migrations/2014_10_12_000000_create_users_table.php
database/migrations/2014_10_12_100000_create_password_reset_tokens_table.php
database/migrations/2019_08_19_000000_create_failed_jobs_table.php
database/migrations/2019_12_14_000001_create_personal_access_tokens_table.php
database/migrations/2024_09_25_094908_create_permission_tables.php
database/migrations/2024_10_02_075647_create_ruleof_meetings_table.php
database/migrations/2024_10_03_014542_create_rule_categories_table.php
database/migrations/2024_10_03_075707_create_regulation_categories_table.php
database/migrations/2024_10_03_075755_create_rugulation_meetings_table.php
database/migrations/2024_10_04_031216_create_meeting_reports_table.php
database/migrations/2024_10_04_034110_create_committee_categories_table.php
database/migrations/2024_10_04_072740_create_meeting_types_table.php
database/migrations/2024_10_07_042706_create_meeting_agendas_table.php
database/migrations/2024_10_07_082831_create_meeting_agenda_sections_table.php
database/migrations/2024_10_07_084921_create_meeting_agenda_lectures_table.php
database/migrations/2024_10_07_084950_create_meeting_agenda_items_table.php
database/migrations/2024_10_09_085015_create_meetings_table.php
database/migrations/2024_10_09_085954_create_meeting_formats_table.php
database/migrations/2024_10_09_150331_create_meeting_approvals_table.php
database/migrations/2024_10_15_064839_create_meeting_approval_details_table.php
database/migrations/2024_10_16_072352_create_prefix_names_table.php
database/migrations/2024_10_16_101820_create_positions_table.php
database/migrations/2024_10_16_115849_create_committee_user_table.php
database/migrations/2024_10_17_065442_create_department_user_table.php
database/migrations/2024_10_17_071859_create_committee_category_user_table.php
database/migrations/2024_10_18_082617_create_main_meetings_table.php
database/migrations/2024_10_18_100044_create_main_meeting_meeting_type_table.php
database/migrations/2024_10_18_100704_create_main_meeting_committee_category_table.php
database/migrations/2024_10_20_054946_create_meeting_type_user_table.php
database/migrations/2024_10_21_144527_create_meeting_views_table.php
database/migrations/2024_10_21_154428_create_meeting_participants_table.php
database/migrations/2024_10_21_160450_create_settings_table.php
database/migrations/2024_10_23_152956_create_meeting_admin_edits_table.php
database/migrations/2024_10_24_154226_create_meeting_approval_histories_table.php
database/migrations/2024_10_26_160843_create_meeting_agenda_rule_of_meeting_table.php
database/migrations/2024_10_27_151554_create_meeting_agenda_regulation_meeting_table.php
database/migrations/2024_11_12_031156_create_notifications_table.php
database/migrations/2024_11_14_143304_create_document_exports_table.php
database/migrations/2024_11_30_085137_create_committee_opinions_table.php
database/migrations/2025_03_06_065431_create_meeting_resolutions_table.php
database/migrations/2025_03_12_080559_add_meeting_agenda_lecture_id_to_meeting_resolutions_table.php
database/migrations/2025_05_02_161719_create_meeting_resolution_types_table.php
database/seeders/DatabaseSeeder.php
database/seeders/UserTableSeeder.php
resources/css/app.css
resources/js/app.js
resources/js/bootstrap.js
resources/views/admin/admin_dashboard.blade.php
resources/views/admin/backend/pages/admin/add_admin.blade.php
resources/views/admin/backend/pages/admin/all_admin.blade.php
resources/views/admin/backend/pages/admin/edit_admin.blade.php
resources/views/admin/backend/pages/approved_reports_by_admin/all_approved_report_by_admin.blade.php
resources/views/admin/backend/pages/approved_reports_by_admin/list_approved_report_by_admin.blade.php
resources/views/admin/backend/pages/committee/committe_category/add_committee_category.blade.php
resources/views/admin/backend/pages/committee/committe_category/all_committee_category.blade.php
resources/views/admin/backend/pages/committee/committe_category/edit_committee_category.blade.php
resources/views/admin/backend/pages/lecture/edit_meeting_agenda_item.blade.php
resources/views/admin/backend/pages/lecture/edit_meeting_agenda_lecture.blade.php
resources/views/admin/backend/pages/main_meeting/add_main_meeting.blade.php
resources/views/admin/backend/pages/main_meeting/all_main_meeting.blade.php
resources/views/admin/backend/pages/main_meeting/edit_main_meeting.blade.php
resources/views/admin/backend/pages/meeting/add_meeting.blade.php
resources/views/admin/backend/pages/meeting_agenda/add_meeting_agenda.blade.php
resources/views/admin/backend/pages/meeting_agenda/all_meeting_agenda.blade.php
resources/views/admin/backend/pages/meeting_agenda/edit_meeting_agenda.blade.php
resources/views/admin/backend/pages/meeting/all_meeting.blade.php
resources/views/admin/backend/pages/meeting_approval/all_meeting_approval.blade.php
resources/views/admin/backend/pages/meeting_approval/approval_details.blade.php
resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail_0.blade.php
resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail_2.blade.php
resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail_3.blade.php
resources/views/admin/backend/pages/meeting_approval/##meeting_approval_detail.blade.php
resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail.blade.php
resources/views/admin/backend/pages/meeting_format/add_meeting_format.blade.php
resources/views/admin/backend/pages/meeting_format/all_meeting_format.blade.php
resources/views/admin/backend/pages/meeting_format/edit_meeting_format.blade.php
resources/views/admin/backend/pages/meeting/meeting_details.blade.php
resources/views/admin/backend/pages/meeting/my_all_meeting.blade.php
resources/views/admin/backend/pages/meeting_report/add_meeting_report.blade.php
resources/views/admin/backend/pages/meeting_report/all_meeting_report.blade.php
resources/views/admin/backend/pages/meeting_report/edit_meeting_report.blade.php
resources/views/admin/backend/pages/meeting_report/meeting_type/add_meeting_type.blade.php
resources/views/admin/backend/pages/meeting_report/meeting_type/all_meeting_type.blade.php
resources/views/admin/backend/pages/meeting_report/meeting_type/edit_meeting_type.blade.php
resources/views/admin/backend/pages/meeting_report_sum/add_meeting_resolution.blade.php
resources/views/admin/backend/pages/meeting_report_sum/all_meeting_report_summary.blade.php
resources/views/admin/backend/pages/meeting_report_sum/all_meeting_resolution.blade.php
resources/views/admin/backend/pages/meeting_report_sum/edit_meeting_resolution.blade.php
resources/views/admin/backend/pages/meeting_report_sum/meeting_summary.blade.php
resources/views/admin/backend/pages/meeting_report_sum/meeting_summary_edit.blade.php
resources/views/admin/backend/pages/meeting_report_sum/partials/approval_table.blade.php
resources/views/admin/backend/pages/meeting_report_sum/search_meeting_resolution.blade.php
resources/views/admin/backend/pages/meeting_report_sum/search_meeting_resolution_results.blade.php
resources/views/admin/backend/pages/meeting_report_sum/summary.blade.php
resources/views/admin/backend/pages/meeting_resolution_type/add_meeting_resolution_type.blade.php
resources/views/admin/backend/pages/meeting_resolution_type/all_meeting_resolution_types.blade.php
resources/views/admin/backend/pages/meeting_resolution_type/edit_meeting_resolution_type.blade.php
resources/views/admin/backend/pages/meeting_resolution_type/search_meeting_resolution_types.blade.php
resources/views/admin/backend/pages/meeting_resolution_type/search_meeting_resolution_types_results.blade.php
resources/views/admin/backend/pages/meeting_section_detail/lecture_detail.blade.php
resources/views/admin/backend/pages/meeting_section_detail/section_agenda_item_detail.blade.php
resources/views/admin/backend/pages/meeting/show_meeting_all.blade.php
resources/views/admin/backend/pages/permission/add_permission.blade.php
resources/views/admin/backend/pages/permission/all_permission.blade.php
resources/views/admin/backend/pages/permission/edit_permission.blade.php
resources/views/admin/backend/pages/position/add_position.blade.php
resources/views/admin/backend/pages/position/all_position.blade.php
resources/views/admin/backend/pages/position/edit_position.blade.php
resources/views/admin/backend/pages/prefix/add_prefix_name.blade.php
resources/views/admin/backend/pages/prefix/all_prefix_name.blade.php
resources/views/admin/backend/pages/prefix/edit_prefix_name.blade.php
resources/views/admin/backend/pages/regulation_meeting/add_regulation_meeting.blade.php
resources/views/admin/backend/pages/regulation_meeting/all_regulation_meeting.blade.php
resources/views/admin/backend/pages/regulation_meeting/edit_regulation_meeting.blade.php
resources/views/admin/backend/pages/regulation_meeting/regulation_category/add_regulation_category.blade.php
resources/views/admin/backend/pages/regulation_meeting/regulation_category/all_regulation_category.blade.php
resources/views/admin/backend/pages/regulation_meeting/regulation_category/edit_regulation_category.blade.php
resources/views/admin/backend/pages/reports/pdf.blade.php
resources/views/admin/backend/pages/roles/add_roles.blade.php
resources/views/admin/backend/pages/roles/all_roles.blade.php
resources/views/admin/backend/pages/roles/edit_roles.blade.php
resources/views/admin/backend/pages/rolesetup/add_roles_permission.blade.php
resources/views/admin/backend/pages/rolesetup/all_roles_permission.blade.php
resources/views/admin/backend/pages/rolesetup/edit_roles_permission.blade.php
resources/views/admin/backend/pages/rule_meeting/add_rule_meeting.blade.php
resources/views/admin/backend/pages/rule_meeting/all_rule_meeting.blade.php
resources/views/admin/backend/pages/rule_meeting/edit_rule_meeting.blade.php
resources/views/admin/backend/pages/rule_meeting/rule_category/add_rule_category.blade.php
resources/views/admin/backend/pages/rule_meeting/rule_category/all_rule_category.blade.php
resources/views/admin/backend/pages/rule_meeting/rule_category/edit_rule_category.blade.php
resources/views/admin/backend/pages/section/add_meeting_agenda_lecture.blade.php
resources/views/admin/backend/pages/section/edit_meeting_agenda_section.blade.php
resources/views/admin/backend/pages/settings/edit_approval_deadline.blade.php
resources/views/admin/backend/pages/user/profile/edit.blade.php
resources/views/admin/body/footer.blade.php
resources/views/admin/body/header.blade.php
resources/views/admin/body/sidebar.blade.php
resources/views/admin/index.blade.php
resources/views/admin/legal_database/index.blade.php
resources/views/auth/confirm-password.blade.php
resources/views/auth/forgot-password.blade.php
resources/views/auth/login.blade.php
resources/views/auth/register.blade.php
resources/views/auth/reset-password.blade.php
resources/views/auth/verify-email.blade.php
resources/views/components/application-logo.blade.php
resources/views/components/auth-session-status.blade.php
resources/views/components/danger-button.blade.php
resources/views/components/dropdown.blade.php
resources/views/components/dropdown-link.blade.php
resources/views/components/input-error.blade.php
resources/views/components/input-label.blade.php
resources/views/components/modal.blade.php
resources/views/components/nav-link.blade.php
resources/views/components/primary-button.blade.php
resources/views/components/responsive-nav-link.blade.php
resources/views/components/secondary-button.blade.php
resources/views/components/text-input.blade.php
resources/views/dashboard.blade.php
resources/views/frontend/index.blade.php
resources/views/layouts/app.blade.php
resources/views/layouts/guest.blade.php
resources/views/layouts/navigation.blade.php
resources/views/profile/edit.blade.php
resources/views/profile/partials/delete-user-form.blade.php
resources/views/profile/partials/update-password-form.blade.php
resources/views/profile/partials/update-profile-information-form.blade.php
resources/views/welcome.blade.php
routes/api.php
routes/auth.php
routes/channels.php
routes/console.php
routes/web.php
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/Http/Controllers/CommitteeOpinionController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeOpinion;
use App\Models\MeetingAgendaLecture;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use App\Events\VoteUpdated;
class CommitteeOpinionController extends Controller
{
    public function store(Request $request)
    {
        $request->validate([
            'lecture_id' => 'required|exists:meeting_agenda_lectures,id',
            'feedback_status' => 'required|in:approve,reject',
            'feedback_content' => 'required_if:feedback_status,reject',
        ]);
        $opinion = CommitteeOpinion::where([
            'meeting_agenda_lecture_id' => $request->lecture_id,
            'user_id' => Auth::id()
        ])->first();
        if (!$opinion) {
            $opinion = new CommitteeOpinion();
            $opinion->meeting_agenda_lecture_id = $request->lecture_id;
            $opinion->user_id = Auth::id();
        }
        $opinion->vote_type = $request->feedback_status;
        $opinion->opinion = $request->feedback_content;
        $opinion->save();
        $opinion->load(['user', 'user.prefixName']);
        $approveCount = CommitteeOpinion::where('meeting_agenda_lecture_id', $request->lecture_id)
            ->where('vote_type', 'approve')
            ->count();
        $rejectCount = CommitteeOpinion::where('meeting_agenda_lecture_id', $request->lecture_id)
            ->where('vote_type', 'reject')
            ->count();
        event(new VoteUpdated($request->lecture_id, $approveCount, $rejectCount, $opinion));
        return response()->json([
            'success' => true,
            'message' => 'บันทึกความเห็นเรียบร้อยแล้ว',
            'approve_count' => $approveCount,
            'reject_count' => $rejectCount
        ]);
    }
    public function getOpinions($lectureId)
    {
        $opinions = CommitteeOpinion::with('user', 'user.prefixName')
            ->where('meeting_agenda_lecture_id', $lectureId)
            ->orderBy('created_at', 'desc')
            ->get();
        return response()->json($opinions);
    }
    public function getCurrentUserOpinion($lectureId)
    {
        $opinion = CommitteeOpinion::with('user', 'user.prefixName')
            ->where('meeting_agenda_lecture_id', $lectureId)
            ->where('user_id', auth()->id())
            ->first();
        return response()->json($opinion);
    }
}
</file>

<file path="app/Http/Controllers/LegalDatabaseController.php">
<?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
class LegalDatabaseController extends Controller
{
    public function index()
    {
        return view('admin.legal_database.index');
    }
}
</file>

<file path="app/Http/Controllers/MeetingResolutionController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\MeetingAgenda;
use App\Models\MeetingAgendaLecture;
use App\Models\MeetingAgendaSection;
use App\Models\MeetingResolution;
use App\Models\MeetingType;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
class MeetingResolutionController extends Controller
{
    public function AllMeetingResolution()
    {
        $meeting_resolutions = MeetingResolution::with([
            'meetingAgenda',
            'meetingAgendaSection',
            'committeeCategory',
            'meetingType'
        ])->latest()->get();
        return view('admin.backend.pages.meeting_report_sum.all_meeting_resolution', compact('meeting_resolutions'));
    }
    public function AddMeetingResolution()
    {
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingTypes = MeetingType::latest()->get();
        return view('admin.backend.pages.meeting_report_sum.add_meeting_resolution', compact('committeeCategories', 'meetingTypes'));
    }
    public function GetMeetingAgendaLectures(Request $request)
    {
        $sectionId = $request->section_id ?? $request->meeting_agenda_section_id;
        $lectures = MeetingAgendaLecture::where('meeting_agenda_section_id', $sectionId)->get();
        return response()->json($lectures);
    }
    public function GetMeetingAgendas(Request $request)
    {
        $committeeId = $request->committee_category_id;
        $meetingTypeId = $request->meeting_type_id;
        $meetingAgendas = MeetingAgenda::where('committee_category_id', $committeeId)
            ->where('meeting_type_id', $meetingTypeId)
            ->get(['id', 'meeting_agenda_title']);
        return response()->json($meetingAgendas);
    }
    public function GetMeetingSections(Request $request)
    {
        $meetingAgendaId = $request->meeting_agenda_id;
        $sections = MeetingAgendaSection::where('meeting_agenda_id', $meetingAgendaId)
            ->get(['id', 'section_title']);
        return response()->json($sections);
    }
    public function StoreMeetingResolution(Request $request)
    {
        $request->validate([
            'committee_category_id' => 'required',
            'meeting_type_id' => 'required',
            'meeting_agenda_id' => 'required',
            'meeting_agenda_section_id' => 'required',
            'meeting_agenda_lecture_id' => 'nullable|exists:meeting_agenda_lectures,id',
            'proposer' => 'required|string|max:255',
            'resolution_text' => 'required',
            'resolution_date' => 'required|date',
            'resolution_status' => 'required',
            'task_title' => 'required|string|max:255',
            'responsible_person' => 'required|string|max:255',
            'task_status' => 'required|in:completed,in_progress,not_started',
            'report_date' => 'required|date',
            'document' => 'nullable|file|mimes:pdf,doc,docx,xls,xlsx,ppt,pptx,jpg,jpeg,png|max:10240',
        ]);
        try {
            $documentPath = null;
            if ($request->hasFile('document')) {
                $file = $request->file('document');
                $fileName = time() . '_' . $file->getClientOriginalName();
                $file->move(public_path('upload/meeting_documents/'), $fileName);
                $documentPath = 'upload/meeting_documents/' . $fileName;
            }
            MeetingResolution::create([
                'committee_category_id' => $request->committee_category_id,
                'meeting_type_id' => $request->meeting_type_id,
                'meeting_agenda_id' => $request->meeting_agenda_id,
                'meeting_agenda_section_id' => $request->meeting_agenda_section_id,
                'meeting_agenda_lecture_id' => $request->meeting_agenda_lecture_id,
                'proposer' => $request->proposer,
                'document' => $documentPath,
                'resolution_text' => $request->resolution_text,
                'resolution_date' => $request->resolution_date,
                'resolution_status' => $request->resolution_status,
                'task_title' => $request->task_title,
                'responsible_person' => $request->responsible_person,
                'task_status' => $request->task_status,
                'report_date' => $request->report_date,
                'user_id' => Auth::id(),
                'created_at' => Carbon::now()
            ]);
            $notification = array(
                'message' => 'เพิ่มมติการประชุมเรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.resolution')->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'เกิดข้อผิดพลาด: ' . $th->getMessage(),
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification)->withInput();
        }
    }
    public function EditMeetingResolution($id)
    {
        $resolution = MeetingResolution::findOrFail($id);
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingTypes = MeetingType::latest()->get();
        $meetingAgendas = MeetingAgenda::where('committee_category_id', $resolution->committee_category_id)
            ->where('meeting_type_id', $resolution->meeting_type_id)
            ->get();
        $meetingSections = MeetingAgendaSection::where('meeting_agenda_id', $resolution->meeting_agenda_id)
            ->get();
        $meetingLectures = MeetingAgendaLecture::where('meeting_agenda_section_id', $resolution->meeting_agenda_section_id)->get();
        return view('admin.backend.pages.meeting_report_sum.edit_meeting_resolution', compact(
            'resolution',
            'committeeCategories',
            'meetingTypes',
            'meetingAgendas',
            'meetingSections',
            'meetingLectures'
        ));
    }
    public function UpdateMeetingResolution(Request $request)
    {
        $request->validate([
            'committee_category_id' => 'required',
            'meeting_type_id' => 'required',
            'meeting_agenda_id' => 'required',
            'meeting_agenda_section_id' => 'required',
            'meeting_agenda_lecture_id' => 'nullable|exists:meeting_agenda_lectures,id',
            'proposer' => 'required|string|max:255',
            'resolution_text' => 'required',
            'resolution_date' => 'required|date',
            'resolution_status' => 'required',
            'task_title' => 'required|string|max:255',
            'responsible_person' => 'required|string|max:255',
            'task_status' => 'required|in:completed,in_progress,not_started',
            'report_date' => 'required|date',
            'document' => 'nullable|file|mimes:pdf,doc,docx,xls,xlsx,ppt,pptx,jpg,jpeg,png|max:10240',
        ]);
        try {
            $resolution = MeetingResolution::findOrFail($request->id);
            $documentPath = $resolution->document;
            if ($request->hasFile('document')) {
                if ($resolution->document && file_exists(public_path($resolution->document))) {
                    unlink(public_path($resolution->document));
                }
                $file = $request->file('document');
                $fileName = time() . '_' . $file->getClientOriginalName();
                $file->move(public_path('upload/meeting_documents/'), $fileName);
                $documentPath = 'upload/meeting_documents/' . $fileName;
            } elseif ($request->remove_document == '1') {
                if ($resolution->document && file_exists(public_path($resolution->document))) {
                    unlink(public_path($resolution->document));
                }
                $documentPath = null;
            }
            $resolution->update([
                'committee_category_id' => $request->committee_category_id,
                'meeting_type_id' => $request->meeting_type_id,
                'meeting_agenda_id' => $request->meeting_agenda_id,
                'meeting_agenda_section_id' => $request->meeting_agenda_section_id,
                'meeting_agenda_lecture_id' => $request->meeting_agenda_lecture_id,
                'proposer' => $request->proposer,
                'document' => $documentPath,
                'resolution_text' => $request->resolution_text,
                'resolution_date' => $request->resolution_date,
                'resolution_status' => $request->resolution_status,
                'task_title' => $request->task_title,
                'responsible_person' => $request->responsible_person,
                'task_status' => $request->task_status,
                'report_date' => $request->report_date,
                'updated_at' => Carbon::now()
            ]);
            $notification = array(
                'message' => 'อัปเดตมติการประชุมเรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.resolution')->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'เกิดข้อผิดพลาด: ' . $th->getMessage(),
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification)->withInput();
        }
    }
    public function DeleteMeetingResolution($id)
    {
        try {
            $resolution = MeetingResolution::findOrFail($id);
            if ($resolution->document && file_exists(public_path($resolution->document))) {
                unlink(public_path($resolution->document));
            }
            $resolution->delete();
            $notification = array(
                'message' => 'ลบมติการประชุมเรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->back()->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'เกิดข้อผิดพลาด: ' . $th->getMessage(),
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification);
        }
    }
    public function SearchMeetingResolution()
    {
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingTypes = MeetingType::latest()->get();
        $meeting_resolutions = null;
        return view('admin.backend.pages.meeting_report_sum.search_meeting_resolution', compact('committeeCategories', 'meetingTypes', 'meeting_resolutions'));
    }
    public function SearchMeetingResolutionResults(Request $request)
    {
        $query = MeetingResolution::with([
            'meetingAgenda',
            'meetingAgendaSection',
            'committeeCategory',
            'meetingType'
        ]);
        if ($request->filled('committee_category_id')) {
            $query->where('committee_category_id', $request->committee_category_id);
        }
        if ($request->filled('meeting_type_id')) {
            $query->where('meeting_type_id', $request->meeting_type_id);
        }
        if ($request->filled('meeting_agenda_id')) {
            $query->where('meeting_agenda_id', $request->meeting_agenda_id);
        }
        if ($request->filled('meeting_agenda_section_id')) {
            $query->where('meeting_agenda_section_id', $request->meeting_agenda_section_id);
        }
if ($request->filled('meeting_agenda_lecture_id')) {
    $query->where('meeting_agenda_lecture_id', $request->meeting_agenda_lecture_id);
}
        if ($request->filled('keyword')) {
            $query->where(function($q) use ($request) {
                $q->where('resolution_text', 'LIKE', '%' . $request->keyword . '%')
                  ->orWhere('task_title', 'LIKE', '%' . $request->keyword . '%')
                  ->orWhere('responsible_person', 'LIKE', '%' . $request->keyword . '%')
                  ->orWhere('proposer', 'LIKE', '%' . $request->keyword . '%')
                  ->orWhereHas('meetingAgenda', function($query) use ($request) {
                      $query->where('meeting_agenda_title', 'LIKE', '%' . $request->keyword . '%');
                  })
                  ->orWhereHas('meetingAgendaSection', function($query) use ($request) {
                      $query->where('section_title', 'LIKE', '%' . $request->keyword . '%');
                  });
            });
        }
        if ($request->filled('task_status')) {
            $query->where('task_status', $request->task_status);
        }
        if ($request->filled('start_date') && $request->filled('end_date')) {
            $query->whereBetween('resolution_date', [$request->start_date, $request->end_date]);
        } elseif ($request->filled('start_date')) {
            $query->where('resolution_date', '>=', $request->start_date);
        } elseif ($request->filled('end_date')) {
            $query->where('resolution_date', '<=', $request->end_date);
        }
        $meeting_resolutions = $query->latest()->get();
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingTypes = MeetingType::latest()->get();
        return view('admin.backend.pages.meeting_report_sum.search_meeting_resolution', compact('meeting_resolutions', 'committeeCategories', 'meetingTypes', 'request'));
    }
}
</file>

<file path="app/Http/Controllers/MeetingResolutionTypeController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\MeetingType;
use App\Models\MeetingResolutionType;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Carbon\Carbon;
class MeetingResolutionTypeController extends Controller
{
    public function AllMeetingResolutionTypes()
    {
        $resolutionTypes = MeetingResolutionType::with(['committeeCategory', 'meetingType'])->latest()->get();
        return view('admin.backend.pages.meeting_resolution_type.all_meeting_resolution_types', compact('resolutionTypes'));
    }
    public function AddMeetingResolutionType()
    {
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingTypes = MeetingType::latest()->get();
        return view('admin.backend.pages.meeting_resolution_type.add_meeting_resolution_type', compact('committeeCategories', 'meetingTypes'));
    }
    public function StoreMeetingResolutionType(Request $request)
    {
        $request->validate([
            'committee_category_id' => 'required',
            'meeting_type_id' => 'required',
            'meeting_no' => 'required|string|max:10',
            'meeting_year' => 'required|string|max:4',
            'meeting_date' => 'required|date',
            'name' => 'required|string|max:255',
            'agenda_title' => 'required|string|max:255',
            'resolution_text' => 'required|string',
            'task_status' => 'required|in:completed,in_progress,not_started',
            'document' => 'nullable|file|mimes:pdf,doc,docx,xls,xlsx,ppt,pptx,jpg,jpeg,png|max:10240',
        ]);
        try {
            $documentPath = null;
            if ($request->hasFile('document')) {
                $file = $request->file('document');
                $fileName = time() . '_' . $file->getClientOriginalName();
                $file->move(public_path('upload/meeting_documents/'), $fileName);
                $documentPath = 'upload/meeting_documents/' . $fileName;
            }
            MeetingResolutionType::create([
                'committee_category_id' => $request->committee_category_id,
                'meeting_type_id' => $request->meeting_type_id,
                'meeting_no' => $request->meeting_no,
                'meeting_year' => $request->meeting_year,
                'meeting_date' => $request->meeting_date,
                'name' => $request->name,
                'agenda_title' => $request->agenda_title,
                'resolution_text' => $request->resolution_text,
                'task_status' => $request->task_status,
                'document' => $documentPath,
                'created_at' => Carbon::now()
            ]);
            $notification = array(
                'message' => 'เพิ่มรายงานมติที่ประชุมเรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.resolution.types')->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'เกิดข้อผิดพลาด: ' . $th->getMessage(),
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification)->withInput();
        }
    }
    public function EditMeetingResolutionType($id)
    {
        $resolutionType = MeetingResolutionType::findOrFail($id);
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingTypes = MeetingType::latest()->get();
        return view('admin.backend.pages.meeting_resolution_type.edit_meeting_resolution_type', compact('resolutionType', 'committeeCategories', 'meetingTypes'));
    }
    public function UpdateMeetingResolutionType(Request $request)
    {
        $request->validate([
            'committee_category_id' => 'required',
            'meeting_type_id' => 'required',
            'meeting_no' => 'required|string|max:10',
            'meeting_year' => 'required|string|max:4',
            'meeting_date' => 'required|date',
            'name' => 'required|string|max:255',
            'agenda_title' => 'required|string|max:255',
            'resolution_text' => 'required|string',
            'task_status' => 'required|in:completed,in_progress,not_started',
            'document' => 'nullable|file|mimes:pdf,doc,docx,xls,xlsx,ppt,pptx,jpg,jpeg,png|max:10240',
        ]);
        try {
            $resolutionType = MeetingResolutionType::findOrFail($request->id);
            $data = [
                'committee_category_id' => $request->committee_category_id,
                'meeting_type_id' => $request->meeting_type_id,
                'meeting_no' => $request->meeting_no,
                'meeting_year' => $request->meeting_year,
                'meeting_date' => $request->meeting_date,
                'name' => $request->name,
                'agenda_title' => $request->agenda_title,
                'resolution_text' => $request->resolution_text,
                'task_status' => $request->task_status,
            ];
            if ($request->hasFile('document')) {
                if ($resolutionType->document && file_exists(public_path($resolutionType->document))) {
                    unlink(public_path($resolutionType->document));
                }
                $file = $request->file('document');
                $fileName = time() . '_' . $file->getClientOriginalName();
                $file->move(public_path('upload/meeting_documents/'), $fileName);
                $data['document'] = 'upload/meeting_documents/' . $fileName;
            }
            $resolutionType->update($data);
            $notification = array(
                'message' => 'อัปเดตรายงานมติที่ประชุมเรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.resolution.types')->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'เกิดข้อผิดพลาด: ' . $th->getMessage(),
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification)->withInput();
        }
    }
    public function DeleteMeetingResolutionType($id)
    {
        try {
            MeetingResolutionType::findOrFail($id)->delete();
            $notification = array(
                'message' => 'ลบประเภทองค์มติการประชุมเรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->back()->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'เกิดข้อผิดพลาด: ' . $th->getMessage(),
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification);
        }
    }
    public function GetMeetingResolutionTypes(Request $request)
    {
        $committeeId = $request->committee_category_id;
        $meetingTypeId = $request->meeting_type_id;
        $resolutionTypes = MeetingResolutionType::where('committee_category_id', $committeeId)
            ->where('meeting_type_id', $meetingTypeId)
            ->get(['id', 'name']);
        return response()->json($resolutionTypes);
    }
    public function SearchMeetingResolutionTypes(Request $request)
    {
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingTypes = MeetingType::latest()->get();
        $results = null;
        if ($request->filled('keyword') || $request->filled('committee_category_id') ||
            $request->filled('meeting_type_id') || $request->filled('meeting_no') ||
            $request->filled('meeting_year') || $request->filled('meeting_date')) {
            $query = MeetingResolutionType::with(['committeeCategory', 'meetingType']);
            if ($request->filled('committee_category_id')) {
                $query->where('committee_category_id', $request->committee_category_id);
            }
            if ($request->filled('meeting_type_id')) {
                $query->where('meeting_type_id', $request->meeting_type_id);
            }
            if ($request->filled('meeting_year')) {
                $query->where('meeting_year', $request->meeting_year);
            }
            if ($request->filled('meeting_no')) {
                $query->where('meeting_no', $request->meeting_no);
            }
            if ($request->filled('meeting_date')) {
                $query->whereDate('meeting_date', $request->meeting_date);
            }
            if ($request->filled('keyword')) {
                $keyword = $request->keyword;
                $query->where(function($q) use ($keyword) {
                    $q->where('name', 'LIKE', "%{$keyword}%")
                      ->orWhere('agenda_title', 'LIKE', "%{$keyword}%")
                      ->orWhere('resolution_text', 'LIKE', "%{$keyword}%");
                });
            }
            $results = $query->latest()->get();
        }
        return view('admin.backend.pages.meeting_resolution_type.search_meeting_resolution_types',
            compact('committeeCategories', 'meetingTypes', 'results'));
    }
}
</file>

<file path="app/Models/CommitteeOpinion.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class CommitteeOpinion extends Model
{
    protected $fillable = [
        'meeting_agenda_lecture_id',
        'user_id',
        'opinion',
        'vote_type'
    ];
    public function user()
    {
        return $this->belongsTo(User::class);
    }
    public function lecture()
    {
        return $this->belongsTo(MeetingAgendaLecture::class, 'meeting_agenda_lecture_id');
    }
}
</file>

<file path="app/Models/DocumentExport.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Model;
class DocumentExport extends Model
{
    protected $fillable = [
        'user_id',
        'meeting_agenda_id',
        'file_name',
        'file_path'
    ];
    public function user()
    {
        return $this->belongsTo(User::class);
    }
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class);
    }
}
</file>

<file path="app/Models/MeetingResolution.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingResolution extends Model
{
    use HasFactory;
    protected $guarded = [];
    protected $dates = [
        'resolution_date',
        'created_at',
        'updated_at',
    ];
    public function committeeCategory()
    {
        return $this->belongsTo(CommitteeCategory::class, 'committee_category_id', 'id');
    }
    public function meetingType()
    {
        return $this->belongsTo(MeetingType::class, 'meeting_type_id', 'id');
    }
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class, 'meeting_agenda_id', 'id');
    }
    public function meetingAgendaSection()
    {
        return $this->belongsTo(MeetingAgendaSection::class, 'meeting_agenda_section_id', 'id');
    }
    public function meetingAgendaLecture()
    {
        return $this->belongsTo(MeetingAgendaLecture::class, 'meeting_agenda_lecture_id', 'id');
    }
    public function user()
    {
        return $this->belongsTo(User::class, 'user_id', 'id');
    }
}
</file>

<file path="app/Models/MeetingResolutionType.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingResolutionType extends Model
{
    use HasFactory;
    protected $guarded = [];
    protected $dates = [
        'meeting_date',
        'created_at',
        'updated_at',
    ];
    public function committeeCategory()
    {
        return $this->belongsTo(CommitteeCategory::class, 'committee_category_id', 'id');
    }
    public function meetingType()
    {
        return $this->belongsTo(MeetingType::class, 'meeting_type_id', 'id');
    }
}
</file>

<file path="database/migrations/2024_11_14_143304_create_document_exports_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('document_exports', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained();
            $table->foreignId('meeting_agenda_id')->constrained('meeting_agendas');
            $table->string('file_name');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('document_exports');
    }
};
</file>

<file path="database/migrations/2024_11_30_085137_create_committee_opinions_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('committee_opinions', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_lecture_id');
            $table->unsignedBigInteger('user_id');
            $table->text('opinion')->nullable();
            $table->enum('vote_type', ['approve', 'reject']);
            $table->timestamps();
            $table->softDeletes();
            $table->foreign('meeting_agenda_lecture_id')->references('id')->on('meeting_agenda_lectures')->onDelete('cascade');
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('committee_opinions');
    }
};
</file>

<file path="database/migrations/2025_03_06_065431_create_meeting_resolutions_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_resolutions', function (Blueprint $table) {
            $table->id();
            $table->foreignId('committee_category_id')->constrained('committee_categories')->onDelete('cascade');
            $table->foreignId('meeting_type_id')->constrained('meeting_types')->onDelete('cascade');
            $table->foreignId('meeting_agenda_id')->constrained('meeting_agendas')->onDelete('cascade');
            $table->foreignId('meeting_agenda_section_id')->constrained('meeting_agenda_sections')->onDelete('cascade');
            $table->string('proposer')->nullable();
            $table->string('document')->nullable();
            $table->text('resolution_text');
            $table->date('resolution_date');
            $table->enum('resolution_status', ['approved', 'rejected', 'pending'])->default('pending');
            $table->string('task_title')->nullable();
            $table->string('responsible_person')->nullable();
            $table->enum('task_status', ['completed', 'in_progress', 'not_started'])->default('not_started');
            $table->date('report_date')->nullable();
            $table->foreignId('user_id')->constrained('users')->onDelete('cascade');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_resolutions');
    }
};
</file>

<file path="database/migrations/2025_03_12_080559_add_meeting_agenda_lecture_id_to_meeting_resolutions_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::table('meeting_resolutions', function (Blueprint $table) {
            $table->foreignId('meeting_agenda_lecture_id')->nullable()->after('meeting_agenda_section_id')->constrained('meeting_agenda_lectures')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::table('meeting_resolutions', function (Blueprint $table) {
            $table->dropForeign(['meeting_agenda_lecture_id']);
            $table->dropColumn('meeting_agenda_lecture_id');
        });
    }
};
</file>

<file path="database/migrations/2025_05_02_161719_create_meeting_resolution_types_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_resolution_types', function (Blueprint $table) {
            $table->id();
            $table->foreignId('committee_category_id')->constrained('committee_categories')->onDelete('cascade');
            $table->foreignId('meeting_type_id')->constrained('meeting_types')->onDelete('cascade');
            $table->string('meeting_no');
            $table->string('meeting_year', 4);
            $table->date('meeting_date');
            $table->string('name');
            $table->string('agenda_title');
            $table->text('resolution_text');
            $table->string('document')->nullable();
            $table->enum('task_status', ['completed', 'in_progress', 'not_started'])->default('not_started');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_resolution_types');
    }
};
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/add_meeting_resolution.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มรายงานมติการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มรายงานมติการประชุม</h5>
                <form id="meetingResolutionForm" action="{{ route('store.meeting.resolution') }}" method="post" class="row g-3" enctype="multipart/form-data">
                    @csrf
                    @if ($errors->any())
                        <div class="alert alert-danger">
                            <ul>
                                @foreach ($errors->all() as $error)
                                    <li>{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif
                    <div class="col-md-12">
                        <div class="card border-0 shadow-none bg-light">
                            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                <h6 class="mb-0 text-white">ข้อมูลการประชุม</h6>
                                <div class="header-elements">
                                    <i class="bx bx-info-circle text-white"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <label for="meeting_type_id" class="form-label">1. เลือกประเภทการประชุม</label>
                                        <select name="meeting_type_id" id="meeting_type_id" class="form-select mb-3" required>
                                            <option selected="" disabled>เลือกประเภทการประชุม</option>
                                            @foreach ($meetingTypes as $type)
                                                <option value="{{ $type->id }}">{{ $type->name }}</option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="committee_category_id" class="form-label">2. เลือกประเภทคณะกรรมการ</label>
                                        <select name="committee_category_id" id="committee_category_id" class="form-select mb-3" required>
                                            <option selected="" disabled>เลือกประเภทคณะกรรมการ</option>
                                            @foreach ($committeeCategories as $committee)
                                                <option value="{{ $committee->id }}">{{ $committee->name }}</option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="meeting_agenda_id" class="form-label">3. เลือกชื่อรายงานการประชุม</label>
                                        <select name="meeting_agenda_id" id="meeting_agenda_id" class="form-select mb-3" required disabled>
                                            <option selected="" disabled>เลือกชื่อรายงานการประชุม</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="meeting_agenda_section_id" class="form-label">4. เลือกวาระการประชุม</label>
                                        <select name="meeting_agenda_section_id" id="meeting_agenda_section_id" class="form-select mb-3" required disabled>
                                            <option selected="" disabled>เลือกวาระการประชุม</option>
                                        </select>
                                    </div>
                                    <!-- เพิ่มหลังจาก dropdown เลือก section -->
                                    <div class="form-group col-md-6">
                                        <label for="meeting_agenda_lecture_id" class="form-label">5. เลือกหัวข้อย่อย</label>
                                        <select name="meeting_agenda_lecture_id" id="meeting_agenda_lecture_id" class="form-select mb-3" required disabled>
                                            <option value="">-- เลือกหัวข้อย่อย --</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="proposer" class="form-label">ผู้เสนอวาระ :</label>
                                        <input type="text" name="proposer" id="proposer" class="form-control" required>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="document" class="form-label">เอกสารประกอบการประชุม :</label>
                                        <div class="input-group">
                                            <input type="file" name="document" id="document" class="form-control">
                                            <button class="btn btn-outline-secondary" type="button">
                                                <i class="bx bx-paperclip"></i>
                                            </button>
                                        </div>
                                        <small class="text-muted mt-1 d-block">รองรับไฟล์: PDF, Word, Excel, PowerPoint, รูปภาพ (ขนาดไม่เกิน 10MB)</small>
                                        <div id="document-preview" class="mt-2 d-none">
                                            <div class="alert alert-info d-flex align-items-center">
                                                <i class="bx bx-file me-2"></i>
                                                <span id="document-name"></span>
                                                <button type="button" class="btn-close ms-auto" id="remove-document"></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 mt-3">
                        <div class="card border-0 shadow-none bg-light">
                            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                <h6 class="mb-0 text-white">มติที่ประชุม</h6>
                                <div class="header-elements">
                                    <i class="bx bx-info-circle text-white"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="form-group col-md-12">
                                        <label for="resolution_text" class="form-label">มติที่ประชุม :</label>
                                        <textarea name="resolution_text" id="resolution_text" class="form-control" rows="8" required></textarea>
                                    </div>
                                    {{-- <div class="form-group col-md-12">
                                        <label for="resolution_text" class="form-label">มติที่ประชุม :</label>
                                        <textarea name="resolution_text" id="resolution_text" class="form-control" rows="8" required></textarea>
                                    </div> --}}
                                    <div class="form-group col-md-6">
                                        <label for="resolution_date" class="form-label">วันที่มีมติ</label>
                                        <input type="date" name="resolution_date" id="resolution_date" class="form-control" required>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="resolution_status" class="form-label">สถานะมติ</label>
                                        <select name="resolution_status" id="resolution_status" class="form-select mb-3" required>
                                            <option value="approved">อนุมัติ</option>
                                            <option value="rejected">ไม่อนุมัติ</option>
                                            <option value="pending">รอพิจารณา</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <hr class="my-4" style="border-top: 1px solid #ddd; opacity: 0.7;">
                    </div>
                    <!-- เพิ่มส่วนการดำเนินการที่ได้รับมอบหมาย -->
                    <div class="col-md-12 mt-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                <h6 class="mb-0 text-white">การดำเนินการที่ได้รับมอบหมาย</h6>
                                <div class="header-elements">
                                    <i class="bx bx-info-circle text-white"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="form-group col-md-12 mb-3">
                                    <label for="task_title" class="form-label">เรื่อง :</label>
                                    <input type="text" name="task_title" id="task_title" class="form-control" required>
                                </div>
                                <div class="form-group col-md-12 mb-3">
                                    <label for="responsible_person" class="form-label">ผู้รับผิดชอบ :</label>
                                    <input type="text" name="responsible_person" id="responsible_person" class="form-control" required>
                                </div>
                                <div class="form-group col-md-12 mb-3">
                                    <label class="form-label">ผลการดำเนินงาน :</label>
                                    <div class="d-flex gap-4 mt-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="task_status" id="task_status_completed" value="completed" checked>
                                            <label class="form-check-label" for="task_status_completed">
                                                ดำเนินการแล้ว
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="task_status" id="task_status_in_progress" value="in_progress">
                                            <label class="form-check-label" for="task_status_in_progress">
                                                อยู่ระหว่างดำเนินการ
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="task_status" id="task_status_not_started" value="not_started">
                                            <label class="form-check-label" for="task_status_not_started">
                                                ยังไม่ดำเนินการ
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="report_date" class="form-label">วันที่รายงานผล :</label>
                                    <input type="date" name="report_date" id="report_date" class="form-control" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 mt-4">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="bx bx-save me-1"></i> บันทึก
                            </button>
                            <a href="{{ route('all.meeting.resolution') }}" class="btn btn-danger px-4">
                                <i class="bx bx-x-circle me-1"></i> ยกเลิก
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#committee_category_id, #meeting_type_id').change(function() {
                var committeeId = $('#committee_category_id').val();
                var meetingTypeId = $('#meeting_type_id').val();
                if (committeeId && meetingTypeId) {
                    $('#meeting_agenda_id').prop('disabled', false);
                    $.ajax({
                        url: "{{ route('get.meeting.agendas') }}",
                        type: "GET",
                        data: {
                            committee_category_id: committeeId,
                            meeting_type_id: meetingTypeId
                        },
                        success: function(data) {
                            $('#meeting_agenda_id').empty();
                            $('#meeting_agenda_id').append('<option selected disabled>เลือกชื่อรายงานการประชุม</option>');
                            $.each(data, function(key, value) {
                                $('#meeting_agenda_id').append('<option value="' + value.id + '">' + value.meeting_agenda_title + '</option>');
                            });
                        }
                    });
                } else {
                    $('#meeting_agenda_id').prop('disabled', true);
                    $('#meeting_agenda_section_id').prop('disabled', true);
                }
            });
            $('#meeting_agenda_id').change(function() {
                var meetingAgendaId = $(this).val();
                if (meetingAgendaId) {
                    $('#meeting_agenda_section_id').prop('disabled', false);
                    $.ajax({
                        url: "{{ route('get.meeting.sections') }}",
                        type: "GET",
                        data: {
                            meeting_agenda_id: meetingAgendaId
                        },
                        success: function(data) {
                            $('#meeting_agenda_section_id').empty();
                            $('#meeting_agenda_section_id').append('<option selected disabled>เลือกวาระการประชุม</option>');
                            $.each(data, function(key, value) {
                                $('#meeting_agenda_section_id').append('<option value="' + value.id + '">' + value.section_title + '</option>');
                            });
                        }
                    });
                } else {
                    $('#meeting_agenda_section_id').prop('disabled', true);
                }
            });
            $('#meeting_agenda_section_id').change(function() {
                var sectionId = $(this).val();
                if (sectionId) {
                    $('#meeting_agenda_lecture_id').prop('disabled', false);
                    $.ajax({
                        url: '/get-meeting-agenda-lectures/' + sectionId,
                        type: 'GET',
                        dataType: 'json',
                        success: function(data) {
                            $('#meeting_agenda_lecture_id').empty();
                            $('#meeting_agenda_lecture_id').append('<option value="">-- เลือกหัวข้อย่อย --</option>');
                            $.each(data, function(key, value) {
                                $('#meeting_agenda_lecture_id').append('<option value="' + value.id + '">' + value.lecture_title + '</option>');
                            });
                        }
                    });
                } else {
                    $('#meeting_agenda_lecture_id').empty();
                    $('#meeting_agenda_lecture_id').append('<option value="">-- เลือกหัวข้อย่อย --</option>');
                }
            });
            $('#document').change(function() {
                var file = this.files[0];
                if (file) {
                    $('#document-preview').removeClass('d-none');
                    $('#document-name').text(file.name);
                } else {
                    $('#document-preview').addClass('d-none');
                }
            });
            $('#remove-document').click(function() {
                $('#document').val('');
                $('
            });
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0');
            var yyyy = today.getFullYear();
            today = yyyy + '-' + mm + '-' + dd;
            $('#resolution_date').val(today);
            $('#report_date').val(today);
            $('#meetingResolutionForm').validate({
                rules: {
                    committee_category_id: {
                        required: true,
                    },
                    proposer: {
                        required: true,
                    },
                    meeting_type_id: {
                        required: true,
                    },
                    meeting_agenda_id: {
                        required: true,
                    },
                    meeting_agenda_section_id: {
                        required: true,
                    },
                    resolution_text: {
                        required: true,
                    },
                    resolution_date: {
                        required: true,
                    },
                    resolution_status: {
                        required: true,
                    },
                    task_title: {
                        required: true,
                    },
                    responsible_person: {
                        required: true,
                    },
                    report_date: {
                        required: true,
                    },
                },
                messages: {
                    committee_category_id: {
                        required: 'กรุณาเลือกประเภทคณะกรรมการ',
                    },
                    proposer: {
                        required: 'กรุณาระบุผู้เสนอวาระ',
                    },
                    meeting_type_id: {
                        required: 'กรุณาเลือกประเภทการประชุม',
                    },
                    meeting_agenda_id: {
                        required: 'กรุณาเลือกชื่อรายงานการประชุม',
                    },
                    meeting_agenda_section_id: {
                        required: 'กรุณาเลือกวาระการประชุม',
                    },
                    resolution_text: {
                        required: 'กรุณาระบุมติที่ประชุม',
                    },
                    resolution_date: {
                        required: 'กรุณาระบุวันที่มีมติ',
                    },
                    resolution_status: {
                        required: 'กรุณาเลือกสถานะมติ',
                    },
                    task_title: {
                        required: 'กรุณาระบุเรื่องที่ได้รับมอบหมาย',
                    },
                    responsible_person: {
                        required: 'กรุณาระบุผู้รับผิดชอบ',
                    },
                    report_date: {
                        required: 'กรุณาระบุวันที่รายงานผล',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <!-- เพิ่ม CKEditor script -->
    {{-- <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script> --}}
    <script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    <script>
        $(document).ready(function() {
            CKEDITOR.replace('resolution_text', {
                language: 'th',
                height: 300,
                toolbar: [
                    ['Bold', 'Italic', 'Underline', 'Strike', 'RemoveFormat'],
                    ['NumberedList', 'BulletedList', 'Outdent', 'Indent'],
                    ['JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock'],
                    ['Link', 'Unlink'],
                    ['FontSize', 'TextColor', 'BGColor'],
                    ['Source', 'Maximize']
                ],
                removeButtons: 'PasteFromWord'
            });
            $('#meetingResolutionForm').submit(function() {
                for (instance in CKEDITOR.instances) {
                    CKEDITOR.instances[instance].updateElement();
                }
            });
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/all_meeting_resolution.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">รายการมติการประชุมทั้งหมด</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting.resolution') }}" class="btn btn-primary"><i class="bx bx-plus-circle"></i> เพิ่มมติการประชุม</a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <@php
            function formatThaiDate($dateString) {
                $months = [
                    'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',
                    'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'
                ];
                $date = new DateTime($dateString);
                $day = $date->format('d');
                $month = $months[$date->format('n') - 1];
                $year = $date->format('Y') + 543;
                return $day . ' ' . $month . ' ' . $year;
            }
        @endphp
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                {{-- <th>ประเภทคณะกรรมการ</th> --}}
                                <th>ประเภทการประชุม</th>
                                <th>รายงานการประชุม</th>
                                <th>วาระการประชุม</th>
                                {{-- <th>เรื่องที่ได้รับมอบหมาย</th> --}}
                                {{-- <th>ผู้รับผิดชอบ</th> --}}
                                <th>สถานะมติ</th>
                                <th>สถานะงาน</th>
                                <th>วันที่มีมติ</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach($meeting_resolutions as $key => $item)
                            <tr>
                                <td>{{ $key+1 }}</td>
                                {{-- <td>{{ $item->committeeCategory->name }}</td> --}}
                                <td>{{ $item->meetingType->name }}</td>
                                <td>{{ $item->meetingAgenda->meeting_agenda_title }}</td>
                                <td>{{ $item->meetingAgendaSection->section_title }}</td>
                                {{-- <td>{{ $item->task_title }}</td> --}}
                                {{-- <td>{{ $item->responsible_person }}</td> --}}
                                <td>
                                    @if($item->resolution_status == 'approved')
                                        <span class="badge bg-success">อนุมัติ</span>
                                    @elseif($item->resolution_status == 'rejected')
                                        <span class="badge bg-danger">ไม่อนุมัติ</span>
                                    @else
                                        <span class="badge bg-warning">รอพิจารณา</span>
                                    @endif
                                </td>
                                <td>
                                    @if($item->task_status == 'completed')
                                        <span class="badge bg-success">ดำเนินการแล้ว</span>
                                    @elseif($item->task_status == 'in_progress')
                                        <span class="badge bg-warning">อยู่ระหว่างดำเนินการ</span>
                                    @else
                                        <span class="badge bg-danger">ยังไม่ดำเนินการ</span>
                                    @endif
                                </td>
                                <td>{{ formatThaiDate($item->resolution_date) }}</td>
                                <td>
                                    <div class="d-flex">
                                        <a href="{{ route('edit.meeting.resolution', $item->id) }}" class="btn btn-info btn-sm me-2" title="แก้ไข">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="{{ route('delete.meeting.resolution', $item->id) }}" class="btn btn-danger btn-sm" id="delete" title="ลบ">
                                            <i class="fas fa-trash-alt"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/edit_meeting_resolution.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขรายงานมติการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขรายงานมติการประชุม</h5>
                <form id="meetingResolutionForm" action="{{ route('update.meeting.resolution') }}" method="post" class="row g-3" enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $resolution->id }}">
                    @if ($errors->any())
                        <div class="alert alert-danger">
                            <ul>
                                @foreach ($errors->all() as $error)
                                    <li>{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif
                    <div class="col-md-12">
                        <div class="card border-0 shadow-none bg-light">
                            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                <h6 class="mb-0 text-white">ข้อมูลการประชุม</h6>
                                <div class="header-elements">
                                    <i class="bx bx-info-circle text-white"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <label for="meeting_type_id" class="form-label">1. เลือกประเภทการประชุม</label>
                                        <select name="meeting_type_id" id="meeting_type_id" class="form-select mb-3" required>
                                            <option value="" disabled>เลือกประเภทการประชุม</option>
                                            @foreach($meetingTypes as $meetingType)
                                                <option value="{{ $meetingType->id }}" {{ $resolution->meeting_type_id == $meetingType->id ? 'selected' : '' }}>
                                                    {{ $meetingType->name }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="committee_category_id" class="form-label">2. เลือกประเภทคณะกรรมการ</label>
                                        <select name="committee_category_id" id="committee_category_id" class="form-select mb-3" required>
                                            <option value="" disabled>เลือกประเภทคณะกรรมการ</option>
                                            @foreach($committeeCategories as $committeeCategory)
                                                <option value="{{ $committeeCategory->id }}" {{ $resolution->committee_category_id == $committeeCategory->id ? 'selected' : '' }}>
                                                    {{ $committeeCategory->name }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="meeting_agenda_id" class="form-label">3. เลือกชื่อรายงานการประชุม</label>
                                        <select name="meeting_agenda_id" id="meeting_agenda_id" class="form-select mb-3" required>
                                            <option value="" disabled>เลือกชื่อรายงานการประชุม</option>
                                            @foreach($meetingAgendas as $meetingAgenda)
                                                <option value="{{ $meetingAgenda->id }}" {{ $resolution->meeting_agenda_id == $meetingAgenda->id ? 'selected' : '' }}>
                                                    {{ $meetingAgenda->meeting_agenda_title }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="meeting_agenda_section_id" class="form-label">4. เลือกวาระการประชุม</label>
                                        <select name="meeting_agenda_section_id" id="meeting_agenda_section_id" class="form-select mb-3" required>
                                            <option value="" disabled>เลือกวาระการประชุม</option>
                                            @foreach($meetingSections as $meetingSection)
                                                <option value="{{ $meetingSection->id }}" {{ $resolution->meeting_agenda_section_id == $meetingSection->id ? 'selected' : '' }}>
                                                    {{ $meetingSection->section_title }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <!-- เพิ่มหลังจาก dropdown เลือก section -->
                                    <div class="form-group col-md-6">
                                        <label for="meeting_agenda_lecture_id" class="form-label">5. เลือกหัวข้อย่อย</label>
                                        <select name="meeting_agenda_lecture_id" id="meeting_agenda_lecture_id" class="form-select mb-3">
                                            <option value="">-- เลือกหัวข้อย่อย --</option>
                                            @foreach($meetingLectures as $lecture)
                                                <option value="{{ $lecture->id }}" {{ $resolution->meeting_agenda_lecture_id == $lecture->id ? 'selected' : '' }}>
                                                    {{ $lecture->lecture_title }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="proposer" class="form-label">5. ผู้เสนอวาระ</label>
                                        <input type="text" name="proposer" id="proposer" class="form-control" value="{{ $resolution->proposer }}" required>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="document" class="form-label">6. เอกสารประกอบการประชุม (ถ้ามี)</label>
                                        <input type="file" name="document" id="document" class="form-control">
                                        <div class="form-text">รองรับไฟล์: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, JPG, JPEG, PNG (ขนาดไม่เกิน 10MB)</div>
                                        <input type="hidden" name="remove_document" id="remove_document_flag" value="0">
                                        @if($resolution->document)
                                            <div class="mt-2" id="current-document">
                                                <div class="d-flex align-items-center p-2 border rounded">
                                                    <i class="bx bx-file me-2"></i>
                                                    <span>เอกสารปัจจุบัน: <a href="{{ asset($resolution->document) }}" target="_blank">ดูเอกสาร</a></span>
                                                    <button type="button" id="delete-document" class="btn btn-sm btn-link text-danger ms-auto">
                                                        <i class="bx bx-trash"></i> ลบเอกสาร
                                                    </button>
                                                </div>
                                            </div>
                                        @endif
                                        <div class="mt-2 d-none" id="document-preview">
                                            <div class="d-flex align-items-center p-2 border rounded">
                                                <i class="bx bx-file me-2"></i>
                                                <span id="document-name"></span>
                                                <button type="button" id="remove-document" class="btn btn-sm btn-link text-danger ms-auto">
                                                    <i class="bx bx-x"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 mt-3">
                        <div class="card border-0 shadow-none bg-light">
                            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                <h6 class="mb-0 text-white">มติที่ประชุม</h6>
                                <div class="header-elements">
                                    <i class="bx bx-info-circle text-white"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="form-group col-md-12">
                                        <label for="resolution_text" class="form-label">มติที่ประชุม :</label>
                                        <textarea name="resolution_text" id="resolution_text" class="form-control" rows="8" required>{{ $resolution->resolution_text }}</textarea>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="resolution_date" class="form-label">วันที่มีมติ</label>
                                        <input type="date" name="resolution_date" id="resolution_date" class="form-control" value="{{ $resolution->resolution_date }}" required>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="resolution_status" class="form-label">สถานะมติ</label>
                                        <select name="resolution_status" id="resolution_status" class="form-select mb-3" required>
                                            <option value="approved" {{ $resolution->resolution_status == 'approved' ? 'selected' : '' }}>อนุมัติ</option>
                                            <option value="rejected" {{ $resolution->resolution_status == 'rejected' ? 'selected' : '' }}>ไม่อนุมัติ</option>
                                            <option value="pending" {{ $resolution->resolution_status == 'pending' ? 'selected' : '' }}>รอพิจารณา</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <hr class="my-4" style="border-top: 1px solid #ddd; opacity: 0.7;">
                    </div>
                    <!-- ส่วนการดำเนินการที่ได้รับมอบหมาย -->
                    <div class="col-md-12 mt-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                <h6 class="mb-0 text-white">การดำเนินการที่ได้รับมอบหมาย</h6>
                                <div class="header-elements">
                                    <i class="bx bx-info-circle text-white"></i>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="form-group col-md-12 mb-3">
                                    <label for="task_title" class="form-label">เรื่อง :</label>
                                    <input type="text" name="task_title" id="task_title" class="form-control" value="{{ $resolution->task_title }}" required>
                                </div>
                                <div class="form-group col-md-12 mb-3">
                                    <label for="responsible_person" class="form-label">ผู้รับผิดชอบ :</label>
                                    <input type="text" name="responsible_person" id="responsible_person" class="form-control" value="{{ $resolution->responsible_person }}" required>
                                </div>
                                <div class="form-group col-md-12 mb-3">
                                    <label class="form-label">ผลการดำเนินงาน :</label>
                                    <div class="d-flex gap-4 mt-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="task_status" id="task_status_completed" value="completed" {{ $resolution->task_status == 'completed' ? 'checked' : '' }}>
                                            <label class="form-check-label" for="task_status_completed">
                                                ดำเนินการแล้ว
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="task_status" id="task_status_in_progress" value="in_progress" {{ $resolution->task_status == 'in_progress' ? 'checked' : '' }}>
                                            <label class="form-check-label" for="task_status_in_progress">
                                                อยู่ระหว่างดำเนินการ
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="task_status" id="task_status_not_started" value="not_started" {{ $resolution->task_status == 'not_started' ? 'checked' : '' }}>
                                            <label class="form-check-label" for="task_status_not_started">
                                                ยังไม่ดำเนินการ
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="report_date" class="form-label">วันที่รายงานผล :</label>
                                    <input type="date" name="report_date" id="report_date" class="form-control" value="{{ $resolution->report_date }}" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 mt-4">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="bx bx-save me-1"></i> บันทึกการแก้ไข
                            </button>
                            <a href="{{ route('all.meeting.resolution') }}" class="btn btn-danger px-4">
                                <i class="bx bx-x-circle me-1"></i> ยกเลิก
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#committee_category_id, #meeting_type_id').change(function() {
                var committeeId = $('#committee_category_id').val();
                var meetingTypeId = $('#meeting_type_id').val();
                if (committeeId && meetingTypeId) {
                    $('#meeting_agenda_id').prop('disabled', false);
                    $.ajax({
                        url: "{{ route('get.meeting.agendas') }}",
                        type: "GET",
                        data: {
                            committee_category_id: committeeId,
                            meeting_type_id: meetingTypeId
                        },
                        success: function(data) {
                            $('#meeting_agenda_id').empty();
                            $('#meeting_agenda_id').append('<option selected disabled>เลือกชื่อรายงานการประชุม</option>');
                            $.each(data, function(key, value) {
                                $('#meeting_agenda_id').append('<option value="' + value.id + '">' + value.meeting_agenda_title + '</option>');
                            });
                            $('#meeting_agenda_id').val('{{ $resolution->meeting_agenda_id }}');
                            $('#meeting_agenda_id').trigger('change');
                        }
                    });
                } else {
                    $('#meeting_agenda_id').prop('disabled', true);
                    $('#meeting_agenda_section_id').prop('disabled', true);
                }
            });
            $('#meeting_agenda_id').change(function() {
                var meetingAgendaId = $(this).val();
                if (meetingAgendaId) {
                    $('#meeting_agenda_section_id').prop('disabled', false);
                    $.ajax({
                        url: "{{ route('get.meeting.sections') }}",
                        type: "GET",
                        data: {
                            meeting_agenda_id: meetingAgendaId
                        },
                        success: function(data) {
                            $('#meeting_agenda_section_id').empty();
                            $('#meeting_agenda_section_id').append('<option selected disabled>เลือกวาระการประชุม</option>');
                            $.each(data, function(key, value) {
                                $('#meeting_agenda_section_id').append('<option value="' + value.id + '">' + value.section_title + '</option>');
                            });
                            $('#meeting_agenda_section_id').val('{{ $resolution->meeting_agenda_section_id }}');
                        }
                    });
                } else {
                    $('#meeting_agenda_section_id').prop('disabled', true);
                }
            });
            $('#meeting_agenda_section_id').change(function() {
                var sectionId = $(this).val();
                if (sectionId) {
                    $.ajax({
                        url: '/get-meeting-agenda-lectures/' + sectionId,
                        type: 'GET',
                        dataType: 'json',
                        success: function(data) {
                            $('#meeting_agenda_lecture_id').empty();
                            $('#meeting_agenda_lecture_id').append('<option value="">-- เลือกหัวข้อย่อย --</option>');
                            $.each(data, function(key, value) {
                                $('#meeting_agenda_lecture_id').append('<option value="' + value.id + '">' + value.lecture_title + '</option>');
                            });
                        }
                    });
                } else {
                    $('#meeting_agenda_lecture_id').empty();
                    $('#meeting_agenda_lecture_id').append('<option value="">-- เลือกหัวข้อย่อย --</option>');
                }
            });
            $('#document').change(function() {
                var file = this.files[0];
                if (file) {
                    $('#current-document').addClass('d-none');
                    $('#document-preview').removeClass('d-none');
                    $('#document-name').text(file.name);
                } else {
                    $('#document-preview').addClass('d-none');
                    $('#current-document').removeClass('d-none');
                }
            });
           $('#document').change(function() {
                if (this.files.length > 0) {
                    $('#document-name').text(this.files[0].name);
                    $('#document-preview').removeClass('d-none');
                    $('#current-document').addClass('d-none');
                    $('#remove_document_flag').val('0');
                }
            });
            $('#remove-document').click(function() {
                $('#document').val('');
                $('
                $('#current-document').removeClass('d-none');
                $('#remove_document_flag').val('0');
            });
            $('#delete-document').click(function() {
                if (confirm('คุณต้องการลบเอกสารนี้ใช่หรือไม่?')) {
                    $('#current-document').addClass('d-none');
                    $('#remove_document_flag').val('1');
                    $('#document').val(''); // ล้างค่าไฟล์ที่อาจเลือกไว้
                    $('
                }
            });
            $('#meetingResolutionForm').validate({
                rules: {
                    committee_category_id: {
                        required: true,
                    },
                    meeting_type_id: {
                        required: true,
                    },
                    meeting_agenda_id: {
                        required: true,
                    },
                    meeting_agenda_section_id: {
                        required: true,
                    },
                    proposer: {
                        required: true,
                    },
                    resolution_text: {
                        required: true,
                    },
                    resolution_date: {
                        required: true,
                    },
                    resolution_status: {
                        required: true,
                    },
                    task_title: {
                        required: true,
                    },
                    responsible_person: {
                        required: true,
                    },
                    task_status: {
                        required: true,
                    },
                    report_date: {
                        required: true,
                    }
                },
                messages: {
                    committee_category_id: {
                        required: 'กรุณาเลือกประเภทคณะกรรมการ',
                    },
                    meeting_type_id: {
                        required: 'กรุณาเลือกประเภทการประชุม',
                    },
                    meeting_agenda_id: {
                        required: 'กรุณาเลือกชื่อรายงานการประชุม',
                    },
                    meeting_agenda_section_id: {
                        required: 'กรุณาเลือกวาระการประชุม',
                    },
                    proposer: {
                        required: 'กรุณาระบุผู้เสนอวาระ',
                    },
                    resolution_text: {
                        required: 'กรุณาระบุมติที่ประชุม',
                    },
                    resolution_date: {
                        required: 'กรุณาระบุวันที่มีมติ',
                    },
                    resolution_status: {
                        required: 'กรุณาเลือกสถานะมติ',
                    },
                    task_title: {
                        required: 'กรุณาระบุเรื่องที่ได้รับมอบหมาย',
                    },
                    responsible_person: {
                        required: 'กรุณาระบุผู้รับผิดชอบ',
                    },
                    task_status: {
                        required: 'กรุณาเลือกผลการดำเนินงาน',
                    },
                    report_date: {
                        required: 'กรุณาระบุวันที่รายงานผล',
                    }
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <!-- เพิ่ม CKEditor script -->
    {{-- <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script> --}}
    <script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    <script>
        $(document).ready(function() {
            CKEDITOR.replace('resolution_text', {
                language: 'th',
                height: 300,
                toolbar: [
                    ['Bold', 'Italic', 'Underline', 'Strike', 'RemoveFormat'],
                    ['NumberedList', 'BulletedList', 'Outdent', 'Indent'],
                    ['JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock'],
                    ['Link', 'Unlink'],
                    ['FontSize', 'TextColor', 'BGColor'],
                    ['Source', 'Maximize']
                ],
                removeButtons: 'PasteFromWord'
            });
            $('#meetingResolutionForm').submit(function() {
                for (instance in CKEDITOR.instances) {
                    CKEDITOR.instances[instance].updateElement();
                }
            });
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/search_meeting_resolution.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<@php
    function formatThaiDate($dateString) {
        $months = [
            'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',
            'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'
        ];
        $date = new DateTime($dateString);
        $day = $date->format('d');
        $month = $months[$date->format('n') - 1];
        $year = $date->format('Y') + 543;
        return $day . ' ' . $month . ' ' . $year;
    }
@endphp
<div class="page-content">
    <!--breadcrumb-->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
        <div class="ps-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 p-0">
                    <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">สืบค้นข้อมูลมติการประชุม</li>
                </ol>
            </nav>
        </div>
    </div>
    <!--end breadcrumb-->
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-none bg-transparent">
                        <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                            <h5 class="mb-0 text-white">
                                <i class="bx bx-search-alt me-2"></i> สืบค้นข้อมูลมติการประชุม
                            </h5>
                            <button class="btn btn-light btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#searchForm" aria-expanded="{{ request()->has('keyword') || request()->has('committee_category_id') ? 'false' : 'true' }}" aria-controls="searchForm">
                                <i class="bx bx-filter-alt"></i> {{ request()->has('keyword') || request()->has('committee_category_id') ? 'แสดงฟอร์มค้นหา' : 'ซ่อนฟอร์มค้นหา' }}
                            </button>
                        </div>
                        <div class="card-body bg-light rounded-bottom collapse {{ request()->has('keyword') || request()->has('committee_category_id') ? '' : 'show' }}" id="searchForm">
                            <form action="{{ route('search.meeting.resolution.results') }}" method="get" id="resolutionSearchForm" class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="meeting_type_id" class="form-label">ประเภทการประชุม</label>
                                        <select name="meeting_type_id" id="meeting_type_id" class="form-select">
                                            <option value="">-- เลือกทั้งหมด --</option>
                                            @foreach($meetingTypes as $type)
                                                <option value="{{ $type->id }}" {{ (isset($_GET['meeting_type_id']) && $_GET['meeting_type_id'] == $type->id) ? 'selected' : '' }}>
                                                    {{ $type->name }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="committee_category_id" class="form-label">ประเภทคณะกรรมการ</label>
                                        <select name="committee_category_id" id="committee_category_id" class="form-select">
                                            <option value="">-- เลือกทั้งหมด --</option>
                                            @foreach($committeeCategories as $category)
                                                <option value="{{ $category->id }}" {{ (isset($_GET['committee_category_id']) && $_GET['committee_category_id'] == $category->id) ? 'selected' : '' }}>
                                                    {{ $category->name }}
                                                </option>
                                            @endforeach
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="meeting_agenda_id" class="form-label">รายงานการประชุม</label>
                                        <select name="meeting_agenda_id" id="meeting_agenda_id" class="form-select" {{ (!isset($_GET['committee_category_id']) || !isset($_GET['meeting_type_id'])) ? 'disabled' : '' }}>
                                            <option value="">-- เลือกทั้งหมด --</option>
                                            <!-- จะถูกเติมด้วย Ajax -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="meeting_agenda_section_id" class="form-label">วาระการประชุม</label>
                                        <select name="meeting_agenda_section_id" id="meeting_agenda_section_id" class="form-select" {{ !isset($_GET['meeting_agenda_id']) ? 'disabled' : '' }}>
                                            <option value="">-- เลือกทั้งหมด --</option>
                                            <!-- จะถูกเติมด้วย Ajax -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="meeting_agenda_lecture_id" class="form-label">หัวข้อย่อย</label>
                                        <select name="meeting_agenda_lecture_id" id="meeting_agenda_lecture_id" class="form-select" {{ !isset($_GET['meeting_agenda_section_id']) ? 'disabled' : '' }}>
                                            <option value="">-- เลือกทั้งหมด --</option>
                                            <!-- จะถูกเติมด้วย Ajax -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group mb-3">
                                        <label for="keyword" class="form-label">คำค้นหา</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-transparent"><i class="bx bx-search"></i></span>
                                            <input type="text" name="keyword" id="keyword" class="form-control" placeholder="ค้นหาจากมติที่ประชุม, เรื่อง, ผู้รับผิดชอบ หรือผู้เสนอวาระ" value="{{ isset($_GET['keyword']) ? $_GET['keyword'] : '' }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        <label for="task_status" class="form-label">สถานะงาน</label>
                                        <select name="task_status" id="task_status" class="form-select">
                                            <option value="">-- ทั้งหมด --</option>
                                            <option value="completed" {{ (isset($_GET['task_status']) && $_GET['task_status'] == 'completed') ? 'selected' : '' }}>ดำเนินการแล้ว</option>
                                            <option value="in_progress" {{ (isset($_GET['task_status']) && $_GET['task_status'] == 'in_progress') ? 'selected' : '' }}>อยู่ระหว่างดำเนินการ</option>
                                            <option value="not_started" {{ (isset($_GET['task_status']) && $_GET['task_status'] == 'not_started') ? 'selected' : '' }}>ยังไม่ดำเนินการ</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        <label for="start_date" class="form-label">วันที่มีมติ (จาก)</label>
                                        <input type="date" name="start_date" id="start_date" class="form-control" value="{{ isset($_GET['start_date']) ? $_GET['start_date'] : '' }}">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        <label for="end_date" class="form-label">วันที่มีมติ (ถึง)</label>
                                        <input type="date" name="end_date" id="end_date" class="form-control" value="{{ isset($_GET['end_date']) ? $_GET['end_date'] : '' }}">
                                    </div>
                                </div>
                                <div class="col-12 text-center mt-4">
                                    <button type="submit" class="btn btn-success px-5 py-2">
                                        <i class="bx bx-search me-1"></i> ค้นหา
                                    </button>
                                    <button type="button" id="resetBtn" class="btn btn-outline-danger px-5 py-2 ms-2">
                                        <i class="bx bx-reset me-1"></i> ล้างข้อมูล
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ส่วนแสดงผลการค้นหา -->
    @if(isset($meeting_resolutions) && count($meeting_resolutions) > 0)
    <div class="mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">
                <i class="bx bx-list-ul me-1"></i> ผลการค้นหามติการประชุม
            </h5>
            <span class="badge bg-primary rounded-pill">พบข้อมูล {{ count($meeting_resolutions) }} รายการ</span>
        </div>
        @foreach($meeting_resolutions as $key => $item)
        <div class="card mb-3 border-0 shadow-sm">
            <div class="card-body">
                <h5 class="card-title border-bottom pb-2">
                    @if(isset($_GET['keyword']) && $_GET['keyword'])
                        {!! highlightKeyword($item->meetingAgenda->meeting_agenda_title, $_GET['keyword']) !!} ครั้งที่ {{ $item->meetingAgenda->meeting_agenda_number }}/{{ $item->meetingAgenda->meeting_agenda_year }}
                    @else
                        {{ $item->meetingAgenda->meeting_agenda_title }} ครั้งที่ {{ $item->meetingAgenda->meeting_agenda_number }}/{{ $item->meetingAgenda->meeting_agenda_year }}
                    @endif
                </h5>
                <div class="row mt-2">
                    <div class="col-md-12">
                        {{-- <p>วาระที่ {{ $key+1 }} --}}
                        <p>
                            @if(isset($_GET['keyword']) && $_GET['keyword'])
                                {!! highlightKeyword($item->meetingAgendaSection->section_title, $_GET['keyword']) !!}
                            @else
                                {{ $item->meetingAgendaSection->section_title }}
                            @endif
                        </p>
                        <p>หัวข้อย่อย :
                            @if($item->meetingAgendaLecture)
                                {{ $item->meetingAgendaLecture->lecture_title }}
                            @else
                                ไม่มีหัวข้อย่อย
                            @endif
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <p class="fw-bold mb-1">เอกสารประกอบการประชุม :
                            @if($item->document)
                            <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#documentModal{{ $item->id }}">
                                <i class="bx bx-file"></i> เอกสารที่แนบ
                            </button>
                            @else
                            ไม่มีเอกสารแนบ
                            @endif
                        </p>
                    </div>
                </div>
                <!-- Modal แสดงเอกสารประกอบการประชุม -->
                @if($item->document)
                <div class="modal fade" id="documentModal{{ $item->id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                <h5 class="modal-title text-white text-center w-100">เอกสารแนบ - รายงานการประชุม</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-0" style="height: 80vh;">
                                @php
                                    $fileExtension = pathinfo($item->document, PATHINFO_EXTENSION);
                                @endphp
                                @if(in_array(strtolower($fileExtension), ['jpg', 'jpeg', 'png', 'gif']))
                                    <img src="{{ asset($item->document) }}" class="img-fluid w-100" alt="เอกสารประกอบการประชุม">
                                @elseif(strtolower($fileExtension) === 'pdf')
                                    <iframe src="{{ asset($item->document) }}" width="100%" height="100%" frameborder="0"></iframe>
                                @else
                                    <div class="p-5 text-center">
                                        <i class="bx bx-file fs-1 mb-3 text-primary"></i>
                                        <h5>ไม่สามารถแสดงตัวอย่างเอกสารได้</h5>
                                        <p class="mb-4">ประเภทเอกสาร: {{ strtoupper($fileExtension) }}</p>
                                        <a href="{{ asset($item->document) }}" class="btn btn-primary" download>
                                            <i class="bx bx-download me-1"></i> ดาวน์โหลดเอกสาร
                                        </a>
                                    </div>
                                @endif
                            </div>
                            <div class="modal-footer">
                                <a href="{{ asset($item->document) }}" class="btn btn-success" download>
                                    <i class="bx bx-download me-1"></i> ดาวน์โหลด
                                </a>
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
                            </div>
                        </div>
                    </div>
                </div>
                @endif
                <div class="row">
                    <div class="col-md-12">
                        <p class="fw-bold mb-1">ผู้เสนอวาระ :
                            @if(isset($_GET['keyword']) && $_GET['keyword'])
                                {!! highlightKeyword($item->proposer, $_GET['keyword']) !!}
                            @else
                                {{ $item->proposer }}
                            @endif
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <p class="fw-bold mb-1">มติที่ประชุม :</p>
                        <div>
                            @if(isset($_GET['keyword']) && $_GET['keyword'])
                                {!! highlightKeyword($item->resolution_text, $_GET['keyword']) !!}
                            @else
                                {!! $item->resolution_text !!}
                            @endif
                        </div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-12">
                        <p class="fw-bold mb-1">การดำเนินงานที่ได้รับมอบหมาย</p>
                        <p><b>เรื่อง :</b>
                            @if(isset($_GET['keyword']) && $_GET['keyword'])
                                {!! highlightKeyword($item->task_title, $_GET['keyword']) !!}
                            @else
                                {{ $item->task_title }}
                            @endif
                        </p>
                        <p><b>ผู้รับผิดชอบ :</b>
                            @if(isset($_GET['keyword']) && $_GET['keyword'])
                                {!! highlightKeyword($item->responsible_person, $_GET['keyword']) !!}
                            @else
                                {{ $item->responsible_person }}
                            @endif
                        </p>
                        <p><b>ผลการดำเนินงาน :</b>
                            @if($item->task_status == 'completed')
                                <span class="badge bg-success">ดำเนินการแล้ว</span>
                            @elseif($item->task_status == 'in_progress')
                                <span class="badge bg-warning text-dark">อยู่ระหว่างดำเนินการ</span>
                            @else
                                <span class="badge bg-danger">ยังไม่ดำเนินการ</span>
                            @endif
                        </p>
                        <p><b>วันที่รายงานผล :</b> {{ formatThaiDate($item->report_date) }}</p>
                    </div>
                </div>
                {{-- <div class="text-end mt-3">
                    <a href="{{ route('edit.meeting.resolution', $item->id) }}" class="btn btn-sm btn-primary">
                        <i class="bx bx-edit"></i> แก้ไข
                    </a>
                    <a href="{{ route('delete.meeting.resolution', $item->id) }}" class="btn btn-sm btn-danger" onclick="return confirm('คุณต้องการลบรายการนี้ใช่หรือไม่?')">
                        <i class="bx bx-trash"></i> ลบ
                    </a>
                </div> --}}
            </div>
        </div>
        @endforeach
    </div>
    @elseif(isset($meeting_resolutions) && count($meeting_resolutions) == 0)
    <div class="alert alert-info text-center py-4 mt-4">
        <i class="bx bx-info-circle fs-3 mb-2"></i>
        <h5>ไม่พบข้อมูลตามเงื่อนไขที่ค้นหา</h5>
        <p class="mb-0">กรุณาปรับเปลี่ยนเงื่อนไขการค้นหาและลองใหม่อีกครั้ง</p>
    </div>
    @endif
</div>
<?php
function highlightKeyword($text, $keyword) {
    if (!$keyword) return $text;
    $keywords = explode(' ', $keyword);
    foreach ($keywords as $word) {
        if (strlen($word) < 2) continue;
        $word = preg_quote($word, '/');
        $text = preg_replace('/(' . $word . ')/i', '<mark style="background-color: #FFFF00; padding: 0 2px;">$1</mark>', $text);
    }
    return $text;
}
?>
<script type="text/javascript">
    $(document).ready(function() {
        @if(isset($_GET['committee_category_id']) && isset($_GET['meeting_type_id']))
            var committeeId = '{{ $_GET['committee_category_id'] }}';
            var meetingTypeId = '{{ $_GET['meeting_type_id'] }}';
            if(committeeId && meetingTypeId) {
                getMeetingAgendas(committeeId, meetingTypeId, '{{ $_GET['meeting_agenda_id'] ?? '' }}');
            }
            @if(isset($_GET['meeting_agenda_id']))
                var meetingAgendaId = '{{ $_GET['meeting_agenda_id'] }}';
                if(meetingAgendaId) {
                    getMeetingSections(meetingAgendaId, '{{ $_GET['meeting_agenda_section_id'] ?? '' }}');
                }
            @endif
        @endif
        $('#committee_category_id, #meeting_type_id').change(function() {
            var committeeId = $('#committee_category_id').val();
            var meetingTypeId = $('#meeting_type_id').val();
            if (committeeId && meetingTypeId) {
                getMeetingAgendas(committeeId, meetingTypeId);
            } else {
                $('#meeting_agenda_id').prop('disabled', true).html('<option value="">-- เลือกทั้งหมด --</option>');
                $('#meeting_agenda_section_id').prop('disabled', true).html('<option value="">-- เลือกทั้งหมด --</option>');
            }
        });
        $('#meeting_agenda_id').change(function() {
            var meetingAgendaId = $(this).val();
            if (meetingAgendaId) {
                getMeetingSections(meetingAgendaId);
            } else {
                $('#meeting_agenda_section_id').prop('disabled', true).html('<option value="">-- เลือกทั้งหมด --</option>');
            }
        });
        function getMeetingAgendas(committeeId, meetingTypeId, selectedAgendaId = '') {
            // เปิดใช้งาน dropdown รายงานการประชุม
            $('
            $.ajax({
                url: "{{ route('get.meeting.agendas') }}",
                type: "GET",
                data: {
                    committee_category_id: committeeId,
                    meeting_type_id: meetingTypeId
                },
                success: function(data) {
                    $('#meeting_agenda_id').empty();
                    $('#meeting_agenda_id').append('<option value="">-- เลือกทั้งหมด --</option>');
                    $.each(data, function(key, value) {
                        var selected = (selectedAgendaId == value.id) ? 'selected' : '';
                        $('
                    });
                    if (selectedAgendaId) {
                    }
                }
            });
        }
        function getMeetingSections(meetingAgendaId, selectedSectionId = '') {
            // เปิดใช้งาน dropdown วาระการประชุม
            $('
            $.ajax({
                url: "{{ route('get.meeting.sections') }}",
                type: "GET",
                data: {
                    meeting_agenda_id: meetingAgendaId
                },
                success: function(data) {
                    $('#meeting_agenda_section_id').empty();
                    $('#meeting_agenda_section_id').append('<option value="">-- เลือกทั้งหมด --</option>');
                    $.each(data, function(key, value) {
                        var selected = (selectedSectionId == value.id) ? 'selected' : '';
                        $('
                    });
                    if (selectedSectionId) {
                        $('#meeting_agenda_section_id').trigger('change');
                    }
                }
            });
        }
        $('#meeting_agenda_section_id').change(function() {
            var sectionId = $(this).val();
            var selectedLectureId = '{{ $_GET['meeting_agenda_lecture_id'] ?? '' }}';
            if (sectionId) {
                $('#meeting_agenda_lecture_id').prop('disabled', false);
                $.ajax({
                    url: '/get-meeting-agenda-lectures/' + sectionId,
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        $('#meeting_agenda_lecture_id').empty();
                        $('#meeting_agenda_lecture_id').append('<option value="">-- เลือกหัวข้อย่อย --</option>');
                        $.each(data, function(key, value) {
                            var selected = (selectedLectureId == value.id) ? 'selected' : '';
                            $('
                        });
                    }
                });
            } else {
                $('#meeting_agenda_lecture_id').empty();
                $('#meeting_agenda_lecture_id').append('<option value="">-- เลือกหัวข้อย่อย --</option>');
            }
        });
        $('#resetBtn').click(function() {
            $('#committee_category_id').val('');
            $('
            $('#meeting_agenda_id').val('').prop('disabled', true);
            $('#meeting_agenda_section_id').val('').prop('disabled', true);
            $('#meeting_agenda_lecture_id').val('').prop('disabled', true);
            $('#keyword').val('');
            $('
            $('#start_date').val('');
            $('
        });
    });
</script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/search_meeting_resolution_results.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <!--breadcrumb-->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
        <div class="ps-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 p-0">
                    <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                    </li>
                    <li class="breadcrumb-item"><a href="{{ route('search.meeting.resolution') }}">สืบค้นข้อมูลมติการประชุม</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">ผลการค้นหา</li>
                </ol>
            </nav>
        </div>
        <div class="ms-auto">
            <a href="{{ route('search.meeting.resolution') }}" class="btn btn-outline-primary">
                <i class="bx bx-search me-1"></i> ค้นหาใหม่
            </a>
        </div>
    </div>
    <!--end breadcrumb-->
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="mb-0">
                    <i class="bx bx-list-ul me-1"></i> ผลการค้นหามติการประชุม
                </h5>
                <span class="badge bg-primary rounded-pill fs-6">พบ {{ count($meeting_resolutions) }} รายการ</span>
            </div>
            @if(count($meeting_resolutions) > 0)
            <div class="table-responsive">
                <table id="resolutionTable" class="table table-striped table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th class="text-center" width="5%">
                            <th width="20%">รายงานการประชุม</th>
                            <th width="15%">วาระการประชุม</th>
                            <th width="20%">เรื่องที่ได้รับมอบหมาย</th>
                            <th width="15%">ผู้รับผิดชอบ</th>
                            <th width="10%">สถานะงาน</th>
                            <th width="10%">วันที่มีมติ</th>
                            <th width="5%">ดูรายละเอียด</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($meeting_resolutions as $key => $item)
                        <tr>
                            <td class="text-center">{{ $key+1 }}</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="font-weight-bold">
                                        {{ $item->meetingAgenda->meeting_agenda_title }}
                                    </div>
                                </div>
                            </td>
                            <td>{{ $item->meetingAgendaSection->section_title }}</td>
                            <td>{{ $item->task_title }}</td>
                            <td>{{ $item->responsible_person }}</td>
                            <td>
                                @if($item->task_status == 'completed')
                                    <span class="badge bg-success rounded-pill">ดำเนินการแล้ว</span>
                                @elseif($item->task_status == 'in_progress')
                                    <span class="badge bg-warning rounded-pill">อยู่ระหว่างดำเนินการ</span>
                                @else
                                    <span class="badge bg-danger rounded-pill">ยังไม่ดำเนินการ</span>
                                @endif
                            </td>
                            <td>{{ \Carbon\Carbon::parse($item->resolution_date)->format('d/m/Y') }}</td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#resolutionModal{{ $item->id }}">
                                    <i class="bx bx-show"></i>
                                </button>
                            </td>
                        </tr>
                        <!-- Modal แสดงรายละเอียด -->
                        <div class="modal fade" id="resolutionModal{{ $item->id }}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                                <div class="modal-content">
                                    <div class="modal-header" style="background: linear-gradient(to right, #4e73df, #36b9cc);">
                                        <h5 class="modal-title text-white">รายละเอียดมติการประชุม</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="card border-0 shadow-none mb-3">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">ข้อมูลการประชุม</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">ประเภทคณะกรรมการ:</div>
                                                    <div class="col-md-8">{{ $item->committeeCategory->committee_category_name }}</div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">ประเภทการประชุม:</div>
                                                    <div class="col-md-8">{{ $item->meetingType->meeting_type_name }}</div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">รายงานการประชุม:</div>
                                                    <div class="col-md-8">{{ $item->meetingAgenda->meeting_agenda_title }}</div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">วาระการประชุม:</div>
                                                    <div class="col-md-8">{{ $item->meetingAgendaSection->section_title }}</div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">ผู้เสนอวาระ:</div>
                                                    <div class="col-md-8">{{ $item->proposer }}</div>
                                                </div>
                                                @if($item->document)
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">เอกสารประกอบ:</div>
                                                    <div class="col-md-8">
                                                        <a href="{{ asset($item->document) }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                            <i class="bx bx-file"></i> ดูเอกสาร
                                                        </a>
                                                    </div>
                                                </div>
                                                @endif
                                            </div>
                                        </div>
                                        <div class="card border-0 shadow-none mb-3">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">มติที่ประชุม</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row mb-2">
                                                    <div class="col-md-12">
                                                        {!! $item->resolution_text !!}
                                                    </div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">วันที่มีมติ:</div>
                                                    <div class="col-md-8">{{ \Carbon\Carbon::parse($item->resolution_date)->format('d/m/Y') }}</div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">สถานะมติ:</div>
                                                    <div class="col-md-8">
                                                        @if($item->resolution_status == 'approved')
                                                            <span class="badge bg-success">อนุมัติ</span>
                                                        @elseif($item->resolution_status == 'rejected')
                                                            <span class="badge bg-danger">ไม่อนุมัติ</span>
                                                        @else
                                                            <span class="badge bg-warning">รอพิจารณา</span>
                                                        @endif
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card border-0 shadow-none">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">การดำเนินการที่ได้รับมอบหมาย</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">เรื่อง:</div>
                                                    <div class="col-md-8">{{ $item->task_title }}</div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">ผู้รับผิดชอบ:</div>
                                                    <div class="col-md-8">{{ $item->responsible_person }}</div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">ผลการดำเนินงาน:</div>
                                                    <div class="col-md-8">
                                                        @if($item->task_status == 'completed')
                                                            <span class="badge bg-success">ดำเนินการแล้ว</span>
                                                        @elseif($item->task_status == 'in_progress')
                                                            <span class="badge bg-warning">อยู่ระหว่างดำเนินการ</span>
                                                        @else
                                                            <span class="badge bg-danger">ยังไม่ดำเนินการ</span>
                                                        @endif
                                                    </div>
                                                </div>
                                                <div class="row mb-2">
                                                    <div class="col-md-4 fw-bold">วันที่รายงานผล:</div>
                                                    <div class="col-md-8">{{ \Carbon\Carbon::parse($item->report_date)->format('d/m/Y') }}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <a href="{{ route('edit.meeting.resolution', $item->id) }}" class="btn btn-primary">
                                            <i class="bx bx-edit"></i> แก้ไข
                                        </a>
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @endforeach
                    </tbody>
                </table>
            </div>
            @else
            <div class="alert alert-info text-center py-4">
                <i class="bx bx-info-circle fs-3 mb-2"></i>
                <h5>ไม่พบข้อมูลตามเงื่อนไขที่ค้นหา</h5>
                <p class="mb-0">กรุณาปรับเปลี่ยนเงื่อนไขการค้นหาและลองใหม่อีกครั้ง</p>
            </div>
            @endif
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('#resolutionTable').DataTable({
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.25/i18n/Thai.json"
            },
            "pageLength": 10,
            "ordering": true,
            "responsive": true
        });
    });
</script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_resolution_type/add_meeting_resolution_type.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มรายงานมติที่ประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มรายงานมติที่ประชุม</h5>
                <form id="resolutionTypeForm" action="{{ route('store.meeting.resolution.type') }}" method="post" class="row g-3" enctype="multipart/form-data">
                    @csrf
                    @if ($errors->any())
                        <div class="alert alert-danger">
                            <ul>
                                @foreach ($errors->all() as $error)
                                    <li>{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif
                    <div class="col-md-12">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="committee_category_id" class="form-label">เลือกประเภทคณะกรรมการ</label>
                                <select name="committee_category_id" id="committee_category_id" class="form-select">
                                    <option selected="" disabled>เลือกประเภทคณะกรรมการ(O)</option>
                                    @foreach ($committeeCategories as $committee)
                                        <option value="{{ $committee->id }}">{{ $committee->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="meeting_type_id" class="form-label">เลือกประเภทการประชุม</label>
                                <select name="meeting_type_id" id="meeting_type_id" class="form-select">
                                    <option selected="" disabled>เลือกประเภทการประชุม(O)</option>
                                    @foreach ($meetingTypes as $type)
                                        <option value="{{ $type->id }}">{{ $type->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="meeting_no" class="form-label">การประชุม</label>
                                <div class="input-group">
                                    <span class="input-group-text">ครั้งที่</span>
                                    <input type="text" class="form-control" name="meeting_no" id="meeting_no">
                                    <span class="input-group-text">ปี</span>
                                    <input type="text" class="form-control" name="meeting_year" id="meeting_year">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="meeting_date" class="form-label">วันที่ประชุม :</label>
                                <input type="date" class="form-control" name="meeting_date" id="meeting_date">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="name" class="form-label">เพิ่มเรื่องพิจารณา</label>
                            <input type="text" name="name" id="name" class="form-control" required>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="agenda_title" class="form-label">เพิ่มระเบียบวาระการประชุม</label>
                                <input type="text" class="form-control" name="agenda_title" id="agenda_title">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="document" class="form-label">เอกสารแนบ</label>
                                <input type="file" class="form-control" name="document" id="document">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label class="form-label">สถานะการดำเนินการ</label>
                                <div class="d-flex gap-4 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="task_status" id="task_status_completed" value="completed">
                                        <label class="form-check-label" for="task_status_completed">
                                            ดำเนินการแล้วเสร็จ
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="task_status" id="task_status_in_progress" value="in_progress">
                                        <label class="form-check-label" for="task_status_in_progress">
                                            อยู่ระหว่างดำเนินการ
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="task_status" id="task_status_not_started" value="not_started" checked>
                                        <label class="form-check-label" for="task_status_not_started">
                                            ยังไม่ดำเนินการ
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="resolution_text" class="form-label">มติที่ประชุม</label>
                                <textarea name="resolution_text" id="resolution_text" class="form-control" rows="5"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 text-end">
                        <button type="submit" class="btn btn-primary px-4">บันทึกข้อมูล</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $('#resolutionTypeForm').validate({
                rules: {
                    committee_category_id: {
                        required: true,
                    },
                    meeting_type_id: {
                        required: true,
                    },
                    meeting_no: {
                        required: true,
                    },
                    meeting_year: {
                        required: true,
                    },
                    meeting_date: {
                        required: true,
                    },
                    name: {
                        required: true,
                    },
                    agenda_title: {
                        required: true,
                    },
                    task_status: {
                        required: true,
                    },
                    resolution_text: {
                        required: true,
                    },
                },
                messages: {
                    committee_category_id: {
                        required: 'กรุณาเลือกประเภทคณะกรรมการ',
                    },
                    meeting_type_id: {
                        required: 'กรุณาเลือกประเภทการประชุม',
                    },
                    meeting_no: {
                        required: 'กรุณาระบุครั้งที่ประชุม',
                    },
                    meeting_year: {
                        required: 'กรุณาระบุปีที่ประชุม',
                    },
                    meeting_date: {
                        required: 'กรุณาระบุวันที่ประชุม',
                    },
                    name: {
                        required: 'กรุณาระบุเรื่องพิจารณา',
                    },
                    agenda_title: {
                        required: 'กรุณาระบุระเบียบวาระการประชุม',
                    },
                    task_status: {
                        required: 'กรุณาระบุสถานะการดำเนินการ',
                    },
                    resolution_text: {
                        required: 'กรุณาระบุมติที่ประชุม',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <!-- เพิ่ม CKEditor script -->
    <script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    <script>
        $(document).ready(function() {
            CKEDITOR.replace('resolution_text', {
                language: 'th',
                height: 300,
                toolbar: [
                    ['Bold', 'Italic', 'Underline', 'Strike', 'RemoveFormat'],
                    ['NumberedList', 'BulletedList', 'Outdent', 'Indent'],
                    ['JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock'],
                    ['Link', 'Unlink'],
                    ['FontSize', 'TextColor', 'BGColor'],
                    ['Source', 'Maximize']
                ],
                removeButtons: 'PasteFromWord'
            });
            $('#resolutionTypeForm').submit(function() {
                for (instance in CKEDITOR.instances) {
                    CKEDITOR.instances[instance].updateElement();
                }
            });
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_resolution_type/all_meeting_resolution_types.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">รายการมติที่ประชุม</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting.resolution.type') }}" class="btn btn-primary px-5">เพิ่มรายงานมติที่ประชุม</a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ประเภทคณะกรรมการ</th>
                                <th>ประเภทการประชุม</th>
                                <th>ครั้งที่/ปี</th>
                                <th>วันที่ประชุม</th>
                                <th>เรื่องพิจารณา</th>
                                <th>วาระการประชุม</th>
                                <th>สถานะการดำเนินการ</th>
                                <th>เอกสาร</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($resolutionTypes as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->committeeCategory->name }}</td>
                                    <td>{{ $item->meetingType->name }}</td>
                                    <td>{{ $item->meeting_no }}/{{ $item->meeting_year }}</td>
                                    <td>{{ \Carbon\Carbon::parse($item->meeting_date)->format('j F Y') }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>{{ $item->agenda_title }}</td>
                                    <td>
                                        @if($item->task_status == 'completed')
                                            <span class="badge bg-success">ดำเนินการแล้ว</span>
                                        @elseif($item->task_status == 'in_progress')
                                            <span class="badge bg-warning text-dark">อยู่ระหว่างดำเนินการ</span>
                                        @else
                                            <span class="badge bg-danger">ยังไม่ดำเนินการ</span>
                                        @endif
                                    </td>
                                    <td>
                                        @if($item->document)
                                            <a href="{{ asset($item->document) }}" target="_blank" class="btn btn-info btn-sm">ดูเอกสาร</a>
                                        @else
                                            <span class="badge bg-danger">ไม่มีเอกสาร</span>
                                        @endif
                                    </td>
                                    <td>
                                        <a href="{{ route('edit.meeting.resolution.type', $item->id) }}" class="btn btn-info btn-sm">แก้ไข</a>
                                        <a href="{{ route('delete.meeting.resolution.type', $item->id) }}" class="btn btn-danger btn-sm" id="delete">ลบ</a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_resolution_type/edit_meeting_resolution_type.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขรายงานมติที่ประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขรายงานมติที่ประชุม</h5>
                <form id="resolutionTypeForm" action="{{ route('update.meeting.resolution.type') }}" method="post" class="row g-3" enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $resolutionType->id }}">
                    @if ($errors->any())
                        <div class="alert alert-danger">
                            <ul>
                                @foreach ($errors->all() as $error)
                                    <li>{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif
                    <div class="col-md-12">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="committee_category_id" class="form-label">เลือกประเภทคณะกรรมการ</label>
                                <select name="committee_category_id" id="committee_category_id" class="form-select">
                                    <option selected="" disabled>เลือกประเภทคณะกรรมการ(O)</option>
                                    @foreach ($committeeCategories as $committee)
                                        <option value="{{ $committee->id }}" {{ $resolutionType->committee_category_id == $committee->id ? 'selected' : '' }}>{{ $committee->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="meeting_type_id" class="form-label">เลือกประเภทการประชุม</label>
                                <select name="meeting_type_id" id="meeting_type_id" class="form-select">
                                    <option selected="" disabled>เลือกประเภทการประชุม(O)</option>
                                    @foreach ($meetingTypes as $type)
                                        <option value="{{ $type->id }}" {{ $resolutionType->meeting_type_id == $type->id ? 'selected' : '' }}>{{ $type->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="meeting_no" class="form-label">การประชุม</label>
                                <div class="input-group">
                                    <span class="input-group-text">ครั้งที่</span>
                                    <input type="text" class="form-control" name="meeting_no" id="meeting_no" value="{{ $resolutionType->meeting_no }}">
                                    <span class="input-group-text">ปี</span>
                                    <input type="text" class="form-control" name="meeting_year" id="meeting_year" value="{{ $resolutionType->meeting_year }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="meeting_date" class="form-label">วันที่ประชุม :</label>
                                <input type="date" class="form-control" name="meeting_date" id="meeting_date" value="{{ $resolutionType->meeting_date ? date('Y-m-d', strtotime($resolutionType->meeting_date)) : '' }}">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label">เพิ่มเรื่องพิจารณา</label>
                                <input type="text" name="name" id="name" class="form-control" value="{{ $resolutionType->name }}" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="agenda_title" class="form-label">เพิ่มระเบียบวาระการประชุม</label>
                                <input type="text" class="form-control" name="agenda_title" id="agenda_title" value="{{ $resolutionType->agenda_title }}">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="document" class="form-label">เอกสารแนบ</label>
                                <input type="file" class="form-control" name="document" id="document">
                                @if($resolutionType->document)
                                    <div class="mt-2">
                                        <a href="{{ asset($resolutionType->document) }}" target="_blank" class="btn btn-info btn-sm">ดูเอกสารปัจจุบัน</a>
                                    </div>
                                @endif
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label class="form-label">สถานะการดำเนินการ</label>
                                <div class="d-flex gap-4 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="task_status" id="task_status_completed" value="completed" {{ $resolutionType->task_status == 'completed' ? 'checked' : '' }}>
                                        <label class="form-check-label" for="task_status_completed">
                                            ดำเนินการแล้ว
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="task_status" id="task_status_in_progress" value="in_progress" {{ $resolutionType->task_status == 'in_progress' ? 'checked' : '' }}>
                                        <label class="form-check-label" for="task_status_in_progress">
                                            อยู่ระหว่างดำเนินการ
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="task_status" id="task_status_not_started" value="not_started" {{ $resolutionType->task_status == 'not_started' ? 'checked' : '' }}>
                                        <label class="form-check-label" for="task_status_not_started">
                                            ยังไม่ดำเนินการ
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="resolution_text" class="form-label">มติที่ประชุม (ใช้ ckeditor)</label>
                                <textarea name="resolution_text" id="resolution_text" class="form-control" rows="5">{{ $resolutionType->resolution_text }}</textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 text-end">
                        <button type="submit" class="btn btn-primary px-4">อัปเดตข้อมูล</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // Form validation
            $('
                rules: {
                    committee_category_id: {
                        required: true,
                    },
                    meeting_type_id: {
                        required: true,
                    },
                    meeting_no: {
                        required: true,
                    },
                    meeting_year: {
                        required: true,
                    },
                    meeting_date: {
                        required: true,
                    },
                    name: {
                        required: true,
                    },
                    agenda_title: {
                        required: true,
                    },
                    task_status: {
                        required: true,
                    },
                    resolution_text: {
                        required: true,
                    },
                },
                messages: {
                    committee_category_id: {
                        required: 'กรุณาเลือกประเภทคณะกรรมการ',
                    },
                    meeting_type_id: {
                        required: 'กรุณาเลือกประเภทการประชุม',
                    },
                    meeting_no: {
                        required: 'กรุณาระบุครั้งที่ประชุม',
                    },
                    meeting_year: {
                        required: 'กรุณาระบุปีที่ประชุม',
                    },
                    meeting_date: {
                        required: 'กรุณาระบุวันที่ประชุม',
                    },
                    name: {
                        required: 'กรุณาระบุชื่อรายงานการประชุม',
                    },
                    agenda_title: {
                        required: 'กรุณาระบุระเบียบวาระการประชุม',
                    },
                    task_status: {
                        required: 'กรุณาระบุสถานะการดำเนินการ',
                    },
                    resolution_text: {
                        required: 'กรุณาระบุมติที่ประชุม',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <!-- เพิ่ม CKEditor script -->
    <script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    <script>
        $(document).ready(function() {
            CKEDITOR.replace('resolution_text', {
                language: 'th',
                height: 300,
                toolbar: [
                    ['Bold', 'Italic', 'Underline', 'Strike', 'RemoveFormat'],
                    ['NumberedList', 'BulletedList', 'Outdent', 'Indent'],
                    ['JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock'],
                    ['Link', 'Unlink'],
                    ['FontSize', 'TextColor', 'BGColor'],
                    ['Source', 'Maximize']
                ],
                removeButtons: 'PasteFromWord'
            });
            $('#resolutionTypeForm').submit(function() {
                for (instance in CKEDITOR.instances) {
                    CKEDITOR.instances[instance].updateElement();
                }
            });
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_resolution_type/search_meeting_resolution_types.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
@php
    function formatThaiDate($dateString) {
        $months = [
            'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',
            'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'
        ];
        $date = new DateTime($dateString);
        $day = $date->format('d');
        $month = $months[$date->format('n') - 1];
        $year = $date->format('Y') + 543;
        return $day . ' ' . $month . ' ' . $year;
    }
@endphp
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ค้นหามติที่ประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">ค้นหามติที่ประชุม</h5>
                @if(request()->isMethod('get') && request()->has('_token') && empty(request('keyword')) && empty(request('committee_category_id')) && empty(request('meeting_type_id')) && empty(request('meeting_no')) && empty(request('meeting_year')) && empty(request('meeting_date')))
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <i class="bx bx-info-circle me-1"></i> กรุณาระบุเงื่อนไขในการค้นหา
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                @endif
                <form action="{{ route('search.meeting.resolution.types') }}" method="GET">
                    @csrf
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="form-group mb-3">
                                <label for="keyword" class="form-label">คำค้นหา</label>
                                <input type="text" name="keyword" id="keyword" class="form-control" placeholder="ระบุคำค้นหา เช่น ชื่อเรื่อง, รายละเอียดมติที่ประชุม" value="{{ request('keyword') }}">
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="committee_category_id" class="form-label">ประเภทคณะกรรมการ</label>
                                <select name="committee_category_id" id="committee_category_id" class="form-select">
                                    <option value="">-- เลือกประเภทคณะกรรมการ --</option>
                                    @foreach ($committeeCategories as $category)
                                        <option value="{{ $category->id }}" {{ request('committee_category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label for="meeting_type_id" class="form-label">ประเภทการประชุม</label>
                                <select name="meeting_type_id" id="meeting_type_id" class="form-select">
                                    <option value="">-- เลือกประเภทการประชุม --</option>
                                    @foreach ($meetingTypes as $type)
                                        <option value="{{ $type->id }}" {{ request('meeting_type_id') == $type->id ? 'selected' : '' }}>{{ $type->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label for="meeting_no" class="form-label">ครั้งที่</label>
                                <input type="text" name="meeting_no" id="meeting_no" class="form-control" placeholder="ระบุครั้งที่" value="{{ request('meeting_no') }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label for="meeting_year" class="form-label">ปี</label>
                                <input type="text" name="meeting_year" id="meeting_year" class="form-control" placeholder="ระบุปี (พ.ศ.)" value="{{ request('meeting_year') }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label for="meeting_date" class="form-label">วันที่ประชุม</label>
                                <input type="date" name="meeting_date" id="meeting_date" class="form-control" value="{{ request('meeting_date') }}">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary fs-5">
                                    <i class="bx bx-search me-1"></i> ค้นหา
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        @if(isset($results))
        <div class="card shadow-sm border-0 mt-4">
            <div class="card-body">
                <h5 class="card-title mb-4">ผลการค้นหามติที่ประชุม</h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead style="background: linear-gradient(to right, #4e73df, #36b9cc); color: white;">
                            {{-- <tr>
                                <th class="text-center" width="8%">ลำดับ</th>
                                <th class="text-center" width="25%">ประเภทคณะกรรมการ</th>
                                <th class="text-center">ชื่อรายงานการประชุม</th>
                            </tr> --}}
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="3" class="bg-light fw-bold">
                                    <i class="bx bx-list-ol me-1"></i><span style="font-size: 1.1rem;">ลำดับของมติสภามหาวิทยาลัย</span>
                                </td>
                            </tr>
                            @if(count($results) > 0)
                                @foreach($results as $key => $item)
                                    <tr style="background: linear-gradient(to right, #4e73df, #36b9cc); color: white;">
                                        <td class="text-center" style="font-size: 18px;">ลำดับ</td>
                                        <td class="text-center"><strong style="font-size: 18px;">O1 {{ $item->committeeCategory->name }}</strong></td>
                                        <td class="text-center"><strong style="font-size: 18px;">O1 {{ $item->name }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4 fs-5">
                                            <i class="bx bx-calendar me-1">O{{ $key + 1 }}</i>การประชุมครั้งที่ {{ $item->meeting_no }}/{{ $item->meeting_year }} - วันที่ประชุม
                                            {{ formatThaiDate($item->meeting_date) }}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4 fs-5">
                                            <i class="bx bx-notepad me-1"></i><strong>{{ $item->agenda_title }}</strong>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4">
                                            <div class="mb-2 fs-5"><i class="bx bx-chat me-1"></i><strong>มติที่ประชุม</strong></div>
                                            <div class="ps-4 fs-5">{!! $item->resolution_text !!}</div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4">
                                            <div class="mb-2"><i class="bx bx-file me-1"></i><strong>สถานะ</strong></div>
                                            <div class="ps-4">
                                                @if($item->task_status == 'completed')
                                                    <span class="badge bg-success fs-5"><i class="bx bx-check-circle me-1"></i>ดำเนินการแล้วเสร็จ</span>
                                                @elseif($item->task_status == 'in_progress')
                                                    <span class="badge bg-warning fs-5"><i class="bx bx-loader me-1"></i>อยู่ระหว่างดำเนินการ</span>
                                                @else
                                                    <span class="badge bg-danger fs-5"><i class="bx bx-error-circle me-1"></i>ยังไม่ดำเนินการ</span>
                                                @endif
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4">
                                            <div class="mb-2"><i class="bx bx-file me-1"></i><strong>เอกสารแนบ</strong></div>
                                            <div class="ps-4">
                                            @if($item->document)
                                                <a href="{{ asset($item->document) }}" target="_blank" class="btn btn-info btn-sm fs-5"><i class="bx bx-file-find me-1"></i>ดูเอกสาร</a>
                                            @else
                                                <span class="badge bg-danger fs-5"><i class="bx bx-error-circle me-1"></i>ไม่มีเอกสาร</span>
                                            @endif
                                            </div>
                                        </td>
                                    </tr>
                                    {{-- <tr>
                                        <td colspan="3" class="ps-4">
                                            <div class="mb-2"><i class="bx bx-file me-1"></i><strong>เอกสารแนบ</strong></div>
                                            <div class="ps-4">
                                            @if($item->document)
                                                <a href="{{ asset($item->document) }}" target="_blank" class="btn btn-info btn-sm"><i class="bx bx-file-find me-1"></i>ดูเอกสาร</a>
                                            @else
                                                <span class="badge bg-danger"><i class="bx bx-error-circle me-1"></i>ไม่มีเอกสาร</span>
                                            @endif
                                            </div>
                                        </td>
                                    </tr> --}}
                                    @if(!$loop->last)
                                        <tr>
                                            <td colspan="3" class="border-0" style="height: 20px;"></td>
                                        </tr>
                                    @endif
                                @endforeach
                            @else
                                <tr>
                                    <td colspan="3" class="text-center py-4">
                                        <i class="bx bx-search-alt bx-lg d-block mb-2"></i>
                                        ไม่พบข้อมูลที่ตรงกับเงื่อนไขการค้นหา
                                    </td>
                                </tr>
                            @endif
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        @endif
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_resolution_type/search_meeting_resolution_types_results.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<@php
    function formatThaiDate($dateString) {
        $months = [
            'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',
            'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'
        ];
        $date = new DateTime($dateString);
        $day = $date->format('d');
        $month = $months[$date->format('n') - 1];
        $year = $date->format('Y') + 543;
        return $day . ' ' . $month . ' ' . $year;
    }
@endphp
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item"><a href="{{ route('search.meeting.resolution.types') }}">ค้นหามติที่ประชุม</a></li>
                        <li class="breadcrumb-item active" aria-current="page">ผลการค้นหา</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('search.meeting.resolution.types') }}" class="btn btn-secondary"><i class="bx bx-arrow-back me-1"></i>กลับไปหน้าค้นหา</a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h5 class="card-title mb-4"><i class="bx bx-search-alt me-1"></i>ผลการค้นหามติที่ประชุม</h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead style="background: linear-gradient(to right, #4e73df, #36b9cc); color: white;">
                            <tr>
                                <th class="text-center" width="8%">ลำดับ</th>
                                <th class="text-center" width="25%">ประเภทคณะกรรมการ</th>
                                <th class="text-center">ชื่อรายงานการประชุม</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="3" class="bg-light fw-bold">
                                    <i class="bx bx-list-ol me-1"></i>ลำดับของมติสภามหาวิทยาลัย
                                </td>
                            </tr>
                            @if(count($results) > 0)
                                @foreach($results as $key => $item)
                                    <tr style="background: linear-gradient(to right, #4e73df, #36b9cc); color: white;">
                                        <td class="text-center">{{ $key + 1 }}</td>
                                        <td class="text-center"><strong>{{ $item->committeeCategory->name }}</strong></td>
                                        <td class="text-center"><strong>{{ $item->name }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4">
                                            <i class="bx bx-calendar me-1"></i>การประชุมครั้งที่ {{ $item->meeting_no }}/{{ $item->meeting_year }} - วันที่ประชุม
                                            {{ formatThaiDate($item->meeting_date) }}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4">
                                            <i class="bx bx-notepad me-1"></i><strong>{{ $item->agenda_title }}</strong>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="ps-4">
                                            <div class="mb-2"><i class="bx bx-chat me-1"></i><strong>มติที่ประชุม</strong></div>
                                            <div class="ps-4">{!! $item->resolution_text !!}</div>
                                        </td>
                                    </tr>
                                    {{-- <tr>
                                        <td colspan="3" class="ps-4">
                                            <div class="mb-2"><i class="bx bx-file me-1"></i><strong>เอกสารแนบ</strong></div>
                                            <div class="ps-4">
                                            @if($item->document)
                                                <a href="{{ asset($item->document) }}" target="_blank" class="btn btn-info btn-sm"><i class="bx bx-file-find me-1"></i>ดูเอกสาร</a>
                                            @else
                                                <span class="badge bg-danger"><i class="bx bx-error-circle me-1"></i>ไม่มีเอกสาร</span>
                                            @endif
                                            </div>
                                        </td>
                                    </tr> --}}
                                    @if(!$loop->last)
                                        <tr>
                                            <td colspan="3" class="border-0" style="height: 20px;"></td>
                                        </tr>
                                    @endif
                                @endforeach
                            @else
                                <tr>
                                    <td colspan="3" class="text-center py-4">
                                        <i class="bx bx-search-alt bx-lg d-block mb-2"></i>
                                        ไม่พบข้อมูลที่ตรงกับเงื่อนไขการค้นหา
                                    </td>
                                </tr>
                            @endif
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/legal_database/index.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="d-inline-flex align-items-center mb-3">
                            <i class="bx bx-data me-3 text-primary" style="font-size: 2.5rem;"></i>
                            <div>
                                <h4 class="mb-0">ฐานข้อมูลด้านกฎหมาย</h4>
                                <p class="mb-0 text-muted">มหาวิทยาลัยราชภัฏสุราษฎร์ธานี</p>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="card">
                        <div class="card-body">
                            <div class="ratio ratio-16x9">
                                <iframe src="https://centerlaw.sru.ac.th/" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection
</file>

<file path="app/Http/Controllers/Auth/ConfirmablePasswordController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use App\Providers\RouteServiceProvider;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\ValidationException;
use Illuminate\View\View;
class ConfirmablePasswordController extends Controller
{
    public function show(): View
    {
        return view('auth.confirm-password');
    }
    public function store(Request $request): RedirectResponse
    {
        if (! Auth::guard('web')->validate([
            'email' => $request->user()->email,
            'password' => $request->password,
        ])) {
            throw ValidationException::withMessages([
                'password' => __('auth.password'),
            ]);
        }
        $request->session()->put('auth.password_confirmed_at', time());
        return redirect()->intended(RouteServiceProvider::HOME);
    }
}
</file>

<file path="app/Http/Controllers/Auth/EmailVerificationNotificationController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use App\Providers\RouteServiceProvider;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
class EmailVerificationNotificationController extends Controller
{
    public function store(Request $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(RouteServiceProvider::HOME);
        }
        $request->user()->sendEmailVerificationNotification();
        return back()->with('status', 'verification-link-sent');
    }
}
</file>

<file path="app/Http/Controllers/Auth/EmailVerificationPromptController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use App\Providers\RouteServiceProvider;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\View\View;
class EmailVerificationPromptController extends Controller
{
    public function __invoke(Request $request): RedirectResponse|View
    {
        return $request->user()->hasVerifiedEmail()
                    ? redirect()->intended(RouteServiceProvider::HOME)
                    : view('auth.verify-email');
    }
}
</file>

<file path="app/Http/Controllers/Auth/NewPasswordController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use Illuminate\Auth\Events\PasswordReset;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Password;
use Illuminate\Support\Str;
use Illuminate\Validation\Rules;
use Illuminate\View\View;
class NewPasswordController extends Controller
{
    public function create(Request $request): View
    {
        return view('auth.reset-password', ['request' => $request]);
    }
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'token' => ['required'],
            'email' => ['required', 'email'],
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);
        $status = Password::reset(
            $request->only('email', 'password', 'password_confirmation', 'token'),
            function ($user) use ($request) {
                $user->forceFill([
                    'password' => Hash::make($request->password),
                    'remember_token' => Str::random(60),
                ])->save();
                event(new PasswordReset($user));
            }
        );
        return $status == Password::PASSWORD_RESET
                    ? redirect()->route('login')->with('status', __($status))
                    : back()->withInput($request->only('email'))
                            ->withErrors(['email' => __($status)]);
    }
}
</file>

<file path="app/Http/Controllers/Auth/PasswordController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules\Password;
class PasswordController extends Controller
{
    public function update(Request $request): RedirectResponse
    {
        $validated = $request->validateWithBag('updatePassword', [
            'current_password' => ['required', 'current_password'],
            'password' => ['required', Password::defaults(), 'confirmed'],
        ]);
        $request->user()->update([
            'password' => Hash::make($validated['password']),
        ]);
        return back()->with('status', 'password-updated');
    }
}
</file>

<file path="app/Http/Controllers/Auth/PasswordResetLinkController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Password;
use Illuminate\View\View;
class PasswordResetLinkController extends Controller
{
    public function create(): View
    {
        return view('auth.forgot-password');
    }
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'email' => ['required', 'email'],
        ]);
        $status = Password::sendResetLink(
            $request->only('email')
        );
        return $status == Password::RESET_LINK_SENT
                    ? back()->with('status', __($status))
                    : back()->withInput($request->only('email'))
                            ->withErrors(['email' => __($status)]);
    }
}
</file>

<file path="app/Http/Controllers/Auth/RegisteredUserController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use App\Models\User;
use App\Providers\RouteServiceProvider;
use Illuminate\Auth\Events\Registered;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules;
use Illuminate\View\View;
class RegisteredUserController extends Controller
{
    public function create(): View
    {
        return view('auth.register');
    }
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'name' => ['required', 'string', 'max:255'],
            'email' => ['required', 'string', 'lowercase', 'email', 'max:255', 'unique:'.User::class],
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);
        $user = User::create([
            'name' => $request->name,
            'email' => $request->email,
            'password' => Hash::make($request->password),
        ]);
        event(new Registered($user));
        Auth::login($user);
        return redirect(RouteServiceProvider::HOME);
    }
}
</file>

<file path="app/Http/Controllers/Auth/VerifyEmailController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use App\Providers\RouteServiceProvider;
use Illuminate\Auth\Events\Verified;
use Illuminate\Foundation\Auth\EmailVerificationRequest;
use Illuminate\Http\RedirectResponse;
class VerifyEmailController extends Controller
{
    public function __invoke(EmailVerificationRequest $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(RouteServiceProvider::HOME.'?verified=1');
        }
        if ($request->user()->markEmailAsVerified()) {
            event(new Verified($request->user()));
        }
        return redirect()->intended(RouteServiceProvider::HOME.'?verified=1');
    }
}
</file>

<file path="app/Http/Controllers/Backend/RoleController.php">
<?php
namespace App\Http\Controllers\Backend;
use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Spatie\Permission\Models\Role;
use Spatie\Permission\Models\Permission;
class RoleController extends Controller
{
    public function AllPermission()
    {
        $permissions = Permission::all();
        return view('admin.backend.pages.permission.all_permission', compact('permissions'));
    }
    public function AddPermission()
    {
        return view('admin.backend.pages.permission.add_permission');
    }
    public function StorePermission(Request $request)
    {
        $request->validate([
            'name' => 'required',
            'group_name' => 'required',
        ]);
        Permission::create([
            'name' => $request->name,
            'group_name' => $request->group_name
        ]);
        $notification = array(
            'message' => 'Permission Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.permission')->with($notification);
    }
    public function EditPermission($id)
    {
        $permission = Permission::find($id);
        return view('admin.backend.pages.permission.edit_permission', compact('permission'));
    }
    public function UpdatePermission(Request $request)
    {
        $per_id = $request->id;
        Permission::find($per_id)->update([
            'name' => $request->name,
            'group_name' => $request->group_name
        ]);
        $notification = array(
            'message' => 'Permission Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.permission')->with($notification);
    }
    public function DeletePermission($id)
    {
        Permission::find($id)->delete();
        $notification = array(
            'message' => 'Permission Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
    public function AllRole()
    {
        $roles = Role::all();
        return view('admin.backend.pages.roles.all_roles', compact('roles'));
    }
    public function AddRole()
    {
        return view('admin.backend.pages.roles.add_roles');
    }
    public function storeRole(Request $request)
    {
        $request->validate([
            'name' => 'required|max:255',
        ]);
        $role_name = Role::where('name', $request->name)->first();
        if ($role_name) {
            $notification = [
                'message' => 'Role Already Exists!',
                'alert-type' => 'error'
            ];
        } else {
            try {
                Role::create(['name' => $request->name]);
                $notification = [
                    'message' => 'Role Added Successfully',
                    'alert-type' => 'success'
                ];
            } catch (\Exception $e) {
                $notification = [
                    'message' => 'Something went wrong!',
                    'alert-type' => 'error'
                ];
            }
        }
        return redirect()->route('all.roles')->with($notification);
    }
    public function EditRole($id)
    {
        $roles = Role::find($id);
        return view('admin.backend.pages.roles.edit_roles', compact('roles'));
    }
    public function UpdateRole(Request $request)
    {
        $role_id = $request->id;
        $role = Role::find($role_id);
        if ($role->name != $request->name) {
            $role_name = Role::where('name', $request->name)->first();
            if ($role_name) {
                $notification = array(
                    'message' => 'Role name already exists!',
                    'alert-type' => 'error'
                );
            } else {
                $role->update([
                    'name' => $request->name
                ]);
                $notification = array(
                    'message' => 'Role Updated Successfully',
                    'alert-type' => 'success'
                );
            }
        } else {
            $notification = array(
                'message' => 'Role name must be different from current name!',
                'alert-type' => 'warning'
            );
        }
        return redirect()->route('all.roles')->with($notification);
    }
    public function DeleteRole($id)
    {
        Role::find($id)->delete();
        $notification = array(
            'message' => 'Role Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
    public function AddRolesPermission()
    {
        $roles = Role::all();
        $permissions = Permission::all();
        $permission_groups = User::getPermissionGroups();
        return view('admin.backend.pages.rolesetup.add_roles_permission', compact('roles', 'permission_groups', 'permissions'));
    }
    public function RolePermissionStore(Request $request)
    {
        $data = array();
        $permissions = $request->permission;
        foreach ($permissions as $key => $item) {
            $data[] = array(
                'role_id' => $request->role_id,
                'permission_id' => $item
            );
        }
        DB::table('role_has_permissions')->insert($data);
        $notification = array(
            'message' => 'Permission Assigned Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.roles.permission')->with($notification);
    }
    public function AllRolePermission()
    {
        $roles = Role::all();
        return view('admin.backend.pages.rolesetup.all_roles_permission', compact('roles'));
    }
    public function AdminEditRoles($id)
    {
        $role = Role::find($id);
        $permissions = Permission::all();
        $permission_groups = User::getPermissionGroups();
        return view('admin.backend.pages.rolesetup.edit_roles_permission', compact('role', 'permission_groups', 'permissions'));
    }
    public function AdminUpdateRoles(Request $request, $id)
    {
        $role = Role::findOrFail($id);
        $permissions = $request->input('permission', []);
        DB::beginTransaction();
        try {
            $role->permissions()->detach();
            foreach ($permissions as $permissionId) {
                $permission = Permission::findOrFail($permissionId);
                $role->givePermissionTo($permission);
            }
            DB::commit();
            $notification = [
                'message' => 'Permissions Updated Successfully',
                'alert-type' => 'success'
            ];
        } catch (\Exception $e) {
            DB::rollBack();
            \Log::error('Error updating role permissions: ' . $e->getMessage());
            $notification = [
                'message' => 'Error updating permissions. Please try again.',
                'alert-type' => 'error'
            ];
        }
        return redirect()->route('all.roles.permission')->with($notification);
    }
    public function AdminDeleteRoles($id)
    {
        $role = Role::find($id);
        if (!is_null($role)) {
            $role->delete();
        }
        $notification = array(
            'message' => 'Role Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/Category/CommitteeCategoryController.php">
<?php
namespace App\Http\Controllers\Category;
use App\Http\Controllers\Controller;
use App\Models\CommitteeCategory;
use Carbon\Carbon;
use Illuminate\Http\Request;
class CommitteeCategoryController extends Controller
{
    public function AllCommitteeCategory()
    {
        $committee_category = CommitteeCategory::latest()->get();
        return view('admin.backend.pages.committee.committe_category.all_committee_category', compact('committee_category'));
    }
    public function AddCommitteeCategory()
    {
        return view('admin.backend.pages.committee.committe_category.add_committee_category');
    }
    public function StoreCommitteeCategory(Request $request)
    {
        $request->validate([
            'name' => 'required',
        ]);
        CommitteeCategory::insert([
            'name' => $request->name,
            'description' => $request->description,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Committee Category Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.committee.category')->with($notification);
    }
    public function EditCommitteeCategory($id)
    {
        $category = CommitteeCategory::findOrFail($id);
        return view('admin.backend.pages.committee.committe_category.edit_committee_category', compact('category'));
    }
    public function UpdateCommitteeCategory(Request $request)
    {
        $cat_id = $request->id;
        $request->validate([
            'name' => 'required',
        ]);
        CommitteeCategory::findOrFail($cat_id)->update([
            'name' => $request->name,
            'description' => $request->description,
            'updated_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Committee Category Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.committee.category')->with($notification);
    }
    public function DeleteCommitteeCategory($id)
    {
        CommitteeCategory::findOrFail($id)->delete();
        $notification = array(
            'message' => 'Committee Category Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/Category/MeetingTypeController.php">
<?php
namespace App\Http\Controllers\Category;
use App\Http\Controllers\Controller;
use App\Models\MeetingType;
use Carbon\Carbon;
use Illuminate\Http\Request;
class MeetingTypeController extends Controller
{
    public function AllMeetingType()
    {
        $meeting_type = MeetingType::latest()->get();
        return view('admin.backend.pages.meeting_report.meeting_type.all_meeting_type', compact('meeting_type'));
    }
    public function AddMeetingType()
    {
        return view('admin.backend.pages.meeting_report.meeting_type.add_meeting_type');
    }
    public function StoreMeetingType(Request $request)
    {
        $request->validate([
            'name' => 'required',
        ]);
        try {
            MeetingType::insert([
                'name' => $request->name,
                'description' => $request->description,
                'created_at' => Carbon::now()
            ]);
            $notification = array(
                'message' => 'Meeting Type Added Successfully',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.type')->with($notification);
        } catch (\Exception $e) {
            return back()->with('error', 'Unable to add meeting type. Please try again.');
        }
    }
    public function EditMeetingType($id)
    {
        $meeting_type = MeetingType::findOrFail($id);
        return view('admin.backend.pages.meeting_report.meeting_type.edit_meeting_type', compact('meeting_type'));
    }
    public function UpdateMeetingType(Request $request)
    {
        $type_id = $request->id;
        $request->validate([
            'name' => 'required',
        ]);
        try {
            MeetingType::findOrFail($type_id)->update([
                'name' => $request->name,
                'description' => $request->description,
                'updated_at' => Carbon::now()
            ]);
            $notification = array(
                'message' => 'Meeting Type Updated Successfully',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.type')->with($notification);
        } catch (\Exception $e) {
            return back()->with('error', 'Unable to update meeting type. Please try again.');
        }
    }
    public function DeleteMeetingType($id)
    {
        try {
            MeetingType::findOrFail($id)->delete();
            $notification = array(
                'message' => 'Meeting Type Deleted Successfully',
                'alert-type' => 'success'
            );
            return redirect()->back()->with($notification);
        } catch (\Exception $e) {
            return back()->with('error', 'Unable to delete meeting type. Please try again.');
        }
    }
}
</file>

<file path="app/Http/Controllers/Category/RuleCategoryController.php">
<?php
namespace App\Http\Controllers\Category;
use App\Http\Controllers\Controller;
use App\Models\RuleCategory;
use Carbon\Carbon;
use Illuminate\Http\Request;
class RuleCategoryController extends Controller
{
    public function AllRuleCategory()
    {
        $r_cat = RuleCategory::latest()->get();
        return view('admin.backend.pages.rule_meeting.rule_category.all_rule_category', compact('r_cat'));
    }
    public function AddRuleCategory()
    {
        return view('admin.backend.pages.rule_meeting.rule_category.add_rule_category');
    }
    public function StoreRulesCategory(Request $request)
    {
        $request->validate([
            'rule_category_name' => 'required',
        ]);
        RuleCategory::insert([
            'rule_category_name' => $request->rule_category_name,
            'description' => $request->description,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Rule Category Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('rule.category')->with($notification);
    }
    public function EditRulesCategory($id)
    {
        $category = RuleCategory::findOrFail($id);
        return view('admin.backend.pages.rule_meeting.rule_category.edit_rule_category', compact('category'));
    }
    public function UpdateRulesCategory(Request $request)
    {
        $cat_id = $request->id;
        $request->validate([
            'rule_category_name' => 'required',
        ]);
        RuleCategory::findOrFail($cat_id)->update([
            'rule_category_name' => $request->rule_category_name,
            'description' => $request->description,
            'updated_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Rule Category Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('rule.category')->with($notification);
    }
    public function DeleteRulesCategory($id)
    {
        RuleCategory::findOrFail($id)->delete();
        $notification = array(
            'message' => 'Rule Category Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/Controller.php">
<?php
namespace App\Http\Controllers;
use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;
class Controller extends BaseController
{
    use AuthorizesRequests, ValidatesRequests;
}
</file>

<file path="app/Http/Controllers/MeetingApprovalListController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\MeetingReport;
use App\Models\MeetingType;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
class MeetingApprovalListController extends Controller
{
    public function list($meeting_type_id, $committee_id)
    {
        $user = Auth::user();
        $userMeetingTypes = $user->meetingTypes->pluck('id')->toArray();
        if (in_array($meeting_type_id, $userMeetingTypes)) {
            return view('meeting_approval_list.list', ['meeting_type_id' => $meeting_type_id, 'committee_id' => $committee_id]);
        }
        $userCommitteeIds = json_decode($user->meetingTypes->where('id', $meeting_type_id)->first()->pivot->committee_ids, true) ?? [];
        if (!in_array($committee_id, $userCommitteeIds)) {
            return redirect()->route('dashboard')->with('error', 'คุณไม่มีสิทธิ์เข้าถึงข้อมูลนี้');
        }
        $meetingType = MeetingType::findOrFail($meeting_type_id);
        $committee = CommitteeCategory::findOrFail($committee_id);
        $meetingReports = MeetingReport::where('meeting_type_id', $meeting_type_id)
            ->where('committee_category_id', $committee_id)
            ->orderBy('created_at', 'desc')
            ->paginate(10);
        return view('admin.meeting_reports.list', compact('meetingReports', 'meetingType', 'committee'));
    }
}
</file>

<file path="app/Http/Controllers/MeetingFormatController.php">
<?php
namespace App\Http\Controllers;
use App\Models\MeetingFormat;
use Carbon\Carbon;
use Illuminate\Http\Request;
class MeetingFormatController extends Controller
{
    public function AllMeetingFormat()
    {
        $m_format = MeetingFormat::orderBy('id', 'asc')->get();
        return view('admin.backend.pages.meeting_format.all_meeting_format', compact('m_format'));
    }
    public function AddMeetingFormat()
    {
        return view('admin.backend.pages.meeting_format.add_meeting_format');
    }
    public function StoreMeetingFormat(Request $request)
    {
        $request->validate([
            'name' => 'required',
        ]);
        MeetingFormat::insert([
            'name' => $request->name,
            'description' => $request->description,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Meeting Format Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.meeting.format')->with($notification);
    }
    public function EditMeetingFormat($id)
    {
        $m_format = MeetingFormat::findOrFail($id);
        return view('admin.backend.pages.meeting_format.edit_meeting_format', compact('m_format'));
    }
    public function UpdateMeetingFormat(Request $request)
    {
        $m_format_id = $request->id;
        $request->validate([
            'name' => 'required',
        ]);
        MeetingFormat::findOrFail($m_format_id)->update([
            'name' => $request->name,
            'description' => $request->description,
            'updated_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Meeting Format Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.meeting.format')->with($notification);
    }
    public function DeleteMeetingFormat($id)
    {
        MeetingFormat::findOrFail($id)->delete();
        $notification = array(
            'message' => 'Meeting Format Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/PrefixNameController.php">
<?php
namespace App\Http\Controllers;
use App\Models\PrefixName;
use Carbon\Carbon;
use Illuminate\Http\Request;
class PrefixNameController extends Controller
{
    public function AllPrefixName()
    {
        $prefixname = PrefixName::latest()->get();
        return view('admin.backend.pages.prefix.all_prefix_name', compact('prefixname'));
    }
    public function AddPrefixName()
    {
        return view('admin.backend.pages.prefix.add_prefix_name');
    }
    public function StorePrefixName(Request $request)
    {
        $request->validate([
            'prefix_name' => 'required',
        ]);
        PrefixName::insert([
            'title' => $request->prefix_name,
            'created_at' => Carbon::now(),
        ]);
        $notification = array(
            'message' => 'Prefix Name Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.prefix.name')->with($notification);
    }
    public function EditPrefixName($id)
    {
        $prefixname = PrefixName::findOrFail($id);
        return view('admin.backend.pages.prefix.edit_prefix_name', compact('prefixname'));
    }
    public function UpdatePrefixName(Request $request, $id)
    {
        $request->validate([
            'prefix_name' => 'required',
        ]);
        $prefixname = PrefixName::findOrFail($id);
        if ($prefixname === null) {
            abort(404);
        }
        try {
            $prefixname->title = $request->prefix_name;
            $prefixname->save();
        } catch (\Exception $e) {
            return back()->withErrors(['error' => 'Something went wrong.']);
        }
        $notification = array(
            'message' => 'Prefix Name Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.prefix.name')->with($notification);
    }
    public function DeletePrefixName($id)
    {
        $prefixname = PrefixName::findOrFail($id);
        $prefixname->delete();
        $notification = array(
            'message' => 'Prefix Name Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/ProfileController.php">
<?php
namespace App\Http\Controllers;
use App\Http\Requests\ProfileUpdateRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Redirect;
use Illuminate\View\View;
class ProfileController extends Controller
{
    public function edit(Request $request): View
    {
        return view('profile.edit', [
            'user' => $request->user(),
        ]);
    }
    public function update(ProfileUpdateRequest $request): RedirectResponse
    {
        $request->user()->fill($request->validated());
        if ($request->user()->isDirty('email')) {
            $request->user()->email_verified_at = null;
        }
        $request->user()->save();
        return Redirect::route('profile.edit')->with('status', 'profile-updated');
    }
    public function destroy(Request $request): RedirectResponse
    {
        $request->validateWithBag('userDeletion', [
            'password' => ['required', 'current_password'],
        ]);
        $user = $request->user();
        Auth::logout();
        $user->delete();
        $request->session()->invalidate();
        $request->session()->regenerateToken();
        return Redirect::to('/');
    }
}
</file>

<file path="app/Http/Controllers/SettingsController.php">
<?php
namespace App\Http\Controllers;
use App\Models\Setting;
use Illuminate\Http\Request;
class SettingsController extends Controller
{
    public function editApprovalDeadline()
    {
        $deadlineDays = Setting::where('key', 'approval_deadline_days')->first()->value ?? 7;
        return view('admin.backend.pages.settings.edit_approval_deadline', compact('deadlineDays'));
    }
    public function updateApprovalDeadline(Request $request)
    {
        $request->validate([
            'deadline_days' => 'required|integer|min:1|max:30',
        ]);
        Setting::updateOrCreate(
            ['key' => 'approval_deadline_days'],
            ['value' => $request->deadline_days]
        );
        return redirect()->back()->with('success', 'จำนวนวันสำหรับ deadline ได้รับการปรับปรุงแล้ว');
    }
}
</file>

<file path="app/Http/Controllers/UserController.php">
<?php
namespace App\Http\Controllers;
use Illuminate\Http\Request;
class UserController extends Controller
{
    public function UserDashboard()
    {
        return view('frontend.index');
    }
}
</file>

<file path="app/Http/Controllers/UserProfileController.php">
<?php
namespace App\Http\Controllers;
use App\Models\PrefixName;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
class UserProfileController extends Controller
{
    public function editProfile()
    {
        $user = Auth::user();
        $prefixNames = PrefixName::all();
        return view('admin.backend.pages.user.profile.edit', compact('user', 'prefixNames'));
    }
    public function updateProfile(Request $request)
    {
        $user = Auth::user();
        $request->validate([
            'prefix_name_id' => 'required|exists:prefix_names,id',
            'first_name' => 'required|string|max:255',
            'last_name' => 'required|string|max:255',
            'email' => 'required|email|unique:users,email,'.$user->id,
            'current_password' => 'nullable|required_with:new_password',
            'new_password' => 'nullable|min:8|confirmed',
        ]);
        if ($request->filled('current_password')) {
            if (!Hash::check($request->current_password, $user->password)) {
                $notification = array(
                    'message' => 'รหัสผ่านปัจจุบันไม่ถูกต้อง',
                    'alert-type' => 'error'
                );
                return redirect()->back()->with($notification);
            }
        }
        $user->update([
            'prefix_name_id' => $request->prefix_name_id,
            'first_name' => $request->first_name,
            'last_name' => $request->last_name,
            'username' => $request->first_name,
            'email' => $request->email,
            'role' => 'admin',
            'status' => 1,
        ]);
        if ($request->filled('new_password')) {
            $user->update([
                'password' => Hash::make($request->new_password)
            ]);
        }
        $notification = array(
            'message' => 'อัปเดตข้อมูลส่วนตัวเรียบร้อยแล้ว',
            'alert-type' => 'success'
        );
        return redirect()->route('user.profile.edit')->with($notification);
    }
}
</file>

<file path="app/Http/Middleware/Authenticate.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Auth\Middleware\Authenticate as Middleware;
use Illuminate\Http\Request;
class Authenticate extends Middleware
{
    protected function redirectTo(Request $request): ?string
    {
        return $request->expectsJson() ? null : route('login');
    }
}
</file>

<file path="app/Http/Middleware/CheckRole.php">
<?php
namespace App\Http\Middleware;
use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
class CheckRole
{
    public function handle(Request $request, Closure $next, ...$roles): Response
    {
        if (!request()->user() || !$request->user()->hasAnyRole($roles)) {
            abort(403, 'Unauthorized action.');
        }
        return $next($request);
    }
}
</file>

<file path="app/Http/Middleware/EncryptCookies.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Cookie\Middleware\EncryptCookies as Middleware;
class EncryptCookies extends Middleware
{
    protected $except = [
    ];
}
</file>

<file path="app/Http/Middleware/PreventRequestsDuringMaintenance.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance as Middleware;
class PreventRequestsDuringMaintenance extends Middleware
{
    protected $except = [
    ];
}
</file>

<file path="app/Http/Middleware/RedirectIfAuthenticated.php">
<?php
namespace App\Http\Middleware;
use App\Providers\RouteServiceProvider;
use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Symfony\Component\HttpFoundation\Response;
class RedirectIfAuthenticated
{
    public function handle(Request $request, Closure $next, string ...$guards): Response
    {
        $guards = empty($guards) ? [null] : $guards;
        foreach ($guards as $guard) {
            if (Auth::guard($guard)->check()) {
                return redirect(RouteServiceProvider::HOME);
            }
        }
        return $next($request);
    }
}
</file>

<file path="app/Http/Middleware/TrimStrings.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Foundation\Http\Middleware\TrimStrings as Middleware;
class TrimStrings extends Middleware
{
    protected $except = [
        'current_password',
        'password',
        'password_confirmation',
    ];
}
</file>

<file path="app/Http/Middleware/TrustHosts.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Http\Middleware\TrustHosts as Middleware;
class TrustHosts extends Middleware
{
    public function hosts(): array
    {
        return [
            $this->allSubdomainsOfApplicationUrl(),
        ];
    }
}
</file>

<file path="app/Http/Middleware/TrustProxies.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Http\Middleware\TrustProxies as Middleware;
use Illuminate\Http\Request;
class TrustProxies extends Middleware
{
    protected $proxies;
    protected $headers =
        Request::HEADER_X_FORWARDED_FOR |
        Request::HEADER_X_FORWARDED_HOST |
        Request::HEADER_X_FORWARDED_PORT |
        Request::HEADER_X_FORWARDED_PROTO |
        Request::HEADER_X_FORWARDED_AWS_ELB;
}
</file>

<file path="app/Http/Middleware/ValidateSignature.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Routing\Middleware\ValidateSignature as Middleware;
class ValidateSignature extends Middleware
{
    protected $except = [
    ];
}
</file>

<file path="app/Http/Middleware/VerifyCsrfToken.php">
<?php
namespace App\Http\Middleware;
use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;
class VerifyCsrfToken extends Middleware
{
    protected $except = [
    ];
}
</file>

<file path="app/Http/Requests/Auth/LoginRequest.php">
<?php
namespace App\Http\Requests\Auth;
use Illuminate\Auth\Events\Lockout;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Str;
use Illuminate\Validation\ValidationException;
class LoginRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }
    public function rules(): array
    {
        return [
            'email' => ['required', 'string', 'email'],
            'password' => ['required', 'string'],
        ];
    }
    public function authenticate(): void
    {
        $this->ensureIsNotRateLimited();
        if (! Auth::attempt($this->only('email', 'password'), $this->boolean('remember'))) {
            RateLimiter::hit($this->throttleKey());
            throw ValidationException::withMessages([
                'email' => trans('auth.failed'),
            ]);
        }
        RateLimiter::clear($this->throttleKey());
    }
    public function ensureIsNotRateLimited(): void
    {
        if (! RateLimiter::tooManyAttempts($this->throttleKey(), 5)) {
            return;
        }
        event(new Lockout($this));
        $seconds = RateLimiter::availableIn($this->throttleKey());
        throw ValidationException::withMessages([
            'email' => trans('auth.throttle', [
                'seconds' => $seconds,
                'minutes' => ceil($seconds / 60),
            ]),
        ]);
    }
    public function throttleKey(): string
    {
        return Str::transliterate(Str::lower($this->string('email')).'|'.$this->ip());
    }
}
</file>

<file path="app/Http/Requests/ProfileUpdateRequest.php">
<?php
namespace App\Http\Requests;
use App\Models\User;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;
class ProfileUpdateRequest extends FormRequest
{
    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255'],
            'email' => ['required', 'string', 'lowercase', 'email', 'max:255', Rule::unique(User::class)->ignore($this->user()->id)],
        ];
    }
}
</file>

<file path="app/Models/MainMeeting.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
class MainMeeting extends Model
{
    use SoftDeletes;
    use HasFactory;
    protected $guarded = [];
    public function meetingTypes()
    {
        return $this->belongsToMany(MeetingType::class);
    }
    public function committeeCategories()
    {
        return $this->belongsToMany(CommitteeCategory::class);
    }
}
</file>

<file path="app/Models/MeetingAdminEdit.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingAdminEdit extends Model
{
    use HasFactory;
    protected $fillable = [
        'meeting_agenda_id',
        'section_id',
        'comment',
        'edited_by',
        'edited_at'
    ];
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class);
    }
    public function section()
    {
        return $this->belongsTo(MeetingAgendaSection::class, 'section_id');
    }
    public function editor()
    {
        return $this->belongsTo(User::class, 'edited_by');
    }
}
</file>

<file path="app/Models/MeetingApprovalDetail.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingApprovalDetail extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function meetingApproval() {
        return $this->belongsTo(MeetingApproval::class, 'meeting_approval_id', 'id');
    }
    public function meetingAgendaSection() {
        return $this->belongsTo(MeetingAgendaSection::class, 'meeting_agenda_section_id', 'id');
    }
}
</file>

<file path="app/Models/MeetingApprovalHistory.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingApprovalHistory extends Model
{
    use HasFactory;
    protected $fillable = [
        'meeting_agenda_id',
        'user_id',
        'action',
        'note',
        'action_at'
    ];
    protected $dates = [
        'action_at',
        'created_at',
        'updated_at'
    ];
    const ACTION_APPROVE = 'approve';
    const ACTION_CANCEL = 'cancel';
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class);
    }
    public function user()
    {
        return $this->belongsTo(User::class);
    }
    public function scopeApprovals($query)
    {
        return $query->where('action', self::ACTION_APPROVE);
    }
    public function scopeCancellations($query)
    {
        return $query->where('action', self::ACTION_CANCEL);
    }
    public function scopeInDateRange($query, $startDate, $endDate)
    {
        return $query->whereBetween('action_at', [$startDate, $endDate]);
    }
    public function getActionTextAttribute()
    {
        return [
            self::ACTION_APPROVE => 'รับรอง',
            self::ACTION_CANCEL => 'ยกเลิกการรับรอง'
        ][$this->action] ?? $this->action;
    }
    public function getActionColorAttribute()
    {
        return [
            self::ACTION_APPROVE => 'success',
            self::ACTION_CANCEL => 'danger'
        ][$this->action] ?? 'secondary';
    }
    public static function recordApproval($meetingAgendaId, $userId, $note = null)
    {
        return self::create([
            'meeting_agenda_id' => $meetingAgendaId,
            'user_id' => $userId,
            'action' => self::ACTION_APPROVE,
            'note' => $note,
            'action_at' => now()
        ]);
    }
    public static function getLatestHistory($meetingAgendaId)
    {
        return self::where('meeting_agenda_id', $meetingAgendaId)
            ->latest('action_at')
            ->first();
    }
    public static function getAllHistory($meetingAgendaId)
    {
        return self::where('meeting_agenda_id', $meetingAgendaId)
            ->with(['user'])
            ->orderBy('action_at', 'desc')
            ->get();
    }
    public function isApproval()
    {
        return $this->action === self::ACTION_APPROVE;
    }
    public function isCancellation()
    {
        return $this->action === self::ACTION_CANCEL;
    }
    public function getSummaryText()
    {
        return sprintf(
            '%s โดย %s เมื่อ %s %s',
            $this->action_text,
            $this->user->name,
            $this->action_at->format('d/m/Y H:i'),
            $this->note ? "($this->note)" : ''
        );
    }
    protected static function boot()
    {
        parent::boot();
        static::creating(function ($history) {
            if (!$history->action_at) {
                $history->action_at = now();
            }
        });
    }
}
</file>

<file path="app/Models/MeetingFormat.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingFormat extends Model
{
    use HasFactory;
    protected $guarded = [];
}
</file>

<file path="app/Models/MeetingParticipant.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingParticipant extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class);
    }
    public function user()
    {
        return $this->belongsTo(User::class);
    }
}
</file>

<file path="app/Models/MeetingReport.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingReport extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function committee_category() {
        return $this->belongsTo(CommitteeCategory::class, 'committee_category_id', 'id');
    }
    public function meeting_type() {
        return $this->belongsTo(MeetingType::class, 'meeting_type_id', 'id');
    }
}
</file>

<file path="app/Models/MeetingView.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingView extends Model
{
    use HasFactory;
    protected $guarded = [];
    public $timestamps = false;
    public function user()
    {
        return $this->belongsTo(User::class);
    }
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class);
    }
}
</file>

<file path="app/Models/PrefixName.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class PrefixName extends Model
{
    use HasFactory;
}
</file>

<file path="app/Models/RegulationMeeting.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class RegulationMeeting extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function regulation_category() {
        return $this->belongsTo(RegulationCategory::class, 'regulation_category_id', 'id');
    }
}
</file>

<file path="app/Models/RuleCategory.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class RuleCategory extends Model
{
    use HasFactory;
    protected $guarded = [];
}
</file>

<file path="app/Models/Setting.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class Setting extends Model
{
    use HasFactory;
}
</file>

<file path="database/factories/UserFactory.php">
<?php
namespace Database\Factories;
use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;
class UserFactory extends Factory
{
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi',
            'remember_token' => Str::random(10),
        ];
    }
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}
</file>

<file path="database/.gitignore">
*.sqlite*
</file>

<file path="database/migrations/2014_10_12_100000_create_password_reset_tokens_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('password_reset_tokens');
    }
};
</file>

<file path="database/migrations/2019_08_19_000000_create_failed_jobs_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('failed_jobs');
    }
};
</file>

<file path="database/migrations/2019_12_14_000001_create_personal_access_tokens_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('personal_access_tokens', function (Blueprint $table) {
            $table->id();
            $table->morphs('tokenable');
            $table->string('name');
            $table->string('token', 64)->unique();
            $table->text('abilities')->nullable();
            $table->timestamp('last_used_at')->nullable();
            $table->timestamp('expires_at')->nullable();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('personal_access_tokens');
    }
};
</file>

<file path="database/migrations/2024_09_25_094908_create_permission_tables.php">
<?php
use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;
return new class extends Migration
{
    public function up(): void
    {
        $teams = config('permission.teams');
        $tableNames = config('permission.table_names');
        $columnNames = config('permission.column_names');
        $pivotRole = $columnNames['role_pivot_key'] ?? 'role_id';
        $pivotPermission = $columnNames['permission_pivot_key'] ?? 'permission_id';
        if (empty($tableNames)) {
            throw new \Exception('Error: config/permission.php not loaded. Run [php artisan config:clear] and try again.');
        }
        if ($teams && empty($columnNames['team_foreign_key'] ?? null)) {
            throw new \Exception('Error: team_foreign_key on config/permission.php not loaded. Run [php artisan config:clear] and try again.');
        }
        Schema::create($tableNames['permissions'], function (Blueprint $table) {
            $table->bigIncrements('id');
            $table->string('name');
            $table->string('guard_name');
            $table->timestamps();
            $table->unique(['name', 'guard_name']);
        });
        Schema::create($tableNames['roles'], function (Blueprint $table) use ($teams, $columnNames) {
            $table->bigIncrements('id');
            if ($teams || config('permission.testing')) {
                $table->unsignedBigInteger($columnNames['team_foreign_key'])->nullable();
                $table->index($columnNames['team_foreign_key'], 'roles_team_foreign_key_index');
            }
            $table->string('name');
            $table->string('guard_name');
            $table->timestamps();
            if ($teams || config('permission.testing')) {
                $table->unique([$columnNames['team_foreign_key'], 'name', 'guard_name']);
            } else {
                $table->unique(['name', 'guard_name']);
            }
        });
        Schema::create($tableNames['model_has_permissions'], function (Blueprint $table) use ($tableNames, $columnNames, $pivotPermission, $teams) {
            $table->unsignedBigInteger($pivotPermission);
            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_permissions_model_id_model_type_index');
            $table->foreign($pivotPermission)
                ->references('id')
                ->on($tableNames['permissions'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_permissions_team_foreign_key_index');
                $table->primary([$columnNames['team_foreign_key'], $pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            } else {
                $table->primary([$pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            }
        });
        Schema::create($tableNames['model_has_roles'], function (Blueprint $table) use ($tableNames, $columnNames, $pivotRole, $teams) {
            $table->unsignedBigInteger($pivotRole);
            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_roles_model_id_model_type_index');
            $table->foreign($pivotRole)
                ->references('id')
                ->on($tableNames['roles'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_roles_team_foreign_key_index');
                $table->primary([$columnNames['team_foreign_key'], $pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            } else {
                $table->primary([$pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            }
        });
        Schema::create($tableNames['role_has_permissions'], function (Blueprint $table) use ($tableNames, $pivotRole, $pivotPermission) {
            $table->unsignedBigInteger($pivotPermission);
            $table->unsignedBigInteger($pivotRole);
            $table->foreign($pivotPermission)
                ->references('id')
                ->on($tableNames['permissions'])
                ->onDelete('cascade');
            $table->foreign($pivotRole)
                ->references('id')
                ->on($tableNames['roles'])
                ->onDelete('cascade');
            $table->primary([$pivotPermission, $pivotRole], 'role_has_permissions_permission_id_role_id_primary');
        });
        app('cache')
            ->store(config('permission.cache.store') != 'default' ? config('permission.cache.store') : null)
            ->forget(config('permission.cache.key'));
    }
    public function down(): void
    {
        $tableNames = config('permission.table_names');
        if (empty($tableNames)) {
            throw new \Exception('Error: config/permission.php not found and defaults could not be merged. Please publish the package configuration before proceeding, or drop the tables manually.');
        }
        Schema::drop($tableNames['role_has_permissions']);
        Schema::drop($tableNames['model_has_roles']);
        Schema::drop($tableNames['model_has_permissions']);
        Schema::drop($tableNames['roles']);
        Schema::drop($tableNames['permissions']);
    }
};
</file>

<file path="database/migrations/2024_10_02_075647_create_ruleof_meetings_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('ruleof_meetings', function (Blueprint $table) {
            $table->id();
            $table->integer('rule_category_id');
            $table->string('title');
            $table->string('rule_meeting_pdf')->nullable();
            $table->text('description')->nullable();
            $table->string('status')->default('1')->comment('1=active, 0=inactive');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('ruleof_meetings');
    }
};
</file>

<file path="database/migrations/2024_10_03_014542_create_rule_categories_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('rule_categories', function (Blueprint $table) {
            $table->id();
            $table->string('rule_category_name');
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('rule_categories');
    }
};
</file>

<file path="database/migrations/2024_10_04_031216_create_meeting_reports_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_reports', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('committee_category_id');
            $table->unsignedBigInteger('meeting_type_id');
            $table->string('title');
            $table->string('meeting_no');
            $table->date('date');
            $table->time('time');
            $table->string('year');
            $table->string('pdf')->nullable();
            $table->text('description')->nullable();
            $table->timestamps();
            $table->foreign('committee_category_id')->references('id')->on('committee_categories')->onDelete('cascade');
            $table->foreign('meeting_type_id')->references('id')->on('meeting_types')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_reports');
    }
};
</file>

<file path="database/migrations/2024_10_04_034110_create_committee_categories_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('committee_categories', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('committee_categories');
    }
};
</file>

<file path="database/migrations/2024_10_04_072740_create_meeting_types_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_types', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_types');
    }
};
</file>

<file path="database/migrations/2024_10_07_042706_create_meeting_agendas_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_agendas', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_type_id');
            $table->unsignedBigInteger('user_id');
            $table->string('meeting_agenda_title');
            $table->string('meeting_agenda_number');
            $table->string('meeting_agenda_year');
            $table->date('meeting_agenda_date');
            $table->time('meeting_agenda_time');
            $table->string('meeting_location');
            $table->text('description')->nullable();
            $table->string('status')->default('1')->comment('1=active, 0=inactive');
            $table->timestamps();
            $table->foreign('meeting_type_id')->references('id')->on('meeting_types')->onDelete('cascade');
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_agendas');
    }
};
</file>

<file path="database/migrations/2024_10_07_082831_create_meeting_agenda_sections_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_agenda_sections', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->string('section_title');
            $table->timestamps();
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_agenda_sections');
    }
};
</file>

<file path="database/migrations/2024_10_07_084921_create_meeting_agenda_lectures_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_agenda_lectures', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('meeting_agenda_section_id');
            $table->string('lecture_title');
            $table->text('content')->nullable();
            $table->timestamps();
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign('meeting_agenda_section_id')->references('id')->on('meeting_agenda_sections')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_agenda_lectures');
    }
};
</file>

<file path="database/migrations/2024_10_09_085954_create_meeting_formats_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_formats', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_formats');
    }
};
</file>

<file path="database/migrations/2024_10_09_150331_create_meeting_approvals_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_approvals', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_id');
            $table->unsignedBigInteger('meeting_type_id');
            $table->unsignedBigInteger('user_id');
            $table->unsignedBigInteger('committee_category_id');
            $table->unsignedBigInteger('meeting_format_id');
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('rule_of_meeting_id');
            $table->unsignedBigInteger('regulation_meeting_id');
            $table->unsignedBigInteger('meeting_agenda_lecture_id');
            $table->unsignedBigInteger('meeting_agenda_section_id');
            $table->unsignedBigInteger('meeting_agenda_items_id');
            $table->boolean('is_approved_without_changes');
            $table->text('changes')->nullable();
            $table->timestamps();
            $table->foreign(['meeting_id'], 'meeting_approvals_meeting_id_foreign')->references('id')->on('meetings')->onDelete('cascade');
            $table->foreign(['meeting_type_id'], 'meeting_approvals_meeting_type_id_foreign')->references('id')->on('meeting_types')->onDelete('cascade');
            $table->foreign(['user_id'], 'meeting_approvals_user_id_foreign')->references('id')->on('users')->onDelete('cascade');
            $table->foreign(['committee_category_id'], 'meeting_approvals_committee_category_id_foreign')->references('id')->on('committee_categories')->onDelete('cascade');
            $table->foreign(['meeting_format_id'], 'meeting_approvals_meeting_format_id_foreign')->references('id')->on('meeting_formats')->onDelete('cascade');
            $table->foreign(['meeting_agenda_id'], 'meeting_approvals_meeting_agenda_id_foreign')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign(['rule_of_meeting_id'], 'meeting_approvals_rule_of_meeting_id_foreign')->references('id')->on('ruleof_meetings')->onDelete('cascade');
            $table->foreign(['regulation_meeting_id'], 'meeting_approvals_regulation_meeting_id_foreign')->references('id')->on('regulation_meetings')->onDelete('cascade');
            $table->foreign(['meeting_agenda_lecture_id'], 'meeting_approvals_meeting_agenda_lecture_id_foreign')->references('id')->on('meeting_agenda_lectures')->onDelete('cascade');
            $table->foreign(['meeting_agenda_section_id'], 'meeting_approvals_meeting_agenda_section_id_foreign')->references('id')->on('meeting_agenda_sections')->onDelete('cascade');
            $table->foreign(['meeting_agenda_items_id'], 'meeting_approvals_meeting_agenda_items_id_foreign')->references('id')->on('meeting_agenda_items')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_approvals');
    }
};
</file>

<file path="database/migrations/2024_10_15_064839_create_meeting_approval_details_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_approval_details', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_approval_id');
            $table->unsignedBigInteger('meeting_agenda_section_id');
            $table->enum('approval_type', ['no_changes', 'with_changes']);
            $table->text('comments')->nullable();
            $table->timestamps();
            $table->foreign('meeting_approval_id')->references('id')->on('meeting_approvals')->onDelete('cascade');
            $table->foreign('meeting_agenda_section_id')->references('id')->on('meeting_agenda_sections')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_approval_details');
    }
};
</file>

<file path="database/migrations/2024_10_16_072352_create_prefix_names_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('prefix_names', function (Blueprint $table) {
            $table->id();
            $table->string('title');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('prefix_names');
    }
};
</file>

<file path="database/migrations/2024_10_16_101820_create_positions_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('positions', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->foreignId('parent_id')->nullable()->constrained('positions')->nullOnDelete();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('positions');
    }
};
</file>

<file path="database/migrations/2024_10_17_065442_create_department_user_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('department_user', function (Blueprint $table) {
            $table->id();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('department_user');
    }
};
</file>

<file path="database/migrations/2024_10_17_071859_create_committee_category_user_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('committee_category_user', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('committee_category_id');
            $table->unsignedBigInteger('user_id');
            $table->timestamps();
            $table->foreign('committee_category_id')->references('id')->on('committee_categories')->onDelete('cascade');
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
            $table->unique(['committee_category_id', 'user_id']);
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('committee_category_user');
    }
};
</file>

<file path="database/migrations/2024_10_18_082617_create_main_meetings_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('main_meetings', function (Blueprint $table) {
            $table->id();
            $table->string('title');
            $table->text('description')->nullable();
            $table->dateTime('meeting_date');
            $table->unsignedBigInteger('meeting_type_id');
            $table->unsignedBigInteger('committee_category_id');
            $table->timestamps();
            $table->softDeletes();
            $table->foreign('meeting_type_id')->references('id')->on('meeting_types')->onDelete('cascade');
            $table->foreign('committee_category_id')->references('id')->on('committee_categories')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('main_meetings');
    }
};
</file>

<file path="database/migrations/2024_10_18_100044_create_main_meeting_meeting_type_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('main_meeting_meeting_type', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('main_meeting_id');
            $table->unsignedBigInteger('meeting_type_id');
            $table->timestamps();
            $table->foreign('main_meeting_id')->references('id')->on('main_meetings')->onDelete('cascade');
            $table->foreign('meeting_type_id')->references('id')->on('meeting_types')->onDelete('cascade');
            $table->unique(['main_meeting_id', 'meeting_type_id']);
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('main_meeting_meeting_type');
    }
};
</file>

<file path="database/migrations/2024_10_18_100704_create_main_meeting_committee_category_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('main_meeting_committee_category', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('main_meeting_id');
            $table->unsignedBigInteger('committee_category_id');
            $table->timestamps();
            $table->foreign('main_meeting_id', 'mm_cc_main_meeting_id_foreign')
                ->references('id')
                ->on('main_meetings')
                ->onDelete('cascade');
            $table->foreign('committee_category_id', 'mm_cc_committee_category_id_foreign')
                ->references('id')
                ->on('committee_categories')
                ->onDelete('cascade');
            $table->unique(['main_meeting_id', 'committee_category_id'], 'mm_cc_unique');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('main_meeting_committee_category');
    }
};
</file>

<file path="database/migrations/2024_10_20_054946_create_meeting_type_user_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_type_user', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('user_id');
            $table->unsignedBigInteger('meeting_type_id');
            $table->timestamps();
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
            $table->foreign('meeting_type_id')->references('id')->on('meeting_types')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_type_user');
    }
};
</file>

<file path="database/migrations/2024_10_21_144527_create_meeting_views_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_views', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('user_id');
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->timestamps();
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_views');
    }
};
</file>

<file path="database/migrations/2024_10_21_154428_create_meeting_participants_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_participants', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('user_id');
            $table->boolean('has_approved')->default(false);
            $table->timestamps();
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_participants');
    }
};
</file>

<file path="database/migrations/2024_10_21_160450_create_settings_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('settings', function (Blueprint $table) {
            $table->id();
            $table->string('key')->unique();
            $table->string('value');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('settings');
    }
};
</file>

<file path="database/migrations/2024_10_23_152956_create_meeting_admin_edits_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_admin_edits', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('section_id');
            $table->text('comment');
            $table->unsignedBigInteger('edited_by');
            $table->timestamp('edited_at');
            $table->timestamps();
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign('section_id')->references('id')->on('meeting_agenda_sections')->onDelete('cascade');
            $table->foreign('edited_by')->references('id')->on('users');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_admin_edits');
    }
};
</file>

<file path="database/migrations/2024_10_24_154226_create_meeting_approval_histories_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_approval_histories', function (Blueprint $table) {
            $table->id();
            $table->foreignId('meeting_agenda_id')->constrained()->onDelete('cascade');
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->string('action');
            $table->text('note')->nullable();
            $table->timestamp('action_at');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_approval_histories');
    }
};
</file>

<file path="database/migrations/2024_10_26_160843_create_meeting_agenda_rule_of_meeting_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_agenda_rule_of_meeting', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('rule_of_meeting_id');
            $table->timestamps();
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign('rule_of_meeting_id')->references('id')->on('ruleof_meetings')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_agenda_rule_of_meeting');
    }
};
</file>

<file path="database/migrations/2024_10_27_151554_create_meeting_agenda_regulation_meeting_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_agenda_regulation_meeting', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('regulation_meeting_id');
            $table->timestamps();
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign('regulation_meeting_id')->references('id')->on('regulation_meetings')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_agenda_regulation_meeting');
    }
};
</file>

<file path="database/migrations/2024_11_12_031156_create_notifications_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('notifications', function (Blueprint $table) {
            $table->uuid('id')->primary();
            $table->string('type');
            $table->morphs('notifiable');
            $table->json('data');
            $table->timestamp('read_at')->nullable();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('notifications');
    }
};
</file>

<file path="database/seeders/DatabaseSeeder.php">
<?php
namespace Database\Seeders;
use Illuminate\Database\Seeder;
class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call(UserTableSeeder::class);
    }
}
</file>

<file path="database/seeders/UserTableSeeder.php">
<?php
namespace Database\Seeders;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Hash;
class UserTableSeeder extends Seeder
{
    public function run(): void
    {
        DB::table('users')->insert([
            [
                'first_name' => 'Admin',
                'last_name' => 'Admin',
                'title' => 'MR',
                'username' => 'admin',
                'email' => 'admin@gmail.com',
                'password' => Hash::make('111'),
                'role' => 'admin',
                'status' => '1',
            ],
            [
                'first_name' => 'User',
                'last_name' => 'User',
                'title' => 'MR',
                'username' => 'user',
                'email' => 'user@gmail.com',
                'password' => Hash::make('111'),
                'role' => 'user',
                'status' => '1',
            ],
        ]);
    }
}
</file>

<file path="resources/css/app.css">
@tailwind base;
@tailwind components;
@tailwind utilities;
</file>

<file path="resources/js/app.js">
import './bootstrap';
import Alpine from 'alpinejs';
window.Alpine = Alpine;
Alpine.start();
</file>

<file path="resources/js/bootstrap.js">
import axios from 'axios';
window.axios = axios;
window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
window.Pusher = require('pusher-js');
window.Echo = new Echo({
    broadcaster: 'pusher',
    key: process.env.MIX_PUSHER_APP_KEY,
    cluster: process.env.MIX_PUSHER_APP_CLUSTER,
    wsHost: window.location.hostname,
    wsPort: 6001,
    wssPort: 6001,
    forceTLS: false,
    disableStats: true,
});
</file>

<file path="resources/views/admin/backend/pages/approved_reports_by_admin/all_approved_report_by_admin.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <div class="container-fluid">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">รายงานการประชุมที่รับรองแล้ว</h5>
                    <div class="table-responsive">
                        <table id="approved-reports-table" class="table table-bordered dt-responsive nowrap" style="width:100%">
                            <thead>
                                <tr>
                                    <th>ประเภทการประชุม</th>
                                    <th>ครั้งที่/ปี</th>
                                    <th>วันที่ประชุม</th>
                                    <th>ผู้รับรอง</th>
                                    <th>วันที่รับรอง</th>
                                    <th>การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach ($approvedReports as $report)
                                    <tr>
                                        <td>{{ $report->meeting_type->name }}</td>
                                        <td>{{ $report->meeting_agenda_number }}/{{ $report->meeting_agenda_year }}</td>
                                        <td>{{ \Carbon\Carbon::parse($report->meeting_agenda_date)->format('d/m/Y') }}</td>
                                        <td>
                                            {{ $report->adminApprovedBy->first_name }}
                                            {{ $report->adminApprovedBy->last_name }}
                                        </td>
                                        <td>{{ \Carbon\Carbon::parse($report->admin_approved_at)->format('d/m/Y H:i') }}
                                        </td>
                                        <td>
                                            <a href="{{ route('list.approved.meeting.reports', $report->id) }}"
                                                class="btn btn-info btn-sm">
                                                <i class="fas fa-eye"></i> ดูรายละเอียด
                                            </a>
                                        </td>
                                    </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                    <script>
                        $(document).ready(function () {
                            $('#approved-reports-table').DataTable({
                                "pageLength": 25,
                                "lengthMenu": [
                                    [10, 25, 50, -1],
                                    [10, 25, 50, "All"]
                                ],
                                "language": {
                                    "url": "//cdn.datatables.net/plug-ins/1.10.25/i18n/Thai.json"
                                },
                                "columnDefs": [{
                                    "targets": [5],
                                    "orderable": false
                                }]
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/committee/committe_category/add_committee_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มประเภทคณะกรรมการ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มประเภทคณะกรรมการ</h5>
                <form id="myForm" action="{{ route('store.committee.category') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อประเภทคณะกรรมการ</label>
                        <input type="text" name="name" placeholder="เพิ่มประเภทสภา" class="form-control" id="input1" required>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10"></textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.committee.category') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/committee/committe_category/all_committee_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ประเภทคณะกรรมการ</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.committee.category') }}" class="btn btn-primary px-5">เพิ่มประเภทคณะกรรมการ </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ชื่อประเภทคณะกรรมการ</th>
                                <th>รายละเอียด</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($committee_category as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>{!! $item->description !!}</td>
                                    <td>
                                        <a href="{{ route('edit.committee.category', $item->id) }}" class="btn btn-info px-5">แก้ไข </a>
                                        <a href="{{ route('delete.committee.category', $item->id) }}" class="btn btn-danger px-5" id="delete">ลบ </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/committee/committe_category/edit_committee_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขประเภทคณะกรรมการ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขประเภทคณะกรรมการ</h5>
                <form id="myForm" action="{{ route('update.committee.category') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $category->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อประเภทคณะกรรมการ</label>
                        <input type="text" name="name" placeholder="เพิ่มประเภทสภา" class="form-control" id="input1" value="{{ $category->name }}">
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10" c>{!! $category->description !!}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.committee.category') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/lecture/edit_meeting_agenda_item.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Edit agenda Lecture</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting.agenda.lecture', ['id' => $meeting_agenda_item->meeting_agenda_id]) }}"
                        class="btn btn-primary px-5">Back </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Edit agenda Lecture</h5>
                <form id="myForm" action="{{ route('update.meeting.agenda.lecture') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $meeting_agenda_item->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Lecture Title</label>
                        <input type="text" name="lecture_title" class="form-control" id="input1" value="{{ $meeting_agenda_item->item_title }}">
                        <textarea name="lecture_description" class="form-control" id="input1" cols="30" rows="5">{{ $meeting_agenda_item->content }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/main_meeting/all_main_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ประชุมหลัก</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.main.meeting') }}" class="btn btn-primary  ">เพิ่มประชุมหลัก </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลําดับ</th>
                                <th>ประชุมหลัก</th>
                                <th>การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($main_meetings as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->title }}</td>
                                    <td>
                                        <a href="{{ route('edit.main.meeting', $item->id) }}" class="btn btn-info px-5">แก้ไข </a>
                                        <a href="{{ route('delete.main.meeting', $item->id) }}" class="btn btn-danger px-5"
                                            id="delete">ลบ </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting/add_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<div class="page-content">
    <!--breadcrumb-->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
        <div class="ps-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 p-0">
                    <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a></li>
                    <li class="breadcrumb-item active" aria-current="page">เพิ่มข้อมูลการประชุม</li>
                </ol>
            </nav>
        </div>
    </div>
    <!--end breadcrumb-->
    <div class="card">
        <div class="card-body p-4">
            <h5 class="mb-4">เพิ่มข้อมูลการประชุม</h5>
            <form id="meetingForm" action="{{ route('store.meeting') }}" method="post" class="row g-3" enctype="multipart/form-data">
                @csrf
                <div class="form-group col-md-6">
                    <label for="meeting_type_id" class="form-label">ประเภทการประชุม</label>
                    <select name="meeting_type_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกประเภทการประชุม</option>
                        @foreach ($meetingTypes as $type)
                            <option value="{{ $type->id }}">{{ $type->name }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="committee_category_id" class="form-label">ประเภทคณะกรรมการ</label>
                    <select name="committee_category_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกประเภทคณะกรรมการ</option>
                        @foreach ($committeeCategories as $category)
                            <option value="{{ $category->id }}">{{ $category->name }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="meeting_format_id" class="form-label">รูปแบบการประชุม</label>
                    <select name="meeting_format_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกรูปแบบการประชุม</option>
                        @foreach ($meetingFormats as $format)
                            <option value="{{ $format->id }}">{{ $format->name }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="meeting_agenda_id" class="form-label">ระเบียบวาระการประชุม</label>
                    <select name="meeting_agenda_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกระเบียบวาระการประชุม</option>
                        @foreach ($meetingAgendas as $agenda)
                            <option value="{{ $agenda->id }}">{{ $agenda->meeting_agenda_title }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="rule_of_meeting_id" class="form-label">กฎการประชุม</label>
                    <select name="rule_of_meeting_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกกฎการประชุม</option>
                        @foreach ($ruleOfMeetings as $rule)
                            <option value="{{ $rule->id }}">{{ $rule->title }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="regulation_meeting_id" class="form-label">ระเบียบการประชุม</label>
                    <select name="regulation_meeting_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกระเบียบการประชุม</option>
                        @foreach ($regulationMeetings as $regulation)
                            <option value="{{ $regulation->id }}">{{ $regulation->regulation_title }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="meeting_agenda_section_id" class="form-label">หมวดวาระการประชุม</label>
                    <select name="meeting_agenda_section_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกหมวดวาระการประชุม</option>
                        @foreach ($meetingAgendaSections as $section)
                            <option value="{{ $section->id }}">{{ $section->section_title }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="meeting_agenda_lecture_id" class="form-label">หัวข้อวาระการประชุม</label>
                    <select name="meeting_agenda_lecture_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกหัวข้อวาระการประชุม</option>
                        @foreach ($meetingAgendaLectures as $lecture)
                            <option value="{{ $lecture->id }}">{{ $lecture->lecture_title }}</option>
                        @endforeach
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="meeting_agenda_item_id" class="form-label">รายการวาระการประชุม</label>
                    <select name="meeting_agenda_item_id" class="form-select mb-3" required>
                        <option value="" selected disabled>เลือกรายการวาระการประชุม</option>
                        @foreach ($meetingAgendaItems as $item)
                            <option value="{{ $item->id }}">{{ $item->item_title }}</option>
                        @endforeach
                    </select>
                </div>
                {{-- <div class="form-group col-md-6">
                    <label for="title" class="form-label">ชื่อการประชุม</label>
                    <input type="text" name="title" class="form-control" required>
                </div> --}}
                {{-- <div class="form-group col-md-12">
                    <label for="description" class="form-label">รายละเอียดการประชุม</label>
                    <textarea name="description" class="form-control" rows="4"></textarea>
                </div> --}}
                <div class="col-md-12">
                    <div class="d-md-flex d-grid align-items-center gap-3">
                        <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                        <a href="" class="btn btn-danger px-4">ยกเลิก</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).ready(function() {
    $('#meetingForm').validate({
        rules: {
            meeting_type_id: { required: true },
            committee_category_id: { required: true },
            meeting_format_id: { required: true },
            meeting_agenda_id: { required: true },
            rule_of_meeting_id: { required: true },
            regulation_meeting_id: { required: true },
            meeting_agenda_section_id: { required: true },
            meeting_agenda_lecture_id: { required: true },
            meeting_agenda_item_id: { required: true },
            title: { required: true },
        },
        messages: {
            meeting_type_id: { required: 'กรุณาเลือกประเภทการประชุม' },
            committee_category_id: { required: 'กรุณาเลือกประเภทคณะกรรมการ' },
            meeting_format_id: { required: 'กรุณาเลือกรูปแบบการประชุม' },
            meeting_agenda_id: { required: 'กรุณาเลือกระเบียบวาระการประชุม' },
            rule_of_meeting_id: { required: 'กรุณาเลือกกฎการประชุม' },
            regulation_meeting_id: { required: 'กรุณาเลือกระเบียบการประชุม' },
            meeting_agenda_section_id: { required: 'กรุณาเลือกหมวดวาระการประชุม' },
            meeting_agenda_lecture_id: { required: 'กรุณาเลือกหัวข้อวาระการประชุม' },
            meeting_agenda_item_id: { required: 'กรุณาเลือกรายการวาระการประชุม' },
            title: { required: 'กรุณากรอกชื่อการประชุม' },
        },
        errorElement: 'span',
        errorPlacement: function(error, element) {
            error.addClass('invalid-feedback');
            element.closest('.form-group').append(error);
        },
        highlight: function(element, errorClass, validClass) {
            $(element).addClass('is-invalid');
        },
        unhighlight: function(element, errorClass, validClass) {
            $(element).removeClass('is-invalid');
        },
    });
});
</script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting/all_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ประชุม</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting') }}" class="btn btn-primary">เพิ่มการประชุม</a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ประเภทการประชุม</th>
                                <th>รูปแบบการประชุม</th>
                                {{-- <th>ชือประชุม</th> --}}
                                <th>status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($meetings as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->meetingType->name }}</td>
                                    <td>{{ $item->meetingFormat->name }}</td>
                                    {{-- <td>{{ $item->title }}</td> --}}
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="status{{ $item->id }}"
                                                {{ $item->status == 1 ? 'checked' : '' }}
                                                onchange="updateStatus({{ $item->id }})">
                                            <label class="form-check-label" for="status{{ $item->id }}">
                                            </label>
                                        </div>                                    </td>
                                    <td>
                                        <a href=""
                                            class="btn btn-info px-2"><i class="bx bx-edit"></i></a>
                                        <a href=""
                                            class="btn btn-danger px-2" id="delete"><i class="bx bx-trash"></i></a>
                                        <a href=""
                                            class="btn btn-warning px-2" title="MeetingAgendaLecture"><i class="lni lni-list"></i></a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        function updateStatus(id) {
            if (id) {
                $.ajax({
                    type: 'POST',
                    url: "{{ route('update.status.meeting.agenda', ':id') }}".replace(':id', id),
                    data: {
                        _token: "{{ csrf_token() }}"
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.status == 1) {
                            $('#status' + id).prop('checked', true);
                        } else {
                            $('#status' + id).prop('checked', false);
                        }
                        toastr.success(response.message);
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error('An error occurred while updating the status.');
                    }
                });
            } else {
                toastr.error('Missing required parameter: id');
            }
        }
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail_2.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
@php
    use Carbon\Carbon;
    Carbon::setLocale('th');
    $meeting_date = Carbon::parse($my_meetings->meeting_date);
    $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
    $thai_months = [
        1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน', 5 => 'พฤษภาคม', 6 => 'มิถุนายน',
        7 => 'กรกฎาคม', 8 => 'สิงหาคม', 9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม',
    ];
    $thai_day = $thai_days[$meeting_date->dayOfWeek];
    $thai_month = $thai_months[$meeting_date->month];
    $thai_date = "วัน{$thai_day}ที่ " . $meeting_date->day . ' ' . $thai_month . ' พ.ศ. ' . ($meeting_date->year + 543);
@endphp
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-5">
                    <div class="text-center mb-5">
                        <h5 class="mb-3 text-primary">{{ $my_meetings->meeting_agenda_title }}</h5>
                        <div class="d-inline-block p-3 border border-primary rounded">
                            <p class="mb-1"><strong>การประชุมครั้งที่:</strong> {{ $my_meetings->meeting_agenda_number }} / {{ $my_meetings->meeting_agenda_year }}</p>
                            <p class="mb-1"><strong>วันที่:</strong> {{ $thai_date }}</p>
                            <p class="mb-0"><strong>สถานที่:</strong> {{ $my_meetings->meeting_location }}</p>
                        </div>
                    </div>
                    <form id="meetingApprovalForm">
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="selectAll">
                                <label class="form-check-label" for="selectAll">
                                    เลือกทั้งหมด
                                </label>
                            </div>
                        </div>
                        @php
                            $sections = App\Models\MeetingAgendaSection::where('meeting_agenda_id', $my_meetings->id)
                                ->orderBy('id', 'asc')
                                ->get();
                        @endphp
                        @foreach ($sections as $index => $section)
                            <div class="mb-5">
                                <div class="d-flex align-items-center mb-3 pb-2 border-bottom">
                                    <input type="checkbox" id="section_{{ $section->id }}" name="approved_sections[]" value="{{ $section->id }}" class="form-check-input section-checkbox me-2" style="display: none;">
                                    <h5 class="mb-0">{{ $section->section_title }}</h5>
                                </div>
                                @if ($section->description != null)
                                    <div class="ms-4 mb-3">
                                        <p>{!! $section->description !!}</p>
                                    </div>
                                @endif
                                @php
                                    $lectures = App\Models\MeetingAgendaLecture::where('meeting_agenda_section_id', $section->id)->get();
                                    $agendaItems = App\Models\MeetingAgendaItems::where('meeting_agenda_section_id', $section->id)
                                        ->orderBy('id', 'asc')
                                        ->get();
                                @endphp
                                @foreach ($lectures as $lectureIndex => $lecture)
                                    <div class="ms-4 mb-3">
                                        <div class="ms-4 bg-light p-3 rounded">
                                            <h6 class="mb-2">{{ $lecture->lecture_title }}</h6>
                                            @if ($lecture->content)
                                                <div class="mb-2">{!! $lecture->content !!}</div>
                                            @endif
                                        </div>
                                        @php
                                            $lectureItems = $agendaItems->where('meeting_agenda_lecture_id', $lecture->id);
                                        @endphp
                                        @if ($lectureItems->count() > 0)
                                            <ul class="list-unstyled ms-4">
                                                @foreach ($lectureItems as $itemIndex => $item)
                                                    <li class="mb-3">
                                                        <div class="ms-4 bg-light p-3 rounded">
                                                            <h6 class="mb-2">{{ $item->item_title }}</h6>
                                                            @if ($item->content)
                                                                <div>{!! $item->content !!}</div>
                                                            @endif
                                                        </div>
                                                    </li>
                                                @endforeach
                                            </ul>
                                        @endif
                                    </div>
                                @endforeach
                                @php
                                    $sectionItems = $agendaItems->whereNull('meeting_agenda_lecture_id');
                                @endphp
                                @if ($sectionItems->count() > 0)
                                    <ul class="list-unstyled ms-4">
                                        @foreach ($sectionItems as $itemIndex => $item)
                                            <li class="mb-3">
                                                <div class="ms-4 bg-light p-3 rounded">
                                                    <h6 class="mb-2">{{ $section->section_title }}.{{ $itemIndex + 1 }} {{ $item->item_title }}</h6>
                                                    @if ($item->content)
                                                        <div>{!! $item->content !!}</div>
                                                    @endif
                                                </div>
                                            </li>
                                        @endforeach
                                    </ul>
                                @endif
                                @if ($section->description == null && $lectures->count() == 0 && $agendaItems->count() == 0)
                                    <p class="ms-4 text-muted fst-italic">ไม่มีรายการในวาระนี้</p>
                                @endif
                            </div>
                        @endforeach
                        <div style="width: 100%;" class="p-3 border border-secondary rounded mb-4">
                            <p class="mb-0 text-center text-secondary fst-italic">* ท่านสามารถดูรายละเอียดเอกสารที่เกี่ยวกับการประชุม</p>
                            @php
                                $meeting_formats = App\Models\MeetingFormat::where('id', $my_meetings->meeting_format_id)->get();
                            @endphp
                            @if ($meeting_formats->count() > 0)
                                <ul class="list-group list-group-flush">
                                    @foreach ($meeting_formats as $meeting_format)
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <p class="mb-0"><strong>รูปแบบการประชุม:</strong> {{ $meeting_format->name }}</p>
                                        </li>
                                    @endforeach
                                </ul>
                            @else
                                <p class="text-muted">ไม่มีข้อมูลรูปแบบการประชุม</p>
                            @endif
                            @php
                                $regulations = App\Models\RegulationMeeting::where('id', $my_meetings->regulation_meeting_id)->get();
                            @endphp
                            @if ($regulations->count() > 0)
                                <ul class="list-group list-group-flush">
                                    @foreach ($regulations as $regulation)
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <p class="mb-0"><strong>ระเบียบ:</strong> <a href="{{ asset($regulation->regulation_pdf) }}" target="_blank"><span class="badge rounded-pill bg-info text-dark">ดูรายละเอียด</span></a></p>
                                        </li>
                                    @endforeach
                                </ul>
                            @else
                                <p class="text-muted">ไม่มีข้อมูลระเบียบ</p>
                            @endif
                        </div>
                        <div style="margin-top: 2rem;"></div>
                        <div class="mb-4 p-3 border border-danger rounded" style="width: 100%;">
                            <h5 class="mb-3">การรับรองการประชุม</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="approval_type" id="noChanges" value="no_changes" checked>
                                <label class="form-check-label" for="noChanges">
                                    รับรองโดยไม่มีข้อแก้ไข
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="approval_type" id="withChanges" value="with_changes">
                                <label class="form-check-label" for="withChanges">
                                    รับรองโดยมีข้อแก้ไข
                                </label>
                            </div>
                            <div id="commentsSection" class="mt-3" style="display: none;">
                                <textarea class="form-control" id="comments" name="comments" rows="4" placeholder="กรุณาระบุข้อแก้ไข"></textarea>
                            </div>
                            <div class="mt-4">
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success"><i class="bx bx-check-circle me-2"></i>บันทึกการรับรอง</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('#selectAll').change(function() {
            if($(this).prop('checked')) {
                $('.section-checkbox').show();
            } else {
                $('.section-checkbox').hide();
            }
            $('.section-checkbox').prop('checked', $(this).prop('checked'));
        });
        $('.section-checkbox').change(function() {
            if ($('.section-checkbox:visible:checked').length == $('.section-checkbox:visible').length) {
                $('#selectAll').prop('checked', true);
            } else {
                $('#selectAll').prop('checked', false);
            }
        });
        $('input[name="approval_type"]').change(function() {
            if ($(this).val() === 'with_changes') {
                $('#commentsSection').show();
            } else {
                $('#commentsSection').hide();
            }
        });
        $('#meetingApprovalForm').submit(function(e) {
            e.preventDefault();
            console.log('Form submitted');
        });
    });
</script>
@endsection
@push('styles')
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Kanit', sans-serif;
        line-height: 1.6;
        background-color:
    }
    h5 {
        font-size: 1.25rem;
        font-weight: 700;
        color:
    }
    h6 {
        font-size: 1rem;
        font-weight: 600;
        color:
    }
    p {
        font-size: 0.9rem;
        font-weight: 400;
        color:
    }
    strong {
        font-weight: 500;
    }
    .card {
        border: none;
        border-radius: 15px;
    }
    .card-body {
        background-color:
    }
    .border-primary {
        border-color:
    }
    .text-primary {
        color:
    }
    .bg-light {
        background-color:
    }
</style>
@endpush
</file>

<file path="resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail_3.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
@php
    use Carbon\Carbon;
    Carbon::setLocale('th');
    $meeting_date = Carbon::parse($my_meetings->meeting_date);
    $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
    $thai_months = [
        1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน', 5 => 'พฤษภาคม', 6 => 'มิถุนายน',
        7 => 'กรกฎาคม', 8 => 'สิงหาคม', 9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม',
    ];
    $thai_day = $thai_days[$meeting_date->dayOfWeek];
    $thai_month = $thai_months[$meeting_date->month];
    $thai_date = "วัน{$thai_day}ที่ " . $meeting_date->day . ' ' . $thai_month . ' พ.ศ. ' . ($meeting_date->year + 543);
@endphp
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-5">
                    <div class="text-center mb-5">
                        <h5 class="mb-3 text-primary">{{ $my_meetings->meeting_agenda_title }}</h5>
                        <div class="d-inline-block p-3 border border-primary rounded">
                            <h5 class="mb-1">การประชุมครั้งที่: {{ $my_meetings->meeting_agenda_number }} / {{ $my_meetings->meeting_agenda_year }}</h5>
                            <h5 class="mb-1">วันที่: {{ $thai_date }}</h5>
                            <h5 class="mb-0">สถานที่:{{ $my_meetings->meeting_location }}</h5>
                        </div>
                    </div>
                    @php
                        $sections = App\Models\MeetingAgendaSection::where('meeting_agenda_id', $my_meetings->id)
                            ->orderBy('id', 'asc')
                            ->get();
                    @endphp
                    @foreach ($sections as $index => $section)
                        <div class="mb-5">
                            <div class="d-flex align-items-center mb-3 pb-2 border-bottom">
                                <h5 class="mb-0">{{ $section->section_title }}</h5>
                            </div>
                            @if ($section->description != null)
                                <div class="ms-4 mb-3">
                                    <p>{!! $section->description !!}</p>
                                </div>
                            @endif
                            @php
                                $lectures = App\Models\MeetingAgendaLecture::where('meeting_agenda_section_id', $section->id)->get();
                                $agendaItems = App\Models\MeetingAgendaItems::where('meeting_agenda_section_id', $section->id)
                                    ->orderBy('id', 'asc')
                                    ->get();
                            @endphp
                            @foreach ($lectures as $lectureIndex => $lecture)
                                <div class="ms-4 mb-3">
                                    <div class="ms-4 bg-light p-3 rounded">
                                        <h6 class="mb-2">{{ $lecture->lecture_title }}</h6>
                                        @if ($lecture->content)
                                            <div class="mb-2">{!! $lecture->content !!}</div>
                                        @endif
                                    </div>
                                    @php
                                        $lectureItems = $agendaItems->where('meeting_agenda_lecture_id', $lecture->id);
                                    @endphp
                                    @if ($lectureItems->count() > 0)
                                        <ul class="list-unstyled ms-4">
                                            @foreach ($lectureItems as $itemIndex => $item)
                                                <li class="mb-3">
                                                    <div class="ms-4 bg-light p-3 rounded">
                                                        <h6 class="mb-2">{{ $item->item_title }}</h6>
                                                        @if ($item->content)
                                                            <div>{!! $item->content !!}</div>
                                                        @endif
                                                    </div>
                                                </li>
                                            @endforeach
                                        </ul>
                                    @endif
                                </div>
                            @endforeach
                            @php
                                $sectionItems = $agendaItems->whereNull('meeting_agenda_lecture_id');
                            @endphp
                            @if ($sectionItems->count() > 0)
                                <ul class="list-unstyled ms-4">
                                    @foreach ($sectionItems as $itemIndex => $item)
                                        <li class="mb-3">
                                            <div class="ms-4 bg-light p-3 rounded">
                                                <h6 class="mb-2">{{ $section->section_title }}.{{ $itemIndex + 1 }} {{ $item->item_title }}</h6>
                                                @if ($item->content)
                                                    <div>{!! $item->content !!}</div>
                                                @endif
                                            </div>
                                        </li>
                                    @endforeach
                                </ul>
                            @endif
                            @if ($section->description == null && $lectures->count() == 0 && $agendaItems->count() == 0)
                                <p class="ms-4 text-muted fst-italic">-ไม่มีรายการ-</p>
                            @endif
                        </div>
                    @endforeach
                    <div style="width: 100%;" class="p-3 border border-secondary rounded mb-4">
                        <p class="mb-0 text-center text-secondary fst-italic">* ท่านสามารถดูรายละเอียดเอกสารที่เกี่ยวกับการประชุม</p>
                        @php
                            $meeting_formats = App\Models\MeetingFormat::where('id', $my_meetings->meeting_format_id)->get();
                        @endphp
                        @if ($meeting_formats->count() > 0)
                            <ul class="list-group list-group-flush">
                                @foreach ($meeting_formats as $meeting_format)
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <p class="mb-0"><strong>รูปแบบการประชุม:</strong> {{ $meeting_format->name }}</p>
                                    </li>
                                @endforeach
                            </ul>
                        @else
                            <p class="text-muted">ไม่มีข้อมูลรูปแบบการประชุม</p>
                        @endif
                        @php
                            $regulations = App\Models\RegulationMeeting::where('id', $my_meetings->regulation_meeting_id)->get();
                        @endphp
                        @if ($regulations->count() > 0)
                            <ul class="list-group list-group-flush">
                                @foreach ($regulations as $regulation)
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <p class="mb-0"><strong>ระเบียบ:</strong> <a href="{{ asset($regulation->regulation_pdf) }}" target="_blank"><span class="badge rounded-pill bg-info text-dark">ดูรายละเอียด</span></a></p>
                                    </li>
                                @endforeach
                            </ul>
                        @else
                            <p class="text-muted">ไม่มีข้อมูลระเบียบ</p>
                        @endif
                    </div>
                    <!-- ส่วนการรับรองรายงานการประชุม -->
                    <form id="meetingApprovalForm">
                        <div class="mb-4 p-3 border border-danger rounded" style="width: 100%;">
                            <h6 class="mb-3">การรับรองรายงานการประชุม</h6>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="approval_type" id="noChanges" value="no_changes" checked>
                                <label class="form-check-label" for="noChanges">
                                    รับรองโดยไม่มีข้อแก้ไข
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="approval_type" id="withChanges" value="with_changes">
                                <label class="form-check-label" for="withChanges">
                                    รับรองโดยมีข้อแก้ไข
                                </label>
                            </div>
                            <div id="commentsSection" class="mt-3" style="display: none;">
                                <textarea class="form-control" id="comments" name="comments" rows="4" placeholder="กรุณาระบุข้อแก้ไข"></textarea>
                            </div>
                            <div class="mt-4">
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success"><i class="bx bx-check-circle me-2"></i>บันทึกการรับรอง</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('input[name="approval_type"]').change(function() {
            if ($(this).val() === 'with_changes') {
                $('#commentsSection').show();
            } else {
                $('#commentsSection').hide();
            }
        });
        $('#meetingApprovalForm').submit(function(e) {
            e.preventDefault();
            console.log('Form submitted');
        });
    });
</script>
@endsection
@push('styles')
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Kanit', sans-serif;
        line-height: 1.6;
        background-color:
    }
    h5 {
        font-size: 1.25rem;
        font-weight: 700;
        color:
    }
    h6 {
        font-size: 1rem;
        font-weight: 600;
        color:
    }
    p {
        font-size: 0.9rem;
        font-weight: 400;
        color:
    }
    strong {
        font-weight: 500;
    }
    .card {
        border: none;
        border-radius: 15px;
    }
    .card-body {
        background-color:
    }
    .border-primary {
        border-color:
    }
    .text-primary {
        color:
    }
    .bg-light {
        background-color:
    }
</style>
@endpush
</file>

<file path="resources/views/admin/backend/pages/meeting_approval/##meeting_approval_detail.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
@php
    use Carbon\Carbon;
    Carbon::setLocale('th');
    $meeting_date = Carbon::parse($my_meetings->meeting_date);
    $approval_date = Carbon::parse($my_meetings->approval_date);
    $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
    $thai_months = [
        1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน', 5 => 'พฤษภาคม', 6 => 'มิถุนายน',
        7 => 'กรกฎาคม', 8 => 'สิงหาคม', 9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม',
    ];
    $thai_date = "วัน" . $thai_days[$meeting_date->dayOfWeek] . "ที่ " . $meeting_date->day . ' ' . $thai_months[$meeting_date->month] . ' พ.ศ. ' . ($meeting_date->year + 543);
    $thai_date_approval = "วัน" . $thai_days[$approval_date->dayOfWeek] . "ที่ " . $approval_date->day . ' ' . $thai_months[$approval_date->month] . ' พ.ศ. ' . ($approval_date->year + 543);
@endphp
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-5">
                    <div class="text-center mb-5">
                        <h5 class="mb-3 text-primary">{{ $my_meetings->meeting_agenda_title }}</h5>
                        <div class="d-inline-block p-3 border border-primary rounded">
                            <p class="mb-1"><strong>การประชุมครั้งที่:</strong> {{ $my_meetings->meeting_agenda_number }} / {{ $my_meetings->meeting_agenda_year }}</p>
                            <p class="mb-1"><strong>วันที่:</strong> {{ $thai_date }}</p>
                            <p class="mb-0"><strong>สถานที่:</strong> {{ $my_meetings->meeting_location }}</p>
                        </div>
                    </div>
                    <!-- แสดงรายการการรับรองที่มีอยู่ -->
                    @if($approvals->isNotEmpty())
                        <h6 class="mb-3 text-danger">การรับรองที่มีอยู่:</h6>
                        <ul class="list-group mb-4">
                            @foreach($approvals as $approval)
                                <li class="list-group-item bg-danger text-white">
                                    <strong>ผู้รับรอง:</strong> {{ $approval->user->first_name }}
                                    <strong>วันที่รับรอง:</strong> {{ $thai_date_approval }}
                                    <button class="btn btn-sm btn-danger float-end show-details" data-approval-id="{{ $approval->id }}">รายละเอียด</button>
                                </li>
                            @endforeach
                        </ul>
                    @endif
                    <!-- ฟอร์มสำหรับการรับรองใหม่ -->
                    <form id="meetingApprovalForm" action="{{ route('meeting.approval.store', $my_meetings->id) }}" method="POST">
                        @csrf
                        <input type="hidden" name="meeting_agenda_id" value="{{ $my_meetings->id }}">
                        <input type="hidden" name="meeting_type_id" value="{{ $my_meetings->meeting_type_id }}">
                        <input type="hidden" name="user_id" value="{{ Auth::user()->id }}">
                        <input type="hidden" name="committee_category_id" value="{{ $my_meetings->committee_category_id }}">
                        <input type="hidden" name="meeting_format_id" value="{{ $my_meetings->meeting_format_id }}">
                        <input type="hidden" name="rule_of_meeting_id" value="{{ $my_meetings->rule_of_meeting_id }}">
                        <input type="hidden" name="regulation_meeting_id" value="{{ $my_meetings->regulation_meeting_id }}">
                        @php
                            $sections = App\Models\MeetingAgendaSection::where('meeting_agenda_id', $my_meetings->id)
                                ->orderBy('id', 'asc')
                                ->get();
                        @endphp
                        @foreach ($sections as $index => $section)
                        <div class="mb-5">
                            <div class="d-flex align-items-center mb-3 pb-2 border-bottom">
                                <h5 class="mb-0">{{ $section->section_title }}</h5>
                            </div>
                            @php
                                $hasContent = false;
                                if ($section->description != null) {
                                    $hasContent = true;
                                }
                                $lectures = App\Models\MeetingAgendaLecture::where('meeting_agenda_section_id', $section->id)->get();
                                $agendaItems = App\Models\MeetingAgendaItems::where('meeting_agenda_section_id', $section->id)
                                    ->orderBy('id', 'asc')
                                    ->get();
                                if ($lectures->count() > 0 || $agendaItems->count() > 0) {
                                    $hasContent = true;
                                }
                            @endphp
                            @if ($section->description != null)
                                <div class="ms-4 mb-3">
                                    <p>{!! $section->description !!}</p>
                                </div>
                            @endif
                            @foreach ($lectures as $lectureIndex => $lecture)
                                <div class="ms-4 mb-3">
                                    <div class="ms-4 bg-light p-3 rounded">
                                        <h6 class="mb-2">{{ $lecture->lecture_title }}</h6>
                                        @if ($lecture->content)
                                            <div class="mb-2">{!! $lecture->content !!}</div>
                                        @endif
                                    </div>
                                    @php
                                        $lectureItems = $agendaItems->where('meeting_agenda_lecture_id', $lecture->id);
                                    @endphp
                                    @if ($lectureItems->count() > 0)
                                        <ul class="list-unstyled ms-4">
                                            @foreach ($lectureItems as $itemIndex => $item)
                                                <li class="mb-3">
                                                    <div class="ms-4 bg-light p-3 rounded">
                                                        <h6 class="mb-2">{{ $item->item_title }}</h6>
                                                        @if ($item->content)
                                                            <div>{!! $item->content !!}</div>
                                                        @endif
                                                    </div>
                                                </li>
                                            @endforeach
                                        </ul>
                                    @endif
                                </div>
                            @endforeach
                            @php
                                $sectionItems = $agendaItems->whereNull('meeting_agenda_lecture_id');
                            @endphp
                            @if ($sectionItems->count() > 0)
                                <ul class="list-unstyled ms-4">
                                    @foreach ($sectionItems as $itemIndex => $item)
                                        <li class="mb-3">
                                            <div class="ms-4 bg-light p-3 rounded">
                                                <h6 class="mb-2">{{ $section->section_title }}.{{ $itemIndex + 1 }} {{ $item->item_title }}</h6>
                                                @if ($item->content)
                                                    <div>{!! $item->content !!}</div>
                                                @endif
                                            </div>
                                        </li>
                                    @endforeach
                                </ul>
                            @endif
                            @if (!$hasContent)
                                <p class="ms-4 text-muted fst-italic">ไม่มีรายการในวาระนี้</p>
                            @else
                                <div class="approval-section mt-3">
                                    <div class="mb-4 p-3 border border-danger rounded" style="width: 100%;">
                                        <h6 class="mb-3">การรับรองรายงานการประชุม - {{ $section->section_title }}</h6>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="approvals[{{ $section->id }}][type]" id="noChanges_{{ $section->id }}" value="no_changes" checked>
                                            <label class="form-check-label" for="noChanges_{{ $section->id }}">
                                                รับรองโดยไม่มีข้อแก้ไข
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="approvals[{{ $section->id }}][type]" id="withChanges_{{ $section->id }}" value="with_changes">
                                            <label class="form-check-label" for="withChanges_{{ $section->id }}">
                                                รับรองโดยมีข้อแก้ไข
                                            </label>
                                        </div>
                                        <div id="commentsSection_{{ $section->id }}" class="mt-3" style="display: none;">
                                            <textarea class="form-control" name="approvals[{{ $section->id }}][comments]" rows="4" placeholder="กรุณาระบุข้อแก้ไข"></textarea>
                                        </div>
                                    </div>
                                </div>
                            @endif
                        </div>
                        @endforeach
                        <div style="width: 100%;" class="p-3 border border-danger rounded">
                            @php
                                $meeting_formats = App\Models\MeetingFormat::where('id', $my_meetings->meeting_format_id)->get();
                            @endphp
                            @if ($meeting_formats->count() > 0)
                                <ul class="list-group list-group-flush">
                                    @foreach ($meeting_formats as $meeting_format)
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <p class="mb-0"><strong>รูปแบบการประชุม:</strong> {{ $meeting_format->name }}</p>
                                        </li>
                                    @endforeach
                                </ul>
                            @else
                                <p class="text-muted">ไม่มีข้อมูลรูปแบบการประชุม</p>
                            @endif
                            @php
                                $regulations = App\Models\RegulationMeeting::where('id', $my_meetings->regulation_meeting_id)->get();
                            @endphp
                            @if ($regulations->count() > 0)
                                <ul class="list-group list-group-flush">
                                    @foreach ($regulations as $regulation)
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <p class="mb-0"><strong>ระเบียบ:</strong> <a href="{{ asset($regulation->regulation_pdf) }}" target="_blank"><span class="badge rounded-pill bg-info text-dark">ดูรายละเอียด</span></a></p>
                                        </li>
                                    @endforeach
                                </ul>
                            @else
                                <p class="text-muted">ไม่มีข้อมูลระเบียบ</p>
                            @endif
                        </div>
                        <div style="margin-top: 2rem;"><hr></div>
                        <div class="mt-4">
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success"><i class="bx bx-check-circle me-2"></i>บันทึกการรับรอง</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal สำหรับแสดงรายละเอียดการรับรอง -->
<div class="modal fade" id="approvalDetailsModal" tabindex="-1" aria-labelledby="approvalDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="approvalDetailsModalLabel">รายละเอียดการรับรอง</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="approvalDetailsContent">
                <!-- รายละเอียดการรับรองจะถูกใส่ที่นี่ด้วย JavaScript -->
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('input[name^="approvals"][name$="[type]"]').change(function() {
            var sectionId = $(this).attr('name').match(/\d+/)[0];
            if ($(this).val() === 'with_changes') {
                $('#commentsSection_' + sectionId).show();
            } else {
                $('#commentsSection_' + sectionId).hide();
            }
        });
        $('#meetingApprovalForm').submit(function(e) {
            e.preventDefault();
            var formData = $(this).serialize();
            $.ajax({
                url: $(this).attr('action'),
                method: 'POST',
                data: formData,
                success: function(response) {
                    alert(response.message);
                    window.location.href = "{{ route('all.meeting.approval') }}";
                },
                error: function(xhr) {
                    alert('เกิดข้อผิดพลาดในการบันทึกข้อมูล');
                    console.error(xhr.responseText);
                }
            });
        });
        $('.show-details').click(function() {
            var approvalId = $(this).data('approval-id');
            $.ajax({
                url: '/meeting-approval-details/' + approvalId,
                method: 'GET',
                success: function(response) {
                    $('#approvalDetailsContent').html(response);
                    $('#approvalDetailsModal').modal('show');
                },
                error: function(xhr) {
                    alert('เกิดข้อผิดพลาดในการโหลดข้อมูล');
                    console.error(xhr.responseText);
                }
            });
        });
    });
</script>
@endsection
@push('styles')
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Kanit', sans-serif;
        line-height: 1.6;
        background-color:
    }
    h5 {
        font-size: 1.25rem;
        font-weight: 700;
        color:
    }
    h6 {
        font-size: 1rem;
        font-weight: 600;
        color:
    }
    p {
        font-size: 0.9rem;
        font-weight: 400;
        color:
    }
    strong {
        font-weight: 500;
    }
    .card {
        border: none;
        border-radius: 15px;
    }
    .card-body {
        background-color:
    }
    .border-primary {
        border-color:
    }
    .text-primary {
        color:
    }
    .bg-light {
        background-color:
    }
</style>
@endpush
</file>

<file path="resources/views/admin/backend/pages/meeting_format/add_meeting_format.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มรูปแบบการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มรูปแบบการประชุม</h5>
                <form id="myForm" action="{{ route('store.meeting.format') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">รูปแบบการประชุม</label>
                        <input type="text" name="name" placeholder="ชื่อรูปแบบการประชุม" class="form-control" id="input1" required>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10"></textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.meeting.format') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_format/all_meeting_format.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">รูปแบบการประชุม</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting.format') }}" class="btn btn-primary px-5">เพิ่มรูปแบบการประชุม</a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลําดับ</th>
                                <th>รูปแบบการประชุม</th>
                                <th>รายละเอียด</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($m_format as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>{!! $item->description !!}</td>
                                    <td>
                                        <a href="{{ route('edit.meeting.format', $item->id) }}" class="btn btn-info px-5">แก้ไข </a>
                                        <a href="" class="btn btn-danger px-5"
                                            id="delete">ลบ </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_format/edit_meeting_format.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขรูปแบบการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขรูปแบบการประชุม</h5>
                <form id="myForm" action="{{ route('update.meeting.format') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $m_format->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">รูปแบบการประชุม</label>
                        <input type="text" name="name" placeholder="Enter Rule Category Name" class="form-control" id="input1" value="{{ $m_format->name }}">
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10" c>{!! $m_format->description !!}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">แก้ไข</button>
                            <a href="{{ route('all.meeting.format') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting/my_all_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0">วาระการประชุม</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        @foreach ($my_meetings as $item)
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="rounded-circle bg-primary p-1 me-3">
                                    <img src="{{ asset('uploads/no_image.jpg') }}" class="rounded-circle"
                                        width="90" height="90" alt="...">
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <a href="{{ route('meeting.detail', $item->id) }}" class="text-decoration-none text-dark">
                                            {{ $item->meeting_agenda_title }}
                                        </a>
                                    </h5>
                                    <h6 class="card-subtitle mb-2 text-muted">
                                        ครั้งที่ {{ $item->meeting_agenda_number }} / {{ $item->meeting_agenda_year }}
                                    </h6>
                                    <p class="card-text">
                                        <small class="text-muted">
                                            สร้างโดย: {{ $item->user->first_name }} {{ $item->user->last_name }}
                                        </small>
                                    </p>
                                    <p class="card-text">
                                        <small class="text-muted">
                                            <i class="bi bi-calendar-event me-1"></i>
                                            ปรับปรุงข้อมูลวันที่ {{ $item->created_at->format('d M Y') }}
                                        </small>
                                    </p>
                                    @php
                                        $section = App\Models\MeetingAgendaSection::where('meeting_agenda_id', $item->id)->get();
                                    @endphp
                                    <p class="card-text">
                                        <span class="badge bg-primary">
                                            วาระการประชุม: {{ count($section) }} รายการ
                                        </span>
                                    </p>
                                </div>
                                <div class="card-footer bg-white border-top-0">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <a href="{{ route('meeting.detail', $item->id) }}" class="btn btn-outline-primary btn-sm">
                                            <i class="bi bi-eye me-1"></i> ดูรายละเอียด
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @endforeach
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection
@push('styles')
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
@endpush
</file>

<file path="resources/views/admin/backend/pages/meeting_report/meeting_type/add_meeting_type.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มประเภทการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มประเภทการประชุม</h5>
                <form id="myForm" action="{{ route('store.meeting.type') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อประเภทการประชุม</label>
                        <input type="text" name="name" placeholder="เพิ่มประเภทสภา" class="form-control" id="input1" required>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10"></textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.meeting.type') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report/meeting_type/all_meeting_type.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ประเภทการประชุม</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting.type') }}" class="btn btn-primary px-5">เพิ่มประเภทการประชุม </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ชื่อประเภทการประชุม</th>
                                <th>รายละเอียด</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($meeting_type as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>{!! $item->description !!}</td>
                                    <td>
                                        <a href="{{ route('edit.meeting.type', $item->id) }}" class="btn btn-info px-5">แก้ไข </a>
                                        <a href="{{ route('delete.meeting.type', $item->id) }}" class="btn btn-danger px-5" id="delete">ลบ </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report/meeting_type/edit_meeting_type.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขประเภทการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขประเภทการประชุม</h5>
                <form id="myForm" action="{{ route('update.meeting.type') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $meeting_type->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อประเภทการประชุม</label>
                        <input type="text" name="name" placeholder="เพิ่มประเภทการประชุม" class="form-control" id="input1" value="{{ $meeting_type->name }}">
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10" c>{!! $meeting_type->description !!}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.meeting.type') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/summary.blade.php">
<!-- resources/views/admin/meeting_reports/summary.blade.php -->
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4 class="card-title">สรุปรายงานการประชุม</h4>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="enableEdit()">แก้ไขรายงาน</button>
                            <button class="btn btn-success" id="saveReport" style="display:none;">บันทึก</button>
                        </div>
                    </div>
                    <!-- Modal แสดงประวัติการแก้ไข -->
                    <div class="modal fade" id="editHistoryModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">ประวัติการแก้ไขรายงานการประชุม</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>วันที่แก้ไข</th>
                                                    <th>ส่วนที่แก้ไข</th>
                                                    <th>ผู้แก้ไข</th>
                                                    <th>รายละเอียด</th>
                                                </tr>
                                            </thead>
                                            <tbody id="editHistoryTableBody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- ข้อมูลการประชุม -->
                        <div class="meeting-info mb-4">
                            <!-- ... ส่วนแสดงข้อมูลการประชุม ... -->
                        </div>
                        <form id="reportForm">
                            @foreach($contentDetails as $section)
                            <div class="section-content mb-4">
                                <h5>{{ $section['title'] }}</h5>
                                <!-- เนื้อหาหลักของส่วน -->
                                <div class="section-main-content mb-3">
                                    <textarea
                                        class="form-control content-editor"
                                        name="sections[{{ $section['id'] }}][content]"
                                        rows="4"
                                        disabled
                                    >{{ $section['content'] }}</textarea>
                                </div>
                                <!-- ส่วนแสดงความคิดเห็นการแก้ไข -->
                                <div class="edit-comments mb-3" style="display:none;">
                                    <textarea
                                        class="form-control"
                                        name="edit_comments[{{ $section['id'] }}]"
                                        placeholder="ระบุความคิดเห็นหรือการแก้ไข"
                                        rows="2"
                                    ></textarea>
                                </div>
                                <!-- Lectures และ Items -->
                                @foreach($section['lectures'] as $lecture)
                                <div class="lecture-content ml-4 mb-3">
                                    <h6>{{ $lecture['title'] }}</h6>
                                    <textarea
                                        class="form-control content-editor"
                                        name="sections[{{ $section['id'] }}][lectures][{{ $lecture['id'] }}][content]"
                                        rows="3"
                                        disabled
                                    >{{ $lecture['content'] }}</textarea>
                                    @foreach($lecture['items'] as $item)
                                    <div class="item-content ml-4 mb-2">
                                        <p class="mb-1">{{ $item['title'] }}</p>
                                        <textarea
                                            class="form-control content-editor"
                                            name="sections[{{ $section['id'] }}][lectures][{{ $lecture['id'] }}][items][{{ $item['id'] }}][content]"
                                            rows="2"
                                            disabled
                                        >{{ $item['content'] }}</textarea>
                                    </div>
                                    @endforeach
                                </div>
                                @endforeach
                                <!-- แสดงการรับรองและความคิดเห็น -->
                                @if(isset($approvalSummary['sections_feedback'][$section['id']]))
                                <div class="approval-feedback">
                                    <div class="approval-stats">
                                        <span class="badge bg-success">
                                            รับรองไม่มีแก้ไข: {{ $approvalSummary['sections_feedback'][$section['id']]['no_changes'] }}
                                        </span>
                                        <span class="badge bg-warning">
                                            รับรองมีแก้ไข: {{ $approvalSummary['sections_feedback'][$section['id']]['with_changes'] }}
                                        </span>
                                    </div>
                                    @if(!empty($approvalSummary['sections_feedback'][$section['id']]['comments']))
                                    <div class="comments-list mt-2">
                                        <h6>ความคิดเห็นจากการรับรอง:</h6>
                                        @foreach($approvalSummary['sections_feedback'][$section['id']]['comments'] as $comment)
                                        <div class="comment-item">
                                            <strong>{{ $comment['user'] }}:</strong>
                                            <span>{{ $comment['comment'] }}</span>
                                        </div>
                                        @endforeach
                                    </div>
                                    @endif
                                </div>
                                @endif
                            </div>
                            @endforeach
                            <!-- การรับรองของ Admin -->
                            <div class="admin-approval mt-4" style="display:none;">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="adminApproval" name="admin_approval">
                                    <label class="form-check-label" for="adminApproval">
                                        รับรองรายงานการประชุมโดย Admin
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="adminComment">ความคิดเห็นเพิ่มเติม</label>
                                    <textarea
                                        class="form-control"
                                        id="adminComment"
                                        name="admin_approval_comment"
                                        rows="3"
                                    ></textarea>
                                </div>
                            </div>
                        </form>
                        <!-- รายชื่อผู้รับรอง -->
                        <div class="approvers-list mt-4">
                            <!-- ... ส่วนแสดงรายชื่อผู้รับรอง ... -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section('scripts')
<script>
    let isEditing = false;
    function showEditHistory() {
        $.ajax({
            url: '{{ route("meeting.report.history", $meeting->id) }}',
            method: 'GET',
            success: function(response) {
                let tableBody = '';
                response.forEach(function(edit) {
                    tableBody += `
                        <tr>
                            <td>${edit.edited_at}</td>
                            <td>${edit.section}</td>
                            <td>${edit.editor}</td>
                            <td>${edit.comment}</td>
                        </tr>
                    `;
                });
                $('
                $('#editHistoryModal').modal('show');
            },
            error: function(xhr) {
                toastr.error('ไม่สามารถโหลดประวัติการแก้ไขได้');
            }
        });
    }
    let originalContent = {};
    function enableEdit() {
        if (!isEditing) {
            $('.content-editor').each(function() {
                originalContent[$(this).attr('name')] = $(this).val();
            });
        }
        isEditing = !isEditing;
        $('.content-editor').prop('disabled', !isEditing);
        $('.edit-comments').toggle(isEditing);
        $('.admin-approval').toggle(isEditing);
        $('#saveReport').toggle(isEditing);
        const btnEdit = $('.btn-primary');
        btnEdit.text(isEditing ? 'ยกเลิกการแก้ไข' : 'แก้ไขรายงาน');
        btnEdit.toggleClass('btn-primary btn-danger');
    }
    function hasChanges() {
        let changed = false;
        $('.content-editor').each(function() {
            const currentValue = $(this).val();
            const originalValue = originalContent[$(this).attr('name')];
            if (currentValue !== originalValue) {
                changed = true;
                return false;
            }
        });
        return changed;
    }
    $(document).ready(function() {
        if (typeof tinymce !== 'undefined') {
            tinymce.init({
                selector: '.content-editor',
                height: 300,
                plugins: 'lists link table',
                toolbar: 'undo redo | formatselect | bold italic | alignleft aligncenter alignright | bullist numlist | link table',
                readonly: true
            });
        }
        $('#saveReport').click(function() {
            if (!hasChanges() && !$('#adminApproval').is(':checked')) {
                toastr.warning('ไม่พบการเปลี่ยนแปลงข้อมูล');
                return;
            }
            const formData = new FormData($('#reportForm')[0]);
            if (typeof tinymce !== 'undefined') {
                $('.content-editor').each(function() {
                    formData.set($(this).attr('name'), tinymce.get($(this).attr('id')).getContent());
                });
            }
            $.ajax({
                url: '{{ route("meeting.report.update", $meeting->id) }}',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    toastr.success(response.message);
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.message || 'เกิดข้อผิดพลาดในการบันทึกข้อมูล');
                }
            });
        });
    });
    window.onbeforeunload = function() {
        if (isEditing && hasChanges()) {
            return "คุณมีข้อมูลที่ยังไม่ได้บันทึก ต้องการออกจากหน้านี้หรือไม่?";
        }
    };
</script>
@endsection
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_section_detail/lecture_detail.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    @php
        use Carbon\Carbon;
        Carbon::setLocale('th');
        $meeting_date = Carbon::parse($lecture->meetingAgendaSection->meetingAgenda->meeting_agenda_date);
        $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
        $thai_months = [
            1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน',
            5 => 'พฤษภาคม', 6 => 'มิถุนายน', 7 => 'กรกฎาคม', 8 => 'สิงหาคม',
            9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม'
        ];
        $thai_day = $thai_days[$meeting_date->dayOfWeek];
        $thai_month = $thai_months[$meeting_date->month];
        $thai_date = "วัน{$thai_day}ที่ " . $meeting_date->day . ' ' . $thai_month . ' พ.ศ. ' . ($meeting_date->year + 543);
    @endphp
    <style>
        .accessibility-controls {
            position: fixed;
            top: 100px;
            right: 20px;
            background:
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            cursor: move;
            user-select: none;
        }
        .font-size-btn {
            padding: 5px 10px;
            margin: 0 2px;
            border: 1px solid
            border-radius: 3px;
            background:
            cursor: pointer;
        }
        .font-size-btn:hover {
            background:
        }
        .document-style {
            background-color: white;
            padding: 40px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            font-family: 'TH Sarabun PSK', sans-serif;
            font-size: 16px;
            line-height: 1.6;
        }
        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        .item-list {
            list-style-type: none;
            padding-left: 20px;
        }
        .ck-content table {
            border-collapse: collapse;
            margin: 15px 0;
            width: 100%;
        }
        .ck-content table td,
        .ck-content table th {
            border: 1px solid
            padding: 8px;
        }
    </style>
    <div class="page-content">
        <!-- Add Accessibility Controls -->
        <div class="accessibility-controls" id="accessibilityControls">
            <div style="margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px solid #eee; cursor: move;" class="drag-handle">
                <i class="fas fa-grip-horizontal"></i>
            </div>
            <button class="font-size-btn" onclick="changeFontSize('decrease')" title="ลดขนาดตัวอักษร">
                <i class="fas fa-minus"></i> ก
            </button>
            <button class="font-size-btn" onclick="changeFontSize('reset')" title="คืนค่าขนาดตัวอักษร">
                <i class="fas fa-sync-alt"></i> ก
            </button>
            <button class="font-size-btn" onclick="changeFontSize('increase')" title="เพิ่มขนาดตัวอักษร">
                <i class="fas fa-plus"></i> ก
            </button>
        </div>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card">
                        <div class="text-center alert border-0 border-start border-5 border-primary alert-dismissible fade show py-2">
                            <ul class="nav nav-tabs card-header-tabs justify-content-center">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#committee" data-bs-toggle="tab">
                                        <i class="fas fa-users me-2"></i>หมวด : {{ $lecture->meetingAgenda->committeeCategory->name ?? 'ไม่ระบุ' }}
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body document-style">
                            @if($lecture->meetingAgendaSection->meetingAgenda)
                                <div class="agenda-info text-center">
                                    <p><strong>{{ $lecture->meetingAgendaSection->meetingAgenda->meeting_agenda_title }}</strong></p>
                                    <p><strong>ครั้งที่:
                                        {{ $lecture->meetingAgendaSection->meetingAgenda->meeting_agenda_number }}/
                                        {{ $lecture->meetingAgendaSection->meetingAgenda->meeting_agenda_year }}</strong>
                                    </p>
                                    <p><strong>{{ $thai_date }} เวลา {{ $lecture->meetingAgendaSection->meetingAgenda->meeting_agenda_time }}น.</strong></p>
                                    <p><strong>{{ $lecture->meetingAgendaSection->meetingAgenda->meeting_location }}</strong></p>
                                </div>
                                <hr>
                            @endif
                            <div class="section-title">{{ $lecture->meetingAgendaSection->section_title }}</div>
                            <div class="lecture-title"><strong>{{ $lecture->lecture_title }}</strong></div>
                            @if($lecture->content)
                                <div style="margin-left: 2rem;" class="lecture-content ck-content">{!! $lecture->content !!}</div>
                            @endif
                            @if($lecture->meetingAgendaItems->count() > 0)
                                <ul class="item-list">
                                    @foreach($lecture->meetingAgendaItems as $item)
                                        <li>
                                            @if($item->item_title)
                                                <div class="item-title">{{ $item->item_title }}</div>
                                            @endif
                                            @if($item->content)
                                                <div style="margin-left: 2rem;" class="item-content ck-content">{!! $item->content !!}</div>
                                            @endif
                                        </li>
                                    @endforeach
                                </ul>
                            @endif
                            {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
                    {{-- @if($lecture->meetingAgendaSection->meetingAgenda->show_committee_opinion) --}}
                    @if($lecture->meetingAgendaSection->meetingAgenda->show_committee_opinion && $lecture->show_committee_opinion)
                            <div class="card mt-4">
                                <div class="card-header bg-primary text-white">
                                    {{-- <h5 class="mb-0">ความเห็นคณะกรรมการกลั่นกรอง</h5> --}}
                                    <h5 class="mb-0">{{ $lecture->meetingAgendaSection->meetingAgenda->committee_opinion_title }}</h5>
                                </div>
                                <!-- ส่วนแสดงผลคะแนนโหวต -->
                        <div class="card-body">
                            <div class="vote-summary mb-4">
                                <div class="row text-center">
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h5 class="text-success">เห็นชอบ</h5>
                                                <h3 id="approve-count">{{ $committeeFeedbacks->where('vote_type', 'approve')->count() }}</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h5 class="text-danger">ไม่เห็นชอบ</h5>
                                                <h3 id="reject-count">{{ $committeeFeedbacks->where('vote_type', 'reject')->count() }}</h3>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                    <!-- ฟอร์มสำหรับเพิ่มความเห็น -->
                                    <form action="{{ route('committee.feedback.store') }}" method="POST" class="committee-feedback-form mb-4">
                                        @csrf
                                        <input type="hidden" name="lecture_id" value="{{ $lecture->id }}">
                                        <div class="form-group">
                                            <label class="d-block">การพิจารณา:</label>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input feedback-status-radio" type="radio"
                                                    name="feedback_status" id="status_approve_{{ $lecture->id }}"
                                                    value="approve" required>
                                                <label class="form-check-label" for="status_approve_{{ $lecture->id }}">
                                                    เห็นชอบ
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input feedback-status-radio" type="radio"
                                                    name="feedback_status" id="status_reject_{{ $lecture->id }}"
                                                    value="reject">
                                                <label class="form-check-label" for="status_reject_{{ $lecture->id }}">
                                                    ไม่เห็นชอบ
                                                </label>
                                            </div>
                                        </div>
                                        <div id="feedback_content_section_{{ $lecture->id }}" class="form-group mt-3" style="display: none;">
                                            <label for="feedback_content_{{ $lecture->id }}">ความเห็น:</label>
                                            <textarea class="form-control" id="feedback_content_{{ $lecture->id }}"
                                                name="feedback_content" rows="3"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary mt-3">บันทึกความเห็น</button>
                                    </form>
                                    <!-- ส่วนแสดงความเห็นที่มีอยู่ -->
 <!-- ส่วนแสดงความเห็นที่มีอยู่ -->
 <div class="existing-feedback">
    <h6 class="border-bottom pb-2">ความเห็นที่ผ่านมาล่าสุด :</h6>
    <div id="feedback-list">
        @foreach ($committeeFeedbacks as $feedback)
            <div class="feedback-item card mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="card-subtitle mb-2 text-muted">
                            {{ $feedback->user->prefixName->title }} {{ $feedback->user->first_name }} {{ $feedback->user->last_name }}
                            <small class="text-muted">
                                ({{ \Carbon\Carbon::parse($feedback->created_at)->locale('th')->isoFormat('D/M/YYYY HH:mm') }})
                            </small>
                        </h6>
                        <span class="badge {{ $feedback->vote_type === 'approve' ? 'bg-success' : 'bg-danger' }}">
                            {{ $feedback->vote_type === 'approve' ? 'เห็นชอบ' : 'ไม่เห็นชอบ' }}
                        </span>
                    </div>
                    @if($feedback->opinion)
                        <p class="card-text mt-2">{{ $feedback->opinion }}</p>
                    @endif
                </div>
            </div>
        @endforeach
    </div>
</div>
                                </div>
                            </div>
                            @else
                            <div class="alert alert-info mt-4">
                                <i class="fas fa-info-circle"></i> การแสดงผลการลงความเห็นถูกปิดโดยผู้จัดการประชุม
                            </div>
                            @endif
                            {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const controls = document.getElementById('accessibilityControls');
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;
            const savedPosition = localStorage.getItem('accessibilityControlsPosition');
            if (savedPosition) {
                const { x, y } = JSON.parse(savedPosition);
                controls.style.transform = `translate(${x}px, ${y}px)`;
                xOffset = x;
                yOffset = y;
            }
            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                if (e.target.closest('.drag-handle')) {
                    isDragging = true;
                }
            }
            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                localStorage.setItem('accessibilityControlsPosition', JSON.stringify({
                    x: xOffset,
                    y: yOffset
                }));
            }
            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX;
                    yOffset = currentY;
                    controls.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
            controls.addEventListener('touchstart', dragStart, false);
            controls.addEventListener('touchend', dragEnd, false);
            controls.addEventListener('touchmove', drag, false);
            controls.addEventListener('mousedown', dragStart, false);
            controls.addEventListener('mouseup', dragEnd, false);
            controls.addEventListener('mousemove', drag, false);
            controls.addEventListener('mouseleave', dragEnd, false);
        });
        function changeFontSize(action) {
            const content = document.querySelector('.document-style');
            const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
            let newSize;
            switch(action) {
                case 'increase':
                    newSize = currentSize * 1.1;
                    break;
                case 'decrease':
                    newSize = currentSize * 0.9;
                    break;
                case 'reset':
                    newSize = 16;
                    break;
            }
            newSize = Math.min(Math.max(newSize, 12), 24);
            content.style.fontSize = `${newSize}px`;
            localStorage.setItem('preferredFontSize', newSize);
        }
        document.addEventListener('DOMContentLoaded', function() {
            const savedSize = localStorage.getItem('preferredFontSize');
            if (savedSize) {
                document.querySelector('.document-style').style.fontSize = `${savedSize}px`;
            }
        });
    </script>
    {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const lectureId = '{{ $lecture->id }}';
            const radioButtons = document.querySelectorAll('.feedback-status-radio');
            const feedbackContentSection = document.getElementById(`feedback_content_section_${lectureId}`);
            const feedbackContent = document.getElementById(`feedback_content_${lectureId}`);
            const existingFeedbackDiv = document.querySelector('.existing-feedback');
            function createFeedbackHTML(feedback) {
                const date = new Date(feedback.created_at).toLocaleString('th-TH', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const fullName = feedback.user ?
                    `${feedback.user.prefix_name.title || ''} ${feedback.user.first_name || ''} ${feedback.user.last_name || ''}`.trim() :
                    'ไม่ระบุชื่อ';
                return `
                    <div class="feedback-item card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="card-subtitle mb-2 text-muted">
                                    ${fullName}
                                    <small class="text-muted">(${date})</small>
                                </h6>
                                <span class="badge ${feedback.vote_type === 'approve' ? 'bg-success' : 'bg-danger'}">
                                    ${feedback.vote_type === 'approve' ? 'เห็นชอบ' : 'ไม่เห็นชอบ'}
                                </span>
                            </div>
                            ${feedback.opinion ? `<p class="card-text mt-2">${feedback.opinion}</p>` : ''}
                        </div>
                    </div>
                `;
            }
            function loadAndDisplayFeedbacks() {
                fetch(`/committee/feedback/${lectureId}`)
                    .then(response => response.json())
                    .then(feedbacks => {
                        const feedbacksHTML = feedbacks.length > 0
                            ? feedbacks.map(createFeedbackHTML).join('')
                            : '<p class="text-muted">ยังไม่มีความเห็นจากคณะกรรมการ</p>';
                        const feedbackContainer = existingFeedbackDiv.querySelector('div') || existingFeedbackDiv;
                        feedbackContainer.innerHTML = `
                            ${feedbacksHTML}
                        `;
                    })
                    .catch(error => {
                        console.error('Error loading feedbacks:', error);
                    });
            }
            fetch(`/committee/feedback/${lectureId}/current`, {
                headers: {
                    'Accept': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data) {
                    const radio = document.querySelector(`input[name="feedback_status"][value="${data.vote_type}"]`);
                    if (radio) {
                        radio.checked = true;
                        if (data.vote_type === 'reject') {
                            feedbackContentSection.style.display = 'block';
                            feedbackContent.required = true;
                            feedbackContent.value = data.opinion || '';
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error loading current user feedback:', error);
            });
            // จัดการการแสดง/ซ่อนช่องความเห็น
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'reject') {
                        feedbackContentSection.style.display = 'block';
                        feedbackContent.required = true;
                    } else {
                        feedbackContentSection.style.display = 'none';
                        feedbackContent.required = false;
                        feedbackContent.value = '';
                    }
                });
            });
            // จัดการการส่งฟอร์ม
            // const feedbackForm = document.querySelector('.committee-feedback-form');
            loadAndDisplayFeedbacks();
        });
    </script>
    {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
    {{-- วันที่เพิ่ม 1/12/2024  --}}
    {{-- @section('scripts') --}}
    <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
    <script>
        const pusher = new Pusher('{{ env('PUSHER_APP_KEY') }}', {
            cluster: '{{ env('PUSHER_APP_CLUSTER') }}',
            encrypted: true
        });
        // Subscribe to the channel
        const channel = pusher.subscribe('lecture-votes.{{ $lecture->id }}');
        // Listen for vote updates
        channel.bind('vote-updated', function(data) {
            document.getElementById('approve-count').textContent = data.approve_count;
            document.getElementById('reject-count').textContent = data.reject_count;
            if (data.new_feedback) {
                const feedbackHtml = createFeedbackHtml(data.new_feedback);
                const feedbackList = document.getElementById('feedback-list');
                feedbackList.insertAdjacentHTML('afterbegin', feedbackHtml);
            }
        });
        function createFeedbackHtml(feedback) {
            const date = new Date(feedback.created_at).toLocaleString('th-TH', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            return `
                <div class="feedback-item card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="card-subtitle mb-2 text-muted">
                                ${feedback.user.prefix_name.title} ${feedback.user.first_name} ${feedback.user.last_name}
                                <small class="text-muted">(${date})</small>
                            </h6>
                            <span class="badge ${feedback.vote_type === 'approve' ? 'bg-success' : 'bg-danger'}">
                                ${feedback.vote_type === 'approve' ? 'เห็นชอบ' : 'ไม่เห็นชอบ'}
                            </span>
                        </div>
                        ${feedback.opinion ? `<p class="card-text mt-2">${feedback.opinion}</p>` : ''}
                    </div>
                </div>
            `;
        }
        document.querySelector('.committee-feedback-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const submitButton = this.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRF-TOKEN': '{{ csrf_token() }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.reset();
                    document.getElementById('feedback_content_section_{{ $lecture->id }}').style.display = 'none';
                    Swal.fire({
                        icon: 'success',
                        title: 'สำเร็จ',
                        text: 'บันทึกความเห็นเรียบร้อยแล้ว',
                        timer: 1500
                    });
                }
                    location.reload();
            })
            .finally(() => {
                submitButton.disabled = false;
            });
        });
    </script>
    {{-- @endsection --}}
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting/show_meeting_all.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<style>
    .pdf-like-document {
        background-color: white;
        padding: 40px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        font-family: Arial, sans-serif;
    }
    .pdf-like-document h1 {
        color:
        border-bottom: 2px solid
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    .pdf-like-document table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    .pdf-like-document th, .pdf-like-document td {
        border: 1px solid
        padding: 12px;
        text-align: left;
    }
    .pdf-like-document th {
        background-color:
        font-weight: bold;
    }
    .pdf-like-document .meeting-info {
        margin-bottom: 15px;
    }
    .pdf-like-document .meeting-actions {
        margin-top: 10px;
    }
    .pdf-like-document .btn {
        text-decoration: none;
        padding: 5px 10px;
        margin-right: 5px;
        color: white;
        border-radius: 3px;
        font-size: 0.9em;
    }
    .pdf-like-document .btn-info { background-color:
    .pdf-like-document .btn-primary { background-color:
    .pdf-like-document .btn-danger { background-color:
</style>
<div class="page-content">
    <div class="pdf-like-document">
        <h1>รายการการประชุมทั้งหมด</h1>
        @if(session('success'))
            <div class="alert alert-success">
                {{ session('success') }}
            </div>
        @endif
        @if(session('error'))
            <div class="alert alert-danger">
                {{ session('error') }}
            </div>
        @endif
        @forelse($meetings as $key => $meeting)
            <div class="meeting-info">
                <h3>การประชุมครั้งที่ {{ $key + 1 }}</h3>
                <table>
                    <tr>
                        <th width="30%">ประเภทการประชุม</th>
                        <td>{{ $meeting->meetingType->name ?? 'ไม่ระบุ' }}</td>
                    </tr>
                    <tr>
                        <th>ระเบียบวาระการประชุม</th>
                        <td>
                            @if($meeting->meetingAgenda)
                                {{ $meeting->meetingAgenda->meeting_agenda_title }}<br>
                                ครั้งที่ {{ $meeting->meetingAgenda->meeting_agenda_number }}<br>
                                วันที่ {{ $meeting->meetingAgenda->meeting_agenda_date }} เวลา {{ $meeting->meetingAgenda->meeting_agenda_time }} น.
                            @else
                                ไม่มีข้อมูล
                            @endif
                        </td>
                    </tr>
                    <tr>
                        <th>หมวดวาระการประชุม</th>
                        <td>{{ $meeting->meetingAgendaSection->section_title ?? 'ไม่ระบุ' }}</td>
                    </tr>
                    <tr>
                        <th>สถานะ</th>
                        <td>{{ $meeting->status == '1' ? 'ใช้งาน' : 'ไม่ใช้งาน' }}</td>
                    </tr>
                </table>
                <div class="meeting-actions">
                    <a href="{{ route('show.meeting', $meeting->id) }}" class="btn btn-info">รายละเอียด</a>
                    <a href="{{ route('edit.meeting', $meeting->id) }}" class="btn btn-primary">แก้ไข</a>
                    <form action="{{ route('delete.meeting', $meeting->id) }}" method="POST" style="display: inline;">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="btn btn-danger" onclick="return confirm('คุณแน่ใจหรือไม่ที่จะลบรายการนี้?')">ลบ</button>
                    </form>
                </div>
            </div>
        @empty
            <p>ไม่พบข้อมูลการประชุม</p>
        @endforelse
        <div class="mt-3">
            {{ $meetings->links() }}
        </div>
        <div class="mt-3">
            <a href="{{ route('add.meeting') }}" class="btn btn-primary">เพิ่มการประชุมใหม่</a>
        </div>
    </div>
</div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/permission/all_permission.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">All Permission</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.permission') }}" class="btn btn-primary px-5">Add Permission </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Permission Name </th>
                                <th>Group Name</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($permissions as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>{{ $item->group_name }}</td>
                                    <td>
                                        <a href="{{ route('edit.permission', $item->id) }}" class="btn btn-info px-5">Edit
                                        </a>
                                        <a href="{{ route('delete.permission', $item->id) }}" class="btn btn-danger px-5"
                                            id="delete">Delete </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/position/add_position.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มตำแหน่ง</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มตำแหน่ง</h5>
                <form id="myForm" action="{{ route('store.position') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อตำแหน่ง</label>
                        <input type="text" name="name" class="form-control" id="input1" value="{{ old('position_name') }}">
                    </div>
                    {{-- <div class="form-group col-md-6">
                        <label for="parent_id" class="form-label">ส่วนงานคณะกรรมการ</label>
                        <select name="parent_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกส่วนงานคณะกรรมการ</option>
                            @foreach ($positions as $item)
                                <option value="{{ $item->id }}">{{ $item->name }}</option>
                            @endforeach
                        </select>
                    </div> --}}
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.position') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    name: {
                        required: true,
                    },
                },
                messages: {
                    name: {
                        required: 'กรุณากรอกชื่อตำแหน่ง',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/position/all_position.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ตำแหน่งทั้งหมด</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.position') }}" class="btn btn-primary  ">เพิ่มตำแหน่ง </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลําดับ</th>
                                <th>ตำแหน่ง</th>
                                <th>การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($positions as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>
                                        <a href="{{ route('edit.position', $item->id) }}" class="btn btn-info px-5">แก้ไข </a>
                                        <a href="{{ route('delete.position', $item->id) }}" class="btn btn-danger px-5"
                                            id="delete">ลบ </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/prefix/add_prefix_name.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มข้อมูลคำนำหน้า</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มข้อมูลคำนำหน้า</h5>
                <form id="myForm" action="{{ route('store.prefix.name') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Prefix Name</label>
                        <input type="text" name="prefix_name" placeholder="Enter Prefix Name" class="form-control" id="input1" required>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.prefix.name') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/prefix/all_prefix_name.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ข้อมูลทั้งหมด</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.prefix.name') }}" class="btn btn-primary  ">เพิ่มข้อมูล </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลําดับ</th>
                                <th>คํานําหน้า</th>
                                <th>การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($prefixname as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->title }}</td>
                                    <td>
                                        <a href="{{ route('edit.prefix.name', $item->id) }}" class="btn btn-info px-5">แก้ไข </a>
                                        <a href="{{ route('delete.prefix.name', $item->id) }}" class="btn btn-danger px-5"
                                            id="delete">ลบ </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/prefix/edit_prefix_name.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขข้อมูลคำนำหน้า</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขข้อมูลคำนำหน้า</h5>
                <form id="myForm" action="{{ route('update.prefix.name', $prefixname->id) }}" method="post"
                    class="row g-3" enctype="multipart/form-data">
                    @csrf
                    @method('POST')
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Prefix Name</label>
                        <input type="text" name="prefix_name" value="{{ $prefixname->title }}"
                            placeholder="Enter Prefix Name" class="form-control" id="input1" required>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">แก้ไข</button>
                            <a href="{{ route('all.prefix.name') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/regulation_meeting/add_regulation_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มระเบียบ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มระเบียบ</h5>
                <form id="myForm" action="{{ route('store.regulation.meeting') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">Regulation Category Name</label>
                        <select name="regulation_category_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทข้อบังคับ</option>
                            @foreach ($categories as $item)
                                <option value="{{ $item->id }}">{{ $item->regulation_category_name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Regulation Title</label>
                        <input type="text" name="regulation_title" class="form-control" id="input1" value="{{ old('regulation_title') }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input_pdf" class="form-label">PDF File</label>
                        <input type="file" name="regulation_pdf" class="form-control" id="input_pdf" accept=".pdf">
                        <span class="text-danger" id="pdfError"></span>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10">{{ old('description') }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.rule.meeting') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    regulation_title: {
                        required: true,
                    },
                    regulation_category_id: {
                        required: true,
                    },
                },
                messages: {
                    regulation_title: {
                        required: 'Please Enter Category Name',
                    },
                    regulation_category_id: {
                        required: 'Please Select Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <script>
        $("#input_pdf").change(function() {
            var file = $(this).val().split('.').pop().toLowerCase();
            if (file != "pdf") {
                $('#pdfError').html('Please select pdf file');
                $(this).val('');
            } else {
                $('
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/regulation_meeting/regulation_category/add_regulation_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มประเภทระเบียบ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มประเภทระเบียบ</h5>
                <form id="myForm" action="{{ route('store.regulation.category') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Regulation Category Name</label>
                        <input type="text" name="regulation_category_name" placeholder="Enter Regulation Category Name" class="form-control" id="input1" required>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10"></textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.regulation.category') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/regulation_meeting/regulation_category/all_regulation_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ประเภทระเบียบ</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.regulation.category') }}" class="btn btn-primary px-5">เพิ่มประเภทระเบียบ </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Category Name</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($reg_cat as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->regulation_category_name }}</td>
                                    <td>{!! $item->description !!}</td>
                                    <td>
                                        <a href="{{ route('edit.regulation.category', $item->id) }}" class="btn btn-info px-5">Edit </a>
                                        <a href="{{ route('delete.regulation.category', $item->id) }}" class="btn btn-danger px-5" id="delete">Delete </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/regulation_meeting/regulation_category/edit_regulation_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขประเภทระเบียบ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขประเภทระเบียบ</h5>
                <form id="myForm" action="{{ route('update.regulation.category') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $category->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Regulation Category Name</label>
                        <input type="text" name="regulation_category_name" placeholder="Enter Regulation Category Name" class="form-control" id="input1" value="{{ $category->regulation_category_name }}">
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10" c>{!! $category->description !!}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.regulation.category') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/reports/pdf.blade.php">
<!DOCTYPE html>
<html>
<head>
    <title>{{ $report->title }}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit&display=swap');
        body {
            font-family: 'Kanit', sans-serif;
        }
        h1, h2, h3, h4, h5 {
            margin: 0;
            padding: 5px 0;
        }
        .section {
            margin-bottom: 20px;
        }
        .lecture {
            margin-left: 20px;
        }
        .item {
            margin-left: 40px;
        }
    </style>
</head>
<body>
    <h1>{{ $report->title }}</h1>
    <p>{{ $report->description }}</p>
    @foreach($report->sections as $section)
        <div class="section">
            <h2>{{ $section->section_title }}</h2>
            {!! $section->description !!}
            @foreach($section->meetingAgendaLectures as $lecture)
                <div class="lecture">
                    <h3>{{ $lecture->lecture_title }}</h3>
                    {!! $lecture->content !!}
                    @foreach($lecture->meetingAgendaItems as $item)
                        <div class="item">
                            <h4>{{ $item->item_title }}</h4>
                            {!! $item->content !!}
                        </div>
                    @endforeach
                </div>
            @endforeach
        </div>
    @endforeach
</body>
</html>
</file>

<file path="resources/views/admin/backend/pages/roles/add_roles.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Add Roles</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Add Roles</h5>
                <form id="myForm" action="{{ route('store.roles') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Roles Name</label>
                        <input type="text" name="name" class="form-control" id="input1">
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.roles') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/roles/all_roles.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">All Roles</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.roles') }}" class="btn btn-primary  ">Add Roles </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Roles Name </th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($roles as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>
                                        <a href="{{ route('edit.roles', $item->id) }}" class="btn btn-info px-5">Edit </a>
                                        <a href="{{ route('delete.roles', $item->id) }}" class="btn btn-danger px-5"
                                            id="delete">Delete </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/roles/edit_roles.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Edit Roles</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Edit Roles</h5>
                <form id="myForm" action="{{ route('update.roles') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $roles->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Roles Name</label>
                        <input type="text" name="name" class="form-control" id="input1"
                            value="{{ $roles->name }}">
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rolesetup/all_roles_permission.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">All Roles in Permission</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.roles.permission') }}" class="btn btn-primary  ">Add Roles Permission </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Roles Name </th>
                                <th>Permission </th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($roles as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->name }}</td>
                                    <td>
                                        @foreach ($item->permissions as $prem)
                                            <span class="badge bg-danger">{{ $prem->name }}</span>
                                        @endforeach
                                    </td>
                                    <td>
                                        <a href="{{ route('admin.edit.roles', $item->id) }}" class="btn btn-info px-5">Edit </a>
                                        <a href="{{ route('admin.delete.roles', $item->id) }}" class="btn btn-danger px-5" id="delete">Delete </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rolesetup/edit_roles_permission.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <style>
        .form-check-label {
            text-transform: capitalize;
        }
    </style>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Edit Role In Permission</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <form id="myForm" action="{{ route('admin.roles.update', $role->id) }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label"> Roles Name</label>
                        <h4>{{ $role->name }}</h4>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckMain">
                        <label class="form-check-label" for="flexCheckMain">Permission All </label>
                    </div>
                    <hr>
                    @foreach ($permission_groups as $group)
                        <div class="row">
                            <div class="col-3">
                                @php
                                    $permissions = App\Models\User::getPermissionsByGroupName($group->group_name);
                                @endphp
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"
                                        {{ App\Models\User::roleHasPermissions($role, $permissions) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="flexCheckDefault"> {{ $group->group_name }}</label>
                                </div>
                            </div>
                            <div class="col-9">
                                @foreach ($permissions as $permission)
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="permission[]"
                                            value="{{ $permission->id }}" id="checkDefault{{ $permission->id }}"
                                            {{ $role->hasPermissionTo($permission->name) ? 'checked' : '' }}>
                                        <label class="form-check-label"
                                            for="checkDefault{{ $permission->id }}">{{ $permission->name }}</label>
                                    </div>
                                @endforeach
                                <br>
                            </div>
                        </div>
                        {{-- // end row --}}
                    @endforeach
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        $('
            if ($(this).is(':checked')) {
                $('input[ type=checkbox]').prop('checked', true)
            } else {
                $('input[ type=checkbox]').prop('checked', false)
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rule_meeting/add_rule_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มข้อบังคับ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มข้อบังคับ</h5>
                <form id="myForm" action="{{ route('store.rule.meeting') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">Rule Category Name</label>
                        <select name="rule_category_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทข้อบังคับ</option>
                            @foreach ($categories as $item)
                                <option value="{{ $item->id }}">{{ $item->rule_category_name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Rule Title</label>
                        <input type="text" name="title" class="form-control" id="input1" {{ old('title') }}>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input_pdf" class="form-label">PDF File</label>
                        <input type="file" name="pdf" class="form-control" id="input_pdf" accept=".pdf">
                        <span class="text-danger" id="pdfError"></span>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10">{{ old('description') }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.rule.meeting') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    rule_title: {
                        required: true,
                    },
                    rule_category_id: {
                        required: true,
                    },
                },
                messages: {
                    rule_title: {
                        required: 'Please Enter SubCategory Name',
                    },
                    rule_category_id: {
                        required: 'Please Select Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <script>
        $("#input_pdf").change(function() {
            var file = $(this).val().split('.').pop().toLowerCase();
            if (file != "pdf") {
                $('#pdfError').html('Please select pdf file');
                $(this).val('');
            } else {
                $('
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/section/edit_meeting_agenda_section.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script>
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">แก้ไขหัวข้อวาระการประชุม</h4>
            </div>
            <div class="card-body">
                <form action="{{ route('update.meeting.agenda.section', $meeting_agenda_section->id) }}" method="POST" enctype="multipart/form-data">
                    @csrf
                    @method('POST')
                    <div class="form-group">
                        <label for="section_title">หัวข้อวาระการประชุม</label>
                        <input type="text" class="form-control" id="section_title" name="section_title" value="{{ $meeting_agenda_section->section_title ?? '' }}" required>
                    </div>
                    <div class="form-group">
                        <label for="description">รายละเอียด</label>
                        <textarea class="form-control" id="editor" name="description" rows="3">{!! $meeting_agenda_section->description !!}</textarea>
                    </div>
                    <div class="form-group text-right">
                        <button type="submit" class="btn btn-primary">แก้ไข</button>
                        <a href="{{ route('add.meeting.agenda.lecture', ['id' => $meeting_agenda_section->meeting_agenda_id]) }}" class="btn btn-secondary">กลับไปเพิ่มระเบียบวาระย่อย</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    CKEDITOR.replace('editor');
</script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/settings/edit_approval_deadline.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">ตั้งค่าจำนวนวันสำหรับ Deadline การรับรอง</h5>
                </div>
                <div class="card-body">
                    @if(session('success'))
                        <div class="alert alert-success">
                            {{ session('success') }}
                        </div>
                    @endif
                    <form action="{{ route('settings.update_approval_deadline') }}" method="POST">
                        @csrf
                        <div class="mb-3">
                            <label for="deadline_days" class="form-label">จำนวนวันสำหรับ Deadline:</label>
                            <input type="number" class="form-control @error('deadline_days') is-invalid @enderror"
                                   id="deadline_days" name="deadline_days" value="{{ old('deadline_days', $deadlineDays) }}"
                                   min="1" max="30" required>
                            @error('deadline_days')
                                <div class="invalid-feedback">{{ $message }}</div>
                            @enderror
                            <small class="form-text text-muted">กำหนดจำนวนวันหลังจากวันประชุมที่จะใช้เป็น deadline สำหรับการรับรอง (1-30 วัน)</small>
                        </div>
                        <button type="submit" class="btn btn-primary">บันทึกการเปลี่ยนแปลง</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/user/profile/edit.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg border-0 rounded-lg">
                    <div class="card-header bg-primary text-white">
                        <h4 class="card-title mb-0">แก้ไขข้อมูลส่วนตัว</h4>
                    </div>
                    <div class="card-body p-4">
                        @if(session('success'))
                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                {{ session('success') }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        @endif
                        <form method="post" action="{{ route('user.profile.update') }}" class="mt-4">
                            @csrf
                            <div class="mb-4 row align-items-center">
                                <label class="col-sm-3 col-form-label fw-bold fs-5">คำนำหน้า</label>
                                <div class="col-sm-4">
                                    <select name="prefix_name_id" class="form-select form-select-lg @error('prefix_name_id') is-invalid @enderror">
                                        @foreach($prefixNames as $prefix)
                                            <option value="{{ $prefix->id }}"
                                                {{ old('prefix_name_id', $user->prefix_name_id) == $prefix->id ? 'selected' : '' }}>
                                                {{ $prefix->title }}
                                            </option>
                                        @endforeach
                                    </select>
                                    @error('prefix_name_id')
                                        <div class="invalid-feedback">{{ $message }}</div>
                                    @enderror
                                </div>
                            </div>
                            <div class="mb-4 row align-items-center">
                                <label class="col-sm-3 col-form-label fw-bold fs-5">ชื่อ</label>
                                <div class="col-sm-6">
                                    <input type="text" name="first_name"
                                        class="form-control form-control-lg @error('first_name') is-invalid @enderror"
                                        value="{{ old('first_name', $user->first_name) }}">
                                    @error('first_name')
                                        <div class="invalid-feedback">{{ $message }}</div>
                                    @enderror
                                </div>
                            </div>
                            <div class="mb-4 row align-items-center">
                                <label class="col-sm-3 col-form-label fw-bold fs-5">นามสกุล</label>
                                <div class="col-sm-6">
                                    <input type="text" name="last_name"
                                        class="form-control form-control-lg @error('last_name') is-invalid @enderror"
                                        value="{{ old('last_name', $user->last_name) }}">
                                    @error('last_name')
                                        <div class="invalid-feedback">{{ $message }}</div>
                                    @enderror
                                </div>
                            </div>
                            <div class="mb-4 row align-items-center">
                                <label class="col-sm-3 col-form-label fw-bold fs-5">Email</label>
                                <div class="col-sm-6">
                                    <input type="email" name="email"
                                        class="form-control form-control-lg @error('email') is-invalid @enderror"
                                        value="{{ old('email', $user->email) }}">
                                    @error('email')
                                        <div class="invalid-feedback">{{ $message }}</div>
                                    @enderror
                                </div>
                            </div>
                            <div class="mb-4 row align-items-center">
                                <label class="col-sm-3 col-form-label fw-bold fs-5">รหัสผ่านปัจจุบัน</label>
                                {{-- <label class="fs-10">(ปล่อยว่างถ้าไม่ต้องการเปลี่ยน)</label> --}}
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input type="password" name="current_password" placeholder="(ปล่อยว่างถ้าไม่ต้องการเปลี่ยน)"
                                            class="form-control form-control-lg @error('current_password') is-invalid @enderror">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('current_password')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        @error('current_password')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                            </div>
                            <div class="mb-4 row align-items-center">
                                <label class="col-sm-3 col-form-label fw-bold fs-5">รหัสผ่านใหม่</label>
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input type="password" name="new_password" placeholder="(รหัสผ่าน ต้องไม่ต่ำกว่า 8 ตัวอักษร )"
                                            class="form-control form-control-lg @error('new_password') is-invalid @enderror">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        @error('new_password')
                                            <div class="invalid-feedback">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                            </div>
                            <div class="mb-4 row align-items-center">
                                <label class="col-sm-3 col-form-label fw-bold fs-5">ยืนยันรหัสผ่านใหม่</label>
                                <div class="col-sm-8">
                                    <div class="input-group">
                                        <input type="password" name="new_password_confirmation" placeholder="(รหัสผ่าน ต้องไม่ต่ำกว่า 8 ตัวอักษร )"
                                            class="form-control form-control-lg">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password_confirmation')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-sm-9 offset-sm-3">
                                    <button type="submit" class="btn btn-primary btn-lg px-5">
                                        <i class="fas fa-save me-2"></i>บันทึกข้อมูล
                                    </button>
                                    <a href="{{ route('admin.dashboard') }}" class="btn btn-danger btn-lg ms-3">
                                        <i class="fas fa-times me-2"></i>ยกเลิก
                                    </a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .card {
        border-radius: 15px;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    .card-header {
        border-radius: 15px 15px 0 0;
    }
    .form-control, .form-select {
        border-radius: 10px;
        border: 1px solid #dce7f1;
    }
    .form-control:focus, .form-select:focus {
        box-shadow: 0 0 0 0.25rem rgba(13,110,253,.15);
    }
    .btn {
        border-radius: 10px;
        padding: 10px 20px;
    }
</style>
<script>
    function togglePassword(inputName) {
        const input = document.querySelector(`input[name="${inputName}"]`);
        const icon = event.currentTarget.querySelector('i');
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }
</script>
@endsection
</file>

<file path="resources/views/admin/index.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <h6 class="mb-0 text-uppercase">สิทธิ์การประชุมและคณะกรรมการ</h6>
<div class="text-center my-4">
    <a href="https://cisco.webex.com" target="_blank" class="btn btn-primary btn-lg px-5 py-3 shadow">
        <i class="bx bx-video-plus me-2 fs-1"></i>
        <span style="font-size: 1.5rem; font-weight: bold;">เข้าร่วมประชุม Cisco Webex</span>
    </a>
</div>
    <hr>
    <div class="row">
        <div class="col">
            <div class="card radius-10 border-start border-2 border-primary">
                <div class="card-body">
                    @forelse ($user->meetingTypes as $meetingType)
                        <h5 class="card-title fw-bold shadow-sm p-2 bg-light rounded">{{ $meetingType->name }}</h5>
                        <ul class="list-group list-group-flush mb-3">
                            @php
                                $committeeIds = json_decode($meetingType->pivot->committee_ids, true) ?? [];
                            @endphp
                            @forelse ($committeeIds as $committeeId)
                                @php
                                    $committee = $committeecategories->find($committeeId);
                                @endphp
                                @if ($committee)
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <i class="bx bx-check-circle me-2"></i> {{ $committee->name }}
                                        <div class="widgets-icons bg-light-success text-success ms-auto"><i class="bx bx-user-circle"></i></div>
                                    </li>
                                @endif
                            @empty
                                <li class="list-group-item text-center d-flex align-items-center"><i class="bx bx-info-circle me-2"></i>ไม่พบข้อมูลคณะกรรมการสำหรับประเภทการประชุมนี้</li>
                            @endforelse
                        </ul>
                    @empty
                        <p class="text-center">ไม่พบสิทธิ์การประชุมสำหรับผู้ใช้นี้</p>
                    @endforelse
                </div>
            </div>
        </div>
    </div>
    <h6 class="mb-0 text-uppercase mt-4">รูปแบบการประชุม</h6>
    <hr>
    <div class="row">
        <div class="col">
            <div class="card radius-10 border-start border-2 border-primary">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        @if($user->meeting_format_id)
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">{{ $user->meetingFormat->name }}</h5>
                                <div class="widgets-icons bg-light-info text-info ms-auto"><i class="bx bx-line-chart"></i></div>
                            </li>
                        @else
                            <li class="list-group-item text-center">ไม่พบข้อมูลรูปแบบการประชุมสำหรับผู้ใช้นี้</li>
                        @endif
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection
</file>

<file path="resources/views/auth/confirm-password.blade.php">
<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600">
        {{ __('This is a secure area of the application. Please confirm your password before continuing.') }}
    </div>
    <form method="POST" action="{{ route('password.confirm') }}">
        @csrf
        <!-- Password -->
        <div>
            <x-input-label for="password" :value="__('Password')" />
            <x-text-input id="password" class="block mt-1 w-full"
                            type="password"
                            name="password"
                            required autocomplete="current-password" />
            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>
        <div class="flex justify-end mt-4">
            <x-primary-button>
                {{ __('Confirm') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>
</file>

<file path="resources/views/auth/forgot-password.blade.php">
<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600">
        {{ __('Forgot your password? No problem. Just let us know your email address and we will email you a password reset link that will allow you to choose a new one.') }}
    </div>
    <!-- Session Status -->
    <x-auth-session-status class="mb-4" :status="session('status')" />
    <form method="POST" action="{{ route('password.email') }}">
        @csrf
        <!-- Email Address -->
        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email')" required autofocus />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>
        <div class="flex items-center justify-end mt-4">
            <x-primary-button>
                {{ __('Email Password Reset Link') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>
</file>

<file path="resources/views/auth/register.blade.php">
<x-guest-layout>
    <form method="POST" action="{{ route('register') }}">
        @csrf
        <!-- Name -->
        <div>
            <x-input-label for="name" :value="__('Name')" />
            <x-text-input id="name" class="block mt-1 w-full" type="text" name="name" :value="old('name')" required autofocus autocomplete="name" />
            <x-input-error :messages="$errors->get('name')" class="mt-2" />
        </div>
        <!-- Email Address -->
        <div class="mt-4">
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email')" required autocomplete="username" />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>
        <!-- Password -->
        <div class="mt-4">
            <x-input-label for="password" :value="__('Password')" />
            <x-text-input id="password" class="block mt-1 w-full"
                            type="password"
                            name="password"
                            required autocomplete="new-password" />
            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>
        <!-- Confirm Password -->
        <div class="mt-4">
            <x-input-label for="password_confirmation" :value="__('Confirm Password')" />
            <x-text-input id="password_confirmation" class="block mt-1 w-full"
                            type="password"
                            name="password_confirmation" required autocomplete="new-password" />
            <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
        </div>
        <div class="flex items-center justify-end mt-4">
            <a class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" href="{{ route('login') }}">
                {{ __('Already registered?') }}
            </a>
            <x-primary-button class="ms-4">
                {{ __('Register') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>
</file>

<file path="resources/views/auth/reset-password.blade.php">
<x-guest-layout>
    <form method="POST" action="{{ route('password.store') }}">
        @csrf
        <!-- Password Reset Token -->
        <input type="hidden" name="token" value="{{ $request->route('token') }}">
        <!-- Email Address -->
        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email', $request->email)" required autofocus autocomplete="username" />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>
        <!-- Password -->
        <div class="mt-4">
            <x-input-label for="password" :value="__('Password')" />
            <x-text-input id="password" class="block mt-1 w-full" type="password" name="password" required autocomplete="new-password" />
            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>
        <!-- Confirm Password -->
        <div class="mt-4">
            <x-input-label for="password_confirmation" :value="__('Confirm Password')" />
            <x-text-input id="password_confirmation" class="block mt-1 w-full"
                                type="password"
                                name="password_confirmation" required autocomplete="new-password" />
            <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
        </div>
        <div class="flex items-center justify-end mt-4">
            <x-primary-button>
                {{ __('Reset Password') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>
</file>

<file path="resources/views/auth/verify-email.blade.php">
<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600">
        {{ __('Thanks for signing up! Before getting started, could you verify your email address by clicking on the link we just emailed to you? If you didn\'t receive the email, we will gladly send you another.') }}
    </div>
    @if (session('status') == 'verification-link-sent')
        <div class="mb-4 font-medium text-sm text-green-600">
            {{ __('A new verification link has been sent to the email address you provided during registration.') }}
        </div>
    @endif
    <div class="mt-4 flex items-center justify-between">
        <form method="POST" action="{{ route('verification.send') }}">
            @csrf
            <div>
                <x-primary-button>
                    {{ __('Resend Verification Email') }}
                </x-primary-button>
            </div>
        </form>
        <form method="POST" action="{{ route('logout') }}">
            @csrf
            <button type="submit" class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                {{ __('Log Out') }}
            </button>
        </form>
    </div>
</x-guest-layout>
</file>

<file path="resources/views/components/auth-session-status.blade.php">
@props(['status'])
@if ($status)
    <div {{ $attributes->merge(['class' => 'font-medium text-sm text-green-600']) }}>
        {{ $status }}
    </div>
@endif
</file>

<file path="resources/views/components/danger-button.blade.php">
<button {{ $attributes->merge(['type' => 'submit', 'class' => 'inline-flex items-center px-4 py-2 bg-red-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-500 active:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>
</file>

<file path="resources/views/components/dropdown.blade.php">
@props(['align' => 'right', 'width' => '48', 'contentClasses' => 'py-1 bg-white'])
@php
switch ($align) {
    case 'left':
        $alignmentClasses = 'ltr:origin-top-left rtl:origin-top-right start-0';
        break;
    case 'top':
        $alignmentClasses = 'origin-top';
        break;
    case 'right':
    default:
        $alignmentClasses = 'ltr:origin-top-right rtl:origin-top-left end-0';
        break;
}
switch ($width) {
    case '48':
        $width = 'w-48';
        break;
}
@endphp
<div class="relative" x-data="{ open: false }" @click.outside="open = false" @close.stop="open = false">
    <div @click="open = ! open">
        {{ $trigger }}
    </div>
    <div x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-75"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
            class="absolute z-50 mt-2 {{ $width }} rounded-md shadow-lg {{ $alignmentClasses }}"
            style="display: none;"
            @click="open = false">
        <div class="rounded-md ring-1 ring-black ring-opacity-5 {{ $contentClasses }}">
            {{ $content }}
        </div>
    </div>
</div>
</file>

<file path="resources/views/components/dropdown-link.blade.php">
<a {{ $attributes->merge(['class' => 'block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 transition duration-150 ease-in-out']) }}>{{ $slot }}</a>
</file>

<file path="resources/views/components/input-error.blade.php">
@props(['messages'])
@if ($messages)
    <ul {{ $attributes->merge(['class' => 'text-sm text-red-600 space-y-1']) }}>
        @foreach ((array) $messages as $message)
            <li>{{ $message }}</li>
        @endforeach
    </ul>
@endif
</file>

<file path="resources/views/components/input-label.blade.php">
@props(['value'])
<label {{ $attributes->merge(['class' => 'block font-medium text-sm text-gray-700']) }}>
    {{ $value ?? $slot }}
</label>
</file>

<file path="resources/views/components/modal.blade.php">
@props([
    'name',
    'show' => false,
    'maxWidth' => '2xl'
])
@php
$maxWidth = [
    'sm' => 'sm:max-w-sm',
    'md' => 'sm:max-w-md',
    'lg' => 'sm:max-w-lg',
    'xl' => 'sm:max-w-xl',
    '2xl' => 'sm:max-w-2xl',
][$maxWidth];
@endphp
<div
    x-data="{
        show: @js($show),
        focusables() {
            // All focusable element types...
            let selector = 'a, button, input:not([type=\'hidden\']), textarea, select, details, [tabindex]:not([tabindex=\'-1\'])'
            return [...$el.querySelectorAll(selector)]
                // All non-disabled elements...
                .filter(el => ! el.hasAttribute('disabled'))
        },
        firstFocusable() { return this.focusables()[0] },
        lastFocusable() { return this.focusables().slice(-1)[0] },
        nextFocusable() { return this.focusables()[this.nextFocusableIndex()] || this.firstFocusable() },
        prevFocusable() { return this.focusables()[this.prevFocusableIndex()] || this.lastFocusable() },
        nextFocusableIndex() { return (this.focusables().indexOf(document.activeElement) + 1) % (this.focusables().length + 1) },
        prevFocusableIndex() { return Math.max(0, this.focusables().indexOf(document.activeElement)) -1 },
    }"
    x-init="$watch('show', value => {
        if (value) {
            document.body.classList.add('overflow-y-hidden');
            {{ $attributes->has('focusable') ? 'setTimeout(() => firstFocusable().focus(), 100)' : '' }}
        } else {
            document.body.classList.remove('overflow-y-hidden');
        }
    })"
    x-on:open-modal.window="$event.detail == '{{ $name }}' ? show = true : null"
    x-on:close-modal.window="$event.detail == '{{ $name }}' ? show = false : null"
    x-on:close.stop="show = false"
    x-on:keydown.escape.window="show = false"
    x-on:keydown.tab.prevent="$event.shiftKey || nextFocusable().focus()"
    x-on:keydown.shift.tab.prevent="prevFocusable().focus()"
    x-show="show"
    class="fixed inset-0 overflow-y-auto px-4 py-6 sm:px-0 z-50"
    style="display: {{ $show ? 'block' : 'none' }};"
>
    <div
        x-show="show"
        class="fixed inset-0 transform transition-all"
        x-on:click="show = false"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>
    <div
        x-show="show"
        class="mb-6 bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:w-full {{ $maxWidth }} sm:mx-auto"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
    >
        {{ $slot }}
    </div>
</div>
</file>

<file path="resources/views/components/nav-link.blade.php">
@props(['active'])
@php
$classes = ($active ?? false)
            ? 'inline-flex items-center px-1 pt-1 border-b-2 border-indigo-400 text-sm font-medium leading-5 text-gray-900 focus:outline-none focus:border-indigo-700 transition duration-150 ease-in-out'
            : 'inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out';
@endphp
<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>
</file>

<file path="resources/views/components/responsive-nav-link.blade.php">
@props(['active'])
@php
$classes = ($active ?? false)
            ? 'block w-full ps-3 pe-4 py-2 border-l-4 border-indigo-400 text-start text-base font-medium text-indigo-700 bg-indigo-50 focus:outline-none focus:text-indigo-800 focus:bg-indigo-100 focus:border-indigo-700 transition duration-150 ease-in-out'
            : 'block w-full ps-3 pe-4 py-2 border-l-4 border-transparent text-start text-base font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300 transition duration-150 ease-in-out';
@endphp
<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>
</file>

<file path="resources/views/components/secondary-button.blade.php">
<button {{ $attributes->merge(['type' => 'button', 'class' => 'inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>
</file>

<file path="resources/views/components/text-input.blade.php">
@props(['disabled' => false])
<input {{ $disabled ? 'disabled' : '' }} {!! $attributes->merge(['class' => 'border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm']) !!}>
</file>

<file path="resources/views/dashboard.blade.php">
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Dashboard') }}
        </h2>
    </x-slot>
    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    {{ __("You're logged in!") }}
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
</file>

<file path="resources/views/frontend/index.blade.php">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Home</title>
</head>
<body>
    <h1>Welcome to the User home page</h1>
</body>
</html>
</file>

<file path="resources/views/layouts/app.blade.php">
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="csrf-token" content="{{ csrf_token() }}">
        <title>{{ config('app.name', 'Laravel') }}</title>
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />
        <!-- Scripts -->
        @vite(['resources/css/app.css', 'resources/js/app.js'])
    </head>
    <body class="font-sans antialiased">
        <div class="min-h-screen bg-gray-100">
            @include('layouts.navigation')
            <!-- Page Heading -->
            @if (isset($header))
                <header class="bg-white shadow">
                    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                        {{ $header }}
                    </div>
                </header>
            @endif
            <!-- Page Content -->
            <main>
                {{ $slot }}
            </main>
        </div>
    </body>
</html>
</file>

<file path="resources/views/layouts/guest.blade.php">
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="csrf-token" content="{{ csrf_token() }}">
        <title>{{ config('app.name', 'Laravel') }}</title>
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />
        <!-- Scripts -->
        @vite(['resources/css/app.css', 'resources/js/app.js'])
    </head>
    <body class="font-sans text-gray-900 antialiased">
        <div class="min-h-screen flex flex-col sm:justify-center items-center pt-6 sm:pt-0 bg-gray-100">
            <div>
                <a href="/">
                    <x-application-logo class="w-20 h-20 fill-current text-gray-500" />
                </a>
            </div>
            <div class="w-full sm:max-w-md mt-6 px-6 py-4 bg-white shadow-md overflow-hidden sm:rounded-lg">
                {{ $slot }}
            </div>
        </div>
    </body>
</html>
</file>

<file path="resources/views/layouts/navigation.blade.php">
<nav x-data="{ open: false }" class="bg-white border-b border-gray-100">
    <!-- Primary Navigation Menu -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex">
                <!-- Logo -->
                <div class="shrink-0 flex items-center">
                    <a href="{{ route('dashboard') }}">
                        <x-application-logo class="block h-9 w-auto fill-current text-gray-800" />
                    </a>
                </div>
                <!-- Navigation Links -->
                <div class="hidden space-x-8 sm:-my-px sm:ms-10 sm:flex">
                    <x-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                        {{ __('Dashboard') }}
                    </x-nav-link>
                </div>
            </div>
            <!-- Settings Dropdown -->
            <div class="hidden sm:flex sm:items-center sm:ms-6">
                <x-dropdown align="right" width="48">
                    <x-slot name="trigger">
                        <button class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none transition ease-in-out duration-150">
                            <div>{{ Auth::user()->first_name }}</div>
                            <div class="ms-1">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </button>
                    </x-slot>
                    <x-slot name="content">
                        <x-dropdown-link :href="route('profile.edit')">
                            {{ __('Profile') }}
                        </x-dropdown-link>
                        <!-- Authentication -->
                        <form method="POST" action="{{ route('logout') }}">
                            @csrf
                            <x-dropdown-link :href="route('logout')"
                                    onclick="event.preventDefault();
                                                this.closest('form').submit();">
                                {{ __('Log Out') }}
                            </x-dropdown-link>
                        </form>
                    </x-slot>
                </x-dropdown>
            </div>
            <!-- Hamburger -->
            <div class="-me-2 flex items-center sm:hidden">
                <button @click="open = ! open" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out">
                    <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                        <path :class="{'hidden': open, 'inline-flex': ! open }" class="inline-flex" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        <path :class="{'hidden': ! open, 'inline-flex': open }" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
    <!-- Responsive Navigation Menu -->
    <div :class="{'block': open, 'hidden': ! open}" class="hidden sm:hidden">
        <div class="pt-2 pb-3 space-y-1">
            <x-responsive-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                {{ __('Dashboard') }}
            </x-responsive-nav-link>
        </div>
        <!-- Responsive Settings Options -->
        <div class="pt-4 pb-1 border-t border-gray-200">
            <div class="px-4">
                <div class="font-medium text-base text-gray-800">{{ Auth::user()->name }}</div>
                <div class="font-medium text-sm text-gray-500">{{ Auth::user()->email }}</div>
            </div>
            <div class="mt-3 space-y-1">
                <x-responsive-nav-link :href="route('profile.edit')">
                    {{ __('Profile') }}
                </x-responsive-nav-link>
                <!-- Authentication -->
                <form method="POST" action="{{ route('logout') }}">
                    @csrf
                    <x-responsive-nav-link :href="route('logout')"
                            onclick="event.preventDefault();
                                        this.closest('form').submit();">
                        {{ __('Log Out') }}
                    </x-responsive-nav-link>
                </form>
            </div>
        </div>
    </div>
</nav>
</file>

<file path="resources/views/profile/edit.blade.php">
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Profile') }}
        </h2>
    </x-slot>
    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">
            <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                <div class="max-w-xl">
                    @include('profile.partials.update-profile-information-form')
                </div>
            </div>
            <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                <div class="max-w-xl">
                    @include('profile.partials.update-password-form')
                </div>
            </div>
            <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                <div class="max-w-xl">
                    @include('profile.partials.delete-user-form')
                </div>
            </div>
        </div>
    </div>
</x-app-layout>
</file>

<file path="resources/views/profile/partials/delete-user-form.blade.php">
<section class="space-y-6">
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Delete Account') }}
        </h2>
        <p class="mt-1 text-sm text-gray-600">
            {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Before deleting your account, please download any data or information that you wish to retain.') }}
        </p>
    </header>
    <x-danger-button
        x-data=""
        x-on:click.prevent="$dispatch('open-modal', 'confirm-user-deletion')"
    >{{ __('Delete Account') }}</x-danger-button>
    <x-modal name="confirm-user-deletion" :show="$errors->userDeletion->isNotEmpty()" focusable>
        <form method="post" action="{{ route('profile.destroy') }}" class="p-6">
            @csrf
            @method('delete')
            <h2 class="text-lg font-medium text-gray-900">
                {{ __('Are you sure you want to delete your account?') }}
            </h2>
            <p class="mt-1 text-sm text-gray-600">
                {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Please enter your password to confirm you would like to permanently delete your account.') }}
            </p>
            <div class="mt-6">
                <x-input-label for="password" value="{{ __('Password') }}" class="sr-only" />
                <x-text-input
                    id="password"
                    name="password"
                    type="password"
                    class="mt-1 block w-3/4"
                    placeholder="{{ __('Password') }}"
                />
                <x-input-error :messages="$errors->userDeletion->get('password')" class="mt-2" />
            </div>
            <div class="mt-6 flex justify-end">
                <x-secondary-button x-on:click="$dispatch('close')">
                    {{ __('Cancel') }}
                </x-secondary-button>
                <x-danger-button class="ms-3">
                    {{ __('Delete Account') }}
                </x-danger-button>
            </div>
        </form>
    </x-modal>
</section>
</file>

<file path="resources/views/profile/partials/update-password-form.blade.php">
<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Update Password') }}
        </h2>
        <p class="mt-1 text-sm text-gray-600">
            {{ __('Ensure your account is using a long, random password to stay secure.') }}
        </p>
    </header>
    <form method="post" action="{{ route('password.update') }}" class="mt-6 space-y-6">
        @csrf
        @method('put')
        <div>
            <x-input-label for="update_password_current_password" :value="__('Current Password')" />
            <x-text-input id="update_password_current_password" name="current_password" type="password" class="mt-1 block w-full" autocomplete="current-password" />
            <x-input-error :messages="$errors->updatePassword->get('current_password')" class="mt-2" />
        </div>
        <div>
            <x-input-label for="update_password_password" :value="__('New Password')" />
            <x-text-input id="update_password_password" name="password" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password')" class="mt-2" />
        </div>
        <div>
            <x-input-label for="update_password_password_confirmation" :value="__('Confirm Password')" />
            <x-text-input id="update_password_password_confirmation" name="password_confirmation" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password_confirmation')" class="mt-2" />
        </div>
        <div class="flex items-center gap-4">
            <x-primary-button>{{ __('Save') }}</x-primary-button>
            @if (session('status') === 'password-updated')
                <p
                    x-data="{ show: true }"
                    x-show="show"
                    x-transition
                    x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-gray-600"
                >{{ __('Saved.') }}</p>
            @endif
        </div>
    </form>
</section>
</file>

<file path="resources/views/profile/partials/update-profile-information-form.blade.php">
<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Profile Information') }}
        </h2>
        <p class="mt-1 text-sm text-gray-600">
            {{ __("Update your account's profile information and email address.") }}
        </p>
    </header>
    <form id="send-verification" method="post" action="{{ route('verification.send') }}">
        @csrf
    </form>
    <form method="post" action="{{ route('profile.update') }}" class="mt-6 space-y-6">
        @csrf
        @method('patch')
        <div>
            <x-input-label for="name" :value="__('Name')" />
            <x-text-input id="name" name="name" type="text" class="mt-1 block w-full" :value="old('name', $user->name)" required autofocus autocomplete="name" />
            <x-input-error class="mt-2" :messages="$errors->get('name')" />
        </div>
        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" name="email" type="email" class="mt-1 block w-full" :value="old('email', $user->email)" required autocomplete="username" />
            <x-input-error class="mt-2" :messages="$errors->get('email')" />
            @if ($user instanceof \Illuminate\Contracts\Auth\MustVerifyEmail && ! $user->hasVerifiedEmail())
                <div>
                    <p class="text-sm mt-2 text-gray-800">
                        {{ __('Your email address is unverified.') }}
                        <button form="send-verification" class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            {{ __('Click here to re-send the verification email.') }}
                        </button>
                    </p>
                    @if (session('status') === 'verification-link-sent')
                        <p class="mt-2 font-medium text-sm text-green-600">
                            {{ __('A new verification link has been sent to your email address.') }}
                        </p>
                    @endif
                </div>
            @endif
        </div>
        <div class="flex items-center gap-4">
            <x-primary-button>{{ __('Save') }}</x-primary-button>
            @if (session('status') === 'profile-updated')
                <p
                    x-data="{ show: true }"
                    x-show="show"
                    x-transition
                    x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-gray-600"
                >{{ __('Saved.') }}</p>
            @endif
        </div>
    </form>
</section>
</file>

<file path="routes/api.php">
<?php
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
Route::middleware('auth:sanctum')->get('/user', function (Request $request) {
    return $request->user();
});
</file>

<file path="routes/auth.php">
<?php
use App\Http\Controllers\Auth\AuthenticatedSessionController;
use App\Http\Controllers\Auth\ConfirmablePasswordController;
use App\Http\Controllers\Auth\EmailVerificationNotificationController;
use App\Http\Controllers\Auth\EmailVerificationPromptController;
use App\Http\Controllers\Auth\NewPasswordController;
use App\Http\Controllers\Auth\PasswordController;
use App\Http\Controllers\Auth\PasswordResetLinkController;
use App\Http\Controllers\Auth\RegisteredUserController;
use App\Http\Controllers\Auth\VerifyEmailController;
use Illuminate\Support\Facades\Route;
Route::middleware('guest')->group(function () {
    Route::get('register', [RegisteredUserController::class, 'create'])
                ->name('register');
    Route::post('register', [RegisteredUserController::class, 'store']);
    Route::get('login', [AuthenticatedSessionController::class, 'create'])
                ->name('login');
    Route::post('login', [AuthenticatedSessionController::class, 'store']);
    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])
                ->name('password.request');
    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])
                ->name('password.email');
    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])
                ->name('password.reset');
    Route::post('reset-password', [NewPasswordController::class, 'store'])
                ->name('password.store');
});
Route::middleware('auth')->group(function () {
    Route::get('verify-email', EmailVerificationPromptController::class)
                ->name('verification.notice');
    Route::get('verify-email/{id}/{hash}', VerifyEmailController::class)
                ->middleware(['signed', 'throttle:6,1'])
                ->name('verification.verify');
    Route::post('email/verification-notification', [EmailVerificationNotificationController::class, 'store'])
                ->middleware('throttle:6,1')
                ->name('verification.send');
    Route::get('confirm-password', [ConfirmablePasswordController::class, 'show'])
                ->name('password.confirm');
    Route::post('confirm-password', [ConfirmablePasswordController::class, 'store']);
    Route::put('password', [PasswordController::class, 'update'])->name('password.update');
    Route::post('logout', [AuthenticatedSessionController::class, 'destroy'])
                ->name('logout');
});
</file>

<file path="routes/channels.php">
<?php
use Illuminate\Support\Facades\Broadcast;
Broadcast::channel('App.Models.User.{id}', function ($user, $id) {
    return (int) $user->id === (int) $id;
});
</file>

<file path="routes/console.php">
<?php
use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;
Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');
</file>

<file path="app/Http/Controllers/ApprovedMeetingReportController.php">
<?php
namespace App\Http\Controllers;
use App\Models\MeetingAgenda;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Dompdf\Dompdf;
use Dompdf\Options;
class ApprovedMeetingReportController extends Controller
{
    public function allApprovedByAdmin()
    {
        $user = Auth::user();
        $userMeetingTypes = $user->meetingTypes;
        $userCommitteeIds = [];
        foreach ($userMeetingTypes as $meetingType) {
            $committeeIds = json_decode($meetingType->pivot->committee_ids, true);
            if ($committeeIds) {
                $userCommitteeIds = array_merge($userCommitteeIds, $committeeIds);
            }
        }
        $userCommitteeIds = array_unique($userCommitteeIds);
        $approvedReports = MeetingAgenda::with([
            'meeting_type',
            'committeeCategory',
            'adminApprovedBy',
            'sections'
        ])
            ->where('is_admin_approved', true)
            ->whereIn('meeting_type_id', $userMeetingTypes->pluck('id'))
            ->whereIn('committee_category_id', $userCommitteeIds)
            ->orderBy('admin_approved_at', 'desc')
            ->paginate(10);
        return view(
            'admin.backend.pages.approved_reports_by_admin.all_approved_report_by_admin',
            compact('approvedReports')
        );
    }
    public function ListApprovedByAdmin($id)
    {
        $user = Auth::user();
        $userMeetingTypes = $user->meetingTypes->pluck('id');
        $userCommitteeIds = [];
        foreach ($user->meetingTypes as $meetingType) {
            $committeeIds = json_decode($meetingType->pivot->committee_ids, true);
            if ($committeeIds) {
                $userCommitteeIds = array_merge($userCommitteeIds, $committeeIds);
            }
        }
        $report = MeetingAgenda::with([
            'meeting_type',
            'committeeCategory',
            'meetingFormat',
            'sections.meetingAgendaLectures.meetingAgendaItems',
            'adminApprovedBy'
        ])
            ->where('is_admin_approved', true)
            ->where(function ($query) use ($userMeetingTypes, $userCommitteeIds) {
                $query->whereIn('meeting_type_id', $userMeetingTypes)
                    ->whereIn('committee_category_id', $userCommitteeIds);
            })
            ->findOrFail($id);
        return view('admin.backend.pages.approved_reports_by_admin.list_approved_report_by_admin',compact('report'));
    }
    public function export($id, $type)
    {
        $report = MeetingAgenda::with([
            'meeting_type',
            'committeeCategory',
            'meetingFormat',
            'sections.meetingAgendaLectures.meetingAgendaItems',
            'sections.approvalDetails',
            'adminApprovedBy'
        ])->findOrFail($id);
        if ($type == 'pdf') {
            $options = new Options();
            $options->set('isRemoteEnabled', true);
            $dompdf = new Dompdf($options);
            $html = view('admin.backend.pages.reports.pdf', compact('report'))->render();
            $dompdf->loadHtml($html);
            $dompdf->setPaper('A4', 'portrait');
            $dompdf->render();
            return $dompdf->stream('report.pdf');
        } elseif ($type == 'word') {
            $phpWord = new \PhpOffice\PhpWord\PhpWord();
            $phpWord->setDefaultFontName('TH Sarabun New');
            $phpWord->setDefaultFontSize(16);
            $section = $phpWord->addSection();
            $section->addText('รายงานการประชุม', ['bold' => true, 'size' => 24], ['alignment' => 'center']);
            $section->addTextBreak();
            $currentDate = date('d/m/Y H:i:s');
            $section->addText("วันที่สร้างรายงาน: {$currentDate}", ['size' => 16], ['alignment' => 'center']);
            $section->addTextBreak();
            $section->addText($report->meeting_agenda_title, ['bold' => true, 'size' => 20], ['alignment' => 'center']);
            \PhpOffice\PhpWord\Shared\Html::addHtml($section, $report->description);
            $thaiMonths = [
                '01' => 'มกราคม', '02' => 'กุมภาพันธ์', '03' => 'มีนาคม', '04' => 'เมษายน',
                '05' => 'พฤษภาคม', '06' => 'มิถุนายน', '07' => 'กรกฎาคม', '08' => 'สิงหาคม',
                '09' => 'กันยายน', '10' => 'ตุลาคม', '11' => 'พฤศจิกายน', '12' => 'ธันวาคม'
            ];
            $date = strtotime($report->meeting_agenda_date);
            $day = date('d', $date);
            $month = $thaiMonths[date('m', $date)];
            $year = date('Y', $date) + 543;
            $section->addText("วันที่ประชุม: {$day} {$month} {$year}", ['size' => 16], ['alignment' => 'center']);
            if ($report->meeting_agenda_number) {
                $section->addText("เลขที่ประชุม/ปีที่ประชุม: {$report->meeting_agenda_number}/{$report->meeting_agenda_year}", ['size' => 16], ['alignment' => 'center']);
            }
            if ($report->meeting_agenda_time) {
                $section->addText("เวลาที่ประชุม: " . date('H:i', strtotime($report->meeting_agenda_time)), ['size' => 16], ['alignment' => 'center']);
            }
            if ($report->meeting_location) {
                $section->addText("สถานที่ประชุม: {$report->meeting_location}", ['size' => 16], ['alignment' => 'center']);
            }
            $section->addTextBreak(2);
            foreach ($report->sections as $sectionData) {
                $section->addText($sectionData->section_title, ['bold' => true, 'size' => 18]);
                if ($sectionData->description) {
                    \PhpOffice\PhpWord\Shared\Html::addHtml($section, $sectionData->description);
                }
                foreach ($sectionData->meetingAgendaLectures as $lecture) {
                    $section->addText($lecture->lecture_title, ['bold' => true, 'size' => 16]);
                    if ($lecture->content) {
                        \PhpOffice\PhpWord\Shared\Html::addHtml($section, $lecture->content);
                    }
                    foreach ($lecture->meetingAgendaItems as $item) {
                        $section->addText($item->item_title, ['bold' => true, 'size' => 14]);
                        if ($item->content) {
                            \PhpOffice\PhpWord\Shared\Html::addHtml($section, $item->content);
                        }
                    }
                }
                if ($sectionData->approvalDetails->isNotEmpty()) {
                    $section->addText('การรับรองวาระนี้', ['bold' => true, 'size' => 16, 'color' => '0000FF']);
                    foreach ($sectionData->approvalDetails as $detail) {
                        $approvalType = ($detail->approval_type == 'no_changes') ? 'รับรองโดยไม่มีแก้ไข' : 'รับรองโดยมีแก้ไข';
                        $section->addText("- {$approvalType}", ['size' => 14]);
                        if ($detail->note) {
                            \PhpOffice\PhpWord\Shared\Html::addHtml($section, "<i>หมายเหตุ: {$detail->note}</i>");
                        }
                    }
                }
            }
            $objWriter = \PhpOffice\PhpWord\IOFactory::createWriter($phpWord, 'Word2007');
            $fileName = 'report_' . date('Ymd_His') . '.docx';
            $tempFile = tempnam(sys_get_temp_dir(), $fileName);
            $objWriter->save($tempFile);
            return response()->download($tempFile, $fileName)->deleteFileAfterSend(true);
        } else {
            return redirect()->back()->with('error', 'ประเภทการส่งออกไม่ถูกต้อง');
        }
    }
}
</file>

<file path="app/Http/Controllers/Auth/AuthenticatedSessionController.php">
<?php
namespace App\Http\Controllers\Auth;
use App\Http\Controllers\Controller;
use App\Http\Requests\Auth\LoginRequest;
use App\Models\User;
use App\Notifications\LoginNotification;
use App\Providers\RouteServiceProvider;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\View\View;
class AuthenticatedSessionController extends Controller
{
    public function create(): View
    {
        return view('auth.login');
    }
    public function store(LoginRequest $request): RedirectResponse
    {
        $request->authenticate();
        $request->session()->regenerate();
        $admins = User::where('role', 'admin')
                        ->where('id', '!=', $request->user()->id)
                        ->get();
        foreach ($admins as $admin) {
            $recentNotification = $admin->notifications()
                ->where('type', LoginNotification::class)
                ->where('created_at', '>=', now()->subMinute())
                ->first();
            if (!$recentNotification) {
                $admin->notify(new LoginNotification($request->user()));
            }
        }
        $notification = array(
            'message' => 'Login Successfully',
            'alert-type' => 'success'
        );
        $url = '';
        if ($request->user()->role === 'admin') {
            $url = 'admin/dashboard';
        } elseif ($request->user()->role === 'user') {
            $url = 'user/dashboard';
        }
        return redirect()->intended($url)->with($notification);
    }
    public function destroy(Request $request): RedirectResponse
    {
        Auth::guard('web')->logout();
        $request->session()->invalidate();
        $request->session()->regenerateToken();
        return redirect('/');
    }
}
</file>

<file path="app/Http/Controllers/Category/RegulationCategoryController.php">
<?php
namespace App\Http\Controllers\Category;
use App\Http\Controllers\Controller;
use App\Models\RegulationCategory;
use Carbon\Carbon;
use Illuminate\Http\Request;
class RegulationCategoryController extends Controller
{
    public function AllRegulationCategory()
    {
        $reg_cat = RegulationCategory::latest()->get();
        return view('admin.backend.pages.regulation_meeting.regulation_category.all_regulation_category', compact('reg_cat'));
    }
    public function AddRegulationCategory()
    {
        return view('admin.backend.pages.regulation_meeting.regulation_category.add_regulation_category');
    }
    public function StoreRegulationCategory(Request $request)
    {
        $request->validate([
            'regulation_category_name' => 'required',
        ]);
        RegulationCategory::insert([
            'regulation_category_name' => $request->regulation_category_name,
            'description' => $request->description,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Regulation Category Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.regulation.category')->with($notification);
    }
    public function EditRegulationCategory($id)
    {
        $category = RegulationCategory::findOrFail($id);
        return view('admin.backend.pages.regulation_meeting.regulation_category.edit_regulation_category', compact('category'));
    }
    public function UpdateRegulationCategory(Request $request)
    {
        $cat_id = $request->id;
        $request->validate([
            'regulation_category_name' => 'required',
        ]);
        RegulationCategory::findOrFail($cat_id)->update([
            'regulation_category_name' => $request->regulation_category_name,
            'description' => $request->description,
            'updated_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Regulation Category Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.regulation.category')->with($notification);
    }
    public function DeleteRegulationCategory($id)
    {
        RegulationCategory::findOrFail($id)->delete();
        $notification = array(
            'message' => 'Regulation Category Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/MeetingReportController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\MeetingReport;
use App\Models\MeetingType;
use Carbon\Carbon;
use Illuminate\Http\Request;
class MeetingReportController extends Controller
{
    public function AllMeetingReport()
    {
        $meeting_reports = MeetingReport::latest()->get();
        return view('admin.backend.pages.meeting_report.all_meeting_report', compact('meeting_reports'));
    }
    public function AddMeetingReport()
    {
        $committees = CommitteeCategory::latest()->get();
        $meeting_types = MeetingType::latest()->get();
        return view('admin.backend.pages.meeting_report.add_meeting_report', compact('committees', 'meeting_types'));
    }
    public function StoreMeetingReport(Request $request)
    {
        $request->validate([
            'committee_category_id' => 'required',
            'meeting_type_id' => 'required',
            'title' => 'required',
            'meeting_no' => 'required',
            'date' => 'required',
            'time' => 'required',
            'year' => 'required',
            'location' => 'required',
            'pdf' => 'nullable|mimes:pdf|max:5000',
        ]);
        $save_url = null;
        if ($request->hasFile('pdf')) {
            $file = $request->file('pdf');
            $filename = hexdec(uniqid()) . '.' . $file->getClientOriginalExtension();
            $file->move(public_path('uploads/meeting_report/'), $filename);
            $save_url = 'uploads/meeting_report/' . $filename;
        }
        try {
            MeetingReport::insert([
                'committee_category_id' => $request->committee_category_id,
                'meeting_type_id' => $request->meeting_type_id,
                'title' => $request->title,
                'meeting_no' => $request->meeting_no,
                'date' => $request->date,
                'time' => $request->time,
                'year' => $request->year,
                'location' => $request->location,
                'pdf' => $save_url,
                'description' => $request->description,
                'created_at' => Carbon::now()
            ]);
            $notification = array(
                'message' => 'Meeting Report Added Successfully',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.report')->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'Something went wrong.',
                'alert-type' => 'danger'
            );
            return redirect()->back()->with($notification);
        }
    }
    public function EditMeetingReport($id)
    {
        $meeting_report = MeetingReport::findOrFail($id);
        $committees = CommitteeCategory::latest()->get();
        $meeting_types = MeetingType::latest()->get();
        return view('admin.backend.pages.meeting_report.edit_meeting_report', compact('meeting_report', 'committees', 'meeting_types'));
    }
    public function UpdateMeetingReport(Request $request)
    {
        $meeting_report = MeetingReport::findOrFail($request->id);
        $request->validate([
            'committee_category_id' => 'required',
            'meeting_type_id' => 'required',
            'title' => 'required',
            'meeting_no' => 'required',
            'date' => 'required',
            'time' => 'required',
            'year' => 'required',
            'location' => 'required',
            'pdf' => 'nullable|mimes:pdf|max:5000',
        ]);
        $old_pdf = MeetingReport::where('id', $request->id)->value('pdf');
        $save_url = $old_pdf;
        if ($request->hasFile('pdf')) {
            if ($old_pdf) {
                @unlink(public_path($old_pdf));
            }
            $file = $request->file('pdf');
            $filename = hexdec(uniqid()) . '.' . $file->getClientOriginalExtension();
            $file->move(public_path('uploads/meeting_report/'), $filename);
            $save_url = 'uploads/meeting_report/' . $filename;
        }
        try {
            MeetingReport::findOrFail($request->id)->update([
                'committee_category_id' => $request->committee_category_id,
                'meeting_type_id' => $request->meeting_type_id,
                'title' => $request->title,
                'meeting_no' => $request->meeting_no,
                'date' => $request->date,
                'time' => $request->time,
                'year' => $request->year,
                'pdf' => $save_url,
                'location' => $request->location,
                'description' => $request->description,
                'updated_at' => Carbon::now()
            ]);
            $notification = array(
                'message' => 'Meeting Report Updated Successfully',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.report')->with($notification);
        } catch (\Throwable $th) {
            $notification = array(
                'message' => 'Something went wrong.',
                'alert-type' => 'danger'
            );
            return redirect()->back()->with($notification);
        }
    }
    public function DeleteMeetingReport($id)
    {
        $meeting_report = MeetingReport::findOrFail($id);
        $old_pdf = $meeting_report->pdf;
        if ($old_pdf) {
            @unlink(public_path($old_pdf));
        }
        $meeting_report->delete();
        $notification = array(
            'message' => 'Meeting Report Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/PositionController.php">
<?php
namespace App\Http\Controllers;
use App\Models\Position;
use Carbon\Carbon;
use Illuminate\Http\Request;
class PositionController extends Controller
{
    public function AllPosition()
    {
        $positions = Position::get();
        return view('admin.backend.pages.position.all_position', compact('positions'));
    }
    public function AddPosition()
    {
        $positions = Position::all();
        return view('admin.backend.pages.position.add_position', compact('positions'));
    }
    public function StorePosition(Request $request)
    {
        $request->validate([
            'name' => 'required|unique:positions',
        ], [
            'name.required' => 'กรุณากรอกชื่อตำแหน่ง',
            'name.unique' => 'ชื่อตำแหน่งนี้มีอยู่แล้วในระบบ',
        ]);
        Position::create([
            'name' => $request->name,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'เพิ่มตำแหน่งเรียบร้อยแล้ว',
            'alert-type' => 'success'
        );
        return redirect()->route('all.position')->with($notification);
    }
    public function EditPosition($id)
    {
        $positions = Position::all();
        $editPosition = Position::findOrFail($id);
        return view('admin.backend.pages.position.edit_position', compact('positions', 'editPosition'));
    }
    public function UpdatePosition(Request $request, $id)
    {
        $request->validate([
            'name' => 'required|unique:positions,name,' . $id,
        ], [
            'name.required' => 'กรุณากรอกชื่อตำแหน่ง',
            'name.unique' => 'ชื่อตำแหน่งนี้มีอยู่แล้วในระบบ',
        ]);
        Position::findOrFail($id)->update([
            'name' => $request->name,
            'updated_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'แก้ไขตำแหน่งเรียบร้อยแล้ว',
            'alert-type' => 'success'
        );
        return redirect()->route('all.position')->with($notification);
    }
    public function DeletePosition($id)
    {
        Position::findOrFail($id)->delete();
        $notification = array(
            'message' => 'ลบตำแหน่งเรียบร้อยแล้ว',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Http/Kernel.php">
<?php
namespace App\Http;
use Illuminate\Foundation\Http\Kernel as HttpKernel;
class Kernel extends HttpKernel
{
    protected $middleware = [
        \App\Http\Middleware\TrustProxies::class,
        \Illuminate\Http\Middleware\HandleCors::class,
        \App\Http\Middleware\PreventRequestsDuringMaintenance::class,
        \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class,
        \App\Http\Middleware\TrimStrings::class,
        \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,
    ];
    protected $middlewareGroups = [
        'web' => [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],
        'api' => [
            \Illuminate\Routing\Middleware\ThrottleRequests::class.':api',
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],
    ];
    protected $middlewareAliases = [
        'auth' => \App\Http\Middleware\Authenticate::class,
        'roles' => \App\Http\Middleware\Role::class,
        'role' => \Spatie\Permission\Middleware\RoleMiddleware::class,
        'permission' => \Spatie\Permission\Middleware\PermissionMiddleware::class,
        'role_or_permission' => \Spatie\Permission\Middleware\RoleOrPermissionMiddleware::class,
        'auth.basic' => \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'auth.session' => \Illuminate\Session\Middleware\AuthenticateSession::class,
        'cache.headers' => \Illuminate\Http\Middleware\SetCacheHeaders::class,
        'can' => \Illuminate\Auth\Middleware\Authorize::class,
        'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
        'password.confirm' => \Illuminate\Auth\Middleware\RequirePassword::class,
        'signed' => \App\Http\Middleware\ValidateSignature::class,
        'throttle' => \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'verified' => \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
    ];
}
</file>

<file path="app/Http/Middleware/Role.php">
<?php
namespace App\Http\Middleware;
use App\Models\User;
use Carbon\Carbon;
use Closure;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Cache;
use Symfony\Component\HttpFoundation\Response;
class Role
{
    public function handle(Request $request, Closure $next, ...$roles): Response
    {
        if (Auth::check()) {
            $expireTime = Carbon::now()->addMinutes(30);
            Cache::put('user-is-online' . Auth::user()->id, true, $expireTime);
            User::where('id', Auth::user()->id)->update(['last_seen' => Carbon::now()]);
        }
        $userRole = $request->user()->role;
        if (in_array($userRole, $roles)) {
            return $next($request);
        } elseif ($userRole === 'user') {
            return redirect('dashboard');
        } elseif ($userRole === 'admin') {
            return redirect('/admin/dashboard');
        }
        return abort(403);
    }
}
</file>

<file path="app/Models/CommitteeCategory.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class CommitteeCategory extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function users()
    {
        return $this->belongsToMany(User::class);
    }
}
</file>

<file path="app/Models/MeetingAgendaLecture.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingAgendaLecture extends Model
{
    use HasFactory;
    protected $guarded = [];
    protected $casts = [
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
        'status' => 'boolean'
    ];
    public function meetingAgendaSection()
    {
        return $this->belongsTo(MeetingAgendaSection::class, 'meeting_agenda_section_id');
    }
    public function meetingAgendaItems()
    {
        return $this->hasMany(MeetingAgendaItems::class, 'meeting_agenda_lecture_id');
    }
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class, 'meeting_agenda_id');
    }
    public function committeeOpinions()
    {
        return $this->hasMany(CommitteeOpinion::class);
    }
    public function scopeActive($query)
    {
        return $query->where('status', true);
    }
    public function scopeOrdered($query)
    {
        return $query->orderBy('order', 'asc');
    }
}
</file>

<file path="app/Models/MeetingType.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingType extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function users()
    {
        return $this->belongsToMany(User::class, 'meeting_type_user', 'meeting_type_id', 'user_id');
    }
}
</file>

<file path="app/Models/Position.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class Position extends Model
{
    use HasFactory;
    protected $fillable = [
        'name',
        'parent_id',
    ];
    public function users()
    {
        return $this->hasMany(User::class, 'position_id');
    }
    public function parent()
    {
        return $this->belongsTo(Position::class, 'parent_id');
    }
    public function children()
    {
        return $this->hasMany(Position::class, 'parent_id');
    }
}
</file>

<file path="app/Models/RegulationCategory.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class RegulationCategory extends Model
{
    use HasFactory;
    protected $guarded = [];
}
</file>

<file path="database/migrations/2014_10_12_000000_create_users_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('first_name');
            $table->string('last_name');
            $table->string('title');
            $table->string('username');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->string('phone')->nullable();
            $table->enum('role', ['user', 'admin', 'super_admin'])->default('user');
            $table->enum('status', ['1', '0'])->default('1');
            $table->string('last_seen')->nullable();
            $table->rememberToken();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('users');
    }
};
</file>

<file path="database/migrations/2024_10_03_075707_create_regulation_categories_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('regulation_categories', function (Blueprint $table) {
            $table->id();
            $table->string('regulation_category_name');
            $table->text('description')->nullable();
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('regulation_categories');
    }
};
</file>

<file path="database/migrations/2024_10_03_075755_create_rugulation_meetings_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('regulation_meetings', function (Blueprint $table) {
            $table->id();
            $table->integer('regulation_category_id');
            $table->string('regulation_title');
            $table->string('regulation_pdf')->nullable();
            $table->text('description')->nullable();
            $table->string('status')->default('1')->comment('1=active, 0=inactive');
            $table->timestamps();
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('regulation_meetings');
    }
};
</file>

<file path="database/migrations/2024_10_07_084950_create_meeting_agenda_items_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meeting_agenda_items', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('meeting_agenda_section_id');
            $table->unsignedBigInteger('meeting_agenda_lecture_id');
            $table->unsignedBigInteger('rule_of_meeting_id');
            $table->unsignedBigInteger('regulation_meeting_id');
            $table->string('item_title');
            $table->longText('content')->nullable();
            $table->string('pdf')->nullable();
            $table->timestamps();
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign('meeting_agenda_section_id')->references('id')->on('meeting_agenda_sections')->onDelete('cascade');
            $table->foreign('meeting_agenda_lecture_id')->references('id')->on('meeting_agenda_lectures')->onDelete('cascade');
            $table->foreign('rule_of_meeting_id')->references('id')->on('ruleof_meetings')->onDelete('cascade');
            $table->foreign('regulation_meeting_id')->references('id')->on('regulation_meetings')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meeting_agenda_items');
    }
};
</file>

<file path="database/migrations/2024_10_09_085015_create_meetings_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('meetings', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('meeting_type_id');
            $table->unsignedBigInteger('committee_category_id');
            $table->unsignedBigInteger('meeting_format_id');
            $table->unsignedBigInteger('meeting_agenda_id');
            $table->unsignedBigInteger('rule_of_meeting_id');
            $table->unsignedBigInteger('regulation_meeting_id');
            $table->unsignedBigInteger('meeting_agenda_section_id');
            $table->unsignedBigInteger('meeting_agenda_lecture_id');
            $table->unsignedBigInteger('meeting_agenda_item_id');
            $table->unsignedBigInteger('user_id');
            $table->string('title');
            $table->text('description')->nullable();
            $table->string('status')->default('1')->comment('1=active, 0=inactive');
            $table->timestamps();
            $table->foreign('meeting_type_id')->references('id')->on('meeting_types')->onDelete('cascade');
            $table->foreign('committee_category_id')->references('id')->on('committee_categories')->onDelete('cascade');
            $table->foreign('meeting_format_id')->references('id')->on('meeting_formats')->onDelete('cascade');
            $table->foreign('meeting_agenda_id')->references('id')->on('meeting_agendas')->onDelete('cascade');
            $table->foreign('rule_of_meeting_id')->references('id')->on('ruleof_meetings')->onDelete('cascade');
            $table->foreign('regulation_meeting_id')->references('id')->on('regulation_meetings')->onDelete('cascade');
            $table->foreign('meeting_agenda_section_id')->references('id')->on('meeting_agenda_sections')->onDelete('cascade');
            $table->foreign('meeting_agenda_lecture_id')->references('id')->on('meeting_agenda_lectures')->onDelete('cascade');
            $table->foreign('meeting_agenda_item_id')->references('id')->on('meeting_agenda_items')->onDelete('cascade');
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('meetings');
    }
};
</file>

<file path="database/migrations/2024_10_16_115849_create_committee_user_table.php">
<?php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
return new class extends Migration
{
    public function up(): void
    {
        Schema::create('committee_user', function (Blueprint $table) {
            $table->id();
            $table->unsignedBigInteger('committee_id');
            $table->unsignedBigInteger('user_id');
            $table->timestamps();
            $table->foreign('committee_id')->references('id')->on('committee_categories')->onDelete('cascade');
            $table->foreign('user_id')->references('id')->on('users')->onDelete('cascade');
            $table->unique(['committee_id', 'user_id']);
        });
    }
    public function down(): void
    {
        Schema::dropIfExists('committee_user');
    }
};
</file>

<file path="resources/views/admin/backend/pages/main_meeting/add_main_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มประชุมหลัก</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h1 class="mb-4">Create Main Meeting</h1>
                <form action="{{ route('store.main.meeting') }}" method="POST">
                    @csrf
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label class="form-label">Meeting Types</label>
                        <div>
                            @foreach ($meeting_types as $meetingType)
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="meeting_types_id[]"
                                        value="{{ $meetingType->id }}" id="meetingType{{ $meetingType->id }}">
                                    <label class="form-check-label" for="meetingType{{ $meetingType->id }}">
                                        {{ $meetingType->name }}
                                    </label>
                                </div>
                            @endforeach
                        </div>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label class="form-label">Committee Categories</label>
                        <div>
                            @foreach ($committee_categories as $committeeCategory)
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="committee_categories_id[]"
                                        value="{{ $committeeCategory->id }}"
                                        id="committeeCategory{{ $committeeCategory->id }}">
                                    <label class="form-check-label" for="committeeCategory{{ $committeeCategory->id }}">
                                        {{ $committeeCategory->name }}
                                    </label>
                                </div>
                            @endforeach
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">บันทึก</button>
                    <a href="{{ route('all.main.meeting') }}" class="btn btn-danger">ยกเลิก</a>
                </form>
            </div>
        </div>
    @endsection
    @section('script')
        <script>
            CKEDITOR.replace('description');
        </script>
    @endsection
</file>

<file path="resources/views/admin/backend/pages/main_meeting/edit_main_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขประชุมหลัก</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h1 class="mb-4">Edit Main Meeting</h1>
                <form action="{{ route('update.main.meeting', $main_meeting->id) }}" method="POST">
                    @csrf
                    @method('POST')
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" name="title" value="{{ $main_meeting->title }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3">{{ $main_meeting->description }}</textarea>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label class="form-label">Meeting Types</label>
                        <div>
                            @foreach ($meeting_types as $meetingType)
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="meeting_types_id[]"
                                        value="{{ $meetingType->id }}" id="meetingType{{ $meetingType->id }}"
                                        {{ $main_meeting->meetingTypes->contains($meetingType->id) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="meetingType{{ $meetingType->id }}">
                                        {{ $meetingType->name }}
                                    </label>
                                </div>
                            @endforeach
                        </div>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label class="form-label">Committee Categories</label>
                        <div>
                            @foreach ($committee_categories as $committeeCategory)
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="committee_categories_id[]"
                                        value="{{ $committeeCategory->id }}"
                                        id="committeeCategory{{ $committeeCategory->id }}"
                                        {{ $main_meeting->committeeCategories->contains($committeeCategory->id) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="committeeCategory{{ $committeeCategory->id }}">
                                        {{ $committeeCategory->name }}
                                    </label>
                                </div>
                            @endforeach
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">บันทึกการแก้ไข</button>
                    <a href="{{ route('all.main.meeting') }}" class="btn btn-danger">ยกเลิก</a>
                </form>
            </div>
        </div>
    </div>
@endsection
@section('script')
    <script>
        CKEDITOR.replace('description');
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_agenda/all_meeting_agenda.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ระเบียบวาระการประชุม</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting.agenda') }}" class="btn btn-primary">เพิ่มระเบียบวาระการประชุม</a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ประเภทการประชุม</th>
                                <th>ชื่อวาระการประชุม</th>
                                <th>ประเภทการประชุม</th>
                                <th>ครั้งที่</th>
                                <th>ปี</th>
                                <th>วันที่</th>
                                <th>สร้างโดย</th>
                                <th>status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($meeting_agendas as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->meeting_type->name }}</td>
                                    <td>{{ $item->meeting_agenda_title }}</td>
                                    <td>{{ $item->meetingFormat->name }}</td>
                                    <td>{{ $item->meeting_agenda_number }}</td>
                                    <td>{{ $item->meeting_agenda_year }}</td>
                                    <td>{{ $item->meeting_agenda_date }}</td>
                                    <td>{{ $item->user->username }}</td>
                                    <td class="text-center">
                                        <div class="form-check form-switch d-flex justify-content-center">
                                            <input class="form-check-input" type="checkbox" id="status{{ $item->id }}"
                                                {{ $item->status == 1 ? 'checked' : '' }}
                                                onchange="updateStatus({{ $item->id }})">
                                            <label class="form-check-label" for="status{{ $item->id }}">
                                            </label>
                                        </div>                                    </td>
                                    <td>
                                        <a href="{{ route('edit.meeting.agenda', $item->id) }}"
                                            class="btn btn-info px-2"><i class="bx bx-edit"></i></a>
                                        <a href="{{ route('delete.meeting.agenda', $item->id) }}"
                                            class="btn btn-danger px-2" id="delete"><i class="bx bx-trash"></i></a>
                                        <a href="{{ route('add.meeting.agenda.lecture', $item->id) }}"
                                            class="btn btn-warning px-2" title="MeetingAgendaLecture"><i class="lni lni-list"></i></a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        function updateStatus(id) {
            if (id) {
                $.ajax({
                    type: 'POST',
                    url: "{{ route('update.status.meeting.agenda', ':id') }}".replace(':id', id),
                    data: {
                        _token: "{{ csrf_token() }}"
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.status == 1) {
                            $('#status' + id).prop('checked', true);
                        } else {
                            $('#status' + id).prop('checked', false);
                        }
                        toastr.success(response.message);
                        setTimeout(function() {
                            location.reload();
                        }, 1000);
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error('An error occurred while updating the status.');
                    }
                });
            } else {
                toastr.error('Missing required parameter: id');
            }
        }
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report/add_meeting_report.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มรายงานการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มรายงานการประชุม</h5>
                <form id="myForm" action="{{ route('store.meeting.report') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    @if ($errors->any())
                        <div class="alert alert-danger">
                            <ul>
                                @foreach ($errors->all() as $error)
                                    <li>{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">ประเภทคณะกรรมการ</label>
                        <select name="committee_category_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทคณะกรรมการ</option>
                            @foreach ($committees as $item)
                                <option value="{{ $item->id }}">{{ $item->name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">ประเภทการประชุม</label>
                        <select name="meeting_type_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทการประชุม</option>
                            @foreach ($meeting_types as $item)
                                <option value="{{ $item->id }}">{{ $item->name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อรายงานการประชุม</label>
                        <input type="text" name="title" class="form-control" id="input1" value="{{ old('title') }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ครั้งที่</label>
                        <input type="text" name="meeting_no" class="form-control" id="input1" value="{{ old('meeting_no') }}">
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label">วันที่</label>
                        <input type="date" name="date" class="form-control" id="input1" value="{{ old('date') }}">
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label">เวลา</label>
                        <input type="time" name="time" class="form-control" id="input1" value="{{ old('time') }}">
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label">ปี </label>
                        <input type="text" name="year" class="form-control" id="input1" value="{{ old('year') }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">สถานที่</label>
                        <input type="text" name="location" class="form-control" id="input1" value="{{ old('location') }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input_pdf" class="form-label">PDF File</label>
                        <input type="file" name="pdf" class="form-control" id="input_pdf" accept=".pdf">
                        <span class="text-danger" id="pdfError"></span>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10">{{ old('description') }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.meeting.report') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    title: {
                        required: true,
                    },
                    committee_category_id: {
                        required: true,
                    },
                },
                messages: {
                    title: {
                        required: 'Please Enter Category Name',
                    },
                    committee_category_id: {
                        required: 'Please Select Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <script>
        $("#input_pdf").change(function() {
            var file = $(this).val().split('.').pop().toLowerCase();
            if (file != "pdf") {
                $('#pdfError').html('Please select pdf file');
                $(this).val('');
            } else {
                $('
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report/all_meeting_report.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">รายงานการประชุม ทั้งหมด</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.meeting.report') }}" class="btn btn-primary">เพิ่มรายงานการประชุม </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>คณะกรรมการ</th>
                                <th>ประภทการประชุม</th>
                                <th>ชื่อรายงานการประชุม</th>
                                <th>รายละเอียด</th>
                                <th>ครั้งที่</th>
                                <th>วันที่</th>
                                <th>เวลา</th>
                                <th>ปี</th>
                                <th>pdf</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($meeting_reports as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->committee_category->name }}</td>
                                    <td>{{ $item->meeting_type->name }}</td>
                                    <td>{{ $item->title }}</td>
                                    <td>{{ $item->description }}</td>
                                    <td>{{ $item->meeting_no }}</td>
                                    <td>{{ $item->date }}</td>
                                    <td>{{ $item->time }}</td>
                                    <td>{{ $item->year }}</td>
                                    <td>
                                        @if ($item->pdf)
                                            <a href="{{ asset($item->pdf) }}" target="_blank" class="badge bg-success">ดูไฟล์ PDF</a>
                                        @else
                                            <span class="badge bg-danger">ไม่มีไฟล์ PDF</span>
                                        @endif
                                    </td>
                                    <td>
                                        <a href="{{ route('edit.meeting.report', $item->id) }}" class="btn btn-info px-5">แก้ไข </a>
                                        <a href="{{ route('delete.meeting.report', $item->id) }}" class="btn btn-danger px-5" id="delete">ลบ </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        function updateStatus(id) {
            if (id) {
                $.ajax({
                    type: 'POST',
                    url: "{{ route('update.status.regulation.meeting', ':id') }}".replace(':id', id),
                    data: {
                        _token: "{{ csrf_token() }}"
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.status == 1) {
                            $('#status' + id).prop('checked', true);
                        } else {
                            $('#status' + id).prop('checked', false);
                        }
                        toastr.success(response.message);
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error('An error occurred while updating the status.');
                    }
                });
            } else {
                toastr.error('Missing required parameter: id');
            }
        }
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report/edit_meeting_report.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขรายงานการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขรายงานการประชุม</h5>
                <form id="myForm" action="{{ route('update.meeting.report', $meeting_report->id) }}" method="post"
                    class="row g-3" enctype="multipart/form-data">
                    @csrf
                    @method('POST')
                    @if ($errors->any())
                        <div class="alert alert-danger">
                            <ul>
                                @foreach ($errors->all() as $error)
                                    <li>{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">ประเภทคณะกรรมการ</label>
                        <select name="committee_category_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทคณะกรรมการ</option>
                            @foreach ($committees as $item)
                                <option value="{{ $item->id }}"
                                    {{ $meeting_report->committee_category_id == $item->id ? 'selected' : '' }}>
                                    {{ $item->name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">ประเภทการประชุม</label>
                        <select name="meeting_type_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทการประชุม</option>
                            @foreach ($meeting_types as $item)
                                <option value="{{ $item->id }}"
                                    {{ $meeting_report->meeting_type_id == $item->id ? 'selected' : '' }}>
                                    {{ $item->name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อรายงานการประชุม</label>
                        <input type="text" name="title" class="form-control" id="input1"
                            value="{{ $meeting_report->title }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ครั้งที่</label>
                        <input type="text" name="meeting_no" class="form-control" id="input1"
                            value="{{ $meeting_report->meeting_no }}">
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label">วันที่</label>
                        <input type="date" name="date" class="form-control" id="input1"
                            value="{{ $meeting_report->date }}">
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label">เวลา</label>
                        <input type="time" name="time" class="form-control" id="input1"
                            value="{{ $meeting_report->time }}">
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label">ปี </label>
                        <input type="text" name="year" class="form-control" id="input1"
                            value="{{ $meeting_report->year }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">สถานที่</label>
                        <input type="text" name="location" class="form-control" id="input1" value="{{ $meeting_report->location }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input_pdf" class="form-label">PDF File</label>
                        @if ($meeting_report->pdf)
                            <a href="{{ asset($meeting_report->pdf) }}" target="_blank"><span class="badge rounded-pill bg-danger text-white">View PDF</span></a>
                        @endif
                        <input type="file" name="pdf" class="form-control" id="input_pdf" accept=".pdf">
                        <span class="text-danger" id="pdfError"></span>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียด</label>
                        <textarea name="description" class="form-control" rows="10">{{ $meeting_report->description }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.meeting.report') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    title: {
                        required: true,
                    },
                    committee_category_id: {
                        required: true,
                    },
                },
                messages: {
                    title: {
                        required: 'Please Enter Category Name',
                    },
                    committee_category_id: {
                        required: 'Please Select Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <script>
        $("#input_pdf").change(function() {
            var file = $(this).val().split('.').pop().toLowerCase();
            if (file != "pdf") {
                $('#pdfError').html('Please select pdf file');
                $(this).val('');
            } else {
                $('
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/partials/approval_table.blade.php">
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th style="width: 20%">ผู้รับรอง</th>
                <th style="width: 15%">สถานะ</th>
                <th style="width: 45%">ความคิดเห็น</th>
                <th style="width: 20%">วันที่รับรอง</th>
            </tr>
        </thead>
        <tbody>
            @foreach($approvals as $approval)
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="flex-shrink-0">
                                <div class="avatar avatar-xs me-2">
                                    <span class="avatar-title rounded-circle bg-soft-primary text-primary">
                                        {{ substr($approval['user']->first_name, 0, 1) }}
                                    </span>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                {{ $approval['user']->prefix_name }} {{ $approval['user']->first_name }} {{ $approval['user']->last_name }}
                                <div class="small text-muted">
                                    {{ $approval['user']->position->name ?? '' }}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        @if($approval['type'] == 'no_changes')
                            <span class="badge bg-success">รับรองโดยไม่มีแก้ไข</span>
                        @else
                            <span class="badge bg-warning">รับรองโดยมีแก้ไข</span>
                        @endif
                    </td>
                    <td>
                        @if($approval['comments'])
                            <div class="comment-text">
                                {{ $approval['comments'] }}
                            </div>
                        @else
                            <span class="text-muted">-</span>
                        @endif
                    </td>
                    <td>
                        <div class="small text-muted">
                            {{ date('d/m/Y H:i', strtotime($approval['created_at'] ?? now())) }}
                        </div>
                    </td>
                </tr>
            @endforeach
        </tbody>
    </table>
</div>
</file>

<file path="resources/views/admin/backend/pages/permission/edit_permission.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Edit Permission</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Edit Permission</h5>
                <form id="myForm" action="{{ route('update.permission') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $permission->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Permission Name</label>
                        <input type="text" name="name" class="form-control" id="input1"
                            value="{{ $permission->name }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label"> Group Name</label>
                        <select name="group_name" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>Open this select menu</option>
                            <option value="สภามหาวิทยาลัย" {{ $permission->group_name == 'สภามหาวิทยาลัย' ? 'selected' : '' }}>สภามหาวิทยาลัย
                            </option>
                            <option value="คณะกรรมการนโยบายด้านการจัดการศึกษา" {{ $permission->group_name == 'คณะกรรมการนโยบายด้านการจัดการศึกษา' ? 'selected' : '' }}>คณะกรรมการนโยบายด้านการจัดการศึกษา
                            </option>
                            <option value="คณะกรรมการนโยบายด้านการจบริหารจัดการ" {{ $permission->group_name == 'คณะกรรมการนโยบายด้านการจบริหารจัดการ' ? 'selected' : '' }}>คณะกรรมการนโยบายด้านการจบริหารจัดการ
                            </option>
                            <option value="คณะกรรมการนโยบายด้านการวิจัยฯ" {{ $permission->group_name == 'คณะกรรมการนโยบายด้านการวิจัยฯ' ? 'selected' : '' }}>คณะกรรมการนโยบายด้านการวิจัยฯ
                            </option>
                            <option value="Category" {{ $permission->group_name == 'Category' ? 'selected' : '' }}>Category
                            </option>
                            <option value="All User" {{ $permission->group_name == 'All User' ? 'selected' : '' }}>All User
                            </option>
                            <option value="Blog" {{ $permission->group_name == 'Blog' ? 'selected' : '' }}>Blog</option>
                            <option value="Role and Permission"
                                {{ $permission->group_name == 'Role and Permission' ? 'selected' : '' }}>Role and
                                Permission</option>
                        </select>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.permission') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/position/edit_position.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขข้อบังคับ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
            <div class="card">
                <div class="card-body p-4">
                    <h5 class="mb-4">แก้ไขข้อมูลตำแหน่ง</h5>
                    <form id="myForm" action="{{ route('update.position', $editPosition->id) }}" method="POST" class="row g-3" enctype="multipart/form-data">
                        @csrf
                        @method('POST')
                        <div class="form-group col-md-6">
                            <label for="name" class="form-label">ชื่อตำแหน่ง</label>
                            <input type="text" class="form-control" name="name" value="{{ $editPosition->name }}" placeholder="ชื่อตำแหน่ง" id="name" required>
                        </div>
                        <div class="col-md-12">
                            <div class="d-md-flex d-grid align-items-center gap-3">
                                <button type="submit" class="btn btn-primary px-4">แก้ไข</button>
                                <a href="{{ route('all.position') }}" class="btn btn-danger px-4">ยกเลิก</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/regulation_meeting/all_regulation_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">รายการระเบียบ ทั้งหมด</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.regulation.meeting') }}" class="btn btn-primary">เพิ่มระเบียบ </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Regulation Title</th>
                                <th>description</th>
                                <th>date</th>
                                <th>pdf</th>
                                <th>status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($regulation as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->regulation_title }}</td>
                                    <td>{{ $item->description }}</td>
                                    <td>{{ $item->created_at }}</td>
                                    <td>
                                        @if ($item->regulation_pdf)
                                            <a href="{{ asset($item->regulation_pdf) }}" target="_blank" class="badge bg-success">ดูไฟล์ PDF</a>
                                        @else
                                            <span class="badge bg-danger">ไม่มีไฟล์ PDF</span>
                                        @endif
                                    </td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="status{{ $item->id }}"
                                                {{ $item->status == 1 ? 'checked' : '' }}
                                                onchange="updateStatus({{ $item->id }})">
                                            <label class="form-check-label" for="status{{ $item->id }}">
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <a href="{{ route('edit.regulation.meeting', $item->id) }}" class="btn btn-info px-5">Edit </a>
                                        <a href="{{ route('delete.regulation.meeting', $item->id) }}" class="btn btn-danger px-5" id="delete">Delete </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        function updateStatus(id) {
            if (id) {
                $.ajax({
                    type: 'POST',
                    url: "{{ route('update.status.regulation.meeting', ':id') }}".replace(':id', id),
                    data: {
                        _token: "{{ csrf_token() }}"
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.status == 1) {
                            $('#status' + id).prop('checked', true);
                        } else {
                            $('#status' + id).prop('checked', false);
                        }
                        toastr.success(response.message);
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error('An error occurred while updating the status.');
                    }
                });
            } else {
                toastr.error('Missing required parameter: id');
            }
        }
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/regulation_meeting/edit_regulation_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขระเบียบ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขระเบียบ</h5>
                <form id="myForm" action="{{ route('update.regulation.meeting') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="regulation_meeting_id" value="{{ $regulation->id }}">
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">Regulation Category Name</label>
                        <select name="regulation_category_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทระเบียบ</option>
                            @foreach ($categories as $item)
                                <option value="{{ $item->id }}"
                                    {{ $item->id == $regulation->regulation_category_id ? 'selected' : '' }}>
                                    {{ $item->regulation_category_name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Regulation Title</label>
                        <input type="text" name="regulation_title" class="form-control" id="input1"
                            value="{{ $regulation->regulation_title }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input_pdf" class="form-label"><strong>PDF File : </strong></label>
                        @if ($regulation->regulation_pdf)
                            <a href="{{ asset($regulation->regulation_pdf) }}" target="_blank"><span class="badge rounded-pill bg-danger text-white">View PDF</span></a>
                        @endif
                        <input type="file" name="regulation_pdf" class="form-control" id="input_pdf" accept=".pdf">
                        <span class="text-danger" id="pdfError"></span>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10">{!! $regulation->description !!}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.regulation.meeting') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    regulation_title: {
                        required: true,
                    },
                    regulation_category_id: {
                        required: true,
                    },
                },
                messages: {
                    regulation_title: {
                        required: 'Please Enter regulation title',
                    },
                    regulation_category_id: {
                        required: 'Please Select Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <script>
        $("#input_pdf").change(function() {
            var file = $(this).val().split('.').pop().toLowerCase();
            if (file != "pdf") {
                $('#pdfError').html('Please select pdf file');
                $(this).val('');
            } else {
                $('
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rolesetup/add_roles_permission.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <!-- add css for capitalize all label -->
    <style>
        .form-check-label {
            text-transform: capitalize;
        }
    </style>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Add Role In Permission</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <form id="myForm" action="{{ route('role.permission.store') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label"> Roles Name</label>
                        <select name="role_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>Select Open Roles</option>
                            @foreach ($roles as $role)
                                <option value="{{ $role->id }}">{{ $role->name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckMain">
                        <label class="form-check-label" for="flexCheckMain">Permission All </label>
                    </div>
                    <hr>
                    @foreach ($permission_groups as $group)
                        <div class="row">
                            <div class="col-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                    <label class="form-check-label" for="flexCheckDefault"> {{ $group->group_name }}</label>
                                </div>
                            </div>
                            <div class="col-9">
                                @php
                                    $permissions = App\Models\User::getPermissionsByGroupName($group->group_name);
                                @endphp
                                @foreach ($permissions as $permission)
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="permission[]"
                                            value="{{ $permission->id }}" id="checkDefault{{ $permission->id }}">
                                        <label class="form-check-label"
                                            for="checkDefault{{ $permission->id }}">{{ $permission->name }}</label>
                                    </div>
                                @endforeach
                                <hr>
                            </div>
                        </div>
                        {{--
                    @endforeach
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        $('#flexCheckMain').click(function() {
            if ($(this).is(':checked')) {
                $('input[ type=checkbox]').prop('checked', true)
            } else {
                $('input[ type=checkbox]').prop('checked', false)
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rule_meeting/edit_rule_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขข้อบังคับ</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขข้อบังคับ</h5>
                <form id="myForm" action="{{ route('update.rule.meeting') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="rule_meeting_id" value="{{ $rule->id }}">
                    <div class="form-group col-md-8">
                        <label for="input1" class="form-label">Rule Category Name</label>
                        <select name="rule_category_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทข้อบังคับ</option>
                            @foreach ($categories as $item)
                                <option value="{{ $item->id }}"
                                    {{ $item->id == $rule->rule_category_id ? 'selected' : '' }}>
                                    {{ $item->rule_category_name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Rule Title</label>
                        <input type="text" name="title" class="form-control" id="input1"
                            value="{{ $rule->title }}">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input_pdf" class="form-label"><strong>PDF File</strong></label>
                        @if ($rule->pdf)
                            <a href="{{ asset($rule->pdf) }}" target="_blank"><span class="badge rounded-pill bg-danger text-white">View PDF</span></a>
                        @endif
                        <input type="file" name="pdf" class="form-control" id="input_pdf" accept=".pdf">
                        <span class="text-danger" id="pdfError"></span>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10">{!! $rule->description !!}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.rule.meeting') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    rule_title: {
                        required: true,
                    },
                    rule_category_id: {
                        required: true,
                    },
                },
                messages: {
                    rule_title: {
                        required: 'Please Enter SubCategory Name',
                    },
                    rule_category_id: {
                        required: 'Please Select Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
    <script>
        $("#input_pdf").change(function() {
            var file = $(this).val().split('.').pop().toLowerCase();
            if (file != "pdf") {
                $('#pdfError').html('Please select pdf file');
                $(this).val('');
            } else {
                $('
            }
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rule_meeting/rule_category/add_rule_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Add Rule Category</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Add Rule Category</h5>
                <form id="myForm" action="{{ route('store.rule.category') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Rule Category Name</label>
                        <input type="text" name="rule_category_name" placeholder="Enter Rule Category Name" class="form-control" id="input1" required>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10"></textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('rule.category') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rule_meeting/rule_category/all_rule_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">All Rule Category</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.rule.category') }}" class="btn btn-primary px-5">Add Rule Category </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Category Name</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($r_cat as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->rule_category_name }}</td>
                                    <td>{!! $item->description !!}</td>
                                    <td>
                                        <a href="{{ route('edit.rule.category', $item->id) }}" class="btn btn-info px-5">Edit </a>
                                        <a href="{{ route('delete.rule.category', $item->id) }}" class="btn btn-danger px-5"
                                            id="delete">Delete </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rule_meeting/rule_category/edit_rule_category.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Edit Rule Category</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Edit Rule Category</h5>
                <form id="myForm" action="{{ route('update.rule.category') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $category->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Rule Category Name</label>
                        <input type="text" name="rule_category_name" placeholder="Enter Rule Category Name" class="form-control" id="input1" value="{{ $category->rule_category_name }}">
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="10" c>{!! $category->description !!}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('rule.category') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/components/application-logo.blade.php">
{{-- <svg viewBox="0 0 316 316" xmlns="http://www.w3.org/2000/svg" {{ $attributes }}>
    <path d="M305.8 81.125C305.77 80.995 305.69 80.885 305.65 80.755C305.56 80.525 305.49 80.285 305.37 80.075C305.29 79.935 305.17 79.815 305.07 79.685C304.94 79.515 304.83 79.325 304.68 79.175C304.55 79.045 304.39 78.955 304.25 78.845C304.09 78.715 303.95 78.575 303.77 78.475L251.32 48.275C249.97 47.495 248.31 47.495 246.96 48.275L194.51 78.475C194.33 78.575 194.19 78.725 194.03 78.845C193.89 78.955 193.73 79.045 193.6 79.175C193.45 79.325 193.34 79.515 193.21 79.685C193.11 79.815 192.99 79.935 192.91 80.075C192.79 80.285 192.71 80.525 192.63 80.755C192.58 80.875 192.51 80.995 192.48 81.125C192.38 81.495 192.33 81.875 192.33 82.265V139.625L148.62 164.795V52.575C148.62 52.185 148.57 51.805 148.47 51.435C148.44 51.305 148.36 51.195 148.32 51.065C148.23 50.835 148.16 50.595 148.04 50.385C147.96 50.245 147.84 50.125 147.74 49.995C147.61 49.825 147.5 49.635 147.35 49.485C147.22 49.355 147.06 49.265 146.92 49.155C146.76 49.025 146.62 48.885 146.44 48.785L93.99 18.585C92.64 17.805 90.98 17.805 89.63 18.585L37.18 48.785C37 48.885 36.86 49.035 36.7 49.155C36.56 49.265 36.4 49.355 36.27 49.485C36.12 49.635 36.01 49.825 35.88 49.995C35.78 50.125 35.66 50.245 35.58 50.385C35.46 50.595 35.38 50.835 35.3 51.065C35.25 51.185 35.18 51.305 35.15 51.435C35.05 51.805 35 52.185 35 52.575V232.235C35 233.795 35.84 235.245 37.19 236.025L142.1 296.425C142.33 296.555 142.58 296.635 142.82 296.725C142.93 296.765 143.04 296.835 143.16 296.865C143.53 296.965 143.9 297.015 144.28 297.015C144.66 297.015 145.03 296.965 145.4 296.865C145.5 296.835 145.59 296.775 145.69 296.745C145.95 296.655 146.21 296.565 146.45 296.435L251.36 236.035C252.72 235.255 253.55 233.815 253.55 232.245V174.885L303.81 145.945C305.17 145.165 306 143.725 306 142.155V82.265C305.95 81.875 305.89 81.495 305.8 81.125ZM144.2 227.205L100.57 202.515L146.39 176.135L196.66 147.195L240.33 172.335L208.29 190.625L144.2 227.205ZM244.75 114.995V164.795L226.39 154.225L201.03 139.625V89.825L219.39 100.395L244.75 114.995ZM249.12 57.105L292.81 82.265L249.12 107.425L205.43 82.265L249.12 57.105ZM114.49 184.425L96.13 194.995V85.305L121.49 70.705L139.85 60.135V169.815L114.49 184.425ZM91.76 27.425L135.45 52.585L91.76 77.745L48.07 52.585L91.76 27.425ZM43.67 60.135L62.03 70.705L87.39 85.305V202.545V202.555V202.565C87.39 202.735 87.44 202.895 87.46 203.055C87.49 203.265 87.49 203.485 87.55 203.695V203.705C87.6 203.875 87.69 204.035 87.76 204.195C87.84 204.375 87.89 204.575 87.99 204.745C87.99 204.745 87.99 204.755 88 204.755C88.09 204.905 88.22 205.035 88.33 205.175C88.45 205.335 88.55 205.495 88.69 205.635L88.7 205.645C88.82 205.765 88.98 205.855 89.12 205.965C89.28 206.085 89.42 206.225 89.59 206.325C89.6 206.325 89.6 206.325 89.61 206.335C89.62 206.335 89.62 206.345 89.63 206.345L139.87 234.775V285.065L43.67 229.705V60.135ZM244.75 229.705L148.58 285.075V234.775L219.8 194.115L244.75 179.875V229.705ZM297.2 139.625L253.49 164.795V114.995L278.85 100.395L297.21 89.825V139.625H297.2Z"/>
</svg> --}}
<div class="d-flex align-items-center">
    <div class="rounded-circle bg-primary p-1 me-3">
        <img src="{{ asset('uploads/logo.png') }}" class="rounded-circle"
            width="180" height="180" alt="...">
    </div>
</div>
</file>

<file path="resources/views/components/primary-button.blade.php">
<button {{ $attributes->merge(['type' => 'submit', 'class' => 'w-full flex items-center justify-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>
</file>

<file path="resources/views/welcome.blade.php">
{{-- <!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Laravel</title>
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,600&display=swap" rel="stylesheet" />
        <!-- Styles -->
        <style>
            *,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:
        </style>
    </head>
    <body class="antialiased">
        <div class="relative sm:flex sm:justify-center sm:items-center min-h-screen bg-dots-darker bg-center bg-gray-100 dark:bg-dots-lighter dark:bg-gray-900 selection:bg-red-500 selection:text-white">
            @if (Route::has('login'))
                <div class="sm:fixed sm:top-0 sm:right-0 p-6 text-right">
                    @auth
                        <a href="{{ url('/dashboard') }}" class="font-semibold text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Dashboard</a>
                    @else
                        <a href="{{ route('login') }}" class="font-semibold text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Log in</a>
                        @if (Route::has('register'))
                            <a href="{{ route('register') }}" class="ml-4 font-semibold text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Register</a>
                        @endif
                    @endauth
                </div>
            @endif
            <div class="max-w-7xl mx-auto p-6 lg:p-8">
                <div class="flex justify-center">
                    <svg viewBox="0 0 62 65" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-16 w-auto bg-gray-100 dark:bg-gray-900">
                        <path d="M61.8548 14.6253C61.8778 14.7102 61.8895 14.7978 61.8897 14.8858V28.5615C61.8898 28.737 61.8434 28.9095 61.7554 29.0614C61.6675 29.2132 61.5409 29.3392 61.3887 29.4265L49.9104 36.0351V49.1337C49.9104 49.4902 49.7209 49.8192 49.4118 49.9987L25.4519 63.7916C25.3971 63.8227 25.3372 63.8427 25.2774 63.8639C25.255 63.8714 25.2338 63.8851 25.2101 63.8913C25.0426 63.9354 24.8666 63.9354 24.6991 63.8913C24.6716 63.8838 24.6467 63.8689 24.6205 63.8589C24.5657 63.8389 24.5084 63.8215 24.456 63.7916L0.501061 49.9987C0.348882 49.9113 0.222437 49.7853 0.134469 49.6334C0.0465019 49.4816 0.000120578 49.3092 0 49.1337L0 8.10652C0 8.01678 0.0124642 7.92953 0.0348998 7.84477C0.0423783 7.8161 0.0598282 7.78993 0.0697995 7.76126C0.0884958 7.70891 0.105946 7.65531 0.133367 7.6067C0.152063 7.5743 0.179485 7.54812 0.20192 7.51821C0.230588 7.47832 0.256763 7.43719 0.290416 7.40229C0.319084 7.37362 0.356476 7.35243 0.388883 7.32751C0.425029 7.29759 0.457436 7.26518 0.498568 7.2415L12.4779 0.345059C12.6296 0.257786 12.8015 0.211853 12.9765 0.211853C13.1515 0.211853 13.3234 0.257786 13.475 0.345059L25.4531 7.2415H25.4556C25.4955 7.26643 25.5292 7.29759 25.5653 7.32626C25.5977 7.35119 25.6339 7.37362 25.6625 7.40104C25.6974 7.43719 25.7224 7.47832 25.7523 7.51821C25.7735 7.54812 25.8021 7.5743 25.8196 7.6067C25.8483 7.65656 25.8645 7.70891 25.8844 7.76126C25.8944 7.78993 25.9118 7.8161 25.9193 7.84602C25.9423 7.93096 25.954 8.01853 25.9542 8.10652V33.7317L35.9355 27.9844V14.8846C35.9355 14.7973 35.948 14.7088 35.9704 14.6253C35.9792 14.5954 35.9954 14.5692 36.0053 14.5405C36.0253 14.4882 36.0427 14.4346 36.0702 14.386C36.0888 14.3536 36.1163 14.3274 36.1375 14.2975C36.1674 14.2576 36.1923 14.2165 36.2272 14.1816C36.2559 14.1529 36.292 14.1317 36.3244 14.1068C36.3618 14.0769 36.3942 14.0445 36.4341 14.0208L48.4147 7.12434C48.5663 7.03694 48.7383 6.99094 48.9133 6.99094C49.0883 6.99094 49.2602 7.03694 49.4118 7.12434L61.3899 14.0208C61.4323 14.0457 61.4647 14.0769 61.5021 14.1055C61.5333 14.1305 61.5694 14.1529 61.5981 14.1803C61.633 14.2165 61.6579 14.2576 61.6878 14.2975C61.7103 14.3274 61.7377 14.3536 61.7551 14.386C61.7838 14.4346 61.8 14.4882 61.8199 14.5405C61.8312 14.5692 61.8474 14.5954 61.8548 14.6253ZM59.893 27.9844V16.6121L55.7013 19.0252L49.9104 22.3593V33.7317L59.8942 27.9844H59.893ZM47.9149 48.5566V37.1768L42.2187 40.4299L25.953 49.7133V61.2003L47.9149 48.5566ZM1.99677 9.83281V48.5566L23.9562 61.199V49.7145L12.4841 43.2219L12.4804 43.2194L12.4754 43.2169C12.4368 43.1945 12.4044 43.1621 12.3682 43.1347C12.3371 43.1097 12.3009 43.0898 12.2735 43.0624L12.271 43.0586C12.2386 43.0275 12.2162 42.9888 12.1887 42.9539C12.1638 42.9203 12.1339 42.8916 12.114 42.8567L12.1127 42.853C12.0903 42.8156 12.0766 42.7707 12.0604 42.7283C12.0442 42.6909 12.023 42.656 12.013 42.6161C12.0005 42.5688 11.998 42.5177 11.9931 42.4691C11.9881 42.4317 11.9781 42.3943 11.9781 42.3569V15.5801L6.18848 12.2446L1.99677 9.83281ZM12.9777 2.36177L2.99764 8.10652L12.9752 13.8513L22.9541 8.10527L12.9752 2.36177H12.9777ZM18.1678 38.2138L23.9574 34.8809V9.83281L19.7657 12.2459L13.9749 15.5801V40.6281L18.1678 38.2138ZM48.9133 9.14105L38.9344 14.8858L48.9133 20.6305L58.8909 14.8846L48.9133 9.14105ZM47.9149 22.3593L42.124 19.0252L37.9323 16.6121V27.9844L43.7219 31.3174L47.9149 33.7317V22.3593ZM24.9533 47.987L39.59 39.631L46.9065 35.4555L36.9352 29.7145L25.4544 36.3242L14.9907 42.3482L24.9533 47.987Z" fill="#FF2D20"/>
                    </svg>
                </div>
                <div class="mt-16">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
                        <a href="https://laravel.com/docs" class="scale-100 p-6 bg-white dark:bg-gray-800/50 dark:bg-gradient-to-bl from-gray-700/50 via-transparent dark:ring-1 dark:ring-inset dark:ring-white/5 rounded-lg shadow-2xl shadow-gray-500/20 dark:shadow-none flex motion-safe:hover:scale-[1.01] transition-all duration-250 focus:outline focus:outline-2 focus:outline-red-500">
                            <div>
                                <div class="h-16 w-16 bg-red-50 dark:bg-red-800/20 flex items-center justify-center rounded-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-7 h-7 stroke-red-500">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                                    </svg>
                                </div>
                                <h2 class="mt-6 text-xl font-semibold text-gray-900 dark:text-white">Documentation</h2>
                                <p class="mt-4 text-gray-500 dark:text-gray-400 text-sm leading-relaxed">
                                    Laravel has wonderful documentation covering every aspect of the framework. Whether you are a newcomer or have prior experience with Laravel, we recommend reading our documentation from beginning to end.
                                </p>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="self-center shrink-0 stroke-red-500 w-6 h-6 mx-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75" />
                            </svg>
                        </a>
                        <a href="https://laracasts.com" class="scale-100 p-6 bg-white dark:bg-gray-800/50 dark:bg-gradient-to-bl from-gray-700/50 via-transparent dark:ring-1 dark:ring-inset dark:ring-white/5 rounded-lg shadow-2xl shadow-gray-500/20 dark:shadow-none flex motion-safe:hover:scale-[1.01] transition-all duration-250 focus:outline focus:outline-2 focus:outline-red-500">
                            <div>
                                <div class="h-16 w-16 bg-red-50 dark:bg-red-800/20 flex items-center justify-center rounded-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-7 h-7 stroke-red-500">
                                        <path stroke-linecap="round" d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z" />
                                    </svg>
                                </div>
                                <h2 class="mt-6 text-xl font-semibold text-gray-900 dark:text-white">Laracasts</h2>
                                <p class="mt-4 text-gray-500 dark:text-gray-400 text-sm leading-relaxed">
                                    Laracasts offers thousands of video tutorials on Laravel, PHP, and JavaScript development. Check them out, see for yourself, and massively level up your development skills in the process.
                                </p>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="self-center shrink-0 stroke-red-500 w-6 h-6 mx-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75" />
                            </svg>
                        </a>
                        <a href="https://laravel-news.com" class="scale-100 p-6 bg-white dark:bg-gray-800/50 dark:bg-gradient-to-bl from-gray-700/50 via-transparent dark:ring-1 dark:ring-inset dark:ring-white/5 rounded-lg shadow-2xl shadow-gray-500/20 dark:shadow-none flex motion-safe:hover:scale-[1.01] transition-all duration-250 focus:outline focus:outline-2 focus:outline-red-500">
                            <div>
                                <div class="h-16 w-16 bg-red-50 dark:bg-red-800/20 flex items-center justify-center rounded-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-7 h-7 stroke-red-500">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" />
                                    </svg>
                                </div>
                                <h2 class="mt-6 text-xl font-semibold text-gray-900 dark:text-white">Laravel News</h2>
                                <p class="mt-4 text-gray-500 dark:text-gray-400 text-sm leading-relaxed">
                                    Laravel News is a community driven portal and newsletter aggregating all of the latest and most important news in the Laravel ecosystem, including new package releases and tutorials.
                                </p>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="self-center shrink-0 stroke-red-500 w-6 h-6 mx-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75" />
                            </svg>
                        </a>
                        <div class="scale-100 p-6 bg-white dark:bg-gray-800/50 dark:bg-gradient-to-bl from-gray-700/50 via-transparent dark:ring-1 dark:ring-inset dark:ring-white/5 rounded-lg shadow-2xl shadow-gray-500/20 dark:shadow-none flex motion-safe:hover:scale-[1.01] transition-all duration-250 focus:outline focus:outline-2 focus:outline-red-500">
                            <div>
                                <div class="h-16 w-16 bg-red-50 dark:bg-red-800/20 flex items-center justify-center rounded-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-7 h-7 stroke-red-500">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.115 5.19l.319 1.913A6 6 0 008.11 10.36L9.75 12l-.387.775c-.217.433-.132.956.21 1.298l1.348 1.348c.21.21.329.497.329.795v1.089c0 .426.24.815.622 1.006l.153.076c.433.217.956.132 1.298-.21l.723-.723a8.7 8.7 0 002.288-4.042 1.087 1.087 0 00-.358-1.099l-1.33-1.108c-.251-.21-.582-.299-.905-.245l-1.17.195a1.125 1.125 0 01-.98-.314l-.295-.295a1.125 1.125 0 010-1.591l.13-.132a1.125 1.125 0 011.3-.21l.603.302a.809.809 0 001.086-1.086L14.25 7.5l1.256-.837a4.5 4.5 0 001.528-1.732l.146-.292M6.115 5.19A9 9 0 1017.18 4.64M6.115 5.19A8.965 8.965 0 0112 3c1.929 0 3.716.607 5.18 1.64" />
                                    </svg>
                                </div>
                                <h2 class="mt-6 text-xl font-semibold text-gray-900 dark:text-white">Vibrant Ecosystem</h2>
                                <p class="mt-4 text-gray-500 dark:text-gray-400 text-sm leading-relaxed">
                                    Laravel's robust library of first-party tools and libraries, such as <a href="https://forge.laravel.com" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Forge</a>, <a href="https://vapor.laravel.com" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Vapor</a>, <a href="https://nova.laravel.com" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Nova</a>, and <a href="https://envoyer.io" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Envoyer</a> help you take your projects to the next level. Pair them with powerful open source libraries like <a href="https://laravel.com/docs/billing" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Cashier</a>, <a href="https://laravel.com/docs/dusk" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Dusk</a>, <a href="https://laravel.com/docs/broadcasting" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Echo</a>, <a href="https://laravel.com/docs/horizon" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Horizon</a>, <a href="https://laravel.com/docs/sanctum" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Sanctum</a>, <a href="https://laravel.com/docs/telescope" class="underline hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">Telescope</a>, and more.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-center mt-16 px-0 sm:items-center sm:justify-between">
                    <div class="text-center text-sm text-gray-500 dark:text-gray-400 sm:text-left">
                        <div class="flex items-center gap-4">
                            <a href="https://github.com/sponsors/taylorotwell" class="group inline-flex items-center hover:text-gray-700 dark:hover:text-white focus:outline focus:outline-2 focus:rounded-sm focus:outline-red-500">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="-mt-px mr-1 w-5 h-5 stroke-gray-400 dark:stroke-gray-600 group-hover:stroke-gray-600 dark:group-hover:stroke-gray-400">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                                </svg>
                                Sponsor
                            </a>
                        </div>
                    </div>
                    <div class="ml-4 text-center text-sm text-gray-500 dark:text-gray-400 sm:text-right sm:ml-0">
                        Laravel v{{ Illuminate\Foundation\Application::VERSION }} (PHP v{{ PHP_VERSION }})
                    </div>
                </div>
            </div>
        </div>
    </body>
</html> --}}
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
<head>
    <!-- Head content -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ระบบบริหารจัดการเอกสารประชุมออนไลน์</title>
    <!--favicon-->
    <link rel="icon" href="{{ asset('backend/assets/images/favicon-96x96.png') }}" type="image/png" />
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ asset('css/app.css') }}">
</head>
<body>
    <div class="landing-page">
        <div class="w-64 h-64 relative mx-auto mb-8">
            <img src="{{ asset('uploads/logo.png') }}" alt="Logo" class="w-full h-full object-contain">
        </div>
        <h1>ยินดีต้อนรับสู่เว็บไซต์</h1>
        <p>ระบบบริหารจัดการเอกสารประชุมออนไลน์</p>
        <a href="{{ route('login') }}" class="btn btn-primary">เข้าสู่ระบบ</a>
    </div>
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; พัฒนาโดย ศูนย์นวัตกรรมและเทคโนโลยีดิจิทัล IDTC {{ date('Y') }}. All rights reserved. : Version : 1.0b</p>
            {{-- <p>ที่อยู่: 45 ชั้น 3 อาคารศูนย์บริหารกิจการศาสนาอิสลามแห่งชาติ ถ.พระราม 1 แขวงรองเมือง เขตปทุมวัน กรุงเทพมหานคร 10330</p> --}}
            <p>โทร: 5115</p>
        </div>
    </footer>
</body>
</html>
<style>
    body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: linear-gradient(45deg,
        font-family: 'Figtree', sans-serif;
    }
    .landing-page {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        text-align: center;
        color:
        padding: 2rem;
        background: linear-gradient(-45deg,
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
    }
    @keyframes gradientBG {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }
    h1 {
        font-size: 3rem;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .btn {
        display: inline-block;
        padding: 1rem 2rem;
        margin: 0.5rem;
        border-radius: 50px;
        font-size: 1.1rem;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .btn-primary {
        background-color:
        color:
    }
    .btn-secondary {
        background-color: transparent;
        color:
        border: 2px solid
    }
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(0,0,0,0.2);
    }
    @media (max-width: 640px) {
        h1 {
            font-size: 2rem;
        }
        p {
            font-size: 1rem;
        }
        .btn {
            padding: 0.8rem 1.6rem;
            font-size: 1rem;
        }
    }
    .footer {
        width: 100%;
        background-color:
        color:
        padding: 0.5rem 0;
        text-align: center;
        position: relative;
        bottom: 0;
    }
    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }
    .footer p {
        margin: 0.5rem 0;
        font-size: 0.9rem;
        color:
    }
    @media (max-width: 640px) {
        .footer p {
            font-size: 0.8rem;
        }
    }
</style>
</file>

<file path="app/Http/Controllers/MainMeetingController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\MainMeeting;
use App\Models\MeetingType;
use Illuminate\Http\Request;
class MainMeetingController extends Controller
{
    public function AllMainMeeting()
    {
        $main_meetings = MainMeeting::latest()->get();
        $meeting_types = MeetingType::all();
        $committee_categories = CommitteeCategory::all();
        return view('admin.backend.pages.main_meeting.all_main_meeting', compact('main_meetings', 'meeting_types', 'committee_categories'));
    }
    public function AddMainMeeting()
    {
        $meeting_types = MeetingType::all();
        $committee_categories = CommitteeCategory::all();
        return view('admin.backend.pages.main_meeting.add_main_meeting', compact('meeting_types', 'committee_categories'));
    }
    public function StoreMainMeeting(Request $request)
    {
        $validatedData = $request->validate([
            'title' => 'required',
            'description' => 'nullable',
            'meeting_types_id' => 'required|array',
            'committee_categories_id' => 'required|array',
        ]);
        $main_meeting = new MainMeeting();
        $main_meeting->title = $validatedData['title'];
        $main_meeting->description = $validatedData['description'];
        $main_meeting->save();
        $main_meeting->meetingTypes()->sync($validatedData['meeting_types_id']);
        $main_meeting->committeeCategories()->sync($validatedData['committee_categories_id']);
        if ($main_meeting) {
            $notification = array(
                'message' => 'บันทึกข้อมูลสําเร็จ',
                'alert-type' => 'success'
            );
        } else {
            $notification = array(
                'message' => 'บันทึกข้อมูลไม่สําเร็จ',
                'alert-type' => 'error'
            );
        }
        return redirect()->route('all.main.meeting')->with($notification);
    }
    public function EditMainMeeting($id)
    {
        $main_meeting = MainMeeting::findOrFail($id);
        $meeting_types = MeetingType::all();
        $committee_categories = CommitteeCategory::all();
        return view('admin.backend.pages.main_meeting.edit_main_meeting', compact('main_meeting', 'meeting_types', 'committee_categories'));
    }
    public function UpdateMainMeeting(Request $request, $id)
    {
        $validatedData = $request->validate([
            'title' => 'required',
            'description' => 'nullable',
            'meeting_types_id' => 'required|array|exists:meeting_types,id',
            'committee_categories_id' => 'required|array|exists:committee_categories,id',
        ]);
        $mainMeeting = MainMeeting::findOrFail($id);
        $mainMeeting->update([
            'title' => $validatedData['title'],
            'description' => $validatedData['description'],
        ]);
        $mainMeeting->meetingTypes()->sync($validatedData['meeting_types_id']);
        $mainMeeting->committeeCategories()->sync($validatedData['committee_categories_id']);
        if ($mainMeeting) {
            $notification = array(
                'message' => 'แก้ไขข้อมูลสําเร็จ',
                'alert-type' => 'success'
            );
        } else {
            $notification = array(
                'message' => 'แก้ไขข้อมูลไม่สําเร็จ',
                'alert-type' => 'error'
            );
        }
        return redirect()->route('all.main.meeting')->with($notification);
    }
    public function DeleteMainMeeting($id)
    {
        $mainMeeting = MainMeeting::findOrFail($id);
        $mainMeeting->meetingTypes()->detach();
        $mainMeeting->committeeCategories()->detach();
        $mainMeeting->delete();
        if ($mainMeeting) {
            $notification = array(
                'message' => 'ลบข้อมูลสําเร็จ',
                'alert-type' => 'success'
            );
        } else {
            $notification = array(
                'message' => 'ลบข้อมูลไม่สําเร็จ',
                'alert-type' => 'error'
            );
        }
        return redirect()->route('all.main.meeting')->with($notification);
    }
}
</file>

<file path="app/Http/Controllers/RegulationMeetingController.php">
<?php
namespace App\Http\Controllers;
use App\Models\RegulationCategory;
use App\Models\RegulationMeeting;
use Carbon\Carbon;
use Illuminate\Http\Request;
class RegulationMeetingController extends Controller
{
    public function AllRegulationOfMeeting()
    {
        $regulation = RegulationMeeting::latest()->get();
        return view('admin.backend.pages.regulation_meeting.all_regulation_meeting', compact('regulation'));
    }
    public function AddRegulationOfMeeting()
    {
        $categories = RegulationCategory::latest()->get();
        return view('admin.backend.pages.regulation_meeting.add_regulation_meeting', compact('categories'));
    }
    public function StoreRegulationOfMeeting(Request $request)
    {
        $request->validate([
            'regulation_title' => 'required',
            'regulation_category_id' => 'required',
            'regulation_pdf' => 'nullable|mimes:pdf|max:5000',
        ]);
        $save_url = null;
        if ($request->hasFile('regulation_pdf')) {
            $file = $request->file('regulation_pdf');
            $filename = hexdec(uniqid()) . '.' . $file->getClientOriginalExtension();
            $file->move(public_path('uploads/regulation_meeting/'), $filename);
            $save_url = 'uploads/regulation_meeting/' . $filename;
        }
        RegulationMeeting::insert([
            'regulation_category_id' => $request->regulation_category_id,
            'regulation_title' => $request->regulation_title,
            'description' => $request->description,
            'regulation_pdf' => $save_url,
            'status' => 1,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Regulation meeting Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.regulation.meeting')->with($notification);
    }
    public function UpdateStatusRegulationMeeting($id)
    {
        $regulation = RegulationMeeting::findOrFail($id);
        $regulation->status = $regulation->status == 1 ? 0 : 1;
        $regulation->save();
        return response()->json(['status' => $regulation->status, 'message' => 'Status Updated Successfully']);
    }
    public function EditRegulationOfMeeting($id)
    {
        $regulation = RegulationMeeting::findOrFail($id);
        $categories = RegulationCategory::latest()->get();
        return view('admin.backend.pages.regulation_meeting.edit_regulation_meeting', compact('regulation', 'categories'));
    }
    public function UpdateRegulationOfMeeting(Request $request)
    {
        $regulation_id = $request->regulation_meeting_id;
        $request->validate([
            'regulation_title' => 'required',
            'regulation_category_id' => 'required',
            'regulation_pdf' => 'nullable|mimes:pdf|max:5000',
        ]);
        $old_pdf = RegulationMeeting::where('id', $regulation_id)->value('regulation_pdf');
        if ($old_pdf) {
            @unlink(public_path($old_pdf));
        }
        $save_url = null;
        if ($request->hasFile('regulation_pdf')) {
            $file = $request->file('regulation_pdf');
            $filename = hexdec(uniqid()) . '.' . $file->getClientOriginalExtension();
            $file->move(public_path('uploads/regulation_meeting/'), $filename);
            $save_url = 'uploads/regulation_meeting/' . $filename;
        }
        RegulationMeeting::findOrFail($regulation_id)->update([
            'regulation_category_id' => $request->regulation_category_id,
            'regulation_title' => $request->regulation_title,
            'description' => $request->description,
            'regulation_pdf' => $save_url,
            'updated_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Regulation meeting Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.regulation.meeting')->with($notification);
    }
    public function DeleteRegulationOfMeeting($id)
    {
        $regulation = RegulationMeeting::findOrFail($id);
        $old_pdf = $regulation->regulation_pdf;
        if ($old_pdf) {
            @unlink(public_path($old_pdf));
        }
        $regulation->delete();
        $notification = array(
            'message' => 'Regulation meeting Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="app/Models/MeetingAgendaItems.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingAgendaItems extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function meetingAgendaLecture()
    {
        return $this->belongsTo(MeetingAgendaLecture::class, 'meeting_agenda_lecture_id', 'id');
    }
    public function meetingAgendaSection()
    {
        return $this->belongsTo(MeetingAgendaSection::class, 'meeting_agenda_section_id', 'id');
    }
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class, 'meeting_agenda_id', 'id');
    }
    public function ruleOfMeeting()
    {
        return $this->belongsTo(RuleofMeeting::class, 'rule_of_meeting_id', 'id');
    }
    public function regulationMeeting()
    {
        return $this->belongsTo(RegulationMeeting::class, 'regulation_meeting_id', 'id');
    }
}
</file>

<file path="app/Models/MeetingAgendaSection.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingAgendaSection extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function meetingAgendaLectures()
    {
        return $this->hasMany(MeetingAgendaLecture::class, 'meeting_agenda_section_id');
    }
    public function approvalDetails()
    {
        return $this->hasMany(MeetingApprovalDetail::class, 'meeting_agenda_section_id')
                    ->with(['meetingApproval.user.position']);
    }
    public function meetingAgendaItems()
    {
        return $this->hasMany(MeetingAgendaItems::class, 'meeting_agenda_section_id', 'id');
    }
    public function meetingAgenda()
    {
        return $this->belongsTo(MeetingAgenda::class, 'meeting_agenda_id');
    }
}
</file>

<file path="app/Models/MeetingApproval.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingApproval extends Model
{
    use HasFactory;
    protected $guarded = [];
    protected static function boot()
    {
        parent::boot();
        static::deleting(function($meetingApproval) {
            $meetingApproval->approvalDetails()->delete();
        });
    }
    public function meeting() {
        return $this->belongsTo(Meeting::class, 'meeting_id', 'id');
    }
    public function meetingType() {
        return $this->belongsTo(MeetingType::class, 'meeting_type_id', 'id');
    }
    public function committeeCategory() {
        return $this->belongsTo(CommitteeCategory::class, 'committee_category_id', 'id');
    }
    public function meetingFormat() {
        return $this->belongsTo(MeetingFormat::class, 'meeting_format_id', 'id');
    }
    public function meetingAgenda() {
        return $this->belongsTo(MeetingAgenda::class, 'meeting_agenda_id', 'id');
    }
    public function meetingAgendaLecture() {
        return $this->belongsTo(MeetingAgendaLecture::class, 'meeting_agenda_lecture_id', 'id');
    }
    public function meetingAgendaSection() {
        return $this->belongsTo(MeetingAgendaSection::class, 'meeting_agenda_section_id', 'id');
    }
    public function meetingAgendaItems() {
        return $this->belongsTo(MeetingAgendaItems::class, 'meeting_agenda_items_id', 'id');
    }
    public function ruleOfMeeting() {
        return $this->belongsTo(RuleofMeeting::class, 'rule_of_meeting_id', 'id');
    }
    public function regulationMeeting() {
        return $this->belongsTo(RegulationMeeting::class, 'regulation_meeting_id', 'id');
    }
    public function user()
    {
        return $this->belongsTo(User::class);
    }
    public function approvalDetails()
    {
        return $this->hasMany(MeetingApprovalDetail::class);
    }
}
</file>

<file path="app/Models/Meeting.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class Meeting extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function meetingType() {
        return $this->belongsTo(MeetingType::class, 'meeting_type_id', 'id');
    }
    public function committeeCategory() {
        return $this->belongsTo(CommitteeCategory::class, 'committee_category_id', 'id');
    }
    public function meetingFormat() {
        return $this->belongsTo(MeetingFormat::class, 'meeting_format_id', 'id');
    }
    public function meetingAgenda() {
        return $this->belongsTo(MeetingAgenda::class, 'meeting_agenda_id', 'id');
    }
    public function ruleOfMeeting()
    {
        return $this->belongsToMany(RuleOfMeeting::class);
    }
    public function regulationMeeting()
    {
        return $this->belongsTo(RegulationMeeting::class, 'regulation_meeting_id', 'id');
    }
    public function meetingAgendaSection() {
        return $this->belongsTo(MeetingAgendaSection::class, 'meeting_agenda_section_id', 'id');
    }
    public function meetingAgendaLecture() {
        return $this->belongsTo(MeetingAgendaLecture::class, 'meeting_agenda_lecture_id', 'id');
    }
    public function meetingAgendaItems() {
        return $this->belongsTo(MeetingAgendaItems::class, 'meeting_agenda_items_id', 'id');
    }
    public function user() {
        return $this->belongsTo(User::class, 'user_id', 'id');
    }
}
</file>

<file path="app/Models/RuleofMeeting.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class RuleofMeeting extends Model
{
    use HasFactory;
    protected $guarded = [];
    public function rule_category() {
        return $this->belongsTo(RuleCategory::class, 'rule_category_id', 'id');
    }
    public function meetingAgendas()
    {
        return $this->belongsToMany(MeetingAgenda::class, 'meeting_agenda_rule_of_meeting');
    }
}
</file>

<file path="resources/views/admin/backend/pages/admin/edit_admin.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a></li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขข้อมูลผู้ใช้</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขข้อมูลผู้ใช้</h5>
                <form id="myForm" action="{{ route('update.admin', $user->id) }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-3">
                        <label for="prefix_name" class="form-label">คํานําหน้า</label>
                        <select name="prefix_name" class="form-select mb-3" required>
                            <option disabled>เลือกคํานําหน้า</option>
                            @foreach ($prefixnames as $prefixname)
                                <option value="{{ $prefixname->id }}"
                                    {{ $user->prefix_name_id == $prefixname->id ? 'selected' : '' }}>
                                    {{ $prefixname->title }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="first_name" class="form-label">ชื่อ</label>
                        <input type="text" name="first_name" class="form-control" id="first_name"
                            value="{{ $user->first_name }}" required>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="last_name" class="form-label">นามสกุล</label>
                        <input type="text" name="last_name" class="form-control" id="last_name"
                            value="{{ $user->last_name }}" required>
                    </div>
                    <div class="form-group col-md-7">
                        <label for="position_select" class="form-label">ตำแหน่ง</label>
                        <select name="position_id" class="form-select mb-3" id="position_select" required>
                            <option disabled></option>
                            @foreach ($positions as $position)
                                <option value="{{ $position->id }}"
                                    {{ $user->position_id == $position->id ? 'selected' : '' }}>{{ $position->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    {{-- <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">คณะกรรมการที่สภาฯ แต่งตั้ง</legend>
                        <div class="mb-3">
                            <div class="column-count: 1;">
                                @foreach ($committeecategories as $committee)
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="checkbox" name="committees[]"
                                            value="{{ $committee->id }}" id="committee_{{ $committee->id }}"
                                            {{ in_array($committee->id, $user->committees->pluck('id')->toArray()) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="committee_{{ $committee->id }}">
                                            {{ $committee->name }}
                                        </label>
                                    </div>
                                @endforeach
                            </div>
                            @error('committees')
                                <div class="text-danger">{{ $message }}</div>
                            @enderror
                        </div> --}}
                    </fieldset>
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">ประเภทการประชุมและคณะกรรมการ</legend>
                        @foreach ($meeting_types as $type)
                            <div class="mb-3">
                                <h6>{{ $type->name }}</h6>
                                <div class="ms-3">
                                    @foreach ($committeecategories as $committee)
                                        @php
                                            $pivot = $user->meetingTypes->where('id', $type->id)->first();
                                            $committeeIds = $pivot ? json_decode($pivot->pivot->committee_ids, true) : [];
                                        @endphp
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox"
                                                   name="meeting_committees[{{ $type->id }}][]"
                                                   value="{{ $committee->id }}"
                                                   id="committee_{{ $type->id }}_{{ $committee->id }}"
                                                   {{ in_array($committee->id, $committeeIds) ? 'checked' : '' }}>
                                            <label class="form-check-label" for="committee_{{ $type->id }}_{{ $committee->id }}">
                                                {{ $committee->name }}
                                            </label>
                                        </div>
                                    @endforeach
                                </div>
                            </div>
                        @endforeach
                    </fieldset>
                    {{-- <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">ประเภทการประชุม</legend>
                        <div class="mb-3">
                            <div class="column-count: 1;">
                                @foreach ($meeting_types as $type)
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="checkbox" name="meeting_types[]"
                                            value="{{ $type->id }}" id="meeting_type_{{ $type->id }}"
                                            {{ in_array($type->id, $user->meetingTypes->pluck('id')->toArray()) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="meeting_type_{{ $type->id }}">
                                            {{ $type->name }}
                                        </label>
                                    </div>
                                @endforeach
                            </div>
                            @error('meeting_types')
                                <div class="text-danger">{{ $message }}</div>
                            @enderror
                        </div>
                    </fieldset> --}}
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">Credentials</legend>
                        <div class="form-group col-md-6">
                            <label for="email" class="form-label">Email/Username</label>
                            <input type="email" name="email" class="form-control" id="email"
                                value="{{ $user->email }}" required>
                            <span class="text-danger" id="emailError"></span>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="password" class="form-label">Password (ปล่อยว่างถ้าไม่ต้องการเปลี่ยน)</label>
                            <input type="password" name="password" class="form-control" id="password">
                        </div>
                    </fieldset>
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">Role</legend>
                        <div class="form-group col-md-6">
                            <label for="roles" class="form-label">Role Name</label>
                            <select name="roles" class="form-select mb-3" required>
                                <option disabled>Open this select menu</option>
                                @foreach ($roles as $role)
                                    <option value="{{ $role->name }}"
                                        {{ $user->hasRole($role->name) ? 'selected' : '' }}>{{ $role->name }}</option>
                                @endforeach
                            </select>
                        </div>
                    </fieldset>
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">รูปแบบการประชุม</legend>
                        <div class="mb-3">
                            <div class="d-flex flex-wrap">
                                @foreach ($meeting_formats as $format)
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="radio" name="meeting_format_id"
                                            value="{{ $format->id }}" id="meeting_format_{{ $format->id }}"
                                            {{ $user->meeting_format_id == $format->id ? 'checked' : '' }}>
                                        <label class="form-check-label" for="meeting_format_{{ $format->id }}">
                                            {{ $format->name }}
                                        </label>
                                    </div>
                                @endforeach
                            </div>
                            @error('meeting_format_id')
                                <div class="text-danger">{{ $message }}</div>
                            @enderror
                        </div>
                    </fieldset>
                    {{-- <fieldset class="border border-primary rounded p-2 mt-3">
                    <legend class="float-none w-auto">รูปแบบการประชุม</legend>
                    <div class="mb-3">
                        <div class="d-flex flex-wrap">
                            @foreach ($meeting_formats as $format)
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" name="meeting_formats[]" value="{{ $format->id }}" id="meeting_format_{{ $format->id }}"
                                        {{ in_array($format->id, $user->meetingFormats->pluck('id')->toArray()) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="meeting_format_{{ $format->id }}">
                                        {{ $format->name }}
                                    </label>
                                </div>
                            @endforeach
                        </div>
                        @error('meeting_formats')
                            <div class="text-danger">{{ $message }}</div>
                        @enderror
                    </div>
                </fieldset> --}}
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึกการเปลี่ยนแปลง</button>
                            <a href="{{ route('all.admin') }}" class="btn btn-secondary px-4">กลับ</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#prefix_select').select2({
                theme: 'bootstrap-5',
                width: '100%',
                placeholder: $(this).data('placeholder'),
                allowClear: true
            });
            $('#position_select').select2({
                theme: 'bootstrap-5',
                width: '100%',
                placeholder: $(this).data('placeholder'),
                allowClear: true
            });
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/approved_reports_by_admin/list_approved_report_by_admin.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
@php
    use Carbon\Carbon;
    Carbon::setLocale('th');
    $meeting_date = Carbon::parse($report->meeting_agenda_date);
    $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
    $thai_months = [
        1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน', 5 => 'พฤษภาคม', 6 => 'มิถุนายน',
        7 => 'กรกฎาคม', 8 => 'สิงหาคม', 9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม',
    ];
    $thai_date = "วัน" . $thai_days[$meeting_date->dayOfWeek] . "ที่ " . $meeting_date->day . ' ' . $thai_months[$meeting_date->month] . ' พ.ศ. ' . ($meeting_date->year + 543);
@endphp
<div class="page-content">
    <div class="container-fluid">
        <div class="card">
            <div class="card-body">
                <!-- ส่วนแสดงผู้รับรอง -->
                <div class="mb-4">
                    <span class="badge bg-success px-3 py-2">
                        <i class="fas fa-check-circle me-1"></i>
                        รับรองแล้วโดย: {{ $report->adminApprovedBy->username }}
                        เมื่อ {{ \Carbon\Carbon::parse($report->admin_approved_at)->format('d/m/Y H:i') }}
                    </span>
                </div>
                <div class="mb-4">
                    <a href="{{ route('all.approved.meeting.reports') }}" class="btn btn-danger btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> กลับ
                    </a>
                </div>
                <!-- เพิ่มปุ่ม Export -->
                <div class="position-absolute top-0 end-0 mt-3 me-3">
                    {{-- <a href="{{ route('reports.export', ['id' => $report->id, 'type' => 'pdf']) }}" class="btn btn-danger me-2">Export เป็น PDF</a> --}}
                    <a href="{{ route('reports.export', ['id' => $report->id, 'type' => 'word']) }}" class="btn btn-primary">Export เป็น Word</a>
                </div>
                <div class="word-document p-5 bg-white shadow-sm">
                    <!-- ส่วนหัวรายงาน -->
                    <div class="text-center mb-5">
                        {{-- <h4 class="report-title">รายงานการประชุม{{ $report->meeting_type->name }}</h4> --}}
                        <h5>{{ $report->meeting_agenda_title }}</h5>
                        <h5>ครั้งที่ {{ $report->meeting_agenda_number }}/{{ $report->meeting_agenda_year }}</h5>
                        <h5>{{ $thai_date }}</h5>
                        <h5>เวลา {{ \Carbon\Carbon::parse($report->meeting_agenda_time)->format('H:i') }} น.</h5>
                        <h5>{{ $report->meeting_location }}</h5>
                    </div>
                    <!-- เนื้อหารายงาน -->
                    @foreach($report->sections as $section)
                        <div class="section-content mb-4">
                            <h5 class="section-title">{{ $section->section_title }}</h5>
                            @if($section->description)
                                <div class="section-description mb-3">
                                    {!! $section->description !!}
                                </div>
                            @endif
                            <!-- แสดงเนื้อหา Lectures และ Items -->
                            @foreach($section->meetingAgendaLectures as $lecture)
                                <div class="lecture-content ms-4 mb-3">
                                    <h6 class="lecture-title">{{ $lecture->lecture_title }}</h6>
                                    @if($lecture->content)
                                        <div class="lecture-text mb-2">
                                            {!! $lecture->content !!}
                                        </div>
                                    @endif
                                    @foreach($lecture->meetingAgendaItems as $item)
                                        <div class="item-content ms-4 mb-2">
                                            <p class="item-title mb-1">{{ $item->item_title }}</p>
                                            @if($item->content)
                                                <div class="item-text">
                                                    {!! $item->content !!}
                                                </div>
                                            @endif
                                        </div>
                                    @endforeach
                                </div>
                            @endforeach
                            <!-- แสดงการรับรองท้ายแต่ละวาระ -->
                            @if($section->approvalDetails->isNotEmpty())
                                <div class="approval-section mt-3 p-3 bg-light rounded">
                                    <h6 class="text-primary mb-2">การรับรองวาระนี้</h6>
                                    <div class="approval-list">
                                        @foreach($section->approvalDetails as $detail)
                                            <div class="approval-item mb-2">
                                                <div class="d-flex align-items-center">
                                                    <span class="badge {{ $detail->approval_type == 'no_changes' ? 'bg-success' : 'bg-warning' }} me-2">
                                                        {{ $detail->approval_type == 'no_changes' ? 'รับรองโดยไม่มีแก้ไข' : 'รับรองโดยมีแก้ไข' }}
                                                    </span>
                                                    <span class="text-muted">
                                                        โดย {{ $detail->meetingApproval->user->first_name }}
                                                        {{ $detail->meetingApproval->user->last_name }}
                                                        ({{ $detail->meetingApproval->user->position->name ?? '-' }})
                                                    </span>
                                                </div>
                                                @if($detail->comments)
                                                    <div class="ms-4 mt-1 text-muted">
                                                        <small><i class="fas fa-comment-dots me-1"></i>{{ $detail->comments }}</small>
                                                    </div>
                                                @endif
                                            </div>
                                        @endforeach
                                    </div>
                                </div>
                            @endif
                        </div>
                    @endforeach
                </div>
            </div>
        </div>
    </div>
</div>
<style>
.word-document {
    font-family: 'TH Sarabun New', 'Sarabun', sans-serif;
    font-size: 16px;
    line-height: 1.6;
    color:
    border: 1px solid
    border-radius: 4px;
    background-color: white;
    max-width: 210mm;
    margin: 0 auto;
}
.report-title {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 1rem;
}
.section-title {
    font-size: 20px;
    font-weight: bold;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid
    margin-bottom: 1rem;
}
.section-description {
    text-align: justify;
    padding-left: 1.5rem;
}
.lecture-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color:
}
.lecture-text {
    padding-left: 1rem;
    text-align: justify;
}
.item-title {
    font-weight: bold;
    color:
}
.item-text {
    padding-left: 1rem;
    text-align: justify;
}
@media print {
    .word-document {
        margin: 0;
        padding: 15mm;
        border: none;
        background: none;
        box-shadow: none;
    }
    .btn, .badge {
        display: none;
    }
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
});
</script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/lecture/edit_meeting_agenda_lecture.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    <div class="page-content">
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Edit agenda Lecture</h5>
                <form id="myForm" action="{{ route('update.meeting.agenda.lecture') }}" method="post" class="row g-3">
                    @csrf
                    <input type="hidden" name="id" value="{{ $meeting_agenda_lecture->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Lecture Title</label>
                        <input type="text" name="lecture_title" class="form-control" id="input1"
                            value="{{ $meeting_agenda_lecture->lecture_title }}">
                    </div>
                    <div class="form-group col-md-10">
                        <label for="editor" class="form-label">Lecture Description</label>
                        <textarea name="content" id="content" class="form-control">{{ $meeting_agenda_lecture->content }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('add.meeting.agenda.lecture', $meeting_agenda_lecture->meeting_agenda_id) }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        CKEDITOR.replace('content', {
            language: 'th',
            height: 300,
            removeButtons: 'PasteFromWord'
        });
    </script>
@endsection
{{-- @extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    <div class="page-content">
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขวาระย่อย</h5>
                <form id="myForm" action="{{ route('update.meeting.agenda.lecture') }}" method="post" class="row g-3">
                    @csrf
                    <input type="hidden" name="id" value="{{ $meeting_agenda_lecture->id }}">
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">หัวข้อวาระย่อย</label>
                        <input type="text" name="lecture_title" class="form-control" id="input1"
                            value="{{ $meeting_agenda_lecture->lecture_title }}">
                    </div>
                    <div class="form-group col-md-12">
                        <label for="content" class="form-label">รายละเอียด</label>
                        <textarea name="content" id="content" class="form-control">{{ $meeting_agenda_lecture->content }}</textarea>
                    </div>
                    <!-- เพิ่มส่วนคณะกรรมการกลั่นกรอง -->
                    <div class="col-md-12 mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">ความเห็นคณะกรรมการกลั่นกรอง</h6>
                            </div>
                            <div class="card-body">
                                <!-- ความเห็นทั่วไป -->
                                <div class="mb-4">
                                    <label class="form-label">ความเห็นคณะกรรมการ :</label>
                                    <textarea name="committee_opinion" id="committee_opinion" class="form-control" rows="3">{{ $meeting_agenda_lecture->committee_opinion }}</textarea>
                                </div>
                                <!-- เห็นชอบ -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">1. เห็นชอบ :</label>
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="flex-grow-1">
                                            <textarea name="approve_comment" class="form-control" rows="2"
                                                placeholder="ระบุความเห็น">{{ $meeting_agenda_lecture->approve_comment }}</textarea>
                                        </div>
                                        <div class="input-group" style="width: 200px;">
                                            <input type="number" name="approve_votes" class="form-control"
                                                placeholder="จำนวนเสียง" value="{{ $meeting_agenda_lecture->approve_votes }}">
                                            <span class="input-group-text">เสียง</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- ไม่เห็นชอบ -->
                                <div class="mb-3">
                                    <label class="form-label fw-bold">2. ไม่เห็นชอบ :</label>
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="flex-grow-1">
                                            <textarea name="disapprove_comment" class="form-control" rows="2"
                                                placeholder="ระบุความเห็น">{{ $meeting_agenda_lecture->disapprove_comment }}</textarea>
                                        </div>
                                        <div class="input-group" style="width: 200px;">
                                            <input type="number" name="disapprove_votes" class="form-control"
                                                placeholder="จำนวนเสียง" value="{{ $meeting_agenda_lecture->disapprove_votes }}">
                                            <span class="input-group-text">เสียง</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('add.meeting.agenda.lecture', $meeting_agenda_lecture->meeting_agenda_id) }}"
                               class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        CKEDITOR.replace('content', {
            language: 'th',
            height: 300,
            removeButtons: 'PasteFromWord'
        });
        CKEDITOR.replace('committee_opinion', {
            language: 'th',
            height: 150,
            toolbar: 'Basic',
            removeButtons: 'PasteFromWord'
        });
    </script>
@endsection --}}
</file>

<file path="resources/views/admin/backend/pages/meeting_approval/approval_details.blade.php">
{{--
@php
    use Carbon\Carbon;
    Carbon::setLocale('th');
    $meeting_date = Carbon::parse($approval->approval_date);
    $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
    $thai_months = [
        1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน', 5 => 'พฤษภาคม', 6 => 'มิถุนายน',
        7 => 'กรกฎาคม', 8 => 'สิงหาคม', 9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม',
    ];
    $thai_date = "วัน" . $thai_days[$meeting_date->dayOfWeek] . "ที่ " . $meeting_date->day . ' ' . $thai_months[$meeting_date->month] . ' พ.ศ. ' . ($meeting_date->year + 543);
@endphp
<div class="list-group">
    <h6 class="list-group-item list-group-item-secondary">ผู้รับรอง: {{ $approval->user->first_name }} {{ $approval->user->last_name }}</h6>
    <p class="list-group-item">วันที่รับรอง: {{ $thai_date }}</p>
    @foreach ($approval->approvalDetails as $detail)
        <div class="list-group-item">
            <h6>{{ $detail->meetingAgendaSection->section_title }}</h6>
            <p>การรับรอง: {{ $detail->approval_type === 'no_changes' ? 'รับรองโดยไม่มีข้อแก้ไข' : 'รับรองโดยมีข้อแก้ไข' }}</p>
            @if ($detail->comments)
                <p><span class="badge bg-success">ข้อแก้ไข</span>: {!! $detail->comments !!}</p>
            @endif
        </div>
    @endforeach
</div>
 --}}
<div class="p-3">
    <div class="mb-4">
        <h6 class="border-bottom pb-2">ข้อมูลผู้รับรอง</h6>
        <div class="row">
            <div class="col-md-6">
                <p><strong>ชื่อ-นามสกุล:</strong> {{ $approval->user->prefix_name_id }}
                    {{ $approval->user->first_name }} {{ $approval->user->last_name }}</p>
                <p><strong>ตำแหน่ง:</strong> {{ $approval->user->position->name }}</p>
            </div>
            <div class="col-md-6">
                <p><strong>วันที่รับรอง:</strong> {{ $approval->approval_date }}</p>
                <p><strong>สถานะ:</strong>
                    <span class="badge {{ $approval->status === 'approved' ? 'bg-success' : 'bg-warning' }}">
                        {{ $approval->status === 'approved' ? 'รับรองแล้ว' : 'รอดำเนินการ' }}
                    </span>
                </p>
            </div>
        </div>
    </div>
    <div>
        <h6 class="border-bottom pb-2">รายละเอียดการรับรองแต่ละวาระ</h6>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>วาระ</th>
                        <th>การรับรอง</th>
                        <th>หมายเหตุ</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach ($approval->approvalDetails as $detail)
                        <tr>
                            <td>{{ $detail->meetingAgendaSection->section_title }}</td>
                            <td>
                                @if ($detail->approval_type === 'no_changes')
                                    <span class="badge bg-success">รับรองโดยไม่มีการแก้ไข</span>
                                @else
                                    <span class="badge bg-warning">รับรองโดยมีการแก้ไข</span>
                                @endif
                            </td>
                            <td>
                                @if ($detail->comments)
                                    {!! nl2br(e($detail->comments)) !!}
                                @else
                                    -
                                @endif
                            </td>
                        </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>
</div>
</file>

<file path="resources/views/admin/backend/pages/meeting/meeting_details.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
@php
    use Carbon\Carbon;
    Carbon::setLocale('th');
    $meeting_date = Carbon::parse($my_meetings->meeting_date);
    $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
    $thai_months = [
        1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน', 5 => 'พฤษภาคม', 6 => 'มิถุนายน',
        7 => 'กรกฎาคม', 8 => 'สิงหาคม', 9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม',
    ];
    $thai_day = $thai_days[$meeting_date->dayOfWeek];
    $thai_month = $thai_months[$meeting_date->month];
    $thai_date = "วัน{$thai_day}ที่ " . $meeting_date->day . ' ' . $thai_month . ' พ.ศ. ' . ($meeting_date->year + 543);
@endphp
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-5">
                    <div class="text-center mb-5">
                        <h5 class="mb-3 text-primary">{{ $my_meetings->meeting_agenda_title }}</h5>
                        <div class="d-inline-block p-3 border border-primary rounded">
                            <p class="mb-1"><strong>การประชุมครั้งที่:</strong> {{ $my_meetings->meeting_agenda_number }} / {{ $my_meetings->meeting_agenda_year }}</p>
                            <p class="mb-1"><strong>วันที่:</strong> {{ $thai_date }}</p>
                            <p class="mb-0"><strong>สถานที่:</strong> {{ $my_meetings->meeting_location }}</p>
                        </div>
                    </div>
                    @php
                        $sections = App\Models\MeetingAgendaSection::where('meeting_agenda_id', $my_meetings->id)
                            ->orderBy('id', 'asc')
                            ->get();
                    @endphp
                    @foreach ($sections as $index => $section)
                        <div class="mb-5">
                            <h5 class="mb-3 pb-2 border-bottom">{{ $section->section_title }}</h5>
                            @if ($section->description != null)
                                <div class="ms-4 mb-3">
                                    <p>{!! $section->description !!}</p>
                                </div>
                            @endif
                            @php
                                $lectures = App\Models\MeetingAgendaLecture::where('meeting_agenda_section_id', $section->id)->get();
                                $agendaItems = App\Models\MeetingAgendaItems::where('meeting_agenda_section_id', $section->id)
                                    ->orderBy('id', 'asc')
                                    ->get();
                            @endphp
                            @foreach ($lectures as $lectureIndex => $lecture)
                                <div class="ms-4 mb-3">
                                    <div class="ms-4 bg-light p-3 rounded">
                                        <h6 class="mb-2">{{ $lecture->lecture_title }}</h6>
                                        @if ($lecture->content)
                                            <div class="mb-2">{!! $lecture->content !!}</div>
                                        @endif
                                    </div>
                                    @php
                                        $lectureItems = $agendaItems->where('meeting_agenda_lecture_id', $lecture->id);
                                    @endphp
                                    @if ($lectureItems->count() > 0)
                                        <ul class="list-unstyled ms-4">
                                            @foreach ($lectureItems as $itemIndex => $item)
                                                <li class="mb-3">
                                                    <div class="ms-4 bg-light p-3 rounded">
                                                        <h6 class="mb-2">{{ $item->item_title }}</h6>
                                                        @if ($item->content)
                                                            <div>{!! $item->content !!}</div>
                                                        @endif
                                                    </div>
                                                </li>
                                            @endforeach
                                        </ul>
                                    @endif
                                </div>
                            @endforeach
                            @php
                                $sectionItems = $agendaItems->whereNull('meeting_agenda_lecture_id');
                            @endphp
                            @if ($sectionItems->count() > 0)
                                <ul class="list-unstyled ms-4">
                                    @foreach ($sectionItems as $itemIndex => $item)
                                        <li class="mb-3">
                                            <div class="ms-4 bg-light p-3 rounded">
                                                <h6 class="mb-2">{{ $section->section_title }}.{{ $itemIndex + 1 }} {{ $item->item_title }}</h6>
                                                @if ($item->content)
                                                    <div>{!! $item->content !!}</div>
                                                @endif
                                            </div>
                                        </li>
                                    @endforeach
                                </ul>
                            @endif
                            @if ($section->description == null && $lectures->count() == 0 && $agendaItems->count() == 0)
                                <p class="ms-4 text-muted fst-italic">ไม่มีรายการในวาระนี้</p>
                            @endif
                        </div>
                    @endforeach
                    @php
                        $meeting_formats = App\Models\MeetingFormat::where('id', $my_meetings->meeting_format_id)->get();
                    @endphp
                    <div class="mb-3">
                        @if ($meeting_formats->count() > 0)
                            <ul class="list-group list-group-flush">
                                @foreach ($meeting_formats as $meeting_format)
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <p class="mb-0"><strong>รูปแบบการประชุม:</strong> {{ $meeting_format->name }}</p>
                                    </li>
                                @endforeach
                            </ul>
                        @else
                            <p class="text-muted">ไม่มีข้อมูลรูปแบบการประชุม</p>
                        @endif
                    </div>
                    @php
                        $regulations = App\Models\RegulationMeeting::where('id', $my_meetings->regulation_meeting_id)->get();
                    @endphp
                    <div class="mb-3">
                        @if ($regulations->count() > 0)
                            <ul class="list-group list-group-flush">
                                @foreach ($regulations as $regulation)
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <p class="mb-0"><strong>ระเบียบ:</strong> <a href="{{ asset($regulation->regulation_pdf) }}" target="_blank"><span class="badge rounded-pill bg-info text-dark">ดูรายละเอียด</span></a></p>
                                    </li>
                                @endforeach
                            </ul>
                        @else
                            <p class="text-muted">ไม่มีข้อมูลระเบียบ</p>
                        @endif
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection
@push('styles')
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Kanit', sans-serif;
        line-height: 1.6;
        background-color:
    }
    h5 {
        font-size: 1.25rem;
        font-weight: 700;
        color:
    }
    h6 {
        font-size: 1rem;
        font-weight: 600;
        color:
    }
    p {
        font-size: 0.9rem;
        font-weight: 400;
        color:
    }
    strong {
        font-weight: 500;
    }
    .card {
        border: none;
        border-radius: 15px;
    }
    .card-body {
        background-color:
    }
    .border-primary {
        border-color:
    }
    .text-primary {
        color:
    }
    .bg-light {
        background-color:
    }
</style>
@endpush
</file>

<file path="resources/views/admin/backend/pages/permission/add_permission.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Add Permission</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Add Permission</h5>
                <form id="myForm" action="{{ route('store.permission') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">Permission Name</label>
                        <input type="text" name="name" class="form-control" id="input1">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label"> Group Committee Name</label>
                        <select name="group_name" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>Open this select menu</option>
                            <option value="สภามหาวิทยาลัย">สภามหาวิทยาลัย</option>
                            <option value="คณะกรรมการนโยบายด้านการจัดการศึกษา">คณะกรรมการนโยบายด้านการจัดการศึกษา </option>
                            <option value="คณะกรรมการนโยบายด้านการจบริหารจัดการ">คณะกรรมการนโยบายด้านการจบริหารจัดการ</option>
                            <option value="คณะกรรมการนโยบายด้านการวิจัยฯ">คณะกรรมการนโยบายด้านการวิจัยฯ</option>
                            <option value="Category">Category</option>
                            <option value="Approval">Approval</option>
                            <option value="All User">All User </option>
                            <option value="Role and Permission">Role and Permission</option>
                        </select>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.permission') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/body/footer.blade.php">
<footer class="page-footer">
    <p class="mb-0">พัฒนาโดย ศูนย์นวัตกรรมและเทคโนโลยีดิจิทัล © IDTC 2024. : Version : 1.0b</p>
</footer>
</file>

<file path="app/Http/Controllers/MeetingController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\CommitteeOpinion;
use App\Models\DocumentExport;
use App\Models\Meeting;
use App\Models\MeetingAgenda;
use App\Models\MeetingAgendaItems;
use App\Models\MeetingAgendaLecture;
use App\Models\MeetingAgendaSection;
use App\Models\MeetingFormat;
use App\Models\MeetingType;
use App\Models\RegulationMeeting;
use App\Models\RuleofMeeting;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Storage;
use PhpOffice\PhpWord\IOFactory;
use PhpOffice\PhpWord\PhpWord;
class MeetingController extends Controller
{
    public function MyMeetings(){
        $user_id = Auth::user()->id;
        $my_meetings = MeetingAgenda::latest()->get();
        return view('admin.backend.pages.meeting.my_all_meeting',compact('my_meetings'));
    }
    public function MeetingDetails($id){
        $my_meetings = MeetingAgenda::findOrFail($id);
        return view('admin.backend.pages.meeting.meeting_details',compact('my_meetings'));
    }
    public function AllMeeting(Request $request)
    {
        $meetings = Meeting::where('user_id',Auth::user()->id)->orderBy('id', 'desc')->get();
        return view('admin.backend.pages.meeting.all_meeting',compact('meetings'));
    }
    public function AddMeeting()
    {
        $meetingTypes = MeetingType::latest()->get();
        $committeeCategories = CommitteeCategory::latest()->get();
        $meetingFormats = MeetingFormat::latest()->get();
        $meetingAgendas = MeetingAgenda::latest()->get();
        $ruleOfMeetings = RuleofMeeting::latest()->get();
        $regulationMeetings = RegulationMeeting::latest()->get();
        $meetingAgendaLectures = MeetingAgendaLecture::latest()->get();
        $meetingAgendaSections = MeetingAgendaSection::latest()->get();
        $meetingAgendaItems = MeetingAgendaItems::latest()->get();
        return view('admin.backend.pages.meeting.add_meeting', compact(
            'meetingTypes',
            'committeeCategories',
            'meetingFormats',
            'meetingAgendas',
            'ruleOfMeetings',
            'regulationMeetings',
            'meetingAgendaLectures',
            'meetingAgendaSections',
            'meetingAgendaItems'
        ));
    }
    public function StoreMeeting(Request $request)
    {
        $meeting = new Meeting();
        $meeting->meeting_type_id = $request->input('meeting_type_id');
        $meeting->committee_category_id = $request->input('committee_category_id');
        $meeting->meeting_format_id = $request->input('meeting_format_id');
        $meeting->meeting_agenda_id = $request->input('meeting_agenda_id');
        $meeting->rule_of_meeting_id = $request->input('rule_of_meeting_id');
        $meeting->regulation_meeting_id = $request->input('regulation_meeting_id');
        $meeting->meeting_agenda_lecture_id = $request->input('meeting_agenda_lecture_id');
        $meeting->meeting_agenda_section_id = $request->input('meeting_agenda_section_id');
        $meeting->meeting_agenda_item_id = $request->input('meeting_agenda_item_id');
        $meeting->title = $request->input('title');
        $meeting->description = $request->input('description');
        $meeting->user_id = Auth::user()->id;
        $meeting->save();
        $notification = array(
            'message' => 'Meeting Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.meeting')->with($notification);
    }
    public function sectionAgendaItemDetail($id)
    {
        $meetingAgendaSection = MeetingAgendaSection::findOrFail($id);
        $meetingAgenda = $meetingAgendaSection->meetingAgenda;
        $meetingAgendaItems = MeetingAgendaItems::where('meeting_agenda_section_id', $id)
            ->with('meetingAgendaLecture')
            ->get();
        $meetingAgendaLectures = MeetingAgendaLecture::where('meeting_agenda_section_id', $id)->get();
        return view('admin.backend.pages.meeting_section_detail.section_agenda_item_detail',
            compact('meetingAgendaSection', 'meetingAgendaItems', 'meetingAgenda', 'meetingAgendaLectures'));
    }
    public function lectureSectionDetail($id)
    {
        $lecture = MeetingAgendaLecture::with([
            'meetingAgendaSection',
            'meetingAgendaItems',
            'meetingAgendaSection.meetingAgenda'
        ])->findOrFail($id);
        $committeeFeedbacks = CommitteeOpinion::where('meeting_agenda_lecture_id', $id)
            ->with(['user', 'user.prefixName'])
            ->get();
        return view('admin.backend.pages.meeting_section_detail.lecture_detail', compact('lecture', 'committeeFeedbacks'));
    }
    public function exportToWord($id)
    {
        $meetingAgenda = MeetingAgenda::with(['meetingAgendaSections.meetingAgendaLectures', 'meetingAgendaSections.meetingAgendaItems'])
            ->findOrFail($id);
        $phpWord = new PhpWord();
        $titleStyle = ['bold' => true, 'size' => 18, 'name' => 'TH SarabunPSK', 'alignment' => 'center'];
        $headingStyle = ['bold' => true, 'size' => 16, 'name' => 'TH SarabunPSK', 'alignment' => 'center'];
        $normalStyle = ['size' => 16, 'name' => 'TH SarabunPSK', 'alignment' => 'left'];
        $section = $phpWord->addSection();
    $header = $section->addHeader();
    $table = $header->addTable();
    $table->addRow();
    $cell = $table->addCell(4500);
    $cell = $table->addCell(4500);
    $user = Auth::user();
    $cell->addText($user->prefixName->title.'' . $user->first_name . ' ' . $user->last_name, ['size' => 10, 'name' => 'TH SarabunPSK'], ['alignment' => 'right']);
    $cell->addText(date('Y-m-d H:i:s'), ['size' => 10, 'name' => 'TH SarabunPSK'], ['alignment' => 'right']);
    $section->addText($meetingAgenda->meeting_agenda_title, $titleStyle);
    $section->addText("ครั้งที่: {$meetingAgenda->meeting_agenda_number}/{$meetingAgenda->meeting_agenda_year}", $titleStyle);
    $meeting_date = Carbon::parse($meetingAgenda->meeting_agenda_date);
    $thai_months = [
        1 => 'มกราคม', 2 => 'กุมภาพันธ์', 3 => 'มีนาคม', 4 => 'เมษายน',
        5 => 'พฤษภาคม', 6 => 'มิถุนายน', 7 => 'กรกฎาคม', 8 => 'สิงหาคม',
        9 => 'กันยายน', 10 => 'ตุลาคม', 11 => 'พฤศจิกายน', 12 => 'ธันวาคม'
    ];
                $thai_date = $meeting_date->day . ' ' . $thai_months[$meeting_date->month] . ' พ.ศ. ' . ($meeting_date->year + 543);
                $section->addText("วันที่: {$thai_date}", $titleStyle);
                $section->addText("เวลา: {$meetingAgenda->meeting_agenda_time} น.", $titleStyle);
                $section->addText("สถานที่: {$meetingAgenda->meeting_location}", $titleStyle);
                $section->addTextBreak();
        foreach ($meetingAgenda->meetingAgendaSections as $agendaSection) {
            $section->addText($agendaSection->section_title, $headingStyle);
            if ($agendaSection->description) {
                \PhpOffice\PhpWord\Shared\Html::addHtml($section, $agendaSection->description);
            }
            foreach ($agendaSection->meetingAgendaLectures as $lecture) {
                $section->addText($lecture->lecture_title, $normalStyle);
                if ($lecture->content) {
                    \PhpOffice\PhpWord\Shared\Html::addHtml($section, $lecture->content);
                }
                $section->addTextBreak();
            }
            foreach ($agendaSection->meetingAgendaItems as $item) {
                $section->addText($item->item_title, $normalStyle);
                if ($item->content) {
                    \PhpOffice\PhpWord\Shared\Html::addHtml($section, $item->content);
                }
                $section->addTextBreak();
            }
            $section->addTextBreak();
        }
        $timestamp = Carbon::now()->format('Y-m-d_H-i-s');
        $filename = "meeting_agenda_{$id}_{$timestamp}.docx";
        $directory = 'documents/meeting_exports/' . date('Y/m');
        if (!Storage::exists($directory)) {
            Storage::makeDirectory($directory);
        }
        $filePath = $directory . '/' . $filename;
        $tempFile = tempnam(sys_get_temp_dir(), 'meeting_agenda_');
        $writer = IOFactory::createWriter($phpWord, 'Word2007');
        $writer->save($tempFile);
        Storage::put($filePath, file_get_contents($tempFile));
        DocumentExport::create([
            'user_id' => Auth::id(),
            'meeting_agenda_id' => $id,
            'file_name' => $filename,
            'file_path' => $filePath
        ]);
        $tempFile = tempnam(sys_get_temp_dir(), 'meeting_agenda_');
        $writer = IOFactory::createWriter($phpWord, 'Word2007');
        $writer->save($tempFile);
        return response()->download($tempFile, $filename)->deleteFileAfterSend(true);
    }
    public function updateCommitteeOpinionVisibility(Request $request, $id)
    {
        try {
            $lecture = MeetingAgendaLecture::findOrFail($id);
            $lecture->show_committee_opinion = $request->show_committee_opinion;
            $lecture->save();
            return response()->json([
                'success' => true,
                'message' => 'Committee opinion visibility updated successfully'
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'Error updating committee opinion visibility'
            ], 500);
        }
    }
    public function ViewMeetingType($meeting_type_id = null)
    {
        $user = Auth::user();
        if ($meeting_type_id) {
            $selectedMeetingType = $user->meetingTypes()->where('meeting_type_id', $meeting_type_id)->first();
            if (!$selectedMeetingType) {
                return redirect()->back()->with('error', 'คุณไม่มีสิทธิ์เข้าถึงประเภทการประชุมนี้');
            }
            session(['selected_meeting_type' => $meeting_type_id]);
        }
        return redirect()->back();
    }
}
</file>

<file path="app/Http/Controllers/MeetingReportSummaryController.php">
<?php
namespace App\Http\Controllers;
use App\Models\MeetingAgenda;
use App\Models\MeetingAgendaItems;
use App\Models\MeetingAgendaLecture;
use App\Models\MeetingAgendaSection;
use App\Models\MeetingApproval;
use App\Models\MeetingApprovalDetail;
use App\Models\MeetingApprovalHistory;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
class MeetingReportSummaryController extends Controller
{
    public function index()
    {
        $averageApprovalTime = MeetingAgenda::where('is_admin_approved', true)
            ->whereNotNull('admin_approved_at')
            ->get()
            ->average(function ($agenda) {
                return $agenda->created_at->diffInDays($agenda->admin_approved_at);
            }) ?? 0;
        $meetingAgendas = MeetingAgenda::with([
            'meeting_type',
            'committeeCategory',
            'approvals',
            'adminApprovedBy',
            'sections.approvalDetails'
        ])
        ->orderBy('meeting_agenda_date', 'desc')
        ->get();
        return view('admin.backend.pages.meeting_report_sum.all_meeting_report_summary', compact(
            'meetingAgendas',
            'averageApprovalTime'
        ));
    }
    public function showSummary($id)
    {
        $meetingAgenda = MeetingAgenda::with([
            'meeting_type',
            'committeeCategory',
            'meetingFormat',
            'meetingAgendaSections.meetingAgendaLectures.meetingAgendaItems',
            'sections.meetingAgendaLectures.meetingAgendaItems',
            'sections.approvalDetails.meetingApproval.user.position',
            'approvals.user',
            'approvals.approvalDetails'
        ])->findOrFail($id);
        $approvalsBySection = [];
        foreach ($meetingAgenda->approvals as $approval) {
            foreach ($approval->approvalDetails as $detail) {
                $sectionId = $detail->meeting_agenda_section_id;
                if (!isset($approvalsBySection[$sectionId])) {
                    $approvalsBySection[$sectionId] = [];
                }
                $approvalsBySection[$sectionId][] = [
                    'user' => $approval->user,
                    'type' => $detail->approval_type,
                    'comments' => $detail->comments
                ];
            }
        }
        return view('admin.backend.pages.meeting_report_sum.meeting_summary', compact('meetingAgenda', 'approvalsBySection'));
    }
    public function edit($id)
    {
        $meetingAgenda = MeetingAgenda::with([
            'meeting_type',
            'committeeCategory',
            'meetingFormat',
            'sections.meetingAgendaLectures.meetingAgendaItems',
            'sections.approvalDetails.meetingApproval.user.position'
        ])->findOrFail($id);
        $approvalsBySection = $meetingAgenda->getApprovalsBySections();
        return view('admin.backend.pages.meeting_report_sum.meeting_summary_edit', compact('meetingAgenda', 'approvalsBySection'));
    }
    public function update(Request $request, $id)
    {
        DB::beginTransaction();
        try {
            foreach ($request->approvals as $sectionId => $sectionApprovals) {
                foreach ($sectionApprovals as $approvalId => $data) {
                    $detail = MeetingApprovalDetail::where('meeting_approval_id', $approvalId)
                        ->where('meeting_agenda_section_id', $sectionId)
                        ->first();
                    if ($detail) {
                        $detail->update([
                            'approval_type' => $data['type'],
                            'comments' => $data['comments']
                        ]);
                    }
                }
            }
            DB::commit();
            $notification = array(
                'message' => 'เพิ่มระเบียบวาระการประชุมแล้ว',
                'alert-type' => 'success'
            );
            return redirect()
                ->route('meeting.report.summary', $id)
                ->with($notification);
        } catch (\Exception $e) {
            DB::rollBack();
            $notification = array(
                'message' => 'เกิดข้อผิดพลาดในการบันทึกข้อมูล: ' . $e->getMessage(),
                'alert-type' => 'error'
            );
            return back()
                ->with($notification)
                ->withInput();
        }
    }
    public function adminApprove(Request $request, $id)
    {
        $request->validate([
            'admin_approval_note' => 'required|string|min:5'
        ], [
            'admin_approval_note.required' => 'กรุณาระบุบันทึกการรับรอง',
            'admin_approval_note.min' => 'บันทึกการรับรองต้องมีความยาวอย่างน้อย 5 ตัวอักษร'
        ]);
        DB::beginTransaction();
        try {
            $meetingAgenda = MeetingAgenda::findOrFail($id);
            if ($meetingAgenda->is_admin_approved) {
                throw new \Exception('รายงานการประชุมนี้ถูกรับรองแล้ว');
            }
            $meetingAgenda->update([
                'is_admin_approved' => true,
                'admin_approved_at' => now(),
                'admin_approved_by' => Auth::id(),
                'admin_approval_note' => $request->admin_approval_note,
                'status_public' => 'published'
            ]);
            MeetingApprovalHistory::create([
                'meeting_agenda_id' => $id,
                'user_id' => Auth::id(),
                'action' => 'approve',
                'note' => $request->admin_approval_note,
                'action_at' => now()
            ]);
            DB::commit();
            $notification = array(
                'message' => 'รับรองการประชุมเรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()
                ->route('meeting.report.summary', $id)
                ->with($notification);
        } catch (\Exception $e) {
            DB::rollBack();
            return response()->json([
                'success' => false,
                'message' => $e->getMessage()
            ], 400);
        }
    }
        public function adminCancel($id)
        {
            DB::beginTransaction();
            try {
                $meetingAgenda = MeetingAgenda::findOrFail($id);
                if (!$meetingAgenda->is_admin_approved) {
                    throw new \Exception('รายงานการประชุมนี้ยังไม่ได้รับการรับรอง');
                }
                $meetingAgenda->update([
                    'is_admin_approved' => false,
                    'admin_approved_at' => null,
                    'admin_approved_by' => null,
                    'admin_approval_note' => null,
                    'status_public' => 'draft'
                ]);
                MeetingApprovalHistory::create([
                    'meeting_agenda_id' => $id,
                    'user_id' => Auth::id(),
                    'action' => 'cancel',
                    'note' => 'ยกเลิกการรับรอง',
                    'action_at' => now()
                ]);
                DB::commit();
                return response()->json(['success' => true]);
            } catch (\Exception $e) {
                DB::rollBack();
                return response()->json([
                    'success' => false,
                    'message' => $e->getMessage()
                ], 400);
            }
        }
}
</file>

<file path="app/Http/Controllers/RuleMeetingController.php">
<?php
namespace App\Http\Controllers;
use App\Models\RuleCategory;
use App\Models\RuleofMeeting;
use Carbon\Carbon;
use Illuminate\Http\Request;
class RuleMeetingController extends Controller
{
    public function AllRulesOfMeeting()
    {
        $rules = RuleofMeeting::latest()->get();
        return view('admin.backend.pages.rule_meeting.all_rule_meeting', compact('rules'));
    }
    public function AddRulesOfMeeting()
    {
        $categories = RuleCategory::latest()->get();
        return view('admin.backend.pages.rule_meeting.add_rule_meeting',compact('categories'));
    }
    public function StoreRulesOfMeeting(Request $request)
    {
        $request->validate([
            'title' => 'required',
            'rule_category_id' => 'required',
            'pdf' => 'nullable|mimes:pdf',
        ]);
        $save_url = null;
        if ($request->hasFile('pdf')) {
            $file = $request->file('pdf');
            $filename = hexdec(uniqid()) . '.' . $file->getClientOriginalExtension();
            $file->move(public_path('uploads/rule_meeting/'), $filename);
            $save_url = 'uploads/rule_meeting/' . $filename;
        }
        RuleofMeeting::insert([
            'rule_category_id' => $request->rule_category_id,
            'title' => $request->title,
            'description' => $request->description,
            'pdf' => $save_url,
            'status' => 1,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'Rule meeting Added Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.rule.meeting')->with($notification);
    }
    public function UpdateStatusRulesOfMeeting($id)
    {
        $rule = RuleofMeeting::findOrFail($id);
        $rule->status = $rule->status == 1 ? 0 : 1;
        $rule->save();
        return response()->json(['status' => $rule->status, 'message' => 'Status Updated Successfully']);
    }
    public function EditRulesOfMeeting($id)
    {
        $categories = RuleCategory::latest()->get();
        $rule = RuleofMeeting::findOrFail($id);
        return view('admin.backend.pages.rule_meeting.edit_rule_meeting',compact('categories','rule'));
    }
    public function UpdateRulesOfMeeting(Request $request)
    {
        $rid = $request->rule_meeting_id;
        $old_pdf = RuleofMeeting::where('id', $rid)->value('pdf');
        if ($old_pdf) {
            @unlink(public_path($old_pdf));
        }
        if ($request->hasFile('pdf')) {
            $file = $request->file('pdf');
            $filename = hexdec(uniqid()) . '.' . $file->getClientOriginalExtension();
            $file->move(public_path('uploads/rule_meeting'), $filename);
            $old_pdf = RuleofMeeting::findOrFail($rid)->pdf;
            if ($old_pdf && file_exists(public_path($old_pdf))) {
                @unlink(public_path($old_pdf));
            }
            RuleofMeeting::findOrFail($rid)->update([
                'pdf' => 'uploads/rule_meeting/' . $filename
            ]);
        }
        RuleofMeeting::findOrFail($rid)->update([
            'rule_category_id' => $request->rule_category_id,
            'title' => $request->title,
            'description' => $request->description,
            'updated_at' => Carbon::now(),
        ]);
        $notification = array(
            'message' => 'Rule meeting Updated Successfully',
            'alert-type' => 'success'
        );
        return redirect()->route('all.rule.meeting')->with($notification);
    }
    public function DeleteRulesOfMeeting($id)
    {
        $rule = RuleofMeeting::findOrFail($id);
        $old_pdf = $rule->pdf;
        if ($old_pdf) {
            @unlink(public_path($old_pdf));
        }
        $rule->delete();
        $notification = array(
            'message' => 'Rule meeting Deleted Successfully',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
}
</file>

<file path="resources/views/admin/backend/pages/admin/all_admin.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">All Users</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.admin') }}" class="btn btn-primary  ">Add User </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    @if ($alladmin->isEmpty())
                        <h4 class="text-center">ไม่พบข้อมูลผู้ดูแลระบบ</h4>
                    @else
                        <table id="example" class="table table-striped table-bordered" style="width:100%">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Committee</th>
                                    <th>Meeting Type</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                                @php
                                    $committees = App\Models\CommitteeCategory::all();
                                    $meeting_types = App\Models\MeetingType::all();
                                    $prefixname = App\Models\PrefixName::all();
                                @endphp
                            <tbody>
                                @foreach ($alladmin as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>
                                        @foreach ($prefixname as $prefix)
                                            @if ($prefix->id == $item->prefix_name_id)
                                                {{ $prefix->title }}
                                            @endif
                                        @endforeach
                                        {{ $item->first_name }} {{ $item->last_name }}
                                    </td>
                                    <td>{{ $item->email }}</td>
                                    <td>
                                        @foreach ($item->meetingTypes as $meetingType)
                                            <strong>{{ $meetingType->name }}:</strong><br>
                                            @php
                                                $committeeIds =
                                                    json_decode($meetingType->pivot->committee_ids, true) ?? [];
                                            @endphp
                                            @foreach ($committeeIds as $committeeId)
                                                @php
                                                    $committee = $committees->find($committeeId);
                                                @endphp
                                                @if ($committee)
                                                    <span class="badge bg-info">{{ $committee->name }}</span><br>
                                                @endif
                                            @endforeach
                                        @endforeach
                                    </td>
                                    <td>
                                        @foreach ($item->meetingTypes as $meetingtype)
                                            <span class="badge bg-success d-block mb-1">{{ $meetingtype->name }}</span>
                                        @endforeach
                                    </td>
                                    <td>
                                        @foreach ($item->roles as $role)
                                            <span class="badge bg-primary">{{ $role->name }}</span>
                                        @endforeach
                                    </td>
                                    <td>
                                        @if ($item->UserOnline())
                                            <span class="badge bg-success">Online</span>
                                        @else
                                            <span
                                                class="badge bg-danger">{{ Carbon\Carbon::parse($item->last_seen)->diffForHumans() }}</span>
                                        @endif
                                    </td>
                                    <td>
                                        <a href="{{ route('edit.admin', $item->id) }}" class="btn btn-info px-2"><i class="bx bx-edit"></i></a>
                                        <a href="{{ route('delete.admin', $item->id) }}" class="btn btn-danger px-2" id="delete"><i class="bx bx-trash"></i></a>
                                    </td>
                                </tr>
                            @endforeach
                            </tbody>
                        </table>
                    @endif
                </div>
            </div>
        </div>
    </div>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail_0.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    {{-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script> --}}
    @php
        use Carbon\Carbon;
        Carbon::setLocale('th');
        $meeting_date = Carbon::parse($my_meetings->meeting_date);
        $approval_date = Carbon::parse($my_meetings->approval_date);
        $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
        $thai_months = [
            1 => 'มกราคม',
            2 => 'กุมภาพันธ์',
            3 => 'มีนาคม',
            4 => 'เมษายน',
            5 => 'พฤษภาคม',
            6 => 'มิถุนายน',
            7 => 'กรกฎาคม',
            8 => 'สิงหาคม',
            9 => 'กันยายน',
            10 => 'ตุลาคม',
            11 => 'พฤศจิกายน',
            12 => 'ธันวาคม',
        ];
        $thai_date =
            'วัน' .
            $thai_days[$meeting_date->dayOfWeek] .
            'ที่ ' .
            $meeting_date->day .
            ' ' .
            $thai_months[$meeting_date->month] .
            ' พ.ศ. ' .
            ($meeting_date->year + 543);
        $thai_date_approval =
            'วัน' .
            $thai_days[$approval_date->dayOfWeek] .
            'ที่ ' .
            $approval_date->day .
            ' ' .
            $thai_months[$approval_date->month] .
            ' พ.ศ. ' .
            ($approval_date->year + 543);
    @endphp
    {{-- @php
    $isAdmin = Auth::user()->role === 'admin' || Auth::user()->hasRole('admin');
    @endphp --}}
    @php
        $isAdmin = Auth::user()->hasRole('Super Admin');
    @endphp
    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="card shadow-sm mb-4">
                    <!-- ส่วนหัวของการ์ด -->
                    <div class="card-header bg-white py-3">
                        {{-- <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{{ $meetingAgenda->meeting_agenda_title }}</h5>
                            <div>
                                @if (now()->lt($meetingAgenda->approval_deadline))
                                    <span class="badge bg-info">
                                        เหลือเวลา {{ now()->diffInDays($meetingAgenda->approval_deadline) }} วัน
                                    </span>
                                @else
                                    <span class="badge bg-danger">หมดเวลารับรอง</span>
                                @endif
                            </div>
                        </div> --}}
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{{ $meetingAgenda->meeting_agenda_title }}</h5>
                            <div>
                                @if($isAdmin)
                                    <span class="badge bg-info">
                                        <i class="fas fa-user-shield me-1"></i> สิทธิ์ Admin - สามารถรับรองได้ตลอดเวลา
                                    </span>
                                @elseif(now()->lt($meetingAgenda->approval_deadline))
                                    <span class="badge bg-info">
                                        เหลือเวลา {{ now()->diffInDays($meetingAgenda->approval_deadline) }} วัน
                                    </span>
                                @else
                                    <span class="badge bg-danger">หมดเวลารับรอง</span>
                                @endif
                            </div>
                            <div class="mt-3">
                                {{-- <a href="{{ url()->previous() }}" class="btn btn-danger"><i class="fas fa-chevron-left me-2"></i>กลับ</a> --}}
                                <a href="{{ route('all.meeting.approval') }}" class="btn btn-danger"><i class="fas fa-chevron-left me-2"></i>กลับ</a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-5">
                        <!-- ข้อมูลการประชุม -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center border-bottom pb-3">
                                <div>
                                    <p class="mb-1"><strong>การประชุมครั้งที่:</strong>
                                        {{ $meetingAgenda->meeting_agenda_number }}/{{ $meetingAgenda->meeting_agenda_year }}
                                    </p>
                                    <p class="mb-1"><strong>วันที่:</strong> {{ $thai_date }}</p>
                                    <p class="mb-0"><strong>สถานที่:</strong> {{ $meetingAgenda->meeting_location }}</p>
                                </div>
                                <div class="text-end">
                                    <p class="mb-1"><strong>กำหนดรับรอง:</strong></p>
                                    <p class="mb-0">{{ $meetingAgenda->approval_deadline }}</p>
                                    {{-- <p class="mb-0">{{ $meetingAgenda->approval_deadline->format('d/m/Y H:i') }}</p> --}}
                                </div>
                            </div>
                        </div>
                        <!-- สถานะการรับรองปัจจุบัน -->
                        {{-- <div class="alert {{ $hasApproved ? 'alert-success' : 'alert-warning' }} mb-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">สถานะการรับรอง</h6>
                                    <p class="mb-0">
                                        @if ($hasApproved)
                                            คุณได้รับรองการประชุมนี้แล้ว
                                            <small>(เมื่อ {{ $approvals->where('user_id', Auth::id())->first()->approval_date }})</small>
                                            <a href="{{ route('meeting.approval.edit', $meetingAgenda->id) }}"
                                            class="btn btn-sm btn-warning ms-2"
                                            onclick="return confirm('คุณต้องการแก้ไขการรับรองใช่หรือไม่?')">
                                                <i class="fas fa-edit"></i> แก้ไขการรับรอง
                                            </a>
                                        @endif
                                    </p>
                                </div>
                                <div class="text-end">
                                    <strong>ผู้รับรองทั้งหมด:</strong> {{ $approvals->count() }} คน
                                </div>
                            </div>
                        </div> --}}
                        <div class="alert {{ $hasApproved ? 'alert-success' : ($isAdmin ? 'alert-info' : 'alert-warning') }} mb-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">สถานะการรับรอง</h6>
                                    <p class="mb-0">
                                        @if ($hasApproved)
                                            คุณได้รับรองการประชุมนี้แล้ว
                                            <small>(เมื่อ {{ $approvals->where('user_id', Auth::id())->first()->approval_date }})</small>
                                            <a href="{{ route('meeting.approval.edit', $meetingAgenda->id) }}"
                                            class="btn btn-sm btn-warning ms-2"
                                            onclick="return confirm('คุณต้องการแก้ไขการรับรองใช่หรือไม่?')">
                                                <i class="fas fa-edit"></i> แก้ไขการรับรอง
                                            </a>
                                        @elseif($isAdmin)
                                            คุณมีสิทธิ์ Admin สามารถรับรองได้
                                        @else
                                            คุณยังไม่ได้รับรองการประชุมนี้
                                        @endif
                                    </p>
                                </div>
                                <div class="text-end">
                                    <strong>ผู้รับรองทั้งหมด:</strong> {{ $approvals->count() }} คน
                                </div>
                            </div>
                        </div>
                        <!-- รายการผู้รับรองที่มีอยู่ -->
                        @if ($approvals->isNotEmpty())
                            <div class="mb-4">
                                <h6 class="border-bottom pb-2">รายการผู้รับรอง</h6>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>ผู้รับรอง</th>
                                                <th>วันที่รับรอง</th>
                                                <th>สถานะ</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach ($approvals as $approval)
                                                <tr>
                                                    <td>{{ $approval->user->prefix_name_id }}
                                                        {{ $approval->user->first_name }} {{ $approval->user->last_name }}
                                                    </td>
                                                    <td>{{ $approval->approval_date }}</td>
                                                    {{-- <td>{{ $approval->approval_date->format('d/m/Y H:i') }}</td> --}}
                                                    <td>
                                                        <span
                                                            class="badge {{ $approval->status === 'approved' ? 'bg-success' : 'bg-warning' }}">
                                                            {{ $approval->status === 'approved' ? 'รับรองแล้ว' : 'รอดำเนินการ' }}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <button type="button" class="btn btn-sm btn-info show-details"
                                                            data-bs-toggle="modal" data-bs-target="#approvalDetailsModal"
                                                            data-approval-id="{{ $approval->id }}">
                                                            <i class="fas fa-info-circle"></i> รายละเอียด
                                                        </button>
                                                    </td>
                                                </tr>
                                            @endforeach
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        @endif
                        <!-- แบบฟอร์มการรับรอง -->
                        @if (!$hasApproved && now()->lt($meetingAgenda->approval_deadline) || $isAdmin)
                            <form id="meetingApprovalForm"
                                action="{{ route('meeting.approval.store', $meetingAgenda->id) }}" method="POST"
                                style="{{ $hasApproved && !session('editing_approval') ? 'display: none;' : '' }}">
                                @csrf
                                <!-- ซ่อนค่า input fields ต่างๆ -->
                                <input type="hidden" name="meeting_agenda_id" value="{{ $my_meetings->id }}">
                                <input type="hidden" name="meeting_type_id" value="{{ $my_meetings->meeting_type_id }}">
                                <input type="hidden" name="user_id" value="{{ Auth::user()->id }}">
                                <input type="hidden" name="committee_category_id"
                                    value="{{ $my_meetings->committee_category_id }}">
                                <input type="hidden" name="meeting_format_id"
                                    value="{{ $my_meetings->meeting_format_id }}">
                                <input type="hidden" name="rule_of_meeting_id"
                                    value="{{ $my_meetings->rule_of_meeting_id }}">
                                <input type="hidden" name="regulation_meeting_id"
                                    value="{{ $my_meetings->regulation_meeting_id }}">
                                @php
                                    $sections = App\Models\MeetingAgendaSection::where(
                                        'meeting_agenda_id',
                                        $my_meetings->id,
                                    )
                                        ->orderBy('id', 'asc')
                                        ->get();
                                @endphp
                                <!-- ส่วนของการวนลูปแสดงเนื้อหาและฟอร์มรับรอง -->
                                @foreach ($sections as $section)
                                    <div class="mb-5">
                                        <div class="card">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">{{ $section->section_title }}</h6>
                                            </div>
                                            <div class="card-body">
                                                @php
                                                    $hasContent = false;
                                                    if ($section->description != null) {
                                                        $hasContent = true;
                                                    }
                                                    $lectures = App\Models\MeetingAgendaLecture::where(
                                                        'meeting_agenda_section_id',
                                                        $section->id,
                                                    )->get();
                                                    $agendaItems = App\Models\MeetingAgendaItems::where(
                                                        'meeting_agenda_section_id',
                                                        $section->id,
                                                    )
                                                        ->orderBy('id', 'asc')
                                                        ->get();
                                                    if ($lectures->count() > 0 || $agendaItems->count() > 0) {
                                                        $hasContent = true;
                                                    }
                                                @endphp
                                                <!-- แสดงเนื้อหาของวาระ -->
                                                @if ($section->description != null)
                                                    <div class="mb-4">
                                                        <div class="content-section">
                                                            {!! $section->description !!}
                                                        </div>
                                                    </div>
                                                @endif
                                                <!-- แสดงเนื้อหาของ Lecture -->
                                                @foreach ($lectures as $lecture)
                                                    <div class="ms-4 mb-3">
                                                        <h6 class="mb-2">{{ $lecture->lecture_title }}</h6>
                                                        @if ($lecture->content)
                                                            <div class="content-section mb-3">
                                                                {!! $lecture->content !!}
                                                            </div>
                                                        @endif
                                                        <!-- แสดง Items ภายใต้ Lecture -->
                                                        @php
                                                            $lectureItems = $agendaItems->where(
                                                                'meeting_agenda_lecture_id',
                                                                $lecture->id,
                                                            );
                                                        @endphp
                                                        @if ($lectureItems->count() > 0)
                                                            <div class="ms-4">
                                                                @foreach ($lectureItems as $item)
                                                                    <div class="mb-3">
                                                                        <h6 class="mb-2">{{ $item->item_title }}</h6>
                                                                        @if ($item->content)
                                                                            <div class="content-section">
                                                                                {!! $item->content !!}
                                                                            </div>
                                                                        @endif
                                                                    </div>
                                                                @endforeach
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endforeach
                                                <!-- แสดง Items ที่ไม่อยู่ภายใต้ Lecture -->
                                                @php
                                                    $sectionItems = $agendaItems->whereNull(
                                                        'meeting_agenda_lecture_id',
                                                    );
                                                @endphp
                                                @if ($sectionItems->count() > 0)
                                                    <div class="ms-4">
                                                        @foreach ($sectionItems as $itemIndex => $item)
                                                            <div class="mb-3">
                                                                <h6 class="mb-2">
                                                                    {{ $section->section_title }}.{{ $itemIndex + 1 }}
                                                                    {{ $item->item_title }}</h6>
                                                                @if ($item->content)
                                                                    <div class="content-section">
                                                                        {!! $item->content !!}
                                                                    </div>
                                                                @endif
                                                            </div>
                                                        @endforeach
                                                    </div>
                                                @endif
                                                <!-- แสดงข้อความเมื่อไม่มีเนื้อหา -->
                                                @if (!$hasContent)
                                                    <div class="alert alert-info mb-0">
                                                        <i class="fas fa-info-circle me-2"></i> ไม่มีรายละเอียดในวาระนี้
                                                    </div>
                                                @endif
                                                <!-- ส่วนของการรับรอง - แสดงเฉพาะเมื่อมีเนื้อหาและเป็น admin หรือยังไม่เลย deadline -->
                                                {{-- @if ($hasContent && !$hasApproved && now()->lt($meetingAgenda->approval_deadline)) --}}
                                                @if ($hasContent && (!$hasApproved && (now()->lt($meetingAgenda->approval_deadline) || $isAdmin)))
                                                    <div class="approval-section mt-4 border-top pt-3">
                                                        <h6 class="mb-3">การรับรองวาระที่: {{ $section->section_title }}
                                                        </h6>
                                                        <div class="form-check mb-2">
                                                            <input class="form-check-input" type="radio"
                                                                name="approvals[{{ $section->id }}][type]"
                                                                value="no_changes" checked
                                                                id="noChanges_{{ $section->id }}">
                                                            <label class="form-check-label"
                                                                for="noChanges_{{ $section->id }}">
                                                                รับรองโดยไม่มีการแก้ไข
                                                            </label>
                                                        </div>
                                                        <div class="form-check mb-2">
                                                            <input class="form-check-input" type="radio"
                                                                name="approvals[{{ $section->id }}][type]"
                                                                value="with_changes" id="withChanges_{{ $section->id }}">
                                                            <label class="form-check-label"
                                                                for="withChanges_{{ $section->id }}">
                                                                รับรองโดยมีการแก้ไข
                                                            </label>
                                                        </div>
                                                        <div id="comments_{{ $section->id }}" class="mt-3"
                                                            style="display: none;">
                                                            <div class="form-group">
                                                                <textarea class="form-control" name="approvals[{{ $section->id }}][comments]" rows="3"
                                                                    placeholder="โปรดระบุรายละเอียดการแก้ไข"></textarea>
                                                                <div class="invalid-feedback">
                                                                    กรุณาระบุรายละเอียดการแก้ไข
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endif
                                            </div>
                                        </div>
                                    </div>
                                @endforeach
                                {{-- <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary">บันทึกการรับรอง</button>
                                </div> --}}
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary">
                                        @if($isAdmin && now()->gt($meetingAgenda->approval_deadline))
                                            บันทึกการรับรอง (สิทธิ์ Admin)
                                        @else
                                            บันทึกการรับรอง
                                        @endif
                                    </button>
                                </div>
                            </form>
                        @endif
                        <!-- แสดงข้อความเมื่อหมดเวลารับรองและไม่ใช่ admin -->
                        @if(now()->gt($meetingAgenda->approval_deadline) && !$isAdmin && !$hasApproved)
                        <div class="alert alert-warning">
                            <i class="fas fa-clock me-2"></i> หมดเวลารับรองแล้ว
                        </div>
                        @endif
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal สำหรับแสดงรายละเอียด -->
    <div class="modal fade" id="approvalDetailsModal" tabindex="-1" aria-labelledby="approvalDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="approvalDetailsModalLabel">รายละเอียดการรับรอง</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="approvalDetailsContent">
                    <!-- Content will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal แสดงรายละเอียดการรับรอง -->
    {{-- <div class="modal fade" id="approvalDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">รายละเอียดการรับรอง</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="approvalDetailsContent">
                <!-- เนื้อหาจะถูกเพิ่มด้วย AJAX -->
            </div>
        </div>
    </div>
</div> --}}
<script>
$(document).ready(function() {
    $('input[type=radio][name^="approvals"]').change(function() {
        const sectionId = $(this).attr('name').match(/\[(\d+)\]/)[1];
        const commentSection = $('#comments_' + sectionId);
        if ($(this).val() === 'with_changes') {
            commentSection.slideDown(300);
            commentSection.find('textarea').prop('required', true);
        } else {
            commentSection.slideUp(300);
            commentSection.find('textarea').prop('required', false).val('');
        }
    });
    // Handle form submission
    $('
        e.preventDefault();
        if (!validateForm()) {
            alert('กรุณากรอกรายละเอียดการแก้ไขให้ครบถ้วน');
            return;
        }
        if (!confirm('ยืนยันการบันทึกการรับรอง?')) {
            return;
        }
        const meetingId = '{{ $meetingAgenda->id }}';
        const submitBtn = $(this).find('button[type="submit"]');
        submitBtn.prop('disabled', true).html(
            '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> กำลังบันทึก...'
        );
        $.ajax({
            url: `/meeting-approval/${meetingId}/update`,
            method: 'POST',
            data: $(this).serialize(),
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            success: function(response) {
                if (response.success) {
                    alert(response.message);
                    location.reload();
                } else {
                    alert('เกิดข้อผิดพลาด: ' + response.message);
                    submitBtn.prop('disabled', false).text('บันทึกการรับรอง');
                }
            },
            error: function(xhr) {
                const errorMsg = xhr.responseJSON?.message || 'เกิดข้อผิดพลาดในการบันทึกข้อมูล';
                alert(errorMsg);
                submitBtn.prop('disabled', false).text('บันทึกการรับรอง');
            }
        });
    });
    $('.show-details').click(function() {
        const approvalId = $(this).data('approval-id');
        const modalContent = $('#approvalDetailsContent');
        modalContent.html(`
            <div class="d-flex justify-content-center p-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        `);
        $.ajax({
            url: `/meeting-approval-details/${approvalId}`,
            method: 'GET',
            success: function(response) {
                modalContent.html(response);
            },
            error: function(xhr) {
                modalContent.html(`
                    <div class="alert alert-danger m-3">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        เกิดข้อผิดพลาดในการโหลดข้อมูล
                    </div>
                `);
            }
        });
    });
    $('#meetingApprovalForm').submit(function(e) {
        e.preventDefault();
        if (!validateForm()) {
            alert('กรุณากรอกรายละเอียดการแก้ไขให้ครบถ้วน');
            return;
        }
        if (confirm('ยืนยันการบันทึกการรับรอง?')) {
            this.submit();
        }
    });
    function validateForm() {
        let isValid = true;
        const withChangesRadios = $('input[type="radio"][value="with_changes"]:checked');
        withChangesRadios.each(function() {
            const sectionId = $(this).attr('name').match(/\[(\d+)\]/)[1];
            const textarea = $(`textarea[name="approvals[${sectionId}][comments]"]`);
            const commentText = textarea.val().trim();
            if (!commentText) {
                isValid = false;
                textarea.addClass('is-invalid');
                textarea.next('.invalid-feedback').show();
            } else {
                textarea.removeClass('is-invalid');
                textarea.next('.invalid-feedback').hide();
            }
        });
        return isValid;
    }
    $(document).on('input', 'textarea', function() {
        $(this).removeClass('is-invalid');
        $(this).next('.invalid-feedback').hide();
    });
    function validateForm() {
        let isValid = true;
        const withChangesRadios = $('input[type="radio"][value="with_changes"]:checked');
        withChangesRadios.each(function() {
            const sectionId = $(this).attr('name').match(/\[(\d+)\]/)[1];
            const textarea = $(`textarea[name="approvals[${sectionId}][comments]"]`);
            const commentText = textarea.val().trim();
            if (!commentText) {
                isValid = false;
                textarea.addClass('is-invalid');
                textarea.next('.invalid-feedback').show();
            } else {
                textarea.removeClass('is-invalid');
                textarea.next('.invalid-feedback').hide();
            }
        });
        return isValid;
    }
    $(document).on('input', 'textarea', function() {
        $(this).removeClass('is-invalid');
        $(this).next('.invalid-feedback').hide();
    });
    $('textarea').on('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
    $('textarea').keydown(function(e) {
        if (e.keyCode === 13 && !e.shiftKey) {
            e.preventDefault();
            return false;
        }
    });
    $('#approvalDetailsModal').on('hidden.bs.modal', function() {
        $('#approvalDetailsContent').html('');
    });
    // Initialize tooltips
    $('[data-bs-toggle="tooltip"]').tooltip();
    // Handle approval deadline countdown
    function updateDeadlineCountdown() {
        const deadlineElement = $('.approval-deadline');
        if (deadlineElement.length) {
            const deadline = moment(deadlineElement.data('deadline'));
            const now = moment();
            const diff = deadline.diff(now, 'hours');
            if (diff > 0) {
                deadlineElement.html(`เหลือเวลาอีก ${diff} ชั่วโมง`);
            } else {
                deadlineElement.html('หมดเวลารับรอง').addClass('text-danger');
            }
        }
    }
    if ($('.approval-deadline').length) {
        updateDeadlineCountdown();
        setInterval(updateDeadlineCountdown, 60000);
    }
});
</script>
{{-- <script>
    $('.show-details').click(function() {
        var approvalId = $(this).data('approval-id');
        $.ajax({
            url: '/meeting-approval-details/' + approvalId,
            method: 'GET',
            success: function(response) {
                $('#approvalDetailsContent').html(response);
                $('#approvalDetailsModal').modal('show');
            },
            error: function(xhr) {
                alert('เกิดข้อผิดพลาดในการโหลดข้อมูล');
                console.error(xhr.responseText);
            }
        });
    });
</script> --}}
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/all_meeting_report_summary.blade.php">
{{-- @extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">สรุปรายงานการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ประเภทการประชุม</th>
                                <th>ชื่อวาระการประชุม</th>
                                <th>ครั้งที่</th>
                                <th>ปี</th>
                                <th>วันที่</th>
                                <th>สถานะการรับรอง</th>
                                <th>สถานะการรับรอง (Admin)</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($meetingAgendas as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->meeting_type->name }}</td>
                                    <td>{{ $item->meeting_agenda_title }}</td>
                                    <td>{{ $item->meeting_agenda_number }}</td>
                                    <td>{{ $item->meeting_agenda_year }}</td>
                                    <td>{{ \Carbon\Carbon::parse($item->meeting_agenda_date)->format('d/m/Y') }}</td>
                                    <td>
                                        @php
                                            $totalApprovals = $item->approvals->count();
                                            $completedApprovals = $item->approvals->where('status', 'approved')->count();
                                            $percentage = $totalApprovals > 0 ? ($completedApprovals / $totalApprovals) * 100 : 0;
                                        @endphp
                                        <div class="progress">
                                            <div class="progress-bar bg-success" role="progressbar"
                                                style="width: {{ $percentage }}%"
                                                aria-valuenow="{{ $percentage }}"
                                                aria-valuemin="0"
                                                aria-valuemax="100">
                                                {{ number_format($percentage, 0) }}%
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        @if($item->is_admin_approved)
                                            <span class="badge bg-success">รับรองแล้ว</span>
                                            <br>
                                            <small>{{ \Carbon\Carbon::parse($item->admin_approved_at)->format('d/m/Y H:i') }}</small>
                                        @else
                                            <span class="badge bg-warning">รอการรับรอง</span>
                                        @endif
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a href="{{ route('meeting.report.summary', $item->id) }}"
                                                class="btn btn-info btn-sm"
                                                title="ดูรายละเอียด">
                                                <i class="bx bx-show"></i>
                                            </a>
                                            <a href="{{ route('meeting.report.summary.edit', $item->id) }}"
                                                class="btn btn-warning btn-sm"
                                                title="แก้ไข">
                                                <i class="bx bx-edit"></i>
                                            </a>
                                            @if(!$item->is_admin_approved)
                                                <button type="button"
                                                    class="btn btn-success btn-sm"
                                                    title="รับรอง"
                                                    onclick="confirmApproval({{ $item->id }})">
                                                    <i class="bx bx-check"></i>
                                                </button>
                                            @endif
                                        </div>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal สำหรับยืนยันการรับรอง -->
    <div class="modal fade" id="approvalModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ยืนยันการรับรองรายงานการประชุม</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>คุณต้องการรับรองรายงานการประชุมนี้ใช่หรือไม่?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-success" onclick="approveReport()">ยืนยันการรับรอง</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let selectedReportId = null;
        function confirmApproval(id) {
            selectedReportId = id;
            $('#approvalModal').modal('show');
        }
        function approveReport() {
            if (selectedReportId) {
                $.ajax({
                    type: 'POST',
                    url: "{{ route('meeting.report.summary.admin.approve', '') }}/" + selectedReportId,
                    data: {
                        _token: "{{ csrf_token() }}"
                    },
                    success: function(response) {
                        toastr.success('รับรองรายงานการประชุมเรียบร้อยแล้ว');
                        $('#approvalModal').modal('hide');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    },
                    error: function(xhr) {
                        toastr.error('เกิดข้อผิดพลาดในการรับรองรายงานการประชุม');
                    }
                });
            }
        }
        $(document).ready(function() {
            $('#example').DataTable({
                "processing": true,
                "language": {
                    "sProcessing": "กำลังดำเนินการ...",
                    "sLengthMenu": "แสดง _MENU_ รายการ",
                    "sZeroRecords": "ไม่พบข้อมูล",
                    "sInfo": "แสดง _START_ ถึง _END_ จาก _TOTAL_ รายการ",
                    "sInfoEmpty": "แสดง 0 ถึง 0 จาก 0 รายการ",
                    "sInfoFiltered": "(กรองข้อมูล _MAX_ ทุกรายการ)",
                    "sInfoPostFix": "",
                    "sSearch": "ค้นหา:",
                    "sUrl": "",
                    "oPaginate": {
                        "sFirst": "เริ่มต้น",
                        "sPrevious": "ก่อนหน้า",
                        "sNext": "ถัดไป",
                        "sLast": "สุดท้าย"
                    }
                }
            });
        });
    </script>
@endsection --}}
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <!-- Header -->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
        <div class="ps-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 p-0">
                    <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a></li>
                    <li class="breadcrumb-item active" aria-current="page">สรุปรายงานการประชุม</li>
                </ol>
            </nav>
        </div>
    </div>
    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card radius-10 border-primary border-start border-0 border-4">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div>
                            <h5 class="mb-0 text-primary">{{ $meetingAgendas->count() }}</h5>
                            <p class="mb-0">รายงานทั้งหมด</p>
                        </div>
                        <div class="ms-auto"><i class="bx bx-file fs-3 text-primary"></i></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card radius-10 border-success border-start border-0 border-4">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div>
                            <h5 class="mb-0 text-success">
                                {{ $meetingAgendas->where('is_admin_approved', true)->count() }}
                            </h5>
                            <p class="mb-0">รับรองแล้ว</p>
                        </div>
                        <div class="ms-auto"><i class="bx bx-check-circle fs-3 text-success"></i></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card radius-10 border-warning border-start border-0 border-4">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div>
                            <h5 class="mb-0 text-warning">
                                {{ $meetingAgendas->where('is_admin_approved', false)->count() }}
                            </h5>
                            <p class="mb-0">รอการรับรอง</p>
                        </div>
                        <div class="ms-auto"><i class="bx bx-time fs-3 text-warning"></i></div>
                    </div>
                </div>
            </div>
        </div>
        {{-- <div class="col-md-3">
            <div class="card radius-10 border-info border-start border-0 border-4">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div>
                            <h5 class="mb-0 text-info">
                                {{ number_format($averageApprovalTime, 1) }}
                            </h5>
                            <p class="mb-0">วันเฉลี่ยในการรับรอง</p>
                        </div>
                        <div class="ms-auto"><i class="bx bx-calendar fs-3 text-info"></i></div>
                    </div>
                </div>
            </div>
        </div> --}}
    </div>
    <!-- Main Table -->
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="mb-0">รายการรายงานการประชุม</h5>
                {{-- <div>
                    <button class="btn btn-outline-primary btn-sm" onclick="exportReport()">
                        <i class="bx bx-export me-1"></i> ส่งออกข้อมูล
                    </button>
                </div> --}}
            </div>
            <div class="table-responsive">
                <table id="reportTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th style="width: 5%">ลำดับ</th>
                            <th style="width: 15%">ประเภทการประชุม</th>
                            <th style="width: 20%">ชื่อวาระการประชุม</th>
                            <th style="width: 10%">ครั้งที่/ปี</th>
                            <th style="width: 10%">วันที่</th>
                            {{-- <th style="width: 15%">สถานะการรับรอง</th> --}}
                            <th style="width: 15%">สถานะ Admin</th>
                            <th style="width: 10%">ดำเนินการ</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach ($meetingAgendas as $key => $item)
                            <tr>
                                <td class="text-center">{{ $key + 1 }}</td>
                                <td>{{ $item->meeting_type->name }}</td>
                                <td>{{ $item->meeting_agenda_title }}</td>
                                <td class="text-center">
                                    {{ $item->meeting_agenda_number }}/{{ $item->meeting_agenda_year }}
                                </td>
                                <td>{{ \Carbon\Carbon::parse($item->meeting_agenda_date)->format('d/m/Y') }}</td>
                                {{-- <td>
                                    @php
                                        $totalApprovals = $item->approvals->count();
                                        $completedApprovals = $item->approvals->where('status', 'approved')->count();
                                        $percentage = $totalApprovals > 0 ? ($completedApprovals / $totalApprovals) * 100 : 0;
                                        $progressClass = $percentage == 100 ? 'bg-success' : ($percentage >= 50 ? 'bg-warning' : 'bg-danger');
                                    @endphp
                                    <div class="d-flex align-items-center">
                                        <div class="progress flex-grow-1" style="height: 8px;">
                                            <div class="progress-bar {{ $progressClass }}"
                                                role="progressbar"
                                                style="width: {{ $percentage }}%">
                                            </div>
                                        </div>
                                        <span class="ms-2">{{ number_format($percentage, 0) }}%</span>
                                    </div>
                                    <small class="text-muted">
                                        ({{ $completedApprovals }}/{{ $totalApprovals }} ท่าน)
                                    </small>
                                </td> --}}
                                <td class="text-center">
                                    @if($item->is_admin_approved)
                                        <div class="d-flex flex-column">
                                            <span class="badge bg-success mb-1">รับรองแล้ว</span>
                                            <small>
                                                {{ \Carbon\Carbon::parse($item->admin_approved_at)->format('d/m/Y H:i') }}
                                                <br>
                                                โดย: {{ optional($item->adminApprovedBy)->first_name }}
                                            </small>
                                        </div>
                                    @else
                                        <span class="badge bg-warning">รอการรับรอง</span>
                                    @endif
                                </td>
                                <td>
                                    <!-- แก้ไขเฉพาะส่วน Action ในตาราง -->
                                        <div class="btn-group">
                                            <!-- ปุ่มดูรายละเอียด -->
                                            <a href="{{ route('meeting.report.summary', $item->id) }}"
                                                class="btn btn-info btn-sm"
                                                data-bs-toggle="tooltip"
                                                title="ดูรายละเอียด">
                                                <i class="bx bx-show"></i>
                                            </a>
                                            <!-- ปุ่มแก้ไขการรับรอง -->
                                            <a href="{{ route('meeting.report.summary.edit', $item->id) }}"
                                                class="btn btn-warning btn-sm"
                                                data-bs-toggle="tooltip"
                                                title="แก้ไขการรับรอง">
                                                <i class="bx bx-edit"></i>
                                            </a>
                                            <!-- ปุ่มรับรองโดย Admin -->
                                            @if(!$item->is_admin_approved)
                                                <button type="button"
                                                    class="btn btn-success btn-sm"
                                                    onclick="showApprovalModal({{ $item->id }})"
                                                    data-bs-toggle="tooltip"
                                                    title="รับรองโดย Admin">
                                                    <i class="bx bx-check-double"></i>
                                                </button>
                                            @else
                                                <!-- แสดงสถานะเมื่อรับรองแล้ว -->
                                                <button type="button"
                                                    class="btn btn-secondary btn-sm"
                                                    disabled
                                                    data-bs-toggle="tooltip"
                                                    title="รับรองแล้วโดย: {{ optional($item->adminApprovedBy)->first_name }}
                                                           เมื่อ: {{ \Carbon\Carbon::parse($item->admin_approved_at)->format('d/m/Y H:i') }}">
                                                    <i class="bx bx-check-double"></i>
                                                </button>
                                                <!-- ปุ่มยกเลิกการรับรอง -->
                                                <button type="button"
                                                    class="btn btn-danger btn-sm"
                                                    onclick="cancelApproval({{ $item->id }})"
                                                    data-bs-toggle="tooltip"
                                                    title="ยกเลิกการรับรอง">
                                                    <i class="bx bx-x"></i>
                                                </button>
                                            @endif
                                        </div>
                                    {{-- <div class="dropdown">
                                        <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            <i class="bx bx-dots-vertical-rounded"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <a class="dropdown-item" href="{{ route('meeting.report.summary', $item->id) }}">
                                                    <i class="bx bx-show me-2"></i> ดูรายละเอียด
                                                </a>
                                            </li>
                                            @if($percentage == 100 && !$item->is_admin_approved)
                                                <li>
                                                    <a class="dropdown-item" href="#" onclick="showApprovalModal({{ $item->id }})">
                                                        <i class="bx bx-check me-2"></i> รับรองรายงาน
                                                    </a>
                                                </li>
                                            @endif
                                            @if($item->is_admin_approved)
                                                <li>
                                                    <a class="dropdown-item text-danger" href="#" onclick="cancelApproval({{ $item->id }})">
                                                        <i class="bx bx-x me-2"></i> ยกเลิกการรับรอง
                                                    </a>
                                                </li>
                                            @endif
                                        </ul>
                                    </div> --}}
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Modal การรับรองโดย Admin -->
<div class="modal fade" id="approvalModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">รับรองรายงานการประชุม</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="approvalForm" method="POST">
                @csrf
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label required">บันทึกการรับรอง</label>
                        <textarea name="admin_approval_note" class="form-control" rows="3" required></textarea>
                        <div class="form-text">โปรดระบุบันทึกหรือความคิดเห็นประกอบการรับรอง</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="submit" class="btn btn-success">
                        <i class="bx bx-check me-1"></i> ยืนยันการรับรอง
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('#reportTable').DataTable({
            "order": [[4, "desc"]],
            "pageLength": 25,
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.24/i18n/Thai.json"
            }
        });
    });
    function showApprovalModal(id) {
        const form = document.getElementById('approvalForm');
        form.action = `{{ url('/meeting/report') }}/${id}/admin-approve`;
        new bootstrap.Modal(document.getElementById('approvalModal')).show();
    }
    $.ajax({
        url: form.action,
        method: 'POST',
        data: new FormData(form),
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.success) {
                Swal.fire({
                    title: 'สำเร็จ!',
                    text: 'รับรองรายงานการประชุมเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 1500
                }).then(() => {
                    window.location.reload();
                });
            }
        },
        error: function(xhr) {
            Swal.fire({
                title: 'เกิดข้อผิดพลาด!',
                text: xhr.responseJSON?.message || 'ไม่สามารถรับรองรายงานได้',
                icon: 'error'
            });
            submitBtn.disabled = false;
        }
    });
    function cancelApproval(id) {
        Swal.fire({
            title: 'ยืนยันการยกเลิก?',
            text: "คุณต้องการยกเลิกการรับรองรายงานนี้ใช่หรือไม่?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'ใช่, ยกเลิก',
            cancelButtonText: 'ไม่'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `{{ url('meeting/report') }}/${id}/admin-cancel`,
                    type: 'POST',
                    data: { _token: '{{ csrf_token() }}' },
                    success: function(response) {
                        toastr.success('ยกเลิกการรับรองเรียบร้อยแล้ว');
                        setTimeout(() => window.location.reload(), 1500);
                    },
                    error: function(xhr) {
                        toastr.error('เกิดข้อผิดพลาดในการยกเลิกการรับรอง');
                    }
                });
            }
        });
    }
</script>
<style>
    .progress {
        background-color:
    }
    .required:after {
        content: " *";
        color: red;
    }
    .dropdown-item i {
        width: 1rem;
    }
</style>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/meeting_summary.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <div class="container-fluid">
        <!-- Meeting Content -->
        <div class="card">
            <div class="card-body">
                <!-- แสดงสถานะการรับรอง -->
                @if($meetingAgenda->is_admin_approved)
                    <div class="mb-3">
                        <span class="badge bg-success px-3 py-2">
                            <i class="fas fa-check-circle me-1"></i>
                            รายงานการประชุมนี้ได้รับการรับรองแล้ว
                        </span>
                    </div>
                @endif
                <h5 class="card-title mb-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            รายงานการประชุม
                            <span class="text-muted">
                                ครั้งที่ {{ $meetingAgenda->meeting_agenda_number }}/{{ $meetingAgenda->meeting_agenda_year }}
                            </span>
                        </div>
                        <div>
                            <a href="{{ route('meeting.report.summary.index') }}" class="btn btn-danger btn-sm">
                                <i class="fas fa-arrow-left"></i> กลับ
                            </a>
                        </div>
                    </div>
                </h5>
                <!-- ข้อมูลทั่วไปของการประชุม -->
                <div class="mb-4 p-3 bg-light rounded">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2"><strong>ประเภทการประชุม:</strong> {{ $meetingAgenda->meeting_type->name }}</p>
                            <p class="mb-2"><strong>วันที่ประชุม:</strong> {{ \Carbon\Carbon::parse($meetingAgenda->meeting_agenda_date)->format('d/m/Y') }}</p>
                            <p class="mb-2"><strong>เวลา:</strong> {{ \Carbon\Carbon::parse($meetingAgenda->meeting_agenda_time)->format('H:i') }} น.</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>สถานที่:</strong> {{ $meetingAgenda->meeting_location }}</p>
                            <p class="mb-2"><strong>รูปแบบการประชุม:</strong> {{ $meetingAgenda->meetingFormat->name }}</p>
                        </div>
                    </div>
                </div>
                @foreach($meetingAgenda->sections as $section)
                    <div class="mb-4">
                        <!-- หัวข้อส่วน -->
                        <div class="section-header bg-light p-3 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="text-primary mb-0">{{ $section->section_title }}</h6>
                                <span class="badge bg-info">
                                    {{ $section->approvalDetails->count() }} การรับรอง
                                </span>
                            </div>
                        </div>
                        <!-- เนื้อหาส่วน -->
                        @if($section->description)
                            <div class="section-content mt-3 p-3">
                                {!! $section->description !!}
                            </div>
                        @endif
                        <!-- Lectures และ Items -->
                        @foreach($section->meetingAgendaLectures as $lecture)
                            <div class="lecture-content mt-3 p-3 border-start border-primary border-3">
                                <h6 class="text-dark">{{ $lecture->lecture_title }}</h6>
                                @if($lecture->content)
                                    <div class="lecture-text mb-3">
                                        {!! $lecture->content !!}
                                    </div>
                                @endif
                                <!-- Items ภายใน Lecture -->
                                @foreach($lecture->meetingAgendaItems as $item)
                                    <div class="item-content ms-4 mt-2 p-2 border-start border-primary border-3">
                                        <h6 class="text-dark">{{ $item->item_title }}</h6>
                                        @if($item->content)
                                            <div class="item-text">
                                                {!! $item->content !!}
                                            </div>
                                        @endif
                                    </div>
                                @endforeach
                            </div>
                        @endforeach
                        <!-- ส่วนแสดงการรับรองและความคิดเห็น -->
                        @if(isset($approvalsBySection[$section->id]))
                            <div class="mt-3">
                                <div class="card border shadow-none">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">การรับรองและความคิดเห็น</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- [ส่วนแสดงตารางการรับรองและความคิดเห็นคงเดิม] -->
                                        @include('admin.backend.pages.meeting_report_sum.partials.approval_table', [
                                            'approvals' => $approvalsBySection[$section->id]
                                        ])
                                    </div>
                                </div>
                            </div>
                        @endif
                    </div>
                @endforeach
            </div>
        </div>
    </div>
</div>
<style>
    .badge {
    font-size: 0.9rem;
    font-weight: normal;
    }
    .section-content {
        background-color:
        border-radius: 4px;
    }
    .lecture-content {
        background-color:
        border-radius: 4px;
    }
    .item-content {
        background-color:
        border-radius: 4px;
    }
    .lecture-text, .item-text {
        font-size: 0.95rem;
        line-height: 1.6;
    }
</style>
@endsection
</file>

<file path="resources/views/admin/backend/pages/rule_meeting/all_rule_meeting.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">ข้อบังคับ</li>
                    </ol>
                </nav>
            </div>
            <div class="ms-auto">
                <div class="btn-group">
                    <a href="{{ route('add.rule.meeting') }}" class="btn btn-primary  ">เพิ่มข้อบังคับ </a>
                </div>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>title</th>
                                <th>description</th>
                                <th>date</th>
                                <th>pdf</th>
                                <th>status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($rules as $key => $item)
                                <tr>
                                    <td>{{ $key + 1 }}</td>
                                    <td>{{ $item->title }}</td>
                                    <td>{{ $item->description }}</td>
                                    <td>{{ $item->created_at }}</td>
                                    <td>
                                        @if ($item->pdf)
                                            <a href="{{ asset($item->pdf) }}" target="_blank" class="badge bg-success">ดูไฟล์ PDF</a>
                                        @else
                                            <span class="badge bg-danger">ไม่มีไฟล์ PDF</span>
                                        @endif
                                    </td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="status{{ $item->id }}"
                                                {{ $item->status == 1 ? 'checked' : '' }}
                                                onchange="updateStatus({{ $item->id }})">
                                            <label class="form-check-label" for="status{{ $item->id }}">
                                            </label>
                                        </div>
                                    </td>
                                    <td>
                                        <a href="{{ route('edit.rule.meeting', $item->id) }}" class="btn btn-info px-5">Edit </a>
                                        <a href="{{ route('delete.rule.meeting', $item->id) }}" class="btn btn-danger px-5" id="delete">Delete </a>
                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        function updateStatus(id) {
            if (id) {
                $.ajax({
                    type: 'POST',
                    url: "{{ route('update.status.rule.meeting', ':id') }}".replace(':id', id),
                    data: {
                        _token: "{{ csrf_token() }}"
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.status == 1) {
                            $('#status' + id).prop('checked', true);
                        } else {
                            $('#status' + id).prop('checked', false);
                        }
                        toastr.success(response.message);
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        toastr.error('An error occurred while updating the status.');
                    }
                });
            } else {
                toastr.error('Missing required parameter: id');
            }
        }
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_agenda/edit_meeting_agenda.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">แก้ไขระเบียบวาระการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">แก้ไขระเบียบวาระการประชุม</h5>
                <form id="myForm" action="{{ route('update.meeting.agenda') }}" method="post"
                    class="row g-3" enctype="multipart/form-data">
                    @csrf
                    <input type="hidden" name="id" value="{{ $meeting_agenda->id }}">
                    {{-- @method('POST') --}}
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ประเภทการประชุม</label>
                        <select name="meeting_type_id" class="form-select mb-3" aria-label="Default select example">
                            <option selected="" disabled>เลือกประเภทการประชุม</option>
                            @foreach ($meeting_types as $item)
                                <option value="{{ $item->id }}" @if ($meeting_agenda->meeting_type_id == $item->id) selected @endif>
                                    {{ $item->name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="committee_category_id" class="form-label">หมวดหมู่คณะกรรมการ</label>
                        <select name="committee_category_id" class="form-select" required>
                            @foreach($committee_categories as $category)
                                <option value="{{ $category->id }}" {{ $meeting_agenda->committee_category_id == $category->id ? 'selected' : '' }}>
                                    {{ $category->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="meeting_format_id" class="form-label">รูปแบบการประชุม</label>
                        <select name="meeting_format_id" class="form-select" required>
                            @foreach($meeting_formats as $format)
                                <option value="{{ $format->id }}" {{ $meeting_agenda->meeting_format_id == $format->id ? 'selected' : '' }}>
                                    {{ $format->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    {{-- <div class="col-md-6 mb-3">
                        <label for="regulation_meeting_id" class="form-label">ระเบียบการประชุม</label>
                        <select name="regulation_meeting_id" class="form-select" required>
                            @foreach($regulation_meetings as $regulation)
                                <option value="{{ $regulation->id }}" {{ $meeting_agenda->regulation_meeting_id == $regulation->id ? 'selected' : '' }}>
                                    {{ $regulation->regulation_title }}
                                </option>
                            @endforeach
                        </select>
                    </div> --}}
                    <div class="col-md-6 mb-3">
                        <label for="regulation_meeting_ids" class="form-label">ระเบียบการประชุม</label>
                        <select name="regulation_meeting_ids[]" class="form-select" id="regulation-meeting-multiple-field" multiple >
                            @foreach($regulation_meetings as $regulation)
                                <option value="{{ $regulation->id }}" {{ in_array($regulation->id, $meeting_agenda->regulationMeeting->pluck('id')->toArray()) ? 'selected' : '' }}>
                                    {{ $regulation->regulation_title }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="rule_of_meeting_ids" class="form-label">ข้อบังคับการประชุม</label>
                        <select name="rule_of_meeting_ids[]" class="form-select" id="small-bootstrap-class-multiple-field" multiple >
                            @foreach($rule_of_meetings as $rule)
                                <option value="{{ $rule->id }}" {{ in_array($rule->id, $meeting_agenda->ruleOfMeeting->pluck('id')->toArray()) ? 'selected' : '' }}>
                                    {{ $rule->title }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ชื่อระเบียบวาระการประชุม</label>
                        <input type="text" name="meeting_agenda_title" class="form-control" id="input1"
                            value="{{ $meeting_agenda->meeting_agenda_title }}" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">เลขที่ระเบียบวาระการประชุม</label>
                        <input type="text" name="meeting_agenda_number" class="form-control" id="input1"
                            value="{{ $meeting_agenda->meeting_agenda_number }}" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">ปีระเบียบวาระการประชุม</label>
                        <input type="text" name="meeting_agenda_year" class="form-control" id="input1"
                            value="{{ $meeting_agenda->meeting_agenda_year }}" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">วันที่วาระการประชุม</label>
                        <input type="date" name="meeting_agenda_date" class="form-control" id="input1"
                            value="{{ $meeting_agenda->meeting_agenda_date }}" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="input1" class="form-label">เวลาระเบียบวาระการประชุม</label>
                        <input type="time" name="meeting_agenda_time" class="form-control" id="input1"
                            value="{{ $meeting_agenda->meeting_agenda_time }}" required>
                    </div>
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">สถานที่ระเบียบวาระการประชุม</label>
                        <input type="text" name="meeting_location" class="form-control" id="input1"
                            value="{{ $meeting_agenda->meeting_location }}" required>
                    </div>
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">กำหนดการรับรอง</legend>
                        <div class="mb-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="approval_deadline_date" class="form-label">วันที่สิ้นสุดการรับรอง</label>
                                    <input type="date" name="approval_deadline_date"
                                            class="form-control @error('approval_deadline_date') is-invalid @enderror"
                                            value="{{ old('approval_deadline_date', isset($meeting_agenda->approval_deadline) ? date('Y-m-d', strtotime($meeting_agenda->approval_deadline)) : '') }}"
                                            required>
                                    @error('approval_deadline_date')
                                        <div class="invalid-feedback">{{ $message }}</div>
                                    @enderror
                                </div>
                                <div class="col-md-6">
                                    <label for="approval_deadline_time" class="form-label">เวลาสิ้นสุดการรับรอง</label>
                                    <input type="time" name="approval_deadline_time"
                                            class="form-control @error('approval_deadline_time') is-invalid @enderror"
                                            value="{{ old('approval_deadline_time', isset($meeting_agenda->approval_deadline) ? date('H:i', strtotime($meeting_agenda->approval_deadline)) : '') }}"
                                            required>
                                    @error('approval_deadline_time')
                                        <div class="invalid-feedback">{{ $message }}</div>
                                    @enderror
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    {{-- This --}}
                    <fieldset style="border: 1px solid #007bff; border-radius: 5px;" class="p-2">
                        <legend>ตั้งค่าการแสดงผลความเห็นคณะกรรมการ</legend>
                        <div class="form-group mb-3">
                            <label for="committeeOpinionTitle" class="form-label">ข้อความหัวข้อ</label>
                            <input type="text"
                                class="form-control"
                                id="committeeOpinionTitle"
                                name="committee_opinion_title"
                                value="{{ $meeting_agenda->committee_opinion_title }}"
                                required>
                            <small class="text-muted">
                                * กำหนดข้อความที่จะแสดงเป็นหัวข้อในส่วนของการลงความเห็น
                            </small>
                        </div>
                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox"
                                    name="show_committee_opinion"
                                    id="showCommitteeOpinion"
                                    {{ $meeting_agenda->show_committee_opinion ? 'checked' : '' }}>
                                <label class="form-check-label" for="showCommitteeOpinion">
                                    เปิดการแสดงผลการลงความเห็นของคณะกรรมการกลั่นกรอง
                                </label>
                            </div>
                            <small class="text-muted">
                                * หากปิดการแสดงผล ผู้เข้าร่วมประชุมจะไม่สามารถเห็นผลการลงความเห็นของคณะกรรมการกลั่นกรองได้
                            </small>
                        </div>
                    </fieldset>
                    {{-- This --}}
                    <div class="form-group col-md-12">
                        <label for="input1" class="form-label">รายละเอียดระเบียบวาระการประชุม</label>
                        <textarea name="description" class="form-control" rows="10">{{ $meeting_agenda->description }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.meeting.agenda') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    meeting_type_id: {
                        required: true,
                    },
                },
                messages: {
                    meeting_type_id: {
                        required: 'Please Enter Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
<script>
$(document).ready(function() {
    $('#regulation-meeting-multiple-field, #rule-of-meeting-multiple-field').select2({
        theme: "bootstrap-5",
        width: '100%',
        placeholder: $(this).data('placeholder'),
        allowClear: true
    });
});
</script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_report_sum/meeting_summary_edit.blade.php">
{{-- @extends('admin.admin_dashboard')
@section('admin')
<script src="https://cdn.ckeditor.com/ckeditor5/latest/classic/ckeditor.js"></script>
<div class="page-content">
    <div class="container-fluid">
        <!-- Breadcrumb -->
        <div class="row">
            <div class="col-12">
                <div class="page-title-box d-flex align-items-center justify-content-between">
                    <h4 class="mb-0">แก้ไขรายงานการประชุม</h4>
                    <div class="page-title-right">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item">
                                <a href="{{ route('meeting.report.summary', $meetingAgenda->id) }}">
                                    กลับไปหน้ารายงาน
                                </a>
                            </li>
                            <li class="breadcrumb-item active">แก้ไขรายงาน</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- Meeting Info Card -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-2">
                            <strong>ประเภทการประชุม:</strong>
                            {{ $meetingAgenda->meeting_type->name }}
                        </p>
                        <p class="mb-2">
                            <strong>คณะกรรมการ:</strong>
                            {{ $meetingAgenda->committeeCategory->name }}
                        </p>
                        <p class="mb-2">
                            <strong>ครั้งที่:</strong>
                            {{ $meetingAgenda->meeting_agenda_number }}/{{ $meetingAgenda->meeting_agenda_year }}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p class="mb-2">
                            <strong>วันที่ประชุม:</strong>
                            {{ \Carbon\Carbon::parse($meetingAgenda->meeting_agenda_date)->format('d/m/Y') }}
                        </p>
                        <p class="mb-2">
                            <strong>เวลา:</strong>
                            {{ $meetingAgenda->meeting_agenda_time }}
                        </p>
                        <p class="mb-2">
                            <strong>สถานที่:</strong>
                            {{ $meetingAgenda->meeting_location }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Edit Form -->
        <form action="{{ route('meeting.report.summary.update', $meetingAgenda->id) }}" method="POST">
            @csrf
            <div class="card">
                <div class="card-body">
                    @foreach($meetingAgenda->sections as $section)
                        <div class="mb-5 border-bottom pb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">{{ $section->section_title }}</h5>
                                <span class="badge bg-info">
                                    {{ isset($approvalsBySection[$section->id]) ? count($approvalsBySection[$section->id]) : 0 }} การรับรอง
                                </span>
                            </div>
                            <!-- Section Content -->
                            <div class="mb-4">
                                <label class="form-label">เนื้อหาวาระ</label>
                                <textarea
                                    class="form-control @error('sections.'.$section->id.'.content') is-invalid @enderror"
                                    name="sections[{{ $section->id }}][content]"
                                    rows="4"
                                >{{ old('sections.'.$section->id.'.content', $section->description) }}</textarea>
                                @error('sections.'.$section->id.'.content')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>
                            <!-- Lectures and Items -->
                            @foreach($section->meetingAgendaLectures as $lecture)
                                <div class="ms-4 mb-4">
                                    <h6 class="mb-3">{{ $lecture->lecture_title }}</h6>
                                    <div class="mb-3">
                                        <textarea
                                            class="form-control"
                                            name="sections[{{ $section->id }}][lectures][{{ $lecture->id }}][content]"
                                            rows="3"
                                        >{{ old('sections.'.$section->id.'.lectures.'.$lecture->id.'.content', $lecture->content) }}</textarea>
                                    </div>
                                    @foreach($lecture->meetingAgendaItems as $item)
                                        <div class="ms-4 mb-3">
                                            <label class="form-label">{{ $item->item_title }}</label>
                                            <textarea
                                                class="form-control"
                                                name="sections[{{ $section->id }}][lectures][{{ $lecture->id }}][items][{{ $item->id }}][content]"
                                                rows="3"
                                            >{{ old('sections.'.$section->id.'.lectures.'.$lecture->id.'.items.'.$item->id.'.content', $item->content) }}</textarea>
                                        </div>
                                    @endforeach
                                </div>
                            @endforeach
                            <!-- Show Approvals -->
                            @if(isset($approvalsBySection[$section->id]))
                                <div class="mt-3">
                                    <h6 class="mb-3">การรับรองและความคิดเห็น</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>ผู้รับรอง</th>
                                                    <th>สถานะ</th>
                                                    <th>ความคิดเห็น</th>
                                                    <th>วันที่รับรอง</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach($approvalsBySection[$section->id] as $approval)
                                                    <tr>
                                                        <td>{{ $approval['user']->prefix_name }} {{ $approval['user']->first_name }}</td>
                                                        <td>
                                                            <span class="badge bg-{{ $approval['type'] == 'no_changes' ? 'success' : 'warning' }}">
                                                                {{ $approval['type'] == 'no_changes' ? 'ไม่มีแก้ไข' : 'มีแก้ไข' }}
                                                            </span>
                                                        </td>
                                                        <td>{{ $approval['comments'] ?? '-' }}</td>
                                                        <td>{{ \Carbon\Carbon::parse($approval['created_at'])->format('d/m/Y H:i') }}</td>
                                                    </tr>
                                                @endforeach
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            @endif
                        </div>
                    @endforeach
                    <!-- Action Buttons -->
                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary me-2">บันทึกการแก้ไข</button>
                        <a href="{{ route('meeting.report.summary', $meetingAgenda->id) }}"
                            class="btn btn-secondary">ยกเลิก</a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
@push('scripts')
<script>
    $(document).ready(function() {
        if (typeof ClassicEditor !== 'undefined') {
            document.querySelectorAll('textarea').forEach(element => {
                ClassicEditor.create(element);
            });
        }
    });
</script>
@endpush
@endsection --}}
{{-- @extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <div class="container-fluid">
        <!-- Breadcrumb -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="page-title-box d-flex align-items-center justify-content-between">
                    <h4 class="mb-0">แก้ไขการรับรองและความคิดเห็น</h4>
                    <div class="page-title-right">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item">
                                <a href="{{ route('meeting.report.summary', $meetingAgenda->id) }}">
                                    กลับไปหน้ารายงาน
                                </a>
                            </li>
                            <li class="breadcrumb-item active">แก้ไขการรับรอง</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- Meeting Info Summary -->
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">ข้อมูลการประชุม
                    <small class="text-muted">
                        ครั้งที่ {{ $meetingAgenda->meeting_agenda_number }}/{{ $meetingAgenda->meeting_agenda_year }}
                    </small>
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>ประเภท:</strong> {{ $meetingAgenda->meeting_type->name }}</p>
                        <p><strong>วันที่:</strong> {{ \Carbon\Carbon::parse($meetingAgenda->meeting_agenda_date)->format('d/m/Y') }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>คณะกรรมการ:</strong> {{ $meetingAgenda->committeeCategory->name }}</p>
                        <p><strong>สถานที่:</strong> {{ $meetingAgenda->meeting_location }}</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Edit Form -->
        <form action="{{ route('meeting.report.summary.update', $meetingAgenda->id) }}" method="POST">
            @csrf
            @foreach($meetingAgenda->sections as $section)
                @if(isset($approvalsBySection[$section->id]))
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">{{ $section->section_title }}</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead class="bg-light">
                                        <tr>
                                            <th style="width: 25%">ผู้รับรอง</th>
                                            <th style="width: 15%">สถานะ</th>
                                            <th style="width: 40%">ความคิดเห็น</th>
                                            <th style="width: 20%">ดำเนินการ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach($approvalsBySection[$section->id] as $approval)
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-xs me-2">
                                                            <span class="avatar-title rounded-circle bg-primary-subtle text-primary">
                                                                {{ substr($approval['user']->first_name, 0, 1) }}
                                                            </span>
                                                        </div>
                                                        <div>
                                                            <h6 class="mb-0">{{ $approval['user']->prefix_name }} {{ $approval['user']->first_name }}</h6>
                                                            <small class="text-muted">{{ $approval['user']->position->name ?? '' }}</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <select class="form-select form-select-sm"
                                                        name="approvals[{{ $section->id }}][{{ $approval['approval_id'] }}][type]">
                                                        <option value="no_changes"
                                                            {{ $approval['type'] == 'no_changes' ? 'selected' : '' }}>
                                                            รับรองโดยไม่มีแก้ไข
                                                        </option>
                                                        <option value="with_changes"
                                                            {{ $approval['type'] == 'with_changes' ? 'selected' : '' }}>
                                                            รับรองโดยมีแก้ไข
                                                        </option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <textarea class="form-control form-control-sm"
                                                        name="approvals[{{ $section->id }}][{{ $approval['approval_id'] }}][comments]"
                                                        rows="2">{{ $approval['comments'] }}</textarea>
                                                </td>
                                                <td class="text-center">
                                                    <button type="button" class="btn btn-danger btn-sm delete-approval"
                                                        data-approval-id="{{ $approval['approval_id'] }}"
                                                        data-section-id="{{ $section->id }}">
                                                        <i class="bx bx-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        @endforeach
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                @endif
            @endforeach
            <!-- Action Buttons -->
            <div class="d-flex justify-content-between">
                <a href="{{ route('meeting.report.summary', $meetingAgenda->id) }}"
                    class="btn btn-secondary">
                    ยกเลิก
                </a>
                <button type="submit" class="btn btn-primary">
                    บันทึกการแก้ไข
                </button>
            </div>
        </form>
    </div>
</div>
<script>
$(document).ready(function() {
    $('.delete-approval').click(function() {
        const approvalId = $(this).data('approval-id');
        const sectionId = $(this).data('section-id');
        Swal.fire({
            title: 'ยืนยันการลบ?',
            text: "คุณต้องการลบการรับรองนี้ใช่หรือไม่?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'ใช่, ลบ',
            cancelButtonText: 'ยกเลิก'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: ''.replace(':id', approvalId),
                    type: 'DELETE',
                    data: {
                        _token: '{{ csrf_token() }}',
                        section_id: sectionId
                    },
                    success: function(response) {
                        Swal.fire(
                            'สำเร็จ!',
                            'ลบการรับรองเรียบร้อยแล้ว',
                            'success'
                        ).then(() => {
                            location.reload();
                        });
                    },
                    error: function(xhr) {
                        Swal.fire(
                            'Error!',
                            'เกิดข้อผิดพลาดในการลบข้อมูล',
                            'error'
                        );
                    }
                });
            }
        });
    });
});
</script>
@endsection --}}
@extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <div class="container-fluid">
        <!-- Breadcrumb -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="page-title-box d-flex align-items-center justify-content-between">
                    <h4 class="mb-0">แก้ไขการรับรองและความคิดเห็น</h4>
                    <div class="page-title-right">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item">
                                <a href="{{ route('meeting.report.summary.index') }}">
                                    กลับไปหน้ารายงาน
                                </a>
                            </li>
                            <li class="breadcrumb-item active">แก้ไขการรับรอง</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- Meeting Info Summary -->
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">ข้อมูลการประชุม
                    <small class="text-muted">
                        ครั้งที่ {{ $meetingAgenda->meeting_agenda_number }}/{{ $meetingAgenda->meeting_agenda_year }}
                    </small>
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>ประเภท:</strong> {{ $meetingAgenda->meeting_type->name }}</p>
                        <p><strong>วันที่:</strong> {{ \Carbon\Carbon::parse($meetingAgenda->meeting_agenda_date)->format('d/m/Y') }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>คณะกรรมการ:</strong> {{ $meetingAgenda->committeeCategory->name }}</p>
                        <p><strong>สถานที่:</strong> {{ $meetingAgenda->meeting_location }}</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Edit Form -->
        <form action="{{ route('meeting.report.summary.update', $meetingAgenda->id) }}" method="POST">
            @csrf
            @foreach($meetingAgenda->sections as $section)
                <div class="card mb-4">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">{{ $section->section_title }}</h5>
                        @if(isset($approvalsBySection[$section->id]))
                            <span class="badge bg-info">
                                {{ count($approvalsBySection[$section->id]) }} การรับรอง
                            </span>
                        @endif
                    </div>
                    <!-- เพิ่มส่วนแสดงรายละเอียดวาระ -->
                    <div class="card-body">
                        <!-- ส่วนแสดงรายละเอียดหลักของวาระ -->
                        @if($section->description)
                            <div class="mb-4">
                                <h6 class="fw-bold mb-3">
                                    <i class="bx bx-detail me-1"></i>รายละเอียดวาระ
                                </h6>
                                <div class="bg-light p-3 rounded">
                                    {!! $section->description !!}
                                </div>
                            </div>
                        @endif
                        <!-- ส่วนแสดงวาระย่อย (Lectures) -->
                        @if($section->meetingAgendaLectures->count() > 0)
                            <div class="mb-4">
                                {{-- <h6 class="fw-bold mb-3">
                                    <i class="bx bx-list-ul me-1"></i>วาระย่อย
                                </h6> --}}
                                @foreach($section->meetingAgendaLectures as $lecture)
                                    <div class="border-start border-primary border-3 ps-3 mb-4">
                                        <div class="mb-3">
                                            <h6 class="fw-bold text-black mb-2">{{ $lecture->lecture_title }}</h6>
                                            @if($lecture->content)
                                                <div class="bg-light p-3 rounded">
                                                    {!! $lecture->content !!}
                                                </div>
                                            @endif
                                        </div>
                                        <!-- ส่วนแสดงรายการย่อย (Items) -->
                                        @if($lecture->meetingAgendaItems->count() > 0)
                                            <div class="ms-4">
                                                @foreach($lecture->meetingAgendaItems as $item)
                                                    <div class="mb-3">
                                                        <div class="d-flex align-items-start">
                                                            {{-- <i class="bx bx-right-arrow-alt me-2 mt-1 text-primary"></i> --}}
                                                            <div class="flex-grow-1">
                                                                <h6 class="fw-bold mb-2">{{ $item->item_title }}</h6>
                                                                <div class="p-3 rounded">
                                                                    {!! $item->content !!}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                @endforeach
                                            </div>
                                        @endif
                                    </div>
                                @endforeach
                            </div>
                        @endif
                        <!-- ส่วนแสดงการรับรอง -->
                        @if(isset($approvalsBySection[$section->id]))
                            <div class="mt-4">
                                <h6 class="fw-bold mb-3">
                                    <i class="bx bx-check-circle me-1"></i>การรับรองและความคิดเห็น
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead class="bg-light">
                                            <tr>
                                                <th style="width: 25%">ผู้รับรอง</th>
                                                <th style="width: 15%">สถานะ</th>
                                                <th style="width: 40%">ความคิดเห็น</th>
                                                {{-- <th style="width: 20%">ดำเนินการ</th> --}}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach($approvalsBySection[$section->id] as $approval)
                                                <tr>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="avatar-xs me-2">
                                                                <span class="avatar-title rounded-circle bg-primary-subtle text-primary">
                                                                    {{ substr($approval['user']->first_name, 0, 1) }}
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <h6 class="mb-0">{{ $approval['user']->prefix_name }} {{ $approval['user']->first_name }}</h6>
                                                                <small class="text-muted">{{ $approval['user']->position->name ?? '' }}</small>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <select class="form-select form-select-sm approval-status"
                                                            name="approvals[{{ $section->id }}][{{ $approval['approval_id'] }}][type]"
                                                            data-approval-id="{{ $approval['approval_id'] }}"
                                                            data-section-id="{{ $section->id }}">
                                                            <option value="no_changes" {{ $approval['type'] == 'no_changes' ? 'selected' : '' }}>
                                                                รับรองโดยไม่มีแก้ไข
                                                            </option>
                                                            <option value="with_changes" {{ $approval['type'] == 'with_changes' ? 'selected' : '' }}>
                                                                รับรองโดยมีแก้ไข
                                                            </option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <textarea class="form-control form-control-sm approval-comment"
                                                            name="approvals[{{ $section->id }}][{{ $approval['approval_id'] }}][comments]"
                                                            rows="2"
                                                            style="{{ $approval['type'] == 'no_changes' ? 'display: none;' : '' }}"
                                                        >{{ $approval['comments'] }}</textarea>
                                                    </td>
                                                </tr>
                                            @endforeach
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        @endif
                    </div>
                </div>
            @endforeach
            <!-- Action Buttons -->
            <div class="d-flex justify-content-between">
                <a href="{{ route('meeting.report.summary.index') }}"
                    class="btn btn-secondary">
                    ยกเลิก
                </a>
                <button type="submit" class="btn btn-primary">
                    บันทึกการแก้ไข
                </button>
            </div>
        </form>
    </div>
</div>
<script>
$(document).ready(function() {
    $('.delete-approval').click(function() {
        const approvalId = $(this).data('approval-id');
        const sectionId = $(this).data('section-id');
        Swal.fire({
            title: 'ยืนยันการลบ?',
            text: "คุณต้องการลบการรับรองนี้ใช่หรือไม่?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'ใช่, ลบ',
            cancelButtonText: 'ยกเลิก'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: ''.replace(':id', approvalId),
                    type: 'DELETE',
                    data: {
                        _token: '{{ csrf_token() }}',
                        section_id: sectionId
                    },
                    success: function(response) {
                        Swal.fire(
                            'สำเร็จ!',
                            'ลบการรับรองเรียบร้อยแล้ว',
                            'success'
                        ).then(() => {
                            location.reload();
                        });
                    },
                    error: function(xhr) {
                        Swal.fire(
                            'Error!',
                            'เกิดข้อผิดพลาดในการลบข้อมูล',
                            'error'
                        );
                    }
                });
            }
        });
    });
});
</script>
@push('body-scripts')
    <script>
    $(document).ready(function() {
        $('.approval-status').on('change', function() {
            var approvalId = $(this).data('approval-id');
            var sectionId = $(this).data('section-id');
            var textarea = $(`textarea[name="approvals[${sectionId}][${approvalId}][comments]"]`);
            if ($(this).val() === 'with_changes') {
                textarea.show();
            } else {
                textarea.hide().val('');  // ซ่อนและล้างค่า textarea
            }
        });
        // เริ่มต้นซ่อน/แสดง textarea ตามค่าเริ่มต้น
        $('.approval-status').each(function() {
            $(this).trigger('change');
        });
    });
    </script>
@endpush
@endsection
{{-- @extends('admin.admin_dashboard')
@section('admin')
<div class="page-content">
    <div class="container-fluid">
        <!-- ส่วน header และข้อมูลการประชุมเดิม -->
        <!-- Admin Approval Section -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">การรับรองรายงานการประชุมโดย Admin</h5>
                <span class="badge bg-light text-dark">
                    สถานะ:
                    @if($meetingAgenda->is_admin_approved)
                        <span class="text-success">รับรองแล้ว</span>
                    @else
                        <span class="text-warning">รอการรับรอง</span>
                    @endif
                </span>
            </div>
            <div class="card-body">
                <form id="adminApprovalForm" action="" method="POST">
                    @csrf
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="form-label">บันทึกการรับรอง (ถ้ามี)</label>
                                <textarea
                                    name="admin_approval_note"
                                    class="form-control"
                                    rows="3"
                                    {{ $meetingAgenda->is_admin_approved ? 'readonly' : '' }}
                                >{{ $meetingAgenda->admin_approval_note }}</textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            @if($meetingAgenda->is_admin_approved)
                                <div class="text-muted">
                                    <small>
                                        รับรองเมื่อ: {{ $meetingAgenda->admin_approved_at->format('d/m/Y H:i') }}
                                        โดย: {{ optional($meetingAgenda->adminApprovedBy)->first_name }}
                                    </small>
                                </div>
                            @endif
                        </div>
                        <div class="col-md-6 text-end">
                            @if(!$meetingAgenda->is_admin_approved)
                                <button type="button" class="btn btn-success" onclick="confirmAdminApproval()">
                                    <i class="bx bx-check me-1"></i> รับรองรายงานการประชุม
                                </button>
                            @else
                                <button type="button" class="btn btn-warning" onclick="cancelAdminApproval()">
                                    <i class="bx bx-x me-1"></i> ยกเลิกการรับรอง
                                </button>
                            @endif
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- Original Edit Form Content -->
        <!-- ... โค้ดส่วนแก้ไขการรับรองและความคิดเห็นเดิม ... -->
    </div>
</div>
<script>
function confirmAdminApproval() {
    Swal.fire({
        title: 'ยืนยันการรับรอง?',
        text: "คุณต้องการรับรองรายงานการประชุมนี้ใช่หรือไม่?",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#28a745',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'ใช่, รับรอง',
        cancelButtonText: 'ยกเลิก'
    }).then((result) => {
        if (result.isConfirmed) {
            document.getElementById('adminApprovalForm').submit();
        }
    });
}
function cancelAdminApproval() {
    Swal.fire({
        title: 'ยืนยันการยกเลิกการรับรอง?',
        text: "คุณต้องการยกเลิกการรับรองรายงานการประชุมนี้ใช่หรือไม่?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'ใช่, ยกเลิกการรับรอง',
        cancelButtonText: 'ไม่'
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: '',
                type: 'POST',
                data: {
                    _token: '{{ csrf_token() }}'
                },
                success: function(response) {
                    Swal.fire(
                        'สำเร็จ!',
                        'ยกเลิกการรับรองเรียบร้อยแล้ว',
                        'success'
                    ).then(() => {
                        location.reload();
                    });
                },
                error: function(xhr) {
                    Swal.fire(
                        'Error!',
                        'เกิดข้อผิดพลาดในการยกเลิกการรับรอง',
                        'error'
                    );
                }
            });
        }
    });
}
</script>
@endsection --}}
</file>

<file path="resources/views/admin/body/header.blade.php">
<header>
    <div class="topbar d-flex align-items-center">
        <nav class="navbar navbar-expand gap-3">
            <div class="mobile-toggle-menu"><i class='bx bx-menu'></i>
            </div>
            <div class="d-flex justify-content-center align-items-center w-100">
                <div class="system-name text-center">
                    <h2 class="fw-bold mb-0" style="font-size: 1.2rem; letter-spacing: 0.8px;
                        background: linear-gradient(90deg,
                            #0300a5,
                            #042a8a,
                            #064719,
                            #0f6d2b,
                            #f3750e,
                            #ffa54d,
                            #ffdf9b,
                            #ffeda8,
                            #0300a5
                        );
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-size: 800% 100%;
                        animation: gradientFlow 25s linear infinite;">
                        SRU e-Meeting
                    </h2>
                    <div class="border-top border-1 border-gradient my-1"></div>
                    <style>
                        .border-gradient {
                            border-image: linear-gradient(to right,
                            border-image-slice: 1;
                        }
                        @keyframes gradientFlow {
                            0% { background-position: 100% 50% }
                            100% { background-position: -200% 50% }
                        }
                    </style>
                    <p class="text-secondary fw-semibold mb-0" style="font-size: 0.6rem; letter-spacing: 0.6px;">
                        SURATTHANI RAJABHAT UNIVERSITY
                    </p>
                </div>
            </div>
            {{-- <div class="position-relative search-bar d-lg-block d-none" data-bs-toggle="modal"
                data-bs-target="#SearchModal">
                <input class="form-control px-5" disabled type="search" placeholder="Search">
                <span class="position-absolute top-50 search-show ms-3 translate-middle-y start-0 top-50 fs-5"><i
                        class='bx bx-search'></i></span>
            </div> --}}
            <div class="top-menu ms-auto">
                <ul class="navbar-nav align-items-center gap-1">
                    {{-- <li class="nav-item mobile-search-icon d-flex d-lg-none" data-bs-toggle="modal"
                        data-bs-target="#SearchModal">
                        <a class="nav-link" href="avascript:;"><i class='bx bx-search'></i>
                        </a>
                    </li>
                    <li class="nav-item dropdown dropdown-laungauge d-none d-sm-flex">
                        <a class="nav-link dropdown-toggle dropdown-toggle-nocaret" href="avascript:;"
                            data-bs-toggle="dropdown"><img src="assets/images/county/02.png" width="22"
                                alt="">
                        </a>
                    </li> --}}
                    {{-- <li class="nav-item dark-mode d-none d-sm-flex">
                        <a class="nav-link dark-mode-icon" href="javascript:;"><i class='bx bx-moon'></i>
                        </a>
                    </li> --}}
                    {{-- <li class="nav-item dropdown dropdown-large">
                        <a class="nav-link dropdown-toggle dropdown-toggle-nocaret position-relative" href="#"
                            data-bs-toggle="dropdown"><span class="alert-count">7</span>
                            <i class='bx bx-bell'></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <a href="javascript:;">
                                <div class="msg-header">
                                    <p class="msg-header-title">Notifications</p>
                                    <p class="msg-header-badge">8 New</p>
                                </div>
                            </a>
                            <div class="header-notifications-list">
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="user-online">
                                            <img src="assets/images/avatars/avatar-1.png" class="msg-avatar"
                                                alt="user avatar">
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">Daisy Anderson<span class="msg-time float-end">5 sec
                                                    ago</span></h6>
                                            <p class="msg-info">The standard chunk of lorem</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="notify bg-light-danger text-danger">dc
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">New Orders <span class="msg-time float-end">2 min
                                                    ago</span></h6>
                                            <p class="msg-info">You have recived new orders</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="user-online">
                                            <img src="assets/images/avatars/avatar-2.png" class="msg-avatar"
                                                alt="user avatar">
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">Althea Cabardo <span class="msg-time float-end">14
                                                    sec ago</span></h6>
                                            <p class="msg-info">Many desktop publishing packages</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="notify bg-light-success text-success">
                                            <img src="assets/images/app/outlook.png" width="25" alt="user avatar">
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">Account Created<span class="msg-time float-end">28 min
                                                    ago</span></h6>
                                            <p class="msg-info">Successfully created new email</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="notify bg-light-info text-info">Ss
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">New Product Approved <span class="msg-time float-end">2
                                                    hrs ago</span></h6>
                                            <p class="msg-info">Your new product has approved</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="user-online">
                                            <img src="assets/images/avatars/avatar-4.png" class="msg-avatar"
                                                alt="user avatar">
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">Katherine Pechon <span class="msg-time float-end">15
                                                    min ago</span></h6>
                                            <p class="msg-info">Making this the first true generator</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="notify bg-light-success text-success"><i
                                                class='bx bx-check-square'></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">Your item is shipped <span
                                                    class="msg-time float-end">5 hrs
                                                    ago</span></h6>
                                            <p class="msg-info">Successfully shipped your item</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="notify bg-light-primary">
                                            <img src="assets/images/app/github.png" width="25" alt="user avatar">
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">New 24 authors<span class="msg-time float-end">1 day
                                                    ago</span></h6>
                                            <p class="msg-info">24 new authors joined last week</p>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center">
                                        <div class="user-online">
                                            <img src="assets/images/avatars/avatar-8.png" class="msg-avatar"
                                                alt="user avatar">
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="msg-name">Peter Costanzo <span class="msg-time float-end">6 hrs
                                                    ago</span></h6>
                                            <p class="msg-info">It was popularised in the 1960s</p>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <a href="javascript:;">
                                <div class="text-center msg-footer">
                                    <button class="btn btn-primary w-100">View All Notifications</button>
                                </div>
                            </a>
                        </div>
                    </li> --}}
                    {{-- <li class="nav-item dropdown dropdown-large">
                        <a class="nav-link dropdown-toggle dropdown-toggle-nocaret position-relative" href="#"
                            role="button" data-bs-toggle="dropdown" aria-expanded="false"> <span
                                class="alert-count">8</span>
                            <i class='bx bx-shopping-bag'></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <a href="javascript:;">
                                <div class="msg-header">
                                    <p class="msg-header-title">My Cart</p>
                                    <p class="msg-header-badge">10 Items</p>
                                </div>
                            </a>
                            <div class="header-message-list">
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/11.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/02.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/03.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/04.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/05.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/06.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/07.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/08.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="dropdown-item" href="javascript:;">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="position-relative">
                                            <div class="cart-product rounded-circle bg-light">
                                                <img src="assets/images/products/09.png" class=""
                                                    alt="product image">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="cart-product-title mb-0">Men White T-Shirt</h6>
                                            <p class="cart-product-price mb-0">1 X $29.00</p>
                                        </div>
                                        <div class="">
                                            <p class="cart-price mb-0">$250</p>
                                        </div>
                                        <div class="cart-product-cancel"><i class="bx bx-x"></i>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <a href="javascript:;">
                                <div class="text-center msg-footer">
                                    <div class="d-flex align-items-center justify-content-between mb-3">
                                        <h5 class="mb-0">Total</h5>
                                        <h5 class="mb-0 ms-auto">$489.00</h5>
                                    </div>
                                    <button class="btn btn-primary w-100">Checkout</button>
                                </div>
                            </a>
                        </div>
                    </li> --}}
                </ul>
            </div>
            @php
                $id = Auth::user()->id;
                $profileData = App\Models\User::find($id);
                $prefix = $profileData->prefixName;
            @endphp
            <div class="user-box dropdown px-3">
                <a class="d-flex align-items-center nav-link dropdown-toggle gap-3 dropdown-toggle-nocaret"
                    href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="{{ !empty($profileData->photo) ? url('uploads/admin_images/' . $profileData->photo) : url('uploads/no_image.jpg') }}"
                        class="user-img" alt="user avatar">
                    <div class="user-info">
                        <p class="user-name mb-0">{{ $prefix->title }}{{ $profileData->first_name }} {{ $profileData->last_name }}</p>
                        <p class="designattion mb-0">{{ $profileData->email }}</p>
                    </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    @if(!auth()->user()->hasRole(['Super Admin', 'Admin']))
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="{{ route('user.profile.edit') }}">
                            <i class="bx bx-user fs-5"></i>
                            <span>แก้ไขข้อมูลส่วนตัว</span>
                        </a>
                    </li>
                    <li>
                        <div class="dropdown-divider mb-0"></div>
                    </li>
                    @endif
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="{{ route('admin.logout') }}">
                            <i class="bx bx-log-out-circle"></i>
                            <span>ออกจากระบบ</span>
                        </a>
                    </li>
                    {{-- <li><a class="dropdown-item d-flex align-items-center" href=""><i
                                class="bx bx-user fs-5"></i><span>Profile</span></a>
                    </li>
                    <li><a class="dropdown-item d-flex align-items-center"
                            href=""><i class="bx bx-cog fs-5"></i><span>Change
                                Password </span></a>
                    </li>
                    <li><a class="dropdown-item d-flex align-items-center" href="javascript:;"><i
                                class="bx bx-home-circle fs-5"></i><span>Dashboard</span></a>
                    </li>
                    <li><a class="dropdown-item d-flex align-items-center" href="javascript:;"><i
                                class="bx bx-dollar-circle fs-5"></i><span>Earnings</span></a>
                    </li>
                    <li><a class="dropdown-item d-flex align-items-center" href="javascript:;"><i
                                class="bx bx-download fs-5"></i><span>Downloads</span></a>
                    </li>
                    <li>
                        <div class="dropdown-divider mb-0"></div>
                    </li> --}}
                    {{-- <li><a class="dropdown-item d-flex align-items-center" href="{{ route('admin.logout') }}"><i
                                class="bx bx-log-out-circle"></i><span>Logout</span></a>
                    </li> --}}
                </ul>
            </div>
        </nav>
    </div>
</header>
<script>
    @if(session('success'))
        Swal.fire({
            title: 'สำเร็จ!',
            text: "{{ session('success') }}",
            icon: 'success',
            confirmButtonText: 'ตกลง'
        });
    @endif
    @if(session('error'))
        Swal.fire({
            title: 'ขออภัย!',
            text: "{{ session('error') }}",
            icon: 'error',
            confirmButtonText: 'ตกลง'
        });
    @endif
</script>
<style>
    .dropdown-menu {
        min-width: 200px;
    }
    .dropdown-item {
        padding: 8px 16px;
    }
    .dropdown-item i {
        margin-right: 10px;
    }
    .dropdown-item:hover {
        background-color:
    }
    .dropdown-divider {
        margin: 4px 0;
    }
</style>
</file>

<file path="resources/views/auth/login.blade.php">
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ config('app.name') }} - เข้าสู่ระบบ</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    @vite(['resources/css/app.css', 'resources/js/app.js'])
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color:
        }
        .login-container {
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .left-section {
            flex: 1;
            background-color:
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 18rem;
            position: relative;
        }
        .right-section {
            flex: 1;
            background-color:
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem 2rem 10rem;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.1);
        }
        .login-box {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid
            border-radius: 0.375rem;
            margin-top: 0.5rem;
            font-size: 1rem;
        }
        .login-btn {
            width: 100%;
            background-color:
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 1rem;
        }
        .login-btn:hover {
            background-color:
        }
        .logo-section {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            border-radius: 1rem;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        .logo-img {
            width: 80px;
            height: auto;
            margin-bottom: 1rem;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 1;
        }
        .content-wrapper {
            position: relative;
            z-index: 2;
        }
        @media (max-width: 1024px) {
            .left-section {
                padding: 1.5rem;
            }
            .right-section {
                padding: 1.5rem;
            }
            .login-box {
                padding: 1.5rem;
            }
        }
        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
            }
            .left-section {
                min-height: 250px;
                padding: 1rem;
            }
            .right-section {
                box-shadow: none;
                padding: 1rem;
            }
            .logo-section {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            .logo-img {
                width: 60px;
            }
            h1 {
                font-size: 1.5rem !important;
            }
            h2 {
                font-size: 1.25rem !important;
            }
            p {
                font-size: 1rem !important;
            }
        }
        @media (max-width: 480px) {
            .left-section {
                min-height: 200px;
            }
            .login-box {
                padding: 1rem;
            }
            .form-input {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
            .login-btn {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
            footer {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <!-- Left Section - Image -->
        <div class="left-section" style="background-image: url('{{ asset('backend/assets/images/sru-president.jpg') }}'); background-size: cover; background-position: center;">
            <div class="logo-section" style="background-color: rgba(255, 255, 255, 0.7); padding: 3rem; border-radius: 1rem;">
                <div class="logo-bg" style="background-color: rgba(255, 255, 255, 0.8); border-radius: 50%; padding: 10px; display: inline-block;">
                    <img src="{{ asset('uploads/logo.png') }}" alt="SRU Logo" class="logo-img" style="display: block; margin: 0 auto;">
                </div>
                <h1 class="text-3xl mt-4 font-bold text-gray-900 mb-2">SRU e-Meeting</h1>
                <p class="text-lg text-gray-700">ระบบบริหารจัดการเอกสารประชุมออนไลน์</p>
            </div>
        </div>
        <!-- Right Section - Login Form -->
        <div class="right-section">
            <div class="login-box">
                <div class="logo-section bg-transparent">
                    <h2 class="text-3xl font-bold text-gray-900">เข้าสู่ระบบ</h2>
                    <p class="text-lg text-gray-600 mt-2">กรุณาเข้าสู่ระบบด้วยบัญชีของคุณ</p>
                </div>
                <!-- Session Status -->
                <x-auth-session-status class="mb-6" :status="session('status')" />
                <form method="POST" action="{{ route('login') }}">
                    @csrf
                    <!-- Email Address -->
                    <div class="form-group">
                        <x-input-label for="email" :value="__('อีเมล')" />
                        <x-text-input id="email"
                            class="form-input"
                            type="email"
                            name="email"
                            :value="old('email')"
                            required
                            autofocus
                            placeholder="อีเมลของคุณ"
                            autocomplete="username" />
                        <x-input-error :messages="$errors->get('email')" class="mt-2" />
                    </div>
                    <!-- Password -->
                    <div class="form-group">
                        <x-input-label for="password" :value="__('รหัสผ่าน')" />
                        <x-text-input id="password"
                            class="form-input"
                            type="password"
                            name="password"
                            required
                            placeholder="รหัสผ่าน"
                            autocomplete="current-password" />
                        <x-input-error :messages="$errors->get('password')" class="mt-2" />
                    </div>
                    <!-- Remember Me -->
                    <div class="form-group flex items-center">
                        <label class="inline-flex items-center">
                            <input type="checkbox"
                                class="rounded border-gray-300 text-emerald-600 shadow-sm focus:ring-emerald-500"
                                name="remember">
                            <span class="ms-2 text-sm text-gray-600">{{ __('จดจำการเข้าสู่ระบบ') }}</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="login-btn" onclick="this.classList.add('loading')">
                            <span class="button-text">{{ __('เข้าสู่ระบบ SRU e-Meeting') }}</span>
                            <span class="loading-spinner"></span>
                        </button>
                    </div>
                    <style>
                        .login-btn {
                            position: relative;
                            overflow: hidden;
                            transition: all 0.3s ease;
                        }
                        .login-btn.loading .button-text {
                            opacity: 0;
                        }
                        .login-btn.loading .loading-spinner {
                            opacity: 1;
                        }
                        .loading-spinner {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            width: 20px;
                            height: 20px;
                            border: 2px solid
                            border-top: 2px solid transparent;
                            border-radius: 50%;
                            opacity: 0;
                            transition: opacity 0.3s ease;
                            animation: spin 1s linear infinite;
                        }
                        @keyframes spin {
                            0% { transform: translate(-50%, -50%) rotate(0deg); }
                            100% { transform: translate(-50%, -50%) rotate(360deg); }
                        }
                    </style>
                </form>
                <hr style="border-top: 1px solid #ccc; border-bottom: 1px solid #666; margin: 1.5rem 0;">
                <footer class="text-center mt-8 text-md text-gray-600">
                    <p>&copy; พัฒนาโดย ศูนย์นวัตกรรมและเทคโนโลยีดิจิทัล IDTC {{ date('Y') }}.</p>
                    <p>All rights reserved. Version : 1.1</p>
                </footer>
            </div>
        </div>
    </div>
</body>
</html>
</file>

<file path="app/Http/Controllers/AdminController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\MeetingFormat;
use App\Models\MeetingType;
use App\Models\Position;
use App\Models\PrefixName;
use App\Models\User;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Spatie\Permission\Models\Role;
use Spatie\Permission\Models\Permission;
class AdminController extends Controller
{
    public function AdminDashboard() {
        $user = Auth::user();
        $user->load('meetingTypes','meetingFormat');
        $committeecategories = CommitteeCategory::all();
        return view('admin.index', compact('user', 'committeecategories'));
    }
    public function AllAdmin() {
        $alladmin = User::all();
        $committeecategories = CommitteeCategory::all();
        return view('admin.backend.pages.admin.all_admin', compact('alladmin', 'committeecategories'));
    }
    public function AddAdmin() {
        $roles = Role::all();
        $committeecategories = CommitteeCategory::all();
        $prefixnames = PrefixName::all();
        $positions = Position::all();
        $meeting_formats = MeetingFormat::all();
        $meeting_types = MeetingType::all();
        return view('admin.backend.pages.admin.add_admin', compact('roles', 'committeecategories', 'prefixnames', 'positions', 'meeting_formats', 'meeting_types'));
    }
    public function StoreAdmin(Request $request) {
        $checkEmail = User::where('email', $request->email)->first();
        if($checkEmail) {
            $notification = array(
                'message' => 'Email already exists',
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification);
        }
        $validatedData = $request->validate([
            'prefix_name' => 'required',
            'first_name' => 'required|string|max:255',
            'last_name' => 'required|string|max:255',
            'position_id' => 'required|exists:positions,id',
            'password' => 'required|min:3',
            'roles' => 'required|exists:roles,name',
            'meeting_format_id' => 'required|exists:meeting_formats,id',
            'meeting_types' => 'nullable|array',
            'meeting_types.*' => 'exists:meeting_types,id',
            'meeting_committees' => 'nullable|array',
            'meeting_committees.*' => 'array',
            'meeting_committees.*.*' => 'exists:committee_categories,id',
        ]);
        $user = User::create([
            'prefix_name_id' => $request->prefix_name,
            'first_name' => $request->first_name,
            'last_name' => $request->last_name,
            'username' => $request->first_name,
            'position_id' => $request->position_id,
            'meeting_format_id' => $request->meeting_format_id,
            'email' => $request->email,
            'password' => Hash::make($request->password),
            'role' => 'admin',
            'status' => 1,
        ]);
        if ($request->has('meeting_types')) {
            $user->meetingTypes()->attach($request->meeting_types);
        }
        if ($request->has('meeting_committees')) {
            foreach ($request->meeting_committees as $meeting_type_id => $committee_ids) {
                $user->meetingTypes()->attach($meeting_type_id, ['committee_ids' => json_encode($committee_ids)]);
            }
        }
        if($request->roles) {
            $user->assignRole($request->roles);
        }
        $notification = [
            'message' => 'เพิ่มผู้ใช้ใหม่สำเร็จ',
            'alert-type' => 'success'
        ];
        return redirect()->route('all.admin')->with($notification);
    }
    public function EditAdmin($id) {
        $user = User::findOrFail($id);
        $roles = Role::all();
        $committeecategories = CommitteeCategory::all();
        $prefixnames = PrefixName::all();
        $positions = Position::all();
        $meeting_formats = MeetingFormat::all();
        $meeting_types = MeetingType::all();
        return view('admin.backend.pages.admin.edit_admin', compact('user', 'roles', 'committeecategories', 'prefixnames', 'positions', 'meeting_formats', 'meeting_types'));
    }
    public function UpdateAdmin(Request $request, $id) {
        $user = User::findOrFail($id);
        $request->validate([
            'prefix_name' => 'required|exists:prefix_names,id',
            'first_name' => 'required|string|max:255',
            'last_name' => 'required|string|max:255',
            'position_id' => 'required|exists:positions,id',
            'email' => 'required|email|unique:users,email,'.$id,
            'password' => 'nullable|min:3',
            'roles' => 'required|exists:roles,name',
            'meeting_format_id' => 'required|exists:meeting_formats,id',
            'meeting_committees' => 'nullable|array',
            'meeting_committees.*' => 'array',
            'meeting_committees.*.*' => 'exists:committee_categories,id',
        ]);
        $user->update([
            'prefix_name_id' => $request->prefix_name,
            'first_name' => $request->first_name,
            'last_name' => $request->last_name,
            'username' => $request->first_name,
            'position_id' => $request->position_id,
            'meeting_format_id' => $request->meeting_format_id,
            'email' => $request->email,
            'role' => 'admin',
            'status' => 1,
        ]);
        if ($request->filled('password')) {
            $user->update(['password' => Hash::make($request->password)]);
        }
        $user->meetingTypes()->detach();
        if ($request->has('meeting_committees')) {
            foreach ($request->meeting_committees as $meeting_type_id => $committee_ids) {
                $user->meetingTypes()->attach($meeting_type_id, ['committee_ids' => json_encode($committee_ids)]);
            }
        }
        $user->syncRoles([$request->roles]);
        $notification = [
            'message' => 'ข้อมูลผู้ใช้ถูกอัปเดตเรียบร้อยแล้ว',
            'alert-type' => 'success'
        ];
        return redirect()->route('all.admin')->with($notification);
    }
    public function DeleteAdmin($id) {
        try {
            $user = User::findOrFail($id);
            if (Auth::id() == $user->id) {
                $notification = array(
                    'message' => 'คุณไม่สามารถลบบัญชีของตัวเองได้',
                    'alert-type' => 'error'
                );
                return redirect()->back()->with($notification);
            }
            $user->rolse()->detach();
            $user->committees()->detach();
            $user->meetingTypes()->detach();
            $user->delete();
            $notification = array(
                'message' => 'ลบบัญชีผู้ใช้เรียบร้อยแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->back()->with($notification);
        } catch (\Exception $e) {
            $notification = array(
                'message' => $e->getMessage(),
                'alert-type' => 'error'
            );
            return redirect()->back()->with($notification);
        }
    }
    public function AdminLogout(Request $request)
    {
        Auth::guard('web')->logout();
        $request->session()->invalidate();
        $request->session()->regenerateToken();
        $notification = array(
            'message' => 'Logout Successfully',
            'alert-type' => 'success'
        );
        return redirect('/user/login')->with($notification);
    }
    public function UserLogin() {
        return view('auth.login');
    }
}
</file>

<file path="app/Models/User.php">
<?php
namespace App\Models;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Illuminate\Support\Facades\Cache;
use Illuminate\Support\Facades\DB;
use Laravel\Sanctum\HasApiTokens;
use Spatie\Permission\Traits\HasRoles;
class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable, HasRoles;
    protected $guarded = [];
    public $guard_name = 'web';
    protected $hidden = [
        'password',
        'remember_token',
    ];
    protected $casts = [
        'email_verified_at' => 'datetime',
    ];
    public static function getPermissionGroups()
    {
        $permission_groups = DB::table('permissions')->select('group_name')->groupBy('group_name')->get();
        return $permission_groups;
    }
    public static function getPermissionsByGroupName($group_name)
    {
        $permissions = DB::table('permissions')->select('name', 'id')->where('group_name', $group_name)->get();
        return $permissions;
    }
    public static function roleHasPermissions($role, $permissions)
    {
        $hasPermission = true;
        foreach ($permissions as $permission) {
            if (!$role->hasPermissionTo($permission->name)) {
                $hasPermission = false;
                break;
            }
        }
        return $hasPermission;
    }
    public function committees()
    {
        return $this->belongsToMany(CommitteeCategory::class);
    }
    public function committeeCategories()
    {
        return $this->belongsToMany(CommitteeCategory::class, 'committee_category_user');
    }
    public function hasCommitteePermission($committeeCategoryId)
    {
        return $this->committeeCategories->contains('id', $committeeCategoryId);
    }
    public function meetingTypes()
    {
        return $this->belongsToMany(MeetingType::class)
            ->withPivot('committee_ids')
            ->withTimestamps();
    }
    public function position()
    {
        return $this->belongsTo(Position::class);
    }
    public function meetingFormat()
    {
        return $this->belongsTo(MeetingFormat::class);
    }
    public function prefixName()
    {
        return $this->belongsTo(PrefixName::class, 'prefix_name_id', 'id');
    }
    public function UserOnline()
    {
        return Cache::has('user-is-online' . $this->id);
    }
}
</file>

<file path="resources/views/admin/backend/pages/meeting_agenda/add_meeting_agenda.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">เพิ่มระเบียบวาระการประชุม</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">เพิ่มระเบียบวาระการประชุม</h5>
                <form id="myForm" action="{{ route('store.meeting.agenda') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <fieldset style="border: 1px solid #007bff; border-radius: 5px;" class="p-2">
                        <legend>ประเภทการประชุม</legend>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ประเภทการประชุม</label>
                            <select name="meeting_type_id" class="form-select mb-3" aria-label="Default select example">
                                <option selected="" disabled>เลือกประเภทการประชุม</option>
                                @foreach ($meeting_types as $item)
                                    <option value="{{ $item->id }}">{{ $item->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <legend>ประเภทคณะกรรมการ</legend>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ประเภทคณะกรรมการ</label>
                            <select name="committee_category_id" class="form-select mb-3"
                                aria-label="Default select example">
                                <option selected="" disabled>เลือกประเภทคณะกรรมการ</option>
                                @foreach ($committee_categories as $item)
                                    <option value="{{ $item->id }}">{{ $item->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <legend>รูปแบบการประชุม</legend>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">รูปแบบการประชุม</label>
                            <select name="meeting_format_id" class="form-select mb-3" aria-label="Default select example">
                                <option selected="" disabled>เลือกรูปแบบการประชุม</option>
                                @foreach ($meeting_format as $item)
                                    <option value="{{ $item->id }}">{{ $item->name }}</option>
                                @endforeach
                            </select>
                        </div>
                    </fieldset>
                    <div></div>
                    <fieldset style="border: 1px solid
                        <p class="mb-0 text-center text-secondary fst-italic">* ข้อบังคับ / ระเบียบ</p>
                        {{-- <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ข้อบังคับ</label>
                            <select name="rule_of_meeting_id" class="form-select mb-3" aria-label="Default select example">
                                <option selected="" disabled>เลือกกฎการประชุม</option>
                                @foreach ($rule_of_meetings as $item)
                                    <option value="{{ $item->id }}">{{ $item->title }}</option>
                                @endforeach
                            </select>
                        </div> --}}
                        {{-- <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ระเบียบ</label>
                            <select name="regulation_meeting_id" class="form-select mb-3"
                                aria-label="Default select example">
                                <option selected="" disabled>เลือกระเบียบการประชุม</option>
                                @foreach ($regulation_meetings as $item)
                                    <option value="{{ $item->id }}">{{ $item->regulation_title }}</option>
                                @endforeach
                            </select>
                        </div> --}}
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ระเบียบ*</label>
                            <select name="regulation_meeting_ids[]" class="form-select" data-placeholder="เลือกระเบียบการประชุม" id="regulation-meeting-multiple-field" multiple>
                                @foreach ($regulation_meetings as $item)
                                    <option value="{{ $item->id }}">{{ $item->regulation_title }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ข้อบังคับ*</label>
                            <select name="rule_of_meeting_ids[]" class="form-select" data-placeholder="เลือกกฎการประชุม" id="small-bootstrap-class-multiple-field" multiple>
                                @foreach ($rule_of_meetings as $item)
                                    <option value="{{ $item->id }}">{{ $item->title }}</option>
                                @endforeach
                            </select>
                        </div>
                    </fieldset>
                    {{-- เพิ่มวันที่ 3/12/2567 --}}
                    {{-- <fieldset style="border: 1px solid #007bff; border-radius: 5px;" class="p-2">
                        <legend>ตั้งค่าการแสดงผล</legend>
                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="show_committee_opinion" id="showCommitteeOpinion" checked>
                                <label class="form-check-label" for="showCommitteeOpinion">
                                    เปิดการแสดงผลการลงความเห็นของคณะกรรมการกลั่นกรอง
                                </label>
                            </div>
                            <small class="text-muted">
                                * หากปิดการแสดงผล ผู้เข้าร่วมประชุมจะไม่สามารถเห็นผลการลงความเห็นของคณะกรรมการกลั่นกรองได้
                            </small>
                        </div>
                    </fieldset> --}}
                    <fieldset style="border: 1px solid #007bff; border-radius: 5px;" class="p-2">
                        <legend>ตั้งค่าการแสดงผลความเห็นคณะกรรมการ</legend>
                        <div class="form-group mb-3">
                            <label for="committeeOpinionTitle" class="form-label">ข้อความหัวข้อ</label>
                            <input type="text"
                                class="form-control"
                                id="committeeOpinionTitle"
                                name="committee_opinion_title"
                                value="ความเห็นคณะกรรมการกลั่นกรอง"
                                required>
                            <small class="text-muted">
                                * กำหนดข้อความที่จะแสดงเป็นหัวข้อในส่วนของการลงความเห็น
                            </small>
                        </div>
                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="show_committee_opinion" id="showCommitteeOpinion" checked>
                                <label class="form-check-label" for="showCommitteeOpinion">
                                    เปิดการแสดงผลการลงความเห็นของคณะกรรมการกลั่นกรอง
                                </label>
                            </div>
                            <small class="text-muted">
                                * หากปิดการแสดงผล ผู้เข้าร่วมประชุมจะไม่สามารถเห็นผลการลงความเห็นของคณะกรรมการกลั่นกรองได้
                            </small>
                        </div>
                    </fieldset>
                    {{-- เพิ่มวันที่ 3/12/2567 --}}
                    <fieldset style="border: 1px solid #007bff; border-radius: 5px;" class="p-2">
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ชื่อระเบียบวาระการประชุม</label>
                            <input type="text" name="meeting_agenda_title" class="form-control" id="input1" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">เลขที่ระเบียบวาระการประชุม</label>
                            <input type="text" name="meeting_agenda_number" class="form-control" id="input1" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">ปีระเบียบวาระการประชุม</label>
                            <input type="text" name="meeting_agenda_year" class="form-control" id="input1" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">วันที่วาระการประชุม</label>
                            <input type="date" name="meeting_agenda_date" class="form-control" id="input1" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label">เวลาระเบียบวาระการประชุม</label>
                            <input type="time" name="meeting_agenda_time" class="form-control" id="input1" required>
                        </div>
                        <div class="form-group col-md-12">
                            <label for="input1" class="form-label">สถานที่ระเบียบวาระการประชุม</label>
                            <input type="text" name="meeting_location" class="form-control" id="input1" required>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="approval_deadline_date" class="form-label">วันที่สิ้นสุดการรับรอง</label>
                                <input type="date" name="approval_deadline_date"
                                    class="form-control @error('approval_deadline_date') is-invalid @enderror"
                                    value="{{ old('approval_deadline_date', isset($meeting_agenda) ? $meeting_agenda->approval_deadline?->format('Y-m-d') : '') }}"
                                    required>
                                @error('approval_deadline_date')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="approval_deadline_time" class="form-label">เวลาสิ้นสุดการรับรอง</label>
                                <input type="time" name="approval_deadline_time"
                                    class="form-control @error('approval_deadline_time') is-invalid @enderror"
                                    value="{{ old('approval_deadline_time', isset($meeting_agenda) ? $meeting_agenda->approval_deadline?->format('H:i') : '') }}"
                                    required>
                                @error('approval_deadline_time')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>
                        </div>
                        <div class="form-group col-md-12">
                            <label for="input1" class="form-label">รายละเอียดระเบียบวาระการประชุม</label>
                            <textarea name="description" class="form-control" rows="10"></textarea>
                        </div>
                    </fieldset>
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">บันทึก</button>
                            <a href="{{ route('all.meeting.agenda') }}" class="btn btn-danger px-4">ยกเลิก</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        CKEDITOR.replace('description');
    </script>
    <script>
        $(document).ready(function() {
            $('#regulation-meeting-multiple-field, #rule-of-meeting-multiple-field').select2({
                theme: "bootstrap-5",
                width: '100%',
                placeholder: $(this).data('placeholder'),
                allowClear: true
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#myForm').validate({
                rules: {
                    meeting_type_id: {
                        required: true,
                    },
                    committee_category_id: {
                        required: true,
                    },
                    meeting_format_id: {
                        required: true,
                    },
                    rule_of_meeting_id: {
                        required: true,
                    },
                    regulation_meeting_id: {
                        required: true,
                    },
                },
                messages: {
                    meeting_type_id: {
                        required: 'Please Enter Category Name',
                    },
                    committee_category_id: {
                        required: 'Please Enter Category Name',
                    },
                    meeting_format_id: {
                        required: 'Please Enter Category Name',
                    },
                    rule_of_meeting_id: {
                        required: 'Please Enter Category Name',
                    },
                    regulation_meeting_id: {
                        required: 'Please Enter Category Name',
                    },
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
            });
        });
    </script>
@endsection
</file>

<file path="app/Models/MeetingAgenda.php">
<?php
namespace App\Models;
use Carbon\Carbon;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
class MeetingAgenda extends Model
{
    use HasFactory;
    protected $guarded = [];
    protected $dates = [
        'meeting_agenda_date',
        'approval_deadline',
        'created_at',
        'updated_at',
        'admin_approved_at'
    ];
    public function setApprovalDeadlineAttribute($value)
    {
        if (is_string($value)) {
            $this->attributes['approval_deadline'] = Carbon::parse($value);
        } else {
            $this->attributes['approval_deadline'] = $value;
        }
    }
    public function getApprovalDeadlineFormattedAttribute()
    {
        return $this->approval_deadline ? $this->approval_deadline->format('d/m/Y H:i') : '-';
    }
    public function getRemainingTimeAttribute()
    {
        if (!$this->approval_deadline) {
            return null;
        }
        $now = Carbon::now();
        if ($now->gt($this->approval_deadline)) {
            return 'หมดเวลารับรอง';
        }
        return $now->diffForHumans($this->approval_deadline, [
            'parts' => 2,
            'join' => ' และ '
        ]);
    }
    public function getIsExpiredAttribute()
    {
        if (!$this->approval_deadline) {
            return false;
        }
        return Carbon::now()->gt($this->approval_deadline);
    }
    public function meeting_type()
    {
        return $this->belongsTo(MeetingType::class , 'meeting_type_id', 'id');
    }
    public function committeeCategory()
    {
        return $this->belongsTo(CommitteeCategory::class);
    }
    public function meetingFormat()
    {
        return $this->belongsTo(MeetingFormat::class , 'meeting_format_id', 'id');
    }
    public function ruleOfMeeting()
    {
        return $this->belongsToMany(RuleofMeeting::class, 'meeting_agenda_rule_of_meeting');
    }
    public function regulationMeeting()
    {
        return $this->belongsToMany(RegulationMeeting::class, 'meeting_agenda_regulation_meeting', 'meeting_agenda_id', 'regulation_meeting_id');
    }
    public function meetingAgendaSections()
    {
        return $this->hasMany(MeetingAgendaSection::class);
    }
    public function user()
    {
        return $this->belongsTo(User::class, 'user_id', 'id');
    }
    public function approvals()
    {
        return $this->hasMany(MeetingApproval::class);
    }
    public function sections()
    {
        return $this->hasMany(MeetingAgendaSection::class);
    }
    public function lectures()
    {
        return $this->hasMany(MeetingAgendaLecture::class);
    }
    public function items()
    {
        return $this->hasMany(MeetingAgendaItems::class);
    }
    public function adminApprovedBy()
    {
        return $this->belongsTo(User::class, 'admin_approved_by');
    }
    public function approvalHistories()
    {
        return $this->hasMany(MeetingApprovalHistory::class);
    }
    public function adminEdits()
    {
        return $this->hasMany(MeetingAdminEdit::class);
    }
    public function adminUser()
    {
        return $this->belongsTo(User::class, 'admin_user_id');
    }
    public function getApprovalsBySections()
    {
        $approvalsBySection = [];
        foreach ($this->sections as $section) {
            $approvals = $section->approvalDetails()
                ->with(['meetingApproval.user.position'])
                ->get()
                ->map(function($detail) {
                    return [
                        'user' => $detail->meetingApproval->user,
                        'type' => $detail->approval_type,
                        'comments' => $detail->comments,
                        'created_at' => $detail->created_at,
                        'approval_id' => $detail->meetingApproval->id
                    ];
                });
            if ($approvals->isNotEmpty()) {
                $approvalsBySection[$section->id] = $approvals;
            }
        }
        return $approvalsBySection;
    }
    public function getSectionSummaries()
    {
        return $this->sections->mapWithKeys(function($section) {
            return [$section->id => $section->getApprovalSummary()];
        });
    }
}
</file>

<file path="resources/views/admin/backend/pages/admin/add_admin.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i></a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Add User</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->
        <div class="card">
            <div class="card-body p-4">
                <h5 class="mb-4">Add User</h5>
                <form id="myForm" action="{{ route('store.admin') }}" method="post" class="row g-3"
                    enctype="multipart/form-data">
                    @csrf
                    <div class="form-group col-md-3">
                        <label for="input1" class="form-label"> คํานําหน้า</label>
                        <select name="prefix_name" class="form-select mb-3" required>
                            <option selected="" disabled>เลือกคํานําหน้า</option>
                            @foreach ($prefixnames as $prefixname)
                                <option value="{{ $prefixname->id }}">{{ $prefixname->title }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label"> ชื่อ</label>
                        <input type="text" name="first_name" class="form-control" id="input1" required>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="input1" class="form-label"> นามสกุล</label>
                        <input type="text" name="last_name" class="form-control" id="input1" required>
                    </div>
                    <div class="form-group col-md-7">
                        <label for="position_select" class="form-label">ตำแหน่ง</label>
                        <select name="position_id" class="form-select" id="position_select" data-placeholder="เลือกตำแหน่ง" required>
                            <option></option>
                            @foreach ($positions as $position)
                                <option value="{{ $position->id }}"
                                    {{ old('position_id') == $position->id ? 'selected' : '' }}>{{ $position->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">ประเภทการประชุมและคณะกรรมการ</legend>
                        @foreach ($meeting_types as $type)
                            <div class="mb-3">
                                <h6>{{ $type->name }}</h6>
                                <div class="ms-3">
                                    @foreach ($committeecategories as $committee)
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox"
                                                   name="meeting_committees[{{ $type->id }}][]"
                                                   value="{{ $committee->id }}"
                                                   id="committee_{{ $type->id }}_{{ $committee->id }}"
                                                   {{ (is_array(old('meeting_committees.'.$type->id)) && in_array($committee->id, old('meeting_committees.'.$type->id))) ? 'checked' : '' }}>
                                            <label class="form-check-label" for="committee_{{ $type->id }}_{{ $committee->id }}">
                                                {{ $committee->name }}
                                            </label>
                                        </div>
                                    @endforeach
                                </div>
                            </div>
                        @endforeach
                        @error('meeting_committees')
                            <div class="text-danger">{{ $message }}</div>
                        @enderror
                    </fieldset>
                    {{-- <div class="mb-3">
                        <label class="form-label">คณะกรรมการที่สภาฯ แต่งตั้ง</label>
                        <div style="column-count: 1;">
                            @foreach ($committeecategories as $committee)
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="committees[]"
                                        value="{{ $committee->id }}" id="committee_{{ $committee->id }}"
                                        {{ is_array(old('committees')) && in_array($committee->id, old('committees')) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="committee_{{ $committee->id }}">
                                        {{ $committee->name }}
                                    </label>
                                </div>
                            @endforeach
                        </div>
                        @error('committees')
                            <div class="text-danger">{{ $message }}</div>
                        @enderror
                    </div> --}}
                    {{-- <div class="mb-3">
                        <label class="form-label">ประเภทการประชุม</label>
                        @foreach ($meeting_types as $type)
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="meeting_types[]"
                                    value="{{ $type->id }}" id="meeting_type_{{ $type->id }}"
                                    {{ is_array(old('meeting_types')) && in_array($type->id, old('meeting_types')) ? 'checked' : '' }}>
                                <label class="form-check-label" for="meeting_type_{{ $type->id }}">
                                    {{ $type->name }}
                                </label>
                            </div>
                        @endforeach
                    </div>
                    @error('meeting_types')
                        <div class="text-danger">{{ $message }}</div>
                    @enderror --}}
                    {{-- <div class="form-group col-md-6">
                        <label for="input1" class="form-label"> User Name</label>
                        <input type="text" name="username" class="form-control" id="input1" required>
                    </div> --}}
                    {{-- <div class="form-group col-md-3">
                        <label for="input1" class="form-label"> โทร</label>
                        <input type="text" name="phone" class="form-control" id="input1" required>
                    </div> --}}
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">Credentials</legend>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label"> Email/Username</label>
                            <input type="email" name="email" class="form-control" id="input1" required>
                            <span class="text-danger" id="emailError"></span>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label"> Password</label>
                            <input type="password" name="password" class="form-control" id="input1" required>
                        </div>
                    </fieldset>
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">Role</legend>
                        <div class="form-group col-md-6">
                            <label for="input1" class="form-label"> Role Name</label>
                            <select name="roles" class="form-select mb-3" aria-label="Default select example" required>
                                <option selected="" disabled>Open this select menu</option>
                                @foreach ($roles as $role)
                                    <option value="{{ $role->name }}"> {{ $role->name }}</option>
                                @endforeach
                            </select>
                        </div>
                    </fieldset>
                    <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">รูปแบบการประชุม</legend>
                        <div class="mb-3">
                            <div class="d-flex flex-wrap">
                                @foreach ($meeting_formats as $key => $format)
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="radio" name="meeting_format_id"
                                            value="{{ $format->id }}" id="meeting_format_{{ $format->id }}"
                                            {{ $key == 0 ? 'checked' : (old('meeting_format_id') == $format->id ? 'checked' : '') }}>
                                        <label class="form-check-label" for="meeting_format_{{ $format->id }}">
                                            {{ $format->name }}
                                        </label>
                                    </div>
                                @endforeach
                            </div>
                            @error('meeting_format_id')
                                <div class="text-danger">{{ $message }}</div>
                            @enderror
                        </div>
                    </fieldset>
                    {{-- <fieldset class="border border-primary rounded p-2 mt-3">
                        <legend class="float-none w-auto">รูปแบบการประชุม</legend>
                        <div class="mb-3">
                            <div class="d-flex flex-wrap">
                                @foreach ($meeting_formats as $format)
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="checkbox" name="meeting_formats[]" value="{{ $format->id }}" id="meeting_format_{{ $format->id }}"
                                            {{ (is_array(old('meeting_formats')) && in_array($format->id, old('meeting_formats'))) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="meeting_format_{{ $format->id }}">
                                            {{ $format->name }}
                                        </label>
                                    </div>
                                @endforeach
                            </div>
                            @error('meeting_formats')
                                <div class="text-danger">{{ $message }}</div>
                            @enderror
                        </div>
                    </fieldset> --}}
                    {{-- @section('script')
                        <script>
                            $(document).ready(function() {
                                $('#myForm').submit(function(e) {
                                    e.preventDefault();
                                    var email = $('input[name=email]').val();
                                    $.ajax({
                                        url: "{{ route('check.email') }}",
                                        type: "POST",
                                        data: {
                                            "_token": "{{ csrf_token() }}",
                                            email: email
                                        },
                                        success: function(response) {
                                            if (response == 'unique') {
                                                $('#emailError').text('');
                                                $('
                                            } else {
                                                $('#emailError').text('Email already exists');
                                            }
                                        }
                                    });
                                });
                            });
                        </script>
                    @endsection --}}
                    <div class="col-md-12">
                        <div class="d-md-flex d-grid align-items-center gap-3">
                            <button type="submit" class="btn btn-primary px-4">Save Changes</button>
                            <a href="{{ route('all.admin') }}" class="btn btn-danger px-4">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#prefix_select').select2({
                theme: 'bootstrap-5',
                width: '100%',
                placeholder: $(this).data('placeholder'),
                allowClear: true
            });
            $('#position_select').select2({
                theme: 'bootstrap-5',
                width: '100%',
                placeholder: $(this).data('placeholder'),
                allowClear: true
            });
        });
    </script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_approval/meeting_approval_detail.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    @php
        use Carbon\Carbon;
        Carbon::setLocale('th');
        $meeting_date = Carbon::parse($my_meetings->meeting_date);
        $approval_date = Carbon::parse($my_meetings->approval_date);
        $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
        $thai_months = [
            1 => 'มกราคม',
            2 => 'กุมภาพันธ์',
            3 => 'มีนาคม',
            4 => 'เมษายน',
            5 => 'พฤษภาคม',
            6 => 'มิถุนายน',
            7 => 'กรกฎาคม',
            8 => 'สิงหาคม',
            9 => 'กันยายน',
            10 => 'ตุลาคม',
            11 => 'พฤศจิกายน',
            12 => 'ธันวาคม',
        ];
        $thai_date =
            'วัน' .
            $thai_days[$meeting_date->dayOfWeek] .
            'ที่ ' .
            $meeting_date->day .
            ' ' .
            $thai_months[$meeting_date->month] .
            ' พ.ศ. ' .
            ($meeting_date->year + 543);
        $thai_date_approval =
            'วัน' .
            $thai_days[$approval_date->dayOfWeek] .
            'ที่ ' .
            $approval_date->day .
            ' ' .
            $thai_months[$approval_date->month] .
            ' พ.ศ. ' .
            ($approval_date->year + 543);
    @endphp
    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="card shadow-sm mb-4">
                    <div class="card-body p-5">
                        <div class="text-center mb-5">
                            <h5 class="mb-3">{{ $my_meetings->meeting_agenda_title }}</h5>
                            <div class="p-1">
                                <h5 class="mb-1">การประชุมครั้งที่:
                                    {{ $my_meetings->meeting_agenda_number }} / {{ $my_meetings->meeting_agenda_year }}</h5>
                                <h5 class="mb-1">วันที่: {{ $thai_date }}</h5>
                                <h5 class="mb-0">สถานที่: {{ $my_meetings->meeting_location }}</h5>
                            </div>
                        </div>
                        <!-- แสดงรายการการรับรองที่มีอยู่ -->
                        {{-- @if ($approvals->isNotEmpty())
                        <h6 class="mb-3 text-danger">การรับรองที่มีอยู่:</h6>
                        <ul class="list-group mb-4">
                            @foreach ($approvals as $approval)
                                <li class="list-group-item bg-danger text-white">
                                    <strong>ผู้รับรอง:</strong> {{ $approval->user->first_name }}
                                    <strong>วันที่รับรอง:</strong> {{ $thai_date_approval }}
                                    <button class="btn btn-sm btn-danger float-end show-details" data-approval-id="{{ $approval->id }}">รายละเอียด</button>
                                </li>
                            @endforeach
                        </ul>
                    @endif --}}
                        @if ($approvals->isNotEmpty())
                            <h6 class="mb-3 text-danger">การรับรองที่มีอยู่:</h6>
                            <ul class="list-group mb-4">
                                @foreach ($approvals as $approval)
                                    <li
                                        class="list-group-item {{ $approval->user_id == Auth::id() ? 'bg-warning' : 'bg-danger' }} text-black">
                                        <strong>ผู้รับรอง:</strong> {{ $approval->user->prefixname->title }}{{ $approval->user->first_name }} {{ $approval->user->last_name }}
                                        <strong>วันที่รับรอง:</strong> {{ $thai_date_approval }}
                                        <button
                                            class="btn btn-sm btn-{{ $approval->user_id == Auth::id() ? 'warning' : 'danger' }} float-end show-details"
                                            data-approval-id="{{ $approval->id }}">รายละเอียด</button>
                                    </li>
                                @endforeach
                            </ul>
                        @endif
                        <!-- ฟอร์มสำหรับการรับรองใหม่ -->
                        <form id="meetingApprovalForm" action="{{ route('meeting.approval.store', $my_meetings->id) }}"
                            method="POST">
                            @csrf
                            <input type="hidden" name="meeting_agenda_id" value="{{ $my_meetings->id }}">
                            <input type="hidden" name="meeting_type_id" value="{{ $my_meetings->meeting_type_id }}">
                            <input type="hidden" name="user_id" value="{{ Auth::user()->id }}">
                            <input type="hidden" name="committee_category_id"
                                value="{{ $my_meetings->committee_category_id }}">
                            <input type="hidden" name="meeting_format_id" value="{{ $my_meetings->meeting_format_id }}">
                            <input type="hidden" name="rule_of_meeting_id" value="{{ $my_meetings->rule_of_meeting_id }}">
                            <input type="hidden" name="regulation_meeting_id"
                                value="{{ $my_meetings->regulation_meeting_id }}">
                            @php
                                $sections = App\Models\MeetingAgendaSection::where(
                                    'meeting_agenda_id',
                                    $my_meetings->id,
                                )
                                    ->orderBy('id', 'asc')
                                    ->get();
                            @endphp
                            @foreach ($sections as $index => $section)
                                <div class="mb-5">
                                    <div class="d-flex align-items-center mb-3 pb-2 border-bottom">
                                        <h5 class="mb-0">{{ $section->section_title }}</h5>
                                    </div>
                                    @php
                                        $hasContent = false;
                                        if ($section->description != null) {
                                            $hasContent = true;
                                        }
                                        $lectures = App\Models\MeetingAgendaLecture::where(
                                            'meeting_agenda_section_id',
                                            $section->id,
                                        )->get();
                                        $agendaItems = App\Models\MeetingAgendaItems::where(
                                            'meeting_agenda_section_id',
                                            $section->id,
                                        )
                                            ->orderBy('id', 'asc')
                                            ->get();
                                        if ($lectures->count() > 0 || $agendaItems->count() > 0) {
                                            $hasContent = true;
                                        }
                                    @endphp
                                    @if ($section->description != null)
                                        <div class="ms-4 mb-3">
                                            <p>{!! $section->description !!}</p>
                                        </div>
                                    @endif
                                    @foreach ($lectures as $lectureIndex => $lecture)
                                        <div class="ms-4 mb-3">
                                            <div class="ms-4 rounded">
                                                <h6 class="mb-2">{{ $lecture->lecture_title }}</h6>
                                                @if ($lecture->content)
                                                    <div style="margin-left: 2rem;" class="mb-2">{!! $lecture->content !!}</div>
                                                @endif
                                            </div>
                                            @php
                                                $lectureItems = $agendaItems->where(
                                                    'meeting_agenda_lecture_id',
                                                    $lecture->id,
                                                );
                                            @endphp
                                            @if ($lectureItems->count() > 0)
                                                <ul class="list-unstyled ms-4">
                                                    @foreach ($lectureItems as $itemIndex => $item)
                                                        <li class="mb-3">
                                                            <div class="ms-4 bg-light p-3 rounded">
                                                                <h6 class="mb-2">{{ $item->item_title }}</h6>
                                                                @if ($item->content)
                                                                    <div>{!! $item->content !!}</div>
                                                                @endif
                                                            </div>
                                                        </li>
                                                    @endforeach
                                                </ul>
                                            @endif
                                        </div>
                                    @endforeach
                                    @php
                                        $sectionItems = $agendaItems->whereNull('meeting_agenda_lecture_id');
                                    @endphp
                                    @if ($sectionItems->count() > 0)
                                        <ul class="list-unstyled ms-4">
                                            @foreach ($sectionItems as $itemIndex => $item)
                                                <li class="mb-3">
                                                    <div class="ms-4 bg-light p-3 rounded">
                                                        <h6 class="mb-2">
                                                            {{ $section->section_title }}.{{ $itemIndex + 1 }}
                                                            {{ $item->item_title }}</h6>
                                                        @if ($item->content)
                                                            <div>{!! $item->content !!}</div>
                                                        @endif
                                                    </div>
                                                </li>
                                            @endforeach
                                        </ul>
                                    @endif
                                    {{-- @if (!$hasContent)
                                            <p class="ms-4 text-muted fst-italic">ไม่มีรายการในวาระนี้</p>
                                        @else
                                            <div class="approval-section mt-3">
                                                <div class="mb-4 p-3 border border-danger rounded" style="width: 100%;">
                                                    <h6 class="mb-3">การรับรองรายงานการประชุม - {{ $section->section_title }}</h6>
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="radio" name="approvals[{{ $section->id }}][type]" id="noChanges_{{ $section->id }}" value="no_changes" checked>
                                                        <label class="form-check-label" for="noChanges_{{ $section->id }}">
                                                            รับรองโดยไม่มีข้อแก้ไข
                                                        </label>
                                                    </div>
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="radio" name="approvals[{{ $section->id }}][type]" id="withChanges_{{ $section->id }}" value="with_changes">
                                                        <label class="form-check-label" for="withChanges_{{ $section->id }}">
                                                            รับรองโดยมีข้อแก้ไข
                                                        </label>
                                                    </div>
                                                    <div id="commentsSection_{{ $section->id }}" class="mt-3" style="display: none;">
                                                        <textarea class="form-control" name="approvals[{{ $section->id }}][comments]" rows="4" placeholder="กรุณาระบุข้อแก้ไข"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        @endif
                                    </div>
                                    @endforeach --}}
                                    @if (!$hasContent)
                                        <p class="ms-4 text-muted fst-italic">ไม่มีรายการในวาระนี้</p>
                                    @else
                                        <div class="approval-section mt-3">
                                            <div class="mb-4 p-3 border border-danger rounded" style="width: 100%;">
                                                <h6 class="mb-3">การรับรองรายงานการประชุม - {{ $section->section_title }}
                                                </h6>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="radio"
                                                        name="approvals[{{ $section->id }}][type]"
                                                        id="noChanges_{{ $section->id }}" value="no_changes" checked>
                                                    <label class="form-check-label" for="noChanges_{{ $section->id }}">
                                                        รับรองโดยไม่มีข้อแก้ไข
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="radio"
                                                        name="approvals[{{ $section->id }}][type]"
                                                        id="withChanges_{{ $section->id }}" value="with_changes">
                                                    <label class="form-check-label" for="withChanges_{{ $section->id }}">
                                                        รับรองโดยมีข้อแก้ไข
                                                    </label>
                                                </div>
                                                <div id="commentsSection_{{ $section->id }}" class="mt-3"
                                                    style="display: none;">
                                                    <textarea class="form-control" name="approvals[{{ $section->id }}][comments]" rows="4"
                                                        placeholder="กรุณาระบุข้อแก้ไข"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    @endif
                            @endforeach
                            <div style="width: 100%;" class="p-3 border border-danger rounded">
                                @php
                                    $meeting_formats = App\Models\MeetingFormat::where(
                                        'id',
                                        $my_meetings->meeting_format_id,
                                    )->get();
                                @endphp
                                @if ($meeting_formats->count() > 0)
                                    <ul class="list-group list-group-flush">
                                        @foreach ($meeting_formats as $meeting_format)
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                <p class="mb-0"><strong>รูปแบบการประชุม:</strong>
                                                    {{ $meeting_format->name }}</p>
                                            </li>
                                        @endforeach
                                    </ul>
                                @else
                                    <p class="text-muted">ไม่มีข้อมูลรูปแบบการประชุม</p>
                                @endif
                                @php
                                    $regulations = App\Models\RegulationMeeting::where(
                                        'id',
                                        $my_meetings->regulation_meeting_id,
                                    )->get();
                                @endphp
                                @if ($regulations->count() > 0)
                                    <ul class="list-group list-group-flush">
                                        @foreach ($regulations as $regulation)
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                <p class="mb-0"><strong>ระเบียบ:</strong>{{ $regulation->regulation_title }} <a
                                                        href="javascript:;" data-bs-toggle="modal"
                                                        data-bs-target="#regulationPdfModal_{{ $regulation->id }}"
                                                        ><span class="badge rounded-pill bg-info text-dark">ดูรายละเอียด</span></a>
                                                </p>
                                            </li>
                                            <!-- Modal สำหรับแสดงรายละเอียดระเบียบ -->
                                            <div class="modal fade" id="regulationPdfModal_{{ $regulation->id }}"
                                                tabindex="-1" aria-labelledby="regulationPdfModalLabel_{{ $regulation->id }}"
                                                aria-hidden="true">
                                                <div class="modal-dialog modal-lg">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title"
                                                                id="regulationPdfModalLabel_{{ $regulation->id }}">ระเบียบ:
                                                                {{ $regulation->regulation_title }}</h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <embed src="{{ asset($regulation->regulation_pdf) }}"
                                                                type="application/pdf" width="100%" height="600px" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        @endforeach
                                    </ul>
                                @else
                                    <p class="text-muted">ไม่มีข้อมูลระเบียบ</p>
                                @endif
                            </div>
                            <div style="margin-top: 2rem;">
                                <hr>
                            </div>
                            <div class="mt-4">
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-success"><i
                                            class="bx bx-check-circle me-2"></i>บันทึกการรับรอง</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal สำหรับแสดงรายละเอียดการรับรอง -->
    <div class="modal fade" id="approvalDetailsModal" tabindex="-1" aria-labelledby="approvalDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="approvalDetailsModalLabel">รายละเอียดการรับรอง</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="approvalDetailsContent">
                    <!-- รายละเอียดการรับรองจะถูกใส่ที่นี่ด้วย JavaScript -->
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $('input[name^="approvals"][name$="[type]"]').change(function() {
                var sectionId = $(this).attr('name').match(/\d+/)[0];
                if ($(this).val() === 'with_changes') {
                    $('#commentsSection_' + sectionId).show();
                } else {
                    $('#commentsSection_' + sectionId).hide();
                }
            });
            $('#meetingApprovalForm').submit(function(e) {
                e.preventDefault();
                var formData = $(this).serialize();
                $.ajax({
                    url: $(this).attr('action'),
                    method: 'POST',
                    data: formData,
                    success: function(response) {
                        alert(response.message);
                        location.reload();
                    },
                    error: function(xhr) {
                        alert('เกิดข้อผิดพลาดในการบันทึกข้อมูล');
                        console.error(xhr.responseText);
                    }
                });
            });
            $('.show-details').click(function() {
                var approvalId = $(this).data('approval-id');
                $.ajax({
                    url: '/meeting-approval-details/' + approvalId,
                    method: 'GET',
                    success: function(response) {
                        $('#approvalDetailsContent').html(response);
                        $('#approvalDetailsModal').modal('show');
                    },
                    error: function(xhr) {
                        alert('เกิดข้อผิดพลาดในการโหลดข้อมูล');
                        console.error(xhr.responseText);
                    }
                });
            });
        });
    </script>
@endsection
@push('styles')
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            line-height: 1.6;
            background-color:
        }
        h5 {
            font-size: 1.25rem;
            font-weight: 700;
            color:
        }
        h6 {
            font-size: 1rem;
            font-weight: 600;
            color:
        }
        p {
            font-size: 0.9rem;
            font-weight: 400;
            color:
        }
        strong {
            font-weight: 500;
        }
        .card {
            border: none;
            border-radius: 15px;
        }
        .card-body {
            background-color:
        }
        .border-primary {
            border-color:
        }
        .text-primary {
            color:
        }
        .bg-light {
            background-color:
        }
    </style>
@endpush
</file>

<file path="resources/views/admin/backend/pages/meeting_section_detail/section_agenda_item_detail.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <style>
        .accessibility-controls {
            position: fixed;
            top: 90px;
            right: 20px;
            background:
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            cursor: move;
            user-select: none;
        }
        .font-size-btn {
            padding: 5px 10px;
            margin: 0 2px;
            border: 1px solid
            border-radius: 3px;
            background:
            cursor: pointer;
        }
        .font-size-btn:hover {
            background:
        }
    </style>
    @php
        use Carbon\Carbon;
        Carbon::setLocale('th');
        $meeting_date = Carbon::parse($meetingAgenda->meeting_agenda_date);
        $thai_days = ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'];
        $thai_months = [
            1 => 'มกราคม',
            2 => 'กุมภาพันธ์',
            3 => 'มีนาคม',
            4 => 'เมษายน',
            5 => 'พฤษภาคม',
            6 => 'มิถุนายน',
            7 => 'กรกฎาคม',
            8 => 'สิงหาคม',
            9 => 'กันยายน',
            10 => 'ตุลาคม',
            11 => 'พฤศจิกายน',
            12 => 'ธันวาคม',
        ];
        $thai_day = $thai_days[$meeting_date->dayOfWeek];
        $thai_month = $thai_months[$meeting_date->month];
        $thai_date =
            "วัน{$thai_day}ที่ " . $meeting_date->day . ' ' . $thai_month . ' พ.ศ. ' . ($meeting_date->year + 543);
    @endphp
    <style>
        .document-style {
            background-color: white;
            padding: 40px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            font-family: 'Times New Roman', Times, serif;
            font-size: 16px;
            line-height: 1.6;
        }
        .document-title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }
        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        .item-list {
            list-style-type: none;
            padding-left: 20px;
        }
        .item-list li {
            margin-bottom: 10px;
        }
        .ck-content table {
            border-collapse: collapse;
            margin: 15px 0;
            width: 100%;
        }
        .ck-content table td,
        .ck-content table th {
            border: 1px solid
            padding: 8px;
        }
        .ck-content table th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color:
        }
        @media screen and (max-width: 600px) {
            .ck-content table {
                overflow-x: auto;
                display: block;
            }
        }
    </style>
    <div class="page-content">
        <!-- Add Accessibility Controls -->
        <div class="accessibility-controls" id="accessibilityControls">
            <div style="margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px solid #eee; cursor: move;"
                class="drag-handle">
                <i class="fas fa-grip-horizontal"></i>
            </div>
            <button class="font-size-btn" onclick="changeFontSize('decrease')" title="ลดขนาดตัวอักษร">
                <i class="fas fa-minus"></i> ก
            </button>
            <button class="font-size-btn" onclick="changeFontSize('reset')" title="คืนค่าขนาดตัวอักษร">
                <i class="fas fa-sync-alt"></i> ก
            </button>
            <button class="font-size-btn" onclick="changeFontSize('increase')" title="เพิ่มขนาดตัวอักษร">
                <i class="fas fa-plus"></i> ก
            </button>
        </div>
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card">
                        <div
                            class="text-center alert border-0 border-start border-5 border-primary alert-dismissible fade show py-2">
                            <ul class="nav nav-tabs card-header-tabs justify-content-center">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#committee" data-bs-toggle="tab">
                                        <i class="fas fa-users me-2"></i>หมวด :
                                        {{ $meetingAgenda->committeeCategory->name ?? 'ไม่ระบุ' }}
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body document-style">
                            <div class="d-flex justify-content-end mb-3">
                                <a class="btn btn-sm btn-primary"
                                    href="{{ route('meeting.export.word', ['id' => $meetingAgenda->id]) }}">
                                    <i class="fas fa-file-word me-1 d-none d-sm-inline"></i>
                                    <span class="d-inline d-sm-none"><i class="fas fa-file-word"></i></span>
                                    <span class="d-none d-sm-inline">ส่งออกเป็นเอกสาร Word</span>
                                </a>
                            </div>
                            @if (isset($meetingAgenda))
                                <div class="agenda-info text-center">
                                    <p><strong> {{ $meetingAgenda->meeting_agenda_title }}</strong></p>
                                    <p><strong>ครั้งที่:
                                            {{ $meetingAgenda->meeting_agenda_number }}/{{ $meetingAgenda->meeting_agenda_year }}</strong>
                                    </p>
                                    <p><strong>{{ $thai_date }} เวลา {{ $meetingAgenda->meeting_agenda_time }}น.</strong>
                                    </p>
                                    <p><strong>{{ $meetingAgenda->meeting_location }}</strong></p>
                                    {{-- <p><strong>วันที่:</strong> {{ $meetingAgenda->meeting_agenda_date>format('d/m/Y') }}</p> --}}
                                    {{-- @if ($meetingAgenda->description)
                                    <p><strong>รายละเอียด:</strong> {{ $meetingAgenda->description }}</p>
                                @endif --}}
                                </div>
                            @endif
                            <hr>
                            <div class="section-title">{{ $meetingAgendaSection->section_title }}</div>
                            @if ($meetingAgendaSection->description)
                                <div class="section-content ck-content mb-4">{!! $meetingAgendaSection->description !!}</div>
                            @endif
                            @if ($meetingAgendaLectures && $meetingAgendaLectures->count() > 0)
                                @foreach ($meetingAgendaLectures as $lecture)
                                    <div class="lecture-block mb-4">
                                        <!-- หัวข้อ Lecture -->
                                        <div class="lecture-title"><strong>{{ $lecture->lecture_title }}</strong></div>
                                        @if ($lecture->content)
                                            <div style="margin-left: 2rem;" class="lecture-content ck-content">
                                                {!! $lecture->content !!}
                                            </div>
                                        @endif
                                        {{--  ส่วนที่เพิ่มใน section_agenda_item_detail.blade.php หลังส่วนเนื้อหาหลัก --}}
                                        {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
                                        {{-- <div class="card mt-4">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0">ความเห็นคณะกรรมการกลั่นกรอง</h5>
                                            </div>
                                            <div class="card-body">
                                                <!-- ฟอร์มสำหรับเพิ่มความเห็น -->
                                                <form action="{{ route('committee.feedback.store') }}" method="POST"
                                                    class="committee-feedback-form mb-4">
                                                    @csrf
                                                    <input type="hidden" name="lecture_id" value="{{ $lecture->id }}">
                                                    <div class="form-group">
                                                        <label class="d-block">การพิจารณา:</label>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input feedback-status-radio"
                                                                type="radio" name="feedback_status"
                                                                id="status_approve_{{ $lecture->id }}" value="approve"
                                                                required>
                                                            <label class="form-check-label"
                                                                for="status_approve_{{ $lecture->id }}">
                                                                เห็นชอบ
                                                            </label>
                                                        </div>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input feedback-status-radio"
                                                                type="radio" name="feedback_status"
                                                                id="status_reject_{{ $lecture->id }}" value="reject">
                                                            <label class="form-check-label"
                                                                for="status_reject_{{ $lecture->id }}">
                                                                ไม่เห็นชอบ
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div id="feedback_content_section_{{ $lecture->id }}"
                                                        class="form-group mt-3" style="display: none;">
                                                        <label for="feedback_content_{{ $lecture->id }}">ความเห็น:</label>
                                                        <textarea class="form-control" id="feedback_content_{{ $lecture->id }}" name="feedback_content" rows="3"></textarea>
                                                    </div>
                                                    <button type="submit"
                                                        class="btn btn-primary mt-3">บันทึกความเห็น</button>
                                                </form>
                                                <!-- ส่วนแสดงความเห็นที่มีอยู่ -->
                                                <div class="existing-feedback">
                                                    <h6 class="border-bottom pb-2">ความเห็นที่ผ่านมา</h6>
                                                    @if (isset($committeeFeedbacks) && count($committeeFeedbacks) > 0)
                                                        @foreach ($committeeFeedbacks as $feedback)
                                                            <div class="feedback-item card mb-3">
                                                                <div class="card-body">
                                                                    <div
                                                                        class="d-flex justify-content-between align-items-center">
                                                                        <h6 class="card-subtitle mb-2 text-muted">
                                                                            {{ $feedback->user->name }}
                                                                            <small class="text-muted">
                                                                                ({{ Carbon\Carbon::parse($feedback->created_at)->format('d/m/Y H:i') }})
                                                                            </small>
                                                                        </h6>
                                                                        <span
                                                                            class="badge {{ $feedback->vote_type === 'approve' ? 'bg-success' : 'bg-danger' }}">
                                                                            {{ $feedback->vote_type === 'approve' ? 'เห็นชอบ' : 'ไม่เห็นชอบ' }}
                                                                        </span>
                                                                    </div>
                                                                    @if ($feedback->opinion)
                                                                        <p class="card-text mt-2">{{ $feedback->opinion }}
                                                                        </p>
                                                                    @endif
                                                                </div>
                                                            </div>
                                                        @endforeach
                                                    @else
                                                        <p class="text-muted">ยังไม่มีความเห็นจากคณะกรรมการ</p>
                                                    @endif
                                                </div>
                                            </div>
                                        </div> --}}
                                        {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
                                        <!-- ส่วนความเห็นคณะกรรมการกลั่นกรอง -->
                                        {{-- <div class="committee-review card mt-3 ms-4">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0">ความเห็นคณะกรรมการกลั่นกรอง</h6>
                                            </div>
                                            <div class="card-body">
                                                <form class="committee-form" data-lecture-id="{{ $lecture->id }}" method="POST">
                                                    @csrf
                                                    <div class="border p-3 rounded mb-3">
                                                        <!-- ความเห็นทั่วไป -->
                                                        <div class="mb-4">
                                                            <label class="form-label fw-bold">ความเห็นคณะกรรมการ:</label>
                                                            <textarea name="committee_opinion" class="form-control" rows="3" placeholder="ระบุความเห็นของคณะกรรมการ">{{ $lecture->committee_opinion }}</textarea>
                                                        </div>
                                                        <!-- การลงความเห็น -->
                                                        <div class="mb-3">
                                                            <label class="form-label fw-bold">ลงความเห็น:</label>
                                                            <div class="opinion-options">
                                                                <!-- เห็นชอบ -->
                                                                <div class="form-check mb-3">
                                                                    <input class="form-check-input" type="radio" name="opinion_type_{{ $lecture->id }}" id="approve_{{ $lecture->id }}" value="approve" {{ $lecture->approve_votes > 0 ? 'checked' : '' }}>
                                                                    <label class="form-check-label" for="approve_{{ $lecture->id }}">
                                                                        <span class="badge bg-success me-2">1</span>เห็นชอบ
                                                                    </label>
                                                                    <div class="ms-4 mt-2 approve-section {{ $lecture->approve_votes > 0 ? '' : 'd-none' }}">
                                                                        <textarea name="approve_comment" class="form-control mb-2" rows="2" placeholder="ระบุความเห็น (ถ้ามี)">{{ $lecture->approve_comment }}</textarea>
                                                                        <div class="input-group" style="width: 200px;">
                                                                            <input type="number" name="approve_votes" class="form-control" placeholder="จำนวนเสียง" value="{{ $lecture->approve_votes }}">
                                                                            <span class="input-group-text">เสียง</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- ไม่เห็นชอบ -->
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio" name="opinion_type_{{ $lecture->id }}" id="disapprove_{{ $lecture->id }}" value="disapprove" {{ $lecture->disapprove_votes > 0 ? 'checked' : '' }}>
                                                                    <label class="form-check-label" for="disapprove_{{ $lecture->id }}">
                                                                        <span class="badge bg-danger me-2">2</span>ไม่เห็นชอบ
                                                                    </label>
                                                                    <div class="ms-4 mt-2 disapprove-section {{ $lecture->disapprove_votes > 0 ? '' : 'd-none' }}">
                                                                        <textarea name="disapprove_comment" class="form-control mb-2" rows="2" placeholder="ระบุความเห็น (ถ้ามี)">{{ $lecture->disapprove_comment }}</textarea>
                                                                        <div class="input-group" style="width: 200px;">
                                                                            <input type="number" name="disapprove_votes" class="form-control" placeholder="จำนวนเสียง" value="{{ $lecture->disapprove_votes }}">
                                                                            <span class="input-group-text">เสียง</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- ปุ่มบันทึก -->
                                                        <div class="text-end mt-4">
                                                            <button type="submit" class="btn btn-primary btn-save-opinion">บันทึกความเห็น</button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div> --}}
                                        <!-- แสดง Items ที่เกี่ยวข้อง -->
                                        @php
                                            $lectureItems = $meetingAgendaItems->where(
                                                'meeting_agenda_lecture_id',
                                                $lecture->id,
                                            );
                                        @endphp
                                        @if ($lectureItems->count() > 0)
                                            <ul class="item-list">
                                                @foreach ($lectureItems as $item)
                                                    <li>
                                                        @if ($item->item_title)
                                                            <div class="item-title">{{ $item->item_title }}</div>
                                                        @endif
                                                        @if ($item->content)
                                                            <div style="margin-left: 2rem;" class="item-content ck-content">
                                                                {!! $item->content !!}
                                                            </div>
                                                        @endif
                                                    </li>
                                                @endforeach
                                            </ul>
                                        @endif
                                    </div>
                                @endforeach
                            @endif
                            {{-- Original Source Code --}}
                            @if ($meetingAgendaLectures && $meetingAgendaLectures->count() > 0)
                                @foreach ($meetingAgendaLectures as $lecture)
                                    <div class="lecture-title"><strong>{{ $lecture->lecture_title }}</strong></div>
                                    @if ($lecture->content)
                                        <div style="margin-left: 2rem;" class="lecture-content ck-content">
                                            {!! $lecture->content !!}</div>
                                    @endif
                                    @php
                                        $lectureItems = $meetingAgendaItems->where(
                                            'meeting_agenda_lecture_id',
                                            $lecture->id,
                                        );
                                    @endphp
                                    @if ($lectureItems->count() > 0)
                                        <ul class="item-list">
                                            @foreach ($lectureItems as $item)
                                                <li>
                                                    @if ($item->item_title)
                                                        <div class="item-title">{{ $item->item_title }}</div>
                                                    @endif
                                                    @if ($item->content)
                                                        <div style="margin-left: 2rem;" class="item-content ck-content">
                                                            {!! $item->content !!}</div>
                                                    @endif
                                                </li>
                                            @endforeach
                                        </ul>
                                    @endif
                                @endforeach
                            @endif
                            @php
                                $itemsWithoutLecture = $meetingAgendaItems->whereNull('meeting_agenda_lecture_id');
                            @endphp
                            @if ($itemsWithoutLecture->count() > 0)
                                <ul class="item-list">
                                    @foreach ($itemsWithoutLecture as $item)
                                        <li>
                                            @if ($item->item_title)
                                                <div class="item-title">{{ $item->item_title }}</div>
                                            @endif
                                            @if ($item->content)
                                                <div style="margin-left: 2rem;" class="item-content ck-content">
                                                    {!! $item->content !!}</div>
                                            @endif
                                        </li>
                                    @endforeach
                                </ul>
                            @endif
                            @if (!$meetingAgendaSection->description && $meetingAgendaLectures->count() == 0 && $meetingAgendaItems->count() == 0)
                                <p>-ไม่พบรายการ-</p>
                            @endif
                            <!-- แสดงรายการเอกสารที่เกี่ยวข้อง -->
                            <!-- สิ้นสุดการแสดงรายการเอกสารที่เกี่ยวข้อง -->
                            <br>
                            <div style="width: 100%;" class="p-3 border border-danger rounded mb-4">
                                <p class="mb-0 text-center text-secondary fst-italic">*
                                    ท่านสามารถดูรายละเอียดเอกสารที่เกี่ยวกับการประชุม</p>
                                @php
                                    $my_meetings = App\Models\MeetingAgenda::where('status', 1)->get();
                                @endphp
                                @if ($my_meetings->count() > 0)
                                    <div class="d-flex flex-column">
                                        @php
                                            $meeting_formats = App\Models\MeetingFormat::where(
                                                'id',
                                                $meetingAgendaSection->meetingAgenda->meeting_format_id
                                            )->get();
                                        @endphp
                                        @if ($meeting_formats->count() > 0)
                                            <ul class="list-group list-group-flush">
                                                @foreach ($meeting_formats as $meeting_format)
                                                    <li
                                                        class="list-group-item d-flex justify-content-between align-items-center">
                                                        <p class="mb-0"><strong>รูปแบบการประชุม:</strong>
                                                            {{ $meeting_format->name }}</p>
                                                    </li>
                                                @endforeach
                                            </ul>
                                        @endif
                                        @php
                                            $regulations = App\Models\RegulationMeeting::where(
                                                'id',
                                                $my_meetings->first()->regulation_meeting_id,
                                            )->get();
                                        @endphp
                                        @if ($regulations->count() > 0)
                                            <ul class="list-group list-group-flush">
                                                @foreach ($regulations as $regulation)
                                                    <li
                                                        class="list-group-item d-flex justify-content-between align-items-center">
                                                        <p class="mb-0"><strong>*ระเบียบ:</strong>
                                                            {{ $regulation->regulation_title }}<a href="#"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#regulationModal{{ $regulation->id }}"><span
                                                                    class="badge rounded-pill bg-info text-dark">ดูรายละเอียด</span></a>
                                                        </p>
                                                        <!-- Modal สำหรับแสดงรายละเอียดระเบียบ -->
                                                        <div class="modal fade" id="regulationModal{{ $regulation->id }}"
                                                            tabindex="-1" aria-labelledby="regulationModalLabel"
                                                            aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="regulationModalLabel">
                                                                            ระเบียบ</h5>
                                                                        <button type="button" class="btn-close"
                                                                            data-bs-dismiss="modal"
                                                                            aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <embed
                                                                            src="{{ asset($regulation->regulation_pdf) }}"
                                                                            width="100%" height="600"
                                                                            type="application/pdf">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                @endforeach
                                            </ul>
                                        @endif
                                        @php
                                            $meetingAgendaId = $meetingAgenda->id;
                                            $ruleofmeetings = App\Models\RuleofMeeting::whereHas(
                                                'meetingAgendas',
                                                function ($query) use ($meetingAgendaId) {
                                                    $query->where('meeting_agenda_id', $meetingAgendaId);
                                                },
                                            )->get();
                                        @endphp
                                        @if ($ruleofmeetings->count() > 0)
                                            <ul class="list-group list-group-flush">
                                                @foreach ($ruleofmeetings as $ruleofmeet)
                                                    <li
                                                        class="list-group-item d-flex justify-content-between align-items-center">
                                                        <p class="mb-0">
                                                            <strong>*ข้อบังคับ:</strong> {{ $ruleofmeet->title }}
                                                            @if ($ruleofmeet->pdf)
                                                                <a href="#" data-bs-toggle="modal"
                                                                    data-bs-target="#ruleofmeet_{{ $ruleofmeet->id }}">
                                                                    <span
                                                                        class="badge rounded-pill bg-info text-dark">ดูรายละเอียด</span>
                                                                </a>
                                                            @endif
                                                        </p>
                                                    </li>
                                                    @if ($ruleofmeet->pdf)
                                                        <!-- Modal สำหรับแสดงรายละเอียดข้อบังคับ -->
                                                        <div class="modal fade" id="ruleofmeet_{{ $ruleofmeet->id }}"
                                                            tabindex="-1"
                                                            aria-labelledby="ruleofmeet_{{ $ruleofmeet->id }}Label"
                                                            aria-hidden="true">
                                                            <div class="modal-dialog modal-lg">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title"
                                                                            id="ruleofmeet_{{ $ruleofmeet->id }}Label">
                                                                            ข้อบังคับ: {{ $ruleofmeet->title }}</h5>
                                                                        <button type="button" class="btn-close"
                                                                            data-bs-dismiss="modal"
                                                                            aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <object data="{{ asset($ruleofmeet->pdf) }}"
                                                                            type="application/pdf" width="100%"
                                                                            height="600px">
                                                                            <p>ไม่สามารถแสดง PDF ได้</p>
                                                                        </object>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    @endif
                                                @endforeach
                                            </ul>
                                        @endif
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const controls = document.getElementById('accessibilityControls');
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;
            const savedPosition = localStorage.getItem('accessibilityControlsPosition');
            if (savedPosition) {
                const {
                    x,
                    y
                } = JSON.parse(savedPosition);
                controls.style.transform = `translate(${x}px, ${y}px)`;
                xOffset = x;
                yOffset = y;
            }
            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                if (e.target.closest('.drag-handle')) {
                    isDragging = true;
                }
            }
            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                localStorage.setItem('accessibilityControlsPosition', JSON.stringify({
                    x: xOffset,
                    y: yOffset
                }));
            }
            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX;
                    yOffset = currentY;
                    controls.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
            controls.addEventListener('touchstart', dragStart, false);
            controls.addEventListener('touchend', dragEnd, false);
            controls.addEventListener('touchmove', drag, false);
            controls.addEventListener('mousedown', dragStart, false);
            controls.addEventListener('mouseup', dragEnd, false);
            controls.addEventListener('mousemove', drag, false);
            controls.addEventListener('mouseleave', dragEnd, false);
        });
        function changeFontSize(action) {
            const content = document.querySelector('.document-style');
            const currentSize = parseFloat(window.getComputedStyle(content).fontSize);
            let newSize;
            switch (action) {
                case 'increase':
                    newSize = currentSize * 1.1;
                    break;
                case 'decrease':
                    newSize = currentSize * 0.9;
                    break;
                case 'reset':
                    newSize = 16;
                    break;
            }
            newSize = Math.min(Math.max(newSize, 12), 24);
            content.style.fontSize = `${newSize}px`;
            localStorage.setItem('preferredFontSize', newSize);
        }
        document.addEventListener('DOMContentLoaded', function() {
            const savedSize = localStorage.getItem('preferredFontSize');
            if (savedSize) {
                document.querySelector('.document-style').style.fontSize = `${savedSize}px`;
            }
        });
    </script>
    {{-- radio button ส่วนลงความเห็น คณะกรรมการกลั่นกรอง --}}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.committee-form').forEach(form => {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    try {
                        const response = await fetch('/committee/vote', {
                            method: 'POST',
                            body: formData,
                            headers: {
                                'X-CSRF-TOKEN': document.querySelector(
                                    'meta[name="csrf-token"]').content
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'สำเร็จ',
                                text: 'บันทึกความเห็นเรียบร้อยแล้ว'
                            });
                            updateVoteSummary(this.dataset.lectureId);
                        }
                    } catch (error) {
                        Swal.fire({
                            icon: 'error',
                            title: 'เกิดข้อผิดพลาด',
                            text: error.message
                        });
                    }
                });
            });
            function updateVoteSummary(lectureId) {
                fetch(`/committee/votes/${lectureId}`)
                    .then(response => response.json())
                    .then(data => {
                        const summary = document.querySelector(`#voteSummary_${lectureId}`);
                        summary.innerHTML = `
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-center">
                                        <h4>${data.approve_count}</h4>
                                        <p class="text-success">เห็นชอบ</p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center">
                                        <h4>${data.disapprove_count}</h4>
                                        <p class="text-danger">ไม่เห็นชอบ</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
            }
        });
    </script>
    {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
    {{-- <script>
        document.addEventListener('DOMContentLoaded', function() {
            const lectureId = '{{ $lecture->id }}';
            const radioButtons = document.querySelectorAll('.feedback-status-radio');
            const feedbackContentSection = document.getElementById(`feedback_content_section_${lectureId}`);
            const feedbackContent = document.getElementById(`feedback_content_${lectureId}`);
            const existingFeedbackDiv = document.querySelector('.existing-feedback');
            function createFeedbackHTML(feedback) {
                const date = new Date(feedback.created_at).toLocaleString('th-TH', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                return `
                    <div class="feedback-item card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="card-subtitle mb-2 text-muted">
                                    ${feedback.user ? feedback.user.name : 'ไม่ระบุชื่อ'}
                                    <small class="text-muted">(${date})</small>
                                </h6>
                                <span class="badge ${feedback.vote_type === 'approve' ? 'bg-success' : 'bg-danger'}">
                                    ${feedback.vote_type === 'approve' ? 'เห็นชอบ' : 'ไม่เห็นชอบ'}
                                </span>
                            </div>
                            ${feedback.opinion ? `<p class="card-text mt-2">${feedback.opinion}</p>` : ''}
                        </div>
                    </div>
                `;
            }
            function loadAndDisplayFeedbacks() {
                fetch(`/committee/feedback/${lectureId}`)
                    .then(response => response.json())
                    .then(feedbacks => {
                        const feedbacksHTML = feedbacks.length > 0
                            ? feedbacks.map(createFeedbackHTML).join('')
                            : '<p class="text-muted">ยังไม่มีความเห็นจากคณะกรรมการ</p>';
                        const feedbackContainer = existingFeedbackDiv.querySelector('div') || existingFeedbackDiv;
                        feedbackContainer.innerHTML = `
                            <h6 class="border-bottom pb-2">ความเห็นที่ผ่านมา</h6>
                            ${feedbacksHTML}
                        `;
                    })
                    .catch(error => {
                        console.error('Error loading feedbacks:', error);
                    });
            }
            fetch(`/committee/feedback/${lectureId}/current`, {
                headers: {
                    'Accept': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data) {
                    const radio = document.querySelector(`input[name="feedback_status"][value="${data.vote_type}"]`);
                    if (radio) {
                        radio.checked = true;
                        if (data.vote_type === 'reject') {
                            feedbackContentSection.style.display = 'block';
                            feedbackContent.required = true;
                            feedbackContent.value = data.opinion || '';
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error loading current user feedback:', error);
            });
            // จัดการการแสดง/ซ่อนช่องความเห็น
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'reject') {
                        feedbackContentSection.style.display = 'block';
                        feedbackContent.required = true;
                    } else {
                        feedbackContentSection.style.display = 'none';
                        feedbackContent.required = false;
                        feedbackContent.value = '';
                    }
                });
            });
            // จัดการการส่งฟอร์ม
            const feedbackForm = document.querySelector('.committee-feedback-form');
            if (feedbackForm) {
                feedbackForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    fetch(this.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content,
                            'Accept': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const message = data.is_update ? 'อัพเดทความเห็นเรียบร้อยแล้ว' : 'บันทึกความเห็นเรียบร้อยแล้ว';
                            alert(message);
                            loadAndDisplayFeedbacks();
                        } else {
                            alert(data.message || 'เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง');
                    });
                });
            }
            loadAndDisplayFeedbacks();
        });
    </script> --}}
    {{-- เพิ่มความเห็นคณะกรรมการ วันที่เพิ่ม 1/12/2024 --}}
@endsection
</file>

<file path="resources/views/admin/backend/pages/meeting_approval/all_meeting_approval.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-white py-3">
                    <div class="row align-items-center">
                        <div class="col">
                            <h5 class="mb-0">รับรองรายการการประชุม</h5>
                        </div>
                        <div class="col-auto">
                            <div class="d-flex gap-2">
                                <select id="meetingTypeFilter" class="form-select">
                                    <option value="">ทั้งหมด</option>
                                    @foreach($meeting_types as $type)
                                        <option value="{{ $type->id }}">{{ $type->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="row row-cols-1 row-cols-md-3 g-4" id="meetingCards">
                        @foreach ($my_meetings as $item)
                        <div class="col meeting-card show" data-meeting-type="{{ $item->meeting_type_id }}">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="d-flex flex-column justify-content-center p-3">
                                    <img src="{{ asset('uploads/no_image.jpg') }}" class="rounded-circle mx-auto d-block"
                                        width="90" height="90" alt="Meeting Image">
                                </div>
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="card-title mb-0">
                                            <a href="{{ route('meeting.detail', $item->id) }}"
                                               class="text-decoration-none text-dark hover-primary">
                                                {{ $item->meeting_agenda_title }}
                                            </a>
                                        </h6>
                                        <span class="badge bg-primary">
                                            {{ Str::limit($item->meeting_type->name, 10) }}
                                        </span>
                                    </div>
                                    <h6 class="card-subtitle text-muted mb-3">
                                        ครั้งที่ {{ $item->meeting_agenda_number }} / {{ $item->meeting_agenda_year }}
                                    </h6>
                                    <div class="mb-3">
                                        <small class="text-muted d-block">
                                            <i class="bi bi-person me-1"></i>
                                            สร้างโดย: {{ $item->user->first_name }} {{ $item->user->last_name }}
                                        </small>
                                        <small class="text-muted d-block">
                                            <i class="bi bi-calendar-event me-1"></i>
                                            ปรับปรุงข้อมูล: {{ $item->created_at->format('d M Y') }}
                                        </small>
                                    </div>
                                    @php
                                        $now = \Carbon\Carbon::now();
                                        $deadline = $item->approval_deadline;
                                        $isDeadlinePassed = $deadline ? $now->gt($deadline) : false;
                                        $daysUntilDeadline = $deadline ? $now->diffInDays($deadline, false) : null;
                                    @endphp
                                    <div class="mb-3">
                                        @if($deadline)
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-clock me-2"></i>
                                                <span class="badge {{ $isDeadlinePassed ? 'bg-danger' : ($daysUntilDeadline <= 2 ? 'bg-warning deadline-urgent' : 'bg-success') }}">
                                                    @if($isDeadlinePassed)
                                                        หมดเวลารับรอง: {{ \Carbon\Carbon::parse($deadline)->format('d/m/Y H:i') }}
                                                    @else
                                                        เหลือเวลารับรอง: {{ $now->diffForHumans($deadline, ['parts' => 2]) }}
                                                        <small>({{ \Carbon\Carbon::parse($deadline)->format('d/m/Y H:i') }})</small>
                                                    @endif
                                                </span>
                                            </div>
                                        @else
                                            <span class="badge bg-secondary">
                                                <i class="bi bi-exclamation-circle me-1"></i>
                                                ไม่ได้กำหนดเวลาสิ้นสุดการรับรอง
                                            </span>
                                        @endif
                                    </div>
                                    @php
                                        $section = App\Models\MeetingAgendaSection::where('meeting_agenda_id', $item->id)->get();
                                        $hasPermission = $item->hasPermission;
                                        $hasViewed = $item->hasViewed;
                                    @endphp
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-info">
                                            <i class="bi bi-list-check me-1"></i>
                                            วาระการประชุม: {{ count($section) }} รายการ
                                        </span>
                                        @if($hasViewed)
                                            <span class="badge bg-success">
                                                <i class="bi bi-eye-fill me-1"></i>
                                                ดูแล้ว
                                            </span>
                                        @endif
                                    </div>
                                </div>
                                <div class="card-footer bg-white border-top-0 p-3">
                                    <div class="d-grid">
                                        @if ($hasPermission)
                                            <a href="{{ route('meeting.approval.detail', $item->id) }}"
                                                class="btn {{ (!$item->isAdmin && $item->isDeadlinePassed) ? 'btn-secondary' : 'btn-primary' }}"
                                                {{ (!$item->isAdmin && $item->isDeadlinePassed) ? 'disabled' : '' }}
                                                data-bs-toggle="tooltip"
                                                data-bs-placement="top"
                                                title="{{ (!$item->isAdmin && $item->isDeadlinePassed) ? 'หมดเวลารับรองแล้ว' : '' }}">
                                                <i class="bi {{ $hasViewed ? 'bi-eye-fill' : 'bi-eye' }} me-1"></i>
                                                {{ $hasViewed ? 'ดูรายละเอียดอีกครั้ง' : 'ดูรายละเอียด' }}
                                            </a>
                                        @else
                                            <button class="btn btn-secondary" disabled
                                                    data-bs-toggle="tooltip"
                                                    data-bs-placement="top"
                                                    title="ไม่มีสิทธิ์เข้าถึง">
                                                <i class="bi bi-lock-fill me-1"></i>
                                                ไม่มีสิทธิ์เข้าถึง
                                            </button>
                                        @endif
                                    </div>
                                </div>
                            </div>
                        </div>
                        @endforeach
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<style>
    .meeting-card {
        opacity: 1;
        transition: all 0.3s ease-in-out;
    }
    .meeting-card.hidden {
        opacity: 0;
        transform: scale(0.95);
    }
    .form-select {
        min-width: 200px;
        padding: 0.5rem 2.25rem 0.5rem 0.75rem;
        font-size: 0.875rem;
        border-radius: 0.375rem;
        border: 1px solid
        background-color:
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }
    .form-select:focus {
        border-color:
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    .badge {
        font-weight: 500;
        padding: 0.5em 0.75em;
        font-size: 0.75rem;
    }
    .badge small {
        display: block;
        font-size: 0.85em;
        opacity: 0.85;
        margin-top: 0.25em;
    }
    .deadline-urgent {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }
    .card {
        transition: transform 0.2s ease-in-out;
    }
    .card:hover {
        transform: translateY(-2px);
    }
    .hover-primary:hover {
        color:
    }
    .btn:disabled {
        cursor: not-allowed;
    }
    .tooltip {
        font-size: 0.8125rem;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
$(document).ready(function() {
    const filterMeetings = (selectedType) => {
        const cards = $('.meeting-card');
        const noResults = $('.no-results');
        noResults.remove();
        if (selectedType) {
            cards.each(function() {
                const card = $(this);
                const meetingType = card.data('meeting-type');
                if (meetingType == selectedType) {
                    card.removeClass('hidden').fadeIn(300);
                } else {
                    card.addClass('hidden').fadeOut(300);
                }
            });
            setTimeout(() => {
                if ($('.meeting-card:visible').length === 0) {
                    $('#meetingCards').append(`
                        <div class="col-12 no-results">
                            <div class="alert alert-info d-flex align-items-center" role="alert">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                <div>
                                    ไม่พบรายการที่ตรงกับการค้นหา
                                </div>
                            </div>
                        </div>
                    `);
                }
            }, 350);
        } else {
            cards.removeClass('hidden').fadeIn(300);
        }
    };
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });
    const initialType = $('#meetingTypeFilter').val();
    if (initialType) {
        filterMeetings(initialType);
    }
    $('#meetingTypeFilter').on('change', function() {
        const selectedType = $(this).val();
        filterMeetings(selectedType);
    });
});
</script>
@endsection
</file>

<file path="resources/views/admin/backend/pages/section/add_meeting_agenda_lecture.blade.php">
@extends('admin.admin_dashboard')
@section('admin')
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    {{-- <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script> --}}
    {{-- <script src="https://cdn.ckeditor.com/4.25.0-lts/standard/ckeditor.js"></script> --}}
    <script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    {{-- <script src="//cdn.ckeditor.com/4.22.1/full/ckeditor.js"></script> --}}
    <div class="page-content">
        <div class="row">
            <div class="col-12">
                <div class="card radius-10">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <img src="{{ asset('uploads/no_image.jpg') }}" class="rounded-circle p-1 border" width="90"
                                height="90" alt="...">
                            <div class="flex-grow-1 ms-3">
                                <h5 class="mt-0">{{ $meeting_agenda->meeting_agenda_title }}</h5>
                                <p class="mb-0">
                                    {{ 'ครั้งที่ ' . $meeting_agenda->meeting_agenda_number . ' ปี ' . $meeting_agenda->meeting_agenda_year . ' วันที่ ' . \Carbon\Carbon::parse($meeting_agenda->meeting_agenda_date)->locale('th')->isoFormat('LL') }}
                                </p>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="meetingStatusSwitch"
                                    {{ $meeting_agenda->status == 1 ? 'checked' : '' }}
                                    data-meeting-id="{{ $meeting_agenda->id }}"
                                    onchange="updateMeetingStatus(this)"
                                    style="width: 3em; height: 1.5em;">
                                <label class="form-check-label" for="meetingStatusSwitch" style="font-size: 1.2em; margin-left: 10px;">
                                    สถานะ: <span id="statusText" class="{{ $meeting_agenda->status == 1 ? 'text-success' : 'text-danger' }}">{{ $meeting_agenda->status == 1 ? 'เปิดการมองเห็น' : 'ปิดการมองเห็น' }}</span>
                                </label>
                            </div>
                            <div style="width: 20px;"></div>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                data-bs-target="#exampleModal">เพิ่มวาระ</button>
                            <div style="width: 20px;"></div>
                            <a href="{{ route('all.meeting.agenda') }}" class="btn btn-danger">กลับ</a>
                        </div>
                    </div>
                </div>
                @foreach ($meeting_section as $key => $item)
                    <div class="container">
                        <div class="main-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body p-4 d-flex justify-content-between">
                                            <h6>{{ $item->section_title }}</h6>
                                            <div style="margin-top: 10px"
                                                class="d-flex justify-content-between align-items-center">
                                                <form action="{{ route('delete.meeting.agenda.section', ['id' => $item->id]) }}"
                                                    method="POST">
                                                    @csrf
                                                    @method('DELETE')
                                                    <button type="submit" class="btn btn-danger px-2 ms-auto me-2"
                                                        onclick="return confirm('คุณต้องการลบวาระนี้ใช่หรือไม่?')">ลบวาระ </button>
                                                </form>
                                                <a style="margin-left: 10px" class="btn btn-warning ms-2" href="{{ route('edit.meeting.agenda.section', ['id' => $item->id]) }}">แก้ไขวาระ</a>
                                                <a style="margin-left: 10px" class="btn btn-primary ms-2"
                                                    onclick="addLectureDiv({{ $meeting_agenda->id }}, {{ $item->id }}, 'lectureContainer{{ $key }}')"
                                                    id="addLectureBtn($key)">เพิ่มหัวข้อย่อย</a>
                                            </div>
                                        </div>
                                        <div class="courseHide" id="lectureContainer{{ $key }}">
                                            {{-- <div class="container">
                                                @foreach ($item->meetingAgendaLectures as $lecture)
                                                    <div class="lectureDiv mb-3">
                                                        <div class="d-flex align-items-center justify-content-between">
                                                            <strong
                                                                style="margin-left: 10px">{{ $lecture->lecture_title }}</strong>
                                                            <div class="btn-group">
                                                                <a class="btn btn-sm btn-primary me-2"
                                                                    onclick="addAgendaDiv({{ $meeting_agenda->id }}, {{ $item->id }}, {{ $lecture->id }}, 'agendaContainer{{ $lecture->id }}')">เพิ่มรายการ</a>
                                                                <a href="{{ route('edit.meeting.agenda.lecture', ['id' => $lecture->id]) }}"
                                                                    class="btn btn-sm btn-success"><i
                                                                        class="bx bx-edit"></i></a>
                                                                <a href="{{ route('delete.meeting.agenda.lecture', ['id' => $lecture->id]) }}"
                                                                    class="btn btn-sm btn-danger" id="delete"><i
                                                                        class="bx bx-trash"></i></a>
                                                            </div>
                                                        </div> --}}
                                                        <div class="container">
                                                            @foreach ($item->meetingAgendaLectures as $lecture)
                                                                <div class="lectureDiv mb-3">
                                                                    <div class="d-flex align-items-center justify-content-between">
                                                                        <div class="d-flex align-items-center">
                                                                            <strong style="margin-left: 10px">{{ $lecture->lecture_title }}</strong>
                                                                            <div class="form-check form-switch ms-3">
                                                                                <input class="form-check-input" type="checkbox"
                                                                                    id="showCommitteeOpinion{{ $lecture->id }}"
                                                                                    onchange="updateCommitteeOpinionVisibility({{ $lecture->id }})"
                                                                                    {{ $lecture->show_committee_opinion ? 'checked' : '' }}>
                                                                                <label class="form-check-label" for="showCommitteeOpinion{{ $lecture->id }}">
                                                                                    แสดงความเห็นคณะกรรมการ
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="btn-group">
                                                                            <a class="btn btn-sm btn-primary me-2"
                                                                                onclick="addAgendaDiv({{ $meeting_agenda->id }}, {{ $item->id }}, {{ $lecture->id }}, 'agendaContainer{{ $lecture->id }}')">เพิ่มรายการ</a>
                                                                            <a href="{{ route('edit.meeting.agenda.lecture', ['id' => $lecture->id]) }}"
                                                                                class="btn btn-sm btn-success"><i
                                                                                    class="bx bx-edit"></i></a>
                                                                            <a href="{{ route('delete.meeting.agenda.lecture', ['id' => $lecture->id]) }}"
                                                                                class="btn btn-sm btn-danger" id="delete"><i
                                                                                    class="bx bx-trash"></i></a>
                                                                        </div>
                                                                    </div>
                                                        <div id="agendaContainer{{ $lecture->id }}" class="mt-2">
                                                            <!-- Agenda items will be loaded here -->
                                                        </div>
                                                    </div>
                                                @endforeach
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                @endforeach
                {{--
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">เพิ่มวาระการประชุม</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ route('add.meeting.agenda.section') }}" method="POST">
                        @csrf
                        <input type="hidden" name="id" value="{{ $meeting_agenda->id }}">
                        <div class="form-group mb-3">
                            <label for="section_title" class="form-label">หัวข้อวาระการประชุม</label>
                            <input type="text" name="section_title" class="form-control" id="section_title" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="section_content" class="form-label">รายละเอียด</label>
                            <textarea name="section_content" id="section_content" class="form-control ckeditor"></textarea>
                        </div>
                        {{-- <div class="form-group mb-3">
                            <label for="section_content" class="form-label">รายละเอียด</label>
                            <textarea name="section_content" id="section_content" class="form-control"></textarea>
                        </div> --}}
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                            <button type="submit" class="btn btn-primary">บันทึก</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            CKEDITOR.replace('section_content', {
                language: 'th',
                height: 300,
                removeButtons: 'PasteFromWord'
            });
        });
    </script>
    @push('scripts')
    {{-- <script src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script> --}}
    {{-- <script src="https://cdn.ckeditor.com/4.25.0-lts/standard/ckeditor.js"></script> --}}
    <script src="{{ asset('backend/assets/plugins/ckeditor/ckeditor.js') }}"></script>
    <script>
        CKEDITOR.replace('section_content', {
            language: 'th',
            height: 300,
            removeButtons: 'PasteFromWord'
        });
    </script>
    @endpush
    <script>
        ClassicEditor
            .create(document.querySelector('#ckeditor'))
            .then(editor => {
                console.log(editor);
            })
            .catch(error => {
                console.error(error);
            });
    </script>
    <script>
        function addLectureDiv(courseId, sectionId, containerId) {
            const lectureContainer = document.getElementById(containerId);
            const newLectureDiv = document.createElement('div');
            newLectureDiv.classList.add('lectureDiv', 'mb-3');
            newLectureDiv.innerHTML = `
            <div class="container">
                <h6 class="mt-3"> ระเบียบวาระย่อย </h6>
                <input type="text" class="form-control" placeholder="Enter Lecture Title">
                <textarea id="editor-${containerId}" class="form-control"></textarea>
                <button class="btn btn-primary mt-3" onclick="SaveMeetingAgendaLecture('${courseId}',${sectionId},'${containerId}')" >Save Lecture</button>
                <button class="btn btn-secondary mt-3" onclick="hideLectureContainer('${containerId}')">Cancel</button>
            </div>
            `;
            lectureContainer.appendChild(newLectureDiv);
            CKEDITOR.replace(`editor-${containerId}`);
        }
        function hideLectureContainer(containerId) {
            const lectureContainer = document.getElementById(containerId);
            lectureContainer.style.display = 'none';
            location.reload();
        }
    </script>
    <script>
        function addAgendaDiv(courseId, lectureId, sectionId, containerId) {
            const agendaContainer = document.getElementById(containerId);
            const newAgendaDiv = document.createElement('div');
            newAgendaDiv.classList.add('agendaDiv', 'mb-3', 'ml-4');
            newAgendaDiv.innerHTML = `
            <div class="container">
                <h6>Meeting Agenda Item</h6>
                <input type="text" class="form-control mb-2" placeholder="Enter Agenda Title">
                <textarea id="editor-${containerId}" class="form-control" placeholder="Enter Agenda Description"></textarea>
                <button class="btn btn-primary mt-2" onclick="saveAgendaItem(${courseId}, ${lectureId}, ${sectionId}, '${containerId}')">Save Agenda Item</button>
                <button class="btn btn-secondary mt-2" onclick="hideAgendaContainer('${containerId}')">Cancel</button>
            </div>
            `;
            agendaContainer.appendChild(newAgendaDiv);
            CKEDITOR.replace(`editor-${containerId}`);
        }
        function hideAgendaContainer(containerId) {
            const agendaContainer = document.getElementById(containerId);
            agendaContainer.lastElementChild.remove();
        }
        function saveAgendaItem(courseId, sectionId, lectureId, containerId) {
            const agendaContainer = document.getElementById(containerId);
            const agendaTitle = agendaContainer.querySelector('input[type="text"]').value;
            const agendaDescription = CKEDITOR.instances[`editor-${containerId}`].getData();
            const formData = new FormData();
            formData.append('course_id', courseId);
            formData.append('section_id', sectionId);
            formData.append('lecture_id', lectureId);
            formData.append('item_title', agendaTitle);
            formData.append('content', agendaDescription);
            fetch('{{ route('save.meeting.agenda.item') }}', {
                    method: 'POST',
                    headers: {
                        'X-CSRF-TOKEN': '{{ csrf_token() }}',
                    },
                    body: formData,
                })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(text);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                    hideAgendaContainer(containerId);
                    loadAgendaItems(lectureId, containerId);
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: 'Agenda item added successfully',
                        showConfirmButton: false,
                        timer: 1500
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    const errorMessage = JSON.parse(error.message);
                    Swal.fire({
                        icon: 'error',
                        title: 'ขออภัย',
                        text: `เกิดข้อผิดพลาด: ${errorMessage.th} (${errorMessage.en})`,
                    });
                });
        }
        function loadAgendaItems(lectureId, containerId) {
            fetch(`/get-agenda-items/${lectureId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const agendaContainer = document.getElementById(containerId);
                    agendaContainer.innerHTML = '';
                    if (data.length === 0) {
                        agendaContainer.innerHTML =
                        '<p class="text-sm text-muted ms-4 mb-0">No agenda items found.</p>';
                        return;
                    }
                    data.forEach((item, index) => {
                        const agendaItem = document.createElement('div');
                        agendaItem.classList.add('agendaItem', 'ml-4', 'mt-2');
                        agendaItem.style.marginLeft = '1rem';
                        agendaItem.innerHTML = `
                            <div class="d-flex justify-content-between align-items-center ml-4">
                                <p class="mb-0"><strong>${item.item_title}</strong></p>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-primary" onclick="editAgendaItem(${item.id})">แก้ไข</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteAgendaItem(${item.id}, '${containerId}')">ลบ</button>
                                </div>
                            </div>
                            <div class="text-sm text-muted ms-4 mb-0">
                                ${item.content ? item.content : 'ไม่มีการลงรายละเอียด'}
                            </div>
                            <hr>
                        `;
                        agendaContainer.appendChild(agendaItem);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    const agendaContainer = document.getElementById(containerId);
                    agendaContainer.innerHTML =
                        `<p class="text-danger">Error loading agenda items: ${error.message}</p>`;
                });
        }
        function editAgendaItem(itemId) {
            fetch(`/edit/get-agenda-items/${itemId}`)
                .then(response => response.json())
                .then(item => {
                    Swal.fire({
                        title: 'Edit Agenda Item',
                        html:
                            `<input id="swal-input1" class="swal2-input" value="${item.item_title}" placeholder="Enter item title" style="width:100%">` +
                            `<textarea id="swal-input2" class="swal2-textarea">${item.content}</textarea>`,
                        width: '90%',
                        height: '90vh',
                        customClass: {
                            popup: 'swal-wide',
                            content: 'swal-tall'
                        },
                        didOpen: () => {
                            CKEDITOR.replace('swal-input2', {
                                height: '60vh',
                            });
                        },
                        preConfirm: () => {
                            return {
                                item_title: document.getElementById('swal-input1').value,
                                content: CKEDITOR.instances['swal-input2'].getData()
                            }
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            updateAgendaItem(itemId, result.value.item_title, result.value.content);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.fire('Error', 'Failed to load agenda item data', 'error');
                });
        }
        function updateAgendaItem(itemId, item_title, content) {
            fetch(`/update-agenda-item/${itemId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': '{{ csrf_token() }}'
                },
                body: JSON.stringify({ item_title: item_title, content: content })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire('Success', 'Agenda item updated successfully', 'success');
                    loadAgendaItems(data.meeting_agenda_lecture_id, `agendaContainer${data.meeting_agenda_lecture_id}`);
                } else {
                    Swal.fire('Error', data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire('Error', 'Failed to update agenda item', 'error');
            });
        }
        function loadAllAgendaItems() {
            const lectureContainers = document.querySelectorAll('[id^="lectureContainer"]');
            lectureContainers.forEach(container => {
                const agendaContainers = container.querySelectorAll('[id^="agendaContainer"]');
                agendaContainers.forEach(agendaContainer => {
                    const lectureId = agendaContainer.id.replace('agendaContainer', '');
                    loadAgendaItems(lectureId, agendaContainer.id);
                });
            });
        }
        // Call loadAllAgendaItems when the page loads
        document.addEventListener('DOMContentLoaded', loadAllAgendaItems);
        function deleteAgendaItem(id, containerId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/delete-agenda-item/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'X-CSRF-TOKEN': '{{ csrf_token() }}',
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            },
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                loadAgendaItems(data.meeting_agenda_lecture_id, containerId);
                                Swal.fire(
                                    'Deleted!',
                                    'Agenda item has been deleted.',
                                    'success'
                                );
                            } else {
                                throw new Error(data.message || 'Failed to delete agenda item');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            Swal.fire(
                                'Error!',
                                'Failed to delete agenda item.',
                                'error'
                            );
                        });
                    }
                });
            }
    </script>
    <script>
        function SaveMeetingAgendaLecture(courseId, sectionId, containerId) {
            const lectureContainer = document.getElementById(containerId);
            const lectureTitle = lectureContainer.querySelector('input[type="text"]').value;
            const lectureContent = CKEDITOR.instances[`editor-${containerId}`].getData();
            fetch('{{ route('save.meeting.agenda.lecture') }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': '{{ csrf_token() }}',
                    },
                    body: JSON.stringify({
                        meeting_agenda_id: courseId,
                        meeting_agenda_section_id: sectionId,
                        lecture_title: lectureTitle,
                        content: lectureContent,
                    }),
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                    lectureContainer.style.display = 'none';
                    location.reload();
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 10000
                    });
                    Toast.fire({
                        icon: 'success',
                        title: data.success,
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Something went wrong!',
                    });
                });
        }
    </script>
    <script>
        function updateMeetingStatus(element) {
            const meetingId = element.dataset.meetingId;
            const status = element.checked ? 1 : 0;
            $.ajax({
                url: `/update-meeting-status/${meetingId}`,
                type: 'POST',
                data: {
                    status: status,
                    _token: '{{ csrf_token() }}'
                },
                success: function(response) {
                    if (response.success) {
                        toastr.success('อัพเดทสถานะสำเร็จ');
                        setTimeout(function() {
                            window.location.reload();
                        }, 1000);
                    } else {
                        toastr.error('เกิดข้อผิดพลาดในการอัพเดทสถานะ');
                        element.checked = !element.checked;
                    }
                },
                error: function() {
                    toastr.error('เกิดข้อผิดพลาดในการอัพเดทสถานะ');
                    element.checked = !element.checked;
                }
            });
        }
    </script>
<script>
    function updateCommitteeOpinionVisibility(lectureId) {
        const checkbox = document.getElementById(`showCommitteeOpinion${lectureId}`);
        fetch(`/update-committee-opinion-visibility/${lectureId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            },
            body: JSON.stringify({
                show_committee_opinion: checkbox.checked
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                toastr.success('อัพเดทการแสดงผลความคิดเห็นเรียบร้อยแล้ว');
            } else {
                toastr.error('เกิดข้อผิดพลาดในการอัพเดท');
                checkbox.checked = !checkbox.checked;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            toastr.error('เกิดข้อผิดพลาดในการอัพเดท');
            checkbox.checked = !checkbox.checked;
        });
    }
</script>
@endsection
</file>

<file path="resources/views/admin/admin_dashboard.blade.php">
<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--favicon-->
    <link rel="icon" href="{{ asset('backend/assets/images/favicon-96x96.png') }}" type="image/png" />
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <!--tagsinput-->
    <link href="{{ asset('backend/assets/plugins/input-tags/css/tagsinput.css') }}" rel="stylesheet" />
    <!--tagsinput-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/43.2.0/ckeditor5.css">
    <!-- แจ้งเตือน lobibox -->
    <link rel="stylesheet" href="{{ asset('frontend/assets/plugins/notifications/css/lobibox.min.css') }}" />
    <!--plugins-->
    <link href="{{ asset('backend/assets/plugins/vectormap/jquery-jvectormap-2.0.2.css') }}" rel="stylesheet" />
    <link href="{{ asset('backend/assets/plugins/simplebar/css/simplebar.css') }}" rel="stylesheet" />
    <link href="{{ asset('backend/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css') }}" rel="stylesheet" />
    <link href="{{ asset('backend/assets/plugins/metismenu/css/metisMenu.min.css') }}" rel="stylesheet" />
    <!-- Include stylesheet -->
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
    <!-- loader-->
    <link href="{{ asset('backend/assets/css/pace.min.css') }}" rel="stylesheet" />
    <script src="{{ asset('backend/assets/js/pace.min.js') }}"></script>
    <!-- Bootstrap CSS -->
    <link href="{{ asset('backend/assets/css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ asset('backend/assets/css/bootstrap-extended.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="{{ asset('backend/assets/css/app.css') }}" rel="stylesheet">
    <link href="{{ asset('backend/assets/css/icons.css') }}" rel="stylesheet">
    <!-- Theme Style CSS -->
    <link rel="stylesheet" href="{{ asset('backend/assets/css/dark-theme.css') }}" />
    <link rel="stylesheet" href="{{ asset('backend/assets/css/semi-dark.css') }}" />
    <link rel="stylesheet" href="{{ asset('backend/assets/css/header-colors.css') }}" />
    <!-- Datatable -->
    <link href="{{ asset('backend/assets/plugins/datatable/css/dataTables.bootstrap5.min.css') }}" rel="stylesheet" />
    <!-- End Datatable -->
    <!-- เพิ่ม scripts ที่จำเป็นตรงนี้ -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    {{-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script> --}}
    <!-- เพิ่ม Font Awesome ถ้าใช้ icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css">
    <title>SRU e-Meeting </title>
</head>
<body>
    <!--wrapper-->
    <div class="wrapper">
        <!--sidebar wrapper -->
        @include('admin.body.sidebar')
        <!--end sidebar wrapper -->
        <!--start header -->
        @include('admin.body.header')
        <!--end header -->
        <!--start page wrapper -->
        <div class="page-wrapper">
            @yield('admin')
        </div>
        <!--end page wrapper -->
        <!--start overlay-->
        <div class="overlay toggle-icon"></div>
        <!--end overlay-->
        <!--Start Back To Top Button-->
        <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
        <!--End Back To Top Button-->
        @include('admin.body.footer')
    </div>
    <!--end wrapper-->
    <!-- แจ้งเตือน lobibox -->
    <script src="{{ asset('frontend/assets/plugins/notifications/js/lobibox.min.js') }}"></script>
    <script src="{{ asset('frontend/assets/plugins/notifications/js/messageboxes.min.js') }}"></script>
    <script src="{{ asset('frontend/assets/plugins/notifications/js/notifications.min.js') }}"></script>
    <!--end switcher-->
    <!-- Bootstrap JS -->
    <script src="{{ asset('backend/assets/js/bootstrap.bundle.min.js') }}"></script>
    <!--plugins-->
    <script src="{{ asset('backend/assets/js/jquery.min.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/simplebar/js/simplebar.min.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/metismenu/js/metisMenu.min.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/vectormap/jquery-jvectormap-2.0.2.min.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/vectormap/jquery-jvectormap-world-mill-en.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/chartjs/js/chart.js') }}"></script>
    <script src="{{ asset('backend/assets/js/index.js') }}"></script>
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
	<script src="{{ asset('backend/assets/plugins/select2/js/select2-custom.js') }}"></script>
    <!--tagsinput-->
    <script src="{{ asset('backend/assets/plugins/input-tags/js/tagsinput.js') }}"></script>
    <!--tagsinput-->
    <!--app JS-->
    <script src="{{ asset('backend/assets/js/app.js') }}"></script>
    <script src="{{ asset('backend/assets/js/validate.min.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="{{ asset('backend/assets/js/code.js') }}"></script>
    <script>
        new PerfectScrollbar(".app-container")
    </script>
    <!--Datatable-->
    <script src="{{ asset('backend/assets/plugins/datatable/js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/datatable/js/dataTables.bootstrap5.min.js') }}"></script>
    <script>
        $(document).ready(function() {
            $('#example').DataTable();
        });
    </script>
    <!--End Datatable-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        @if (Session::has('message'))
            var type = "{{ Session::get('alert-type', 'info') }}"
            switch (type) {
                case 'info':
                    toastr.info(" {{ Session::get('message') }} ");
                    break;
                case 'success':
                    toastr.success(" {{ Session::get('message') }} ");
                    break;
                case 'warning':
                    toastr.warning(" {{ Session::get('message') }} ");
                    break;
                case 'error':
                    toastr.error(" {{ Session::get('message') }} ");
                    break;
            }
        @endif
    </script>
    {{-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script> --}}
	<script src="{{ asset('backend/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js') }}"></script>
    <script src="{{ asset('backend/assets/plugins/select2/js/select2-custom.js') }}"></script>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        tinymce.init({
            selector: 'textarea#myeditorinstance',
            plugins: 'powerpaste advcode table lists checklist',
            toolbar: 'undo redo | blocks| bold italic | bullist numlist checklist | code | table'
        });
    </script>
    <!-- Include the Quill library -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <script>
		var quill = new Quill('#editor', {
		  theme: 'snow'
		});
	  </script>
      <script>
          $(document).ready(function() {
              $('.mobile-toggle-menu').on('click', function() {
                  $('.wrapper').toggleClass('toggled');
              });
              $(document).on('click touchstart', function(e) {
                  if (!$(e.target).closest('.sidebar-wrapper, .mobile-toggle-menu').length) {
                      $('.wrapper').removeClass('toggled');
                  }
              });
          });
      </script>
    <!-- script การตั้งค่า Lobibox -->
    <script>
        Lobibox.notify.DEFAULTS = {
            soundPath: "{{ asset('frontend/assets/plugins/notifications/sounds/') }}",
            iconSource: "fontAwesome",
            delay: 5000,
            rounded: true,
            delayIndicator: true,
            position: 'top center',
            size: 'mini',
            sound: true,
            msg: '' // ข้อความเริ่มต้น
        };
        // ฟังก์ชั่นตรวจสอบการแจ้งเตือน
        function checkNotifications() {
            $.get('/notifications', function(data) {
                data.forEach(function(notification) {
                    Lobibox.notify('default', {
                        title: 'Login',
                        msg: notification.data.message,
                        icon: 'fa fa-user',
                        sound: 'sound4',
                        delay: 5000,
                        position: 'top center',
                        showClass: 'fadeInDown',
                        hideClass: 'fadeOutUp'
                    });
                });
            });
        }
        setInterval(checkNotifications, 5000);
    </script>
    @stack('body-scripts')
</body>
</html>
</file>

<file path="app/Http/Controllers/MeetingApprovalController.php">
<?php
namespace App\Http\Controllers;
use App\Models\MeetingAgenda;
use App\Models\MeetingAgendaItems;
use App\Models\MeetingAgendaLecture;
use App\Models\MeetingAgendaSection;
use App\Models\MeetingApproval;
use App\Models\MeetingApprovalDetail;
use App\Models\MeetingType;
use App\Models\MeetingView;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
class MeetingApprovalController extends Controller
{
    private function isAdmin($user)
    {
        return $user->hasRole('Super Admin');
    }
    public function AllMeetingApproval()
    {
        $user = Auth::user();
        $meeting_types = MeetingType::all();
        $my_meetings = MeetingAgenda::whereIn('meeting_type_id', $user->meetingTypes->pluck('id'))
            ->whereIn('committee_category_id', $this->getUserCommitteeIds($user))
            ->get();
        $my_meetings = $my_meetings->map(function ($item) use ($user) {
            $item->hasPermission = $this->checkUserPermission($user, $item);
            $item->hasViewed = MeetingView::where('user_id', $user->id)
                                        ->where('meeting_agenda_id', $item->id)
                                        ->exists();
            $item->approvalStatus = $this->getApprovalStatus($user->id, $item->id);
            $item->daysUntilDeadline = now()->diffInDays(Carbon::parse($item->approval_deadline), false);
            $item->isDeadlinePassed = $item->approval_deadline ? now()->gt(Carbon::parse($item->approval_deadline)) : false;
            $item->isAdmin = $this->isAdmin($user);
            return $item;
        });
        return view('admin.backend.pages.meeting_approval.all_meeting_approval', compact('my_meetings', 'meeting_types'));
    }
    public function MeetingApprovalDetail($id)
    {
        $user = Auth::user();
        $meetingAgenda = MeetingAgenda::findOrFail($id);
        if (!$this->checkUserPermission($user, $meetingAgenda)) {
            abort(403, 'Unauthorized action.');
        }
        if (!$this->isAdmin($user) && Carbon::now()->isAfter($meetingAgenda->approval_deadline)) {
            return redirect()->back()->with('error', 'เลยกำหนดเวลารับรองแล้ว');
        }
        if (!$this->checkUserPermission($user, $meetingAgenda)) {
            abort(403, 'Unauthorized action.');
        }
         MeetingView::updateOrCreate(
            ['user_id' => $user->id, 'meeting_agenda_id' => $id],
            ['viewed_at' => now()]
        );
        $my_meetings = MeetingAgenda::findOrFail($id);
        $approvals = MeetingApproval::where('meeting_agenda_id', $id)
        ->with(['user', 'approvalDetails.meetingAgendaSection'])
        ->orderBy('created_at', 'desc')
        ->get();
        $hasApproved = $approvals->where('user_id', $user->id)->isNotEmpty();
        $totalApprovals = $approvals->count();
        $prefixNames = [];
        foreach ($approvals as $approval) {
            $prefixNames[$approval->id] = $approval->user->prefixName();
        }
        return view('admin.backend.pages.meeting_approval.meeting_approval_detail_0', compact('my_meetings', 'approvals', 'prefixNames', 'meetingAgenda', 'hasApproved', 'totalApprovals'));
    }
    private function checkUserPermission($user, $meetingAgenda)
    {
        $userMeetingTypes = $user->meetingTypes;
        $userCommitteeIds = [];
        foreach ($userMeetingTypes as $meetingType) {
            $committeeIds = json_decode($meetingType->pivot->committee_ids, true);
            $userCommitteeIds = array_merge($userCommitteeIds, $committeeIds ?? []);
        }
        $userCommitteeIds = array_unique($userCommitteeIds);
        return $userMeetingTypes->contains($meetingAgenda->meeting_type_id) &&
                in_array($meetingAgenda->committee_category_id, $userCommitteeIds);
    }
    private function getUserCommitteeIds($user)
    {
        $userCommitteeIds = [];
        foreach ($user->meetingTypes as $meetingType) {
            $committeeIds = json_decode($meetingType->pivot->committee_ids, true);
            $userCommitteeIds = array_merge($userCommitteeIds, $committeeIds ?? []);
        }
        return array_unique($userCommitteeIds);
    }
    public function store(Request $request, $meetingAgendaId)
    {
        try {
            DB::beginTransaction();
            $meetingAgenda = MeetingAgenda::findOrFail($meetingAgendaId);
            $userId = Auth::id();
            if ($meetingAgenda->approval_deadline && now()->gt($meetingAgenda->approval_deadline)) {
                return redirect()->back()->with([
                    'message' => 'หมดเวลารับรองแล้ว',
                    'alert-type' => 'error'
                ]);
            }
            if (!$this->checkUserPermission(Auth::user(), $meetingAgenda)) {
                return response()->json(['message' => 'ไม่มีสิทธิ์ในการรับรองการประชุมนี้'], 403);
            }
            $existingApproval = MeetingApproval::where('meeting_agenda_id', $meetingAgenda->id)
                ->where('user_id', $userId)
                ->first();
            $meetingApproval = MeetingApproval::updateOrCreate(
                [
                    'meeting_agenda_id' => $meetingAgenda->id,
                    'user_id' => $userId
                ],
                [
                    'meeting_type_id' => $request->meeting_type_id,
                    'committee_category_id' => $request->committee_category_id,
                    'meeting_format_id' => $request->meeting_format_id,
                    'rule_of_meeting_id' => $request->rule_of_meeting_id,
                    'regulation_meeting_id' => $request->regulation_meeting_id,
                    'approval_date' => now(),
                    'status' => 'approved'
                ]
            );
            MeetingApprovalDetail::where('meeting_approval_id', $meetingApproval->id)->delete();
            foreach ($request->input('approvals') as $sectionId => $approval) {
                $section = MeetingAgendaSection::find($sectionId);
                if ($this->sectionHasContent($section)) {
                    MeetingApprovalDetail::create([
                        'meeting_approval_id' => $meetingApproval->id,
                        'meeting_agenda_section_id' => $sectionId,
                        'approval_type' => $approval['type'],
                        'comments' => $approval['type'] === 'with_changes' ? $approval['comments'] : null,
                    ]);
                }
            }
            DB::commit();
            $message = $existingApproval
                ? 'อัปเดตการรับรองรายงานการประชุมเรียบร้อยแล้ว'
                : 'บันทึกการรับรองรายงานการประชุมเรียบร้อยแล้ว';
            return response()->json([
                'message' => $message,
                'approval_id' => $meetingApproval->id,
                'status' => 'success'
            ]);
        } catch (\Exception $e) {
            DB::rollBack();
            return response()->json([
                'message' => 'เกิดข้อผิดพลาดในการบันทึกข้อมูล: ' . $e->getMessage(),
                'status' => 'error'
            ], 500);
        }
    }
    private function sectionHasContent($section)
    {
        if (!$section) return false;
        if (!empty($section->description)) {
            return true;
        }
        $hasLectures = MeetingAgendaLecture::where('meeting_agenda_section_id', $section->id)
            ->exists();
        if ($hasLectures) {
            return true;
        }
        $hasItems = MeetingAgendaItems::where('meeting_agenda_section_id', $section->id)
            ->exists();
        if ($hasItems) {
            return true;
        }
        return false;
    }
    private function getApprovalStatus($userId, $meetingAgendaId)
    {
        $approval = MeetingApproval::where('meeting_agenda_id', $meetingAgendaId)
            ->where('user_id', $userId)
            ->first();
        $meetingAgenda = MeetingAgenda::find($meetingAgendaId);
        if (Carbon::now()->isAfter($meetingAgenda->approval_deadline)) {
            return $approval ? 'รับรองแล้ว' : 'ไม่ได้รับรอง';
        }
        return $approval ? 'รับรองแล้ว' : 'รอการรับรอง';
    }
    public function getApprovalDetails($id)
    {
        $approval = MeetingApproval::with(['user', 'approvalDetails.meetingAgendaSection'])
            ->findOrFail($id);
        return view('admin.backend.pages.meeting_approval.approval_details', compact('approval'));
    }
    public function editApproval($id)
    {
        try {
            $approval = MeetingApproval::where([
                'meeting_agenda_id' => $id,
                'user_id' => Auth::id()
            ])->first();
            if ($approval) {
                MeetingApprovalDetail::where('meeting_approval_id', $approval->id)->delete();
                $approval->delete();
                $notification = array(
                    'message' => 'คุณสามารถทำการรับรองใหม่ได้',
                    'alert-type' => 'success'
                );
            } else {
                $notification = array(
                    'message' => 'ไม่พบข้อมูลการรับรอง',
                    'alert-type' => 'error'
                );
            }
            return redirect()->route('meeting.approval.detail', $id)->with($notification);
        } catch (\Exception $e) {
            return redirect()->back()->with([
                'message' => 'เกิดข้อผิดพลาด: ' . $e->getMessage(),
                'alert-type' => 'error'
            ]);
        }
    }
    public function getApprovalData($meetingId)
    {
        try {
            $approval = MeetingApproval::where([
                'meeting_agenda_id' => $meetingId,
                'user_id' => Auth::id()
            ])->with('approvalDetails')->first();
            if (!$approval) {
                return response()->json([
                    'success' => false,
                    'message' => 'ไม่พบข้อมูลการรับรอง'
                ], 404);
            }
            $approvalData = [];
            foreach ($approval->approvalDetails as $detail) {
                $approvalData[$detail->meeting_agenda_section_id] = [
                    'type' => $detail->approval_type,
                    'comments' => $detail->comments
                ];
            }
            return response()->json([
                'success' => true,
                'approval_data' => $approvalData
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'เกิดข้อผิดพลาด: ' . $e->getMessage()
            ], 500);
        }
    }
    public function updateApproval(Request $request, $meetingId)
    {
        try {
            DB::beginTransaction();
            $existingApproval = MeetingApproval::where([
                'meeting_agenda_id' => $meetingId,
                'user_id' => Auth::id()
            ])->first();
            if ($existingApproval) {
                MeetingApprovalDetail::where('meeting_approval_id', $existingApproval->id)->delete();
            }
            $approval = MeetingApproval::updateOrCreate(
                [
                    'meeting_agenda_id' => $meetingId,
                    'user_id' => Auth::id()
                ],
                [
                    'meeting_type_id' => $request->meeting_type_id,
                    'committee_category_id' => $request->committee_category_id,
                    'meeting_format_id' => $request->meeting_format_id,
                    'rule_of_meeting_id' => $request->rule_of_meeting_id,
                    'regulation_meeting_id' => $request->regulation_meeting_id,
                    'approval_date' => now(),
                    'status' => 'approved'
                ]
            );
            foreach ($request->approvals as $sectionId => $approvalData) {
                MeetingApprovalDetail::create([
                    'meeting_approval_id' => $approval->id,
                    'meeting_agenda_section_id' => $sectionId,
                    'approval_type' => $approvalData['type'],
                    'comments' => $approvalData['type'] === 'with_changes' ? $approvalData['comments'] : null
                ]);
            }
            DB::commit();
            return response()->json([
                'success' => true,
                'message' => 'บันทึกการรับรองเรียบร้อยแล้ว'
            ]);
        } catch (\Exception $e) {
            DB::rollBack();
            return response()->json([
                'success' => false,
                'message' => 'เกิดข้อผิดพลาด: ' . $e->getMessage()
            ], 500);
        }
    }
}
</file>

<file path="app/Http/Controllers/MeetingAgendaController.php">
<?php
namespace App\Http\Controllers;
use App\Models\CommitteeCategory;
use App\Models\CommitteeOpinion;
use App\Models\MeetingAgenda;
use App\Models\MeetingAgendaItems;
use App\Models\MeetingAgendaLecture;
use App\Models\MeetingAgendaSection;
use App\Models\MeetingFormat;
use App\Models\MeetingParticipant;
use App\Models\MeetingType;
use App\Models\RegulationMeeting;
use App\Models\RuleofMeeting;
use App\Models\Setting;
use App\Models\User;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
use Illuminate\Validation\ValidationException;
class MeetingAgendaController extends Controller
{
    public function AllMeetingAgenda(Request $request)
    {
        $user = Auth::user();
        if ($user->hasRole(['Admin', 'Super Admin'])) {
            $meeting_agendas = MeetingAgenda::orderBy('id', 'desc')->get();
        } else {
            $meeting_agendas = MeetingAgenda::where('user_id', $user->id)->orderBy('id', 'desc')->get();
        }
        return view('admin.backend.pages.meeting_agenda.all_meeting_agenda', compact('meeting_agendas'));
    }
    public function AddMeetingAgenda()
    {
        $meeting_types = MeetingType::latest()->get();
        $meeting_format = MeetingFormat::latest()->get();
        $committee_categories = CommitteeCategory::latest()->get();
        $rule_of_meetings = RuleofMeeting::latest()->get();
        $regulation_meetings = RegulationMeeting::latest()->get();
        return view('admin.backend.pages.meeting_agenda.add_meeting_agenda', compact('meeting_types', 'meeting_format', 'committee_categories', 'rule_of_meetings', 'regulation_meetings'));
    }
    public function StoreMeetingAgenda(Request $request)
    {
        $request->validate([
            'meeting_type_id' => 'required',
            'committee_category_id' => 'required',
            'meeting_format_id' => 'required',
            'meeting_agenda_title' => 'required',
            'meeting_agenda_number' => 'required',
            'meeting_agenda_year' => 'required',
            'meeting_agenda_date' => 'required',
            'meeting_agenda_time' => 'required',
            'meeting_location' => 'required',
            'approval_deadline_date' => 'required|date',
            'approval_deadline_time' => 'required',
            'committee_opinion_title' => 'required|string|max:255'
        ]);
        DB::beginTransaction();
        try {
                $meeting_agenda = new MeetingAgenda();
                $meeting_agenda->meeting_type_id = $request->meeting_type_id;
                $meeting_agenda->committee_category_id = $request->committee_category_id;
                $meeting_agenda->meeting_format_id = $request->meeting_format_id;
                $meeting_agenda->meeting_agenda_title = $request->meeting_agenda_title;
                $meeting_agenda->meeting_agenda_number = $request->meeting_agenda_number;
                $meeting_agenda->meeting_agenda_year = $request->meeting_agenda_year;
                $meeting_agenda->meeting_agenda_date = $request->meeting_agenda_date;
                $meeting_agenda->meeting_agenda_time = $request->meeting_agenda_time;
                $meeting_agenda->meeting_location = $request->meeting_location;
                $meeting_agenda->description = $request->description;
                $meeting_agenda->user_id = Auth::user()->id;
                $meeting_agenda->status = 1;
                $meeting_agenda->created_at = Carbon::now();
                $meeting_agenda->show_committee_opinion = $request->has('show_committee_opinion');
                $meeting_agenda->committee_opinion_title = $request->committee_opinion_title;
                $deadlineDate = $request->approval_deadline_date;
                $deadlineTime = $request->approval_deadline_time;
                $meeting_agenda->approval_deadline = Carbon::parse("$deadlineDate $deadlineTime");
                $meeting_agenda->save();
                if ($request->has('rule_of_meeting_ids')) {
                    $meeting_agenda->ruleOfMeeting()->sync($request->rule_of_meeting_ids);
                }
                if ($request->has('regulation_meeting_ids')) {
                    $meeting_agenda->regulationMeeting()->sync($request->regulation_meeting_ids);
                }
                DB::commit();
                $notification = array(
                    'message' => 'บันทึกระเบียบวาระการประชุมสำเร็จ',
                    'alert-type' => 'success'
                );
                return redirect()->route('all.meeting.agenda')->with($notification);
            } catch (\Exception $e) {
                DB::rollBack();
                $notification = array(
                    'message' => 'เกิดข้อผิดพลาดในการบันทึกข้อมูล: ' . $e->getMessage(),
                    'alert-type' => 'error'
                );
                return redirect()->back()->withInput()->with($notification);
            }
    }
    public function UpdateStatusMeetingAgenda($id)
    {
        try {
            $meeting_agenda = MeetingAgenda::findOrFail($id);
            $meeting_agenda->status = $meeting_agenda->status == 1 ? 0 : 1;
            $meeting_agenda->save();
            $statusText = $meeting_agenda->status == 1 ? 'เปิดใช้งาน' : 'ปิดใช้งาน';
            $notification = [
                'message' => "สถานะถูกเปลี่ยนเป็น {$statusText} เรียบร้อยแล้ว",
                'alert-type' => 'success'
            ];
            return response()->json([
                'status' => $meeting_agenda->status,
                'message' => $notification['message']
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'status' => 'error',
                'message' => 'เกิดข้อผิดพลาดในการอัปเดตสถานะ: ' . $e->getMessage()
            ], 500);
        }
    }
    public function updateStatus($id, Request $request)
    {
        try {
            $meetingAgenda = MeetingAgenda::findOrFail($id);
            $meetingAgenda->status = $request->status;
            $meetingAgenda->save();
            return response()->json([
                'success' => true,
                'message' => 'อัพเดทสถานะสำเร็จ'
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'เกิดข้อผิดพลาดในการอัพเดทสถานะ'
            ], 500);
        }
    }
    public function EditMeetingAgenda($id)
    {
        try {
            $meeting_agenda = MeetingAgenda::with('ruleOfMeeting', 'regulationMeeting')->findOrFail($id);
            $meeting_types = MeetingType::all();
            $committee_categories = CommitteeCategory::all();
            $meeting_formats = MeetingFormat::all();
            $rule_of_meetings = RuleofMeeting::all();
            $regulation_meetings = RegulationMeeting::all();
            return view('admin.backend.pages.meeting_agenda.edit_meeting_agenda', compact(
                'meeting_agenda',
                'meeting_types',
                'committee_categories',
                'meeting_formats',
                'rule_of_meetings',
                'regulation_meetings'
            ));
        } catch (\Exception $e) {
            $notification = [
                'message' => 'เกิดข้อผิดพลาดในการโหลดข้อมูล: ' . $e->getMessage(),
                'alert-type' => 'error'
            ];
            return redirect()->route('all.meeting.agenda')->with($notification);
        }
    }
    public function UpdateMeetingAgenda(Request $request)
    {
        $request->validate([
            'meeting_type_id' => 'required',
            'meeting_agenda_title' => 'required',
            'meeting_agenda_number' => 'required',
            'meeting_agenda_year' => 'required',
            'meeting_agenda_date' => 'required',
            'meeting_agenda_time' => 'required',
            'meeting_location' => 'required',
            'approval_deadline_date' => 'required|date',
            'approval_deadline_time' => 'required',
            'committee_opinion_title' => 'required|string|max:255'
        ]);
        $meeting_agenda = MeetingAgenda::findOrFail($request->id);
        $approval_deadline = null;
        if ($request->approval_deadline_date && $request->approval_deadline_time) {
            $approval_deadline = Carbon::createFromFormat(
                'Y-m-d H:i',
                $request->approval_deadline_date . ' ' . $request->approval_deadline_time
            );
        }
        try {
            $meeting_agenda->meeting_type_id = $request->meeting_type_id;
            $meeting_agenda->committee_category_id = $request->committee_category_id;
            $meeting_agenda->meeting_format_id = $request->meeting_format_id;
            $meeting_agenda->meeting_agenda_title = $request->meeting_agenda_title;
            $meeting_agenda->meeting_agenda_number = $request->meeting_agenda_number;
            $meeting_agenda->meeting_agenda_year = $request->meeting_agenda_year;
            $meeting_agenda->meeting_agenda_date = $request->meeting_agenda_date;
            $meeting_agenda->meeting_agenda_time = $request->meeting_agenda_time;
            $meeting_agenda->meeting_location = $request->meeting_location;
            $meeting_agenda->description = $request->description;
            $meeting_agenda->approval_deadline = $approval_deadline;
            $meeting_agenda->user_id = Auth::user()->id;
            $meeting_agenda->updated_at = Carbon::now();
            $meeting_agenda->show_committee_opinion = $request->has('show_committee_opinion');
            $meeting_agenda->committee_opinion_title = $request->committee_opinion_title;
            $meeting_agenda->save();
            if ($request->has('rule_of_meeting_ids')) {
                $meeting_agenda->ruleOfMeeting()->sync($request->rule_of_meeting_ids);
            } else {
                $meeting_agenda->ruleOfMeeting()->detach();
            }
            if ($request->has('regulation_meeting_ids')) {
                $meeting_agenda->regulationMeeting()->sync($request->regulation_meeting_ids);
            } else {
                $meeting_agenda->regulationMeeting()->detach();
            }
            $notification = array(
                'message' => 'แก้ไขระเบียบวาระการประชุมแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->route('all.meeting.agenda')->with($notification);
        } catch (\Exception $e) {
            return redirect()->back()->with([
                'message' => 'ไม่สามารถแก้ไขระเบียบวาระการประชุมได้: ' . $e->getMessage(),
                'alert-type' => 'error'
            ]);
        }
    }
    public function DeleteMeetingAgenda($id)
    {
        try {
            MeetingAgenda::findOrFail($id)->delete();
            $notification = array(
                'message' => 'ลบระเบียบวาระการประชุมแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->back()->with($notification);
        } catch (\Exception $e) {
            return back()->with('error', 'Unable to delete meeting agenda. Please try again.');
        }
    }
    public function AddMeetingAgendaLecture($id)
    {
        $meeting_agenda = MeetingAgenda::findOrFail($id);
        $meeting_section = MeetingAgendaSection::where('meeting_agenda_id', $id)->orderBy('id', 'asc')->get();
        $meeting_lectures = MeetingAgendaLecture::with('meetingAgendaItems')->where('meeting_agenda_id', $id)->latest()->get();
        return view('admin.backend.pages.section.add_meeting_agenda_lecture', compact('meeting_agenda', 'meeting_section', 'meeting_lectures'));
    }
    public function AddMeetingAgendaSection(Request $request)
    {
        $meeting_agenda_id = $request->id;
        MeetingAgendaSection::insert([
            'meeting_agenda_id' => $meeting_agenda_id,
            'section_title' => $request->section_title,
            'description' => $request->section_content,
            'created_at' => Carbon::now()
        ]);
        $notification = array(
            'message' => 'เพิ่มหัวข้อส่วนของระเบียบวาระการประชุมแล้ว',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
    public function EditMeetingAgendaSection($id)
    {
        $meeting_agenda_section = MeetingAgendaSection::findOrFail($id);
        $meeting_agenda = MeetingAgenda::where('id', $meeting_agenda_section->meeting_agenda_id)->first();
        return view('admin.backend.pages.section.edit_meeting_agenda_section', compact('meeting_agenda_section', 'meeting_agenda'));
    }
    public function UpdateMeetingAgendaSection(Request $request)
    {
        $meeting_agenda_section = MeetingAgendaSection::findOrFail($request->id);
        $meeting_agenda_section->section_title = $request->section_title;
        $meeting_agenda_section->description = $request->description;
        $meeting_agenda_section->updated_at = Carbon::now();
        $meeting_agenda_section->save();
        $notification = array(
            'message' => 'แก้ไขหัวข้อส่วนของระเบียบวาระการประชุมแล้ว',
            'alert-type' => 'success'
        );
        return redirect()->back()->with($notification);
    }
    public function DeleteMeetingAgendaSection($id)
    {
        try {
            MeetingAgendaSection::findOrFail($id)->delete();
            $notification = array(
                'message' => 'ลบหัวข้อส่วนของระเบียบวาระการประชุมแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->back()->with($notification);
        } catch (\Exception $e) {
            return back()->with('error', 'Unable to delete meeting agenda section. Please try again.');
        }
    }
    public function SaveMeetingAgendaLecture(Request $request)
    {
        try {
            DB::beginTransaction();
            $request->validate([
                'meeting_agenda_id' => 'required',
                'meeting_agenda_section_id' => 'required',
                'lecture_title' => 'required|string',
                'content' => 'nullable',
                'committee_review' => 'nullable|array'
            ]);
            $meeting_agenda_lecture = new MeetingAgendaLecture();
            $meeting_agenda_lecture->meeting_agenda_id = $request->meeting_agenda_id;
            $meeting_agenda_lecture->meeting_agenda_section_id = $request->meeting_agenda_section_id;
            $meeting_agenda_lecture->lecture_title = $request->lecture_title;
            $meeting_agenda_lecture->content = $request->content;
            if ($request->has('committee_review')) {
                $meeting_agenda_lecture->committee_opinion = $request->committee_review['general_opinion'] ?? null;
                $meeting_agenda_lecture->approve_comment = $request->committee_review['approve']['comment'] ?? null;
                $meeting_agenda_lecture->approve_votes = $request->committee_review['approve']['votes'] ?? 0;
                $meeting_agenda_lecture->disapprove_comment = $request->committee_review['disapprove']['comment'] ?? null;
                $meeting_agenda_lecture->disapprove_votes = $request->committee_review['disapprove']['votes'] ?? 0;
            }
            $meeting_agenda_lecture->created_at = Carbon::now();
            if ($meeting_agenda_lecture->save()) {
                DB::commit();
                return response()->json([
                    'success' => 'เพิ่มหัวข้อเรื่องรายงานวาระการประชุมแล้ว',
                    'lecture_id' => $meeting_agenda_lecture->id
                ], 200);
            }
            throw new \Exception('ไม่สามารถบันทึกข้อมูลได้');
        } catch (ValidationException $e) {
            DB::rollBack();
            return response()->json([
                'error' => [
                    'th' => 'ข้อมูลไม่ถูกต้อง',
                    'en' => $e->getMessage()
                ]
            ], 422);
        } catch (\Exception $e) {
            DB::rollBack();
            return response()->json([
                'error' => [
                    'th' => 'เกิดข้อผิดพลาดในการบันทึกข้อมูล',
                    'en' => $e->getMessage()
                ]
            ], 500);
        }
    }
    public function EditMeetingAgendaLecture($id)
    {
        $meeting_agenda_lecture = MeetingAgendaLecture::findOrFail($id);
        return view('admin.backend.pages.lecture.edit_meeting_agenda_lecture', compact('meeting_agenda_lecture'));
    }
    public function UpdateMeetingAgendaLecture(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'id' => 'required|exists:meeting_agenda_lectures,id',
                'lecture_title' => 'required|string|max:255',
                'content' => 'nullable',
                'committee_opinion' => 'nullable',
                'approve_comment' => 'nullable|string',
                'approve_votes' => 'nullable|integer|min:0',
                'disapprove_comment' => 'nullable|string',
                'disapprove_votes' => 'nullable|integer|min:0'
            ]);
            $meeting_agenda_lecture = MeetingAgendaLecture::findOrFail($request->id);
            $updateData = [
                'lecture_title' => $request->lecture_title,
                'content' => $request->content,
                'committee_opinion' => $request->committee_opinion,
                'approve_comment' => $request->approve_comment,
                'approve_votes' => $request->approve_votes ?? 0,
                'disapprove_comment' => $request->disapprove_comment,
                'disapprove_votes' => $request->disapprove_votes ?? 0,
                'updated_at' => Carbon::now()
            ];
            $meeting_agenda_lecture->update($updateData);
            $meeting_agenda_id = $meeting_agenda_lecture->meeting_agenda_id;
            DB::commit();
            $notification = [
                'message' => 'ปรับปรุงหัวข้อเรื่องรายงานวาระการประชุมแล้ว',
                'alert-type' => 'success'
            ];
            return redirect()->back()->with($notification);
        } catch (ValidationException $e) {
            DB::rollBack();
            return back()
                ->withErrors($e->errors())
                ->withInput()
                ->with([
                    'message' => 'กรุณาตรวจสอบข้อมูลที่กรอก',
                    'alert-type' => 'error'
                ]);
        } catch (\Exception $e) {
            DB::rollBack();
            return back()
                ->with([
                    'message' => 'เกิดข้อผิดพลาด: ' . $e->getMessage(),
                    'alert-type' => 'error'
                ]);
        }
    }
    public function DeleteMeetingAgendaLecture($id)
    {
        try {
            MeetingAgendaLecture::findOrFail($id)->delete();
            $notification = array(
                'message' => 'ลบหัวข้อเรื่องรายงานวาระการประชุมแล้ว',
                'alert-type' => 'success'
            );
            return redirect()->back()->with($notification);
        } catch (\Exception $e) {
            return back()->with('error', 'Unable to delete meeting agenda lecture. Please try again.');
        }
    }
    public function SaveMeetingAgendaItem(Request $request)
    {
        try {
            $request->validate([
                'course_id' => 'required',
                'section_id' => 'required',
                'lecture_id' => 'required',
                'item_title' => 'required',
            ]);
            $meeting_agenda_item = new MeetingAgendaItems();
            $meeting_agenda_item->meeting_agenda_id = $request->course_id;
            $meeting_agenda_item->meeting_agenda_section_id = $request->section_id;
            $meeting_agenda_item->meeting_agenda_lecture_id = $request->lecture_id;
            $meeting_agenda_item->item_title = $request->item_title;
            $meeting_agenda_item->content = $request->content;
            $meeting_agenda_item->created_at = Carbon::now();
            if ($meeting_agenda_item->save()) {
                return response()->json([
                    'success' => true,
                    'message' => 'เพิ่มรายการของระเบียบวาระการประชุมแล้ว'
                ], 200);
            }
            return response()->json([
                'success' => false,
                'message' => 'ไม่สามารถเพิ่มรายการของระเบียบวาระการประชุมได้'
            ], 400);
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'เกิดข้อผิดพลาดในการประมวลผล: ' . $e->getMessage()
            ], 500);
        }
    }
    public function EditMeetingAgendaItem($id)
    {
        $meeting_agenda_item = MeetingAgendaItems::findOrFail($id);
        return view('admin.backend.pages.lecture.edit_meeting_agenda_item', compact('meeting_agenda_item'));
    }
    public function GetAgendaItem($lectureId)
    {
        $meeting_agenda_items = MeetingAgendaItems::where('meeting_agenda_lecture_id', $lectureId)->get();
        return response()->json($meeting_agenda_items);
    }
    public function getAgendaItems($itemId)
{
    try {
        $item = MeetingAgendaItems::findOrFail($itemId);
        return response()->json($item);
    } catch (\Exception $e) {
        return response()->json(['error' => 'Failed to load agenda item'], 500);
    }
}
    public function UpdateAgendaItem(Request $request, $itemId)
    {
        try {
            $request->validate([
                'item_title' => 'required',
            ]);
            $item = MeetingAgendaItems::findOrFail($itemId);
            $item->item_title = $request->item_title;
            $item->content = $request->content;
            $item->save();
            return response()->json([
                'success' => true,
                'message' => 'Agenda item updated successfully',
                'meeting_agenda_lecture_id' => $item->meeting_agenda_lecture_id
            ]);
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'Failed to update agenda item: ' . $e->getMessage()
            ], 500);
        }
    }
    public function DeleteAgendaItem($itemId)
    {
        $agendaItem = MeetingAgendaItems::findOrFail($itemId);
        $lectureId = $agendaItem->meeting_agenda_lecture_id;
        if ($agendaItem->delete()) {
            return response()->json([
                'success' => true,
                'message' => 'Agenda item deleted successfully',
                'meeting_agenda_lecture_id' => $lectureId
            ]);
        } else {
            return response()->json([
                'success' => false,
                'message' => 'Failed to delete agenda item'
            ], 500);
        }
    }
}
</file>

<file path="routes/web.php">
<?php
use App\Http\Controllers\AdminController;
use App\Http\Controllers\ApprovedMeetingReportController;
use App\Http\Controllers\Backend\RoleController;
use App\Http\Controllers\Category\CommitteeCategoryController;
use App\Http\Controllers\Category\MeetingTypeController;
use App\Http\Controllers\Category\RegulationCategoryController;
use App\Http\Controllers\Category\RuleCategoryController;
use App\Http\Controllers\CommitteeOpinionController;
use App\Http\Controllers\CommitteeVoteController;
use App\Http\Controllers\LegalDatabaseController;
use App\Http\Controllers\MainMeetingController;
use App\Http\Controllers\MeetingAgendaController;
use App\Http\Controllers\MeetingApprovalController;
use App\Http\Controllers\MeetingApprovalListController;
use App\Http\Controllers\MeetingController;
use App\Http\Controllers\MeetingFormatController;
use App\Http\Controllers\MeetingReportController;
use App\Http\Controllers\MeetingReportSummaryController;
use App\Http\Controllers\MeetingResolutionController;
use App\Http\Controllers\MeetingResolutionTypeController;
use App\Http\Controllers\PositionController;
use App\Http\Controllers\PrefixNameController;
use App\Http\Controllers\ProfileController;
use App\Http\Controllers\RegulationMeetingController;
use App\Http\Controllers\RuleMeetingController;
use App\Http\Controllers\SettingsController;
use App\Http\Controllers\UserController;
use App\Http\Controllers\UserProfileController;
use App\Http\Middleware\RedirectIfAuthenticated;
use App\Http\Middleware\Role;
use App\Models\Meeting;
use App\Models\User;
use Illuminate\Support\Facades\Route;
Route::get('/', function () {
    return view('welcome');
});
Route::get('/dashboard', function () {
    return redirect('/admin/dashboard');
})->middleware(['auth', 'verified'])->name('dashboard');
Route::middleware('auth')->group(function () {
    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');
});
require __DIR__.'/auth.php';
Route::middleware(['auth', 'roles:admin'])->group(function () {
    Route::get('/notifications', function() {
        $notifications = auth()->user()->unreadNotifications;
        auth()->user()->unreadNotifications->markAsRead();
        return response()->json($notifications);
    });
    Route::get('/admin/dashboard', [AdminController::class, 'AdminDashboard'])->name('admin.dashboard');
    Route::get('/admin/logout', [AdminController::class, 'AdminLogout'])->name('admin.logout');
    Route::get('/admin/permission', [RoleController::class, 'AllPermission'])->name('all.permission');
    Route::get('/admin/permission/add', [RoleController::class, 'AddPermission'])->name('add.permission');
    Route::post('/admin/permission/store', [RoleController::class, 'StorePermission'])->name('store.permission');
    Route::get('/admin/permission/{id}/edit', [RoleController::class, 'EditPermission'])->name('edit.permission');
    Route::post('/admin/permission/update', [RoleController::class, 'UpdatePermission'])->name('update.permission');
    Route::get('/admin/permission/{id}/delete', [RoleController::class, 'DeletePermission'])->name('delete.permission');
    Route::get('/admin/role', [RoleController::class, 'AllRole'])->name('all.roles');
    Route::get('/admin/role/add', [RoleController::class, 'AddRole'])->name('add.roles');
    Route::post('/admin/role/store', [RoleController::class, 'StoreRole'])->name('store.roles');
    Route::get('/admin/role/{id}/edit', [RoleController::class, 'EditRole'])->name('edit.roles');
    Route::post('/admin/role/update', [RoleController::class, 'UpdateRole'])->name('update.roles');
    Route::get('/admin/role/{id}/delete', [RoleController::class, 'DeleteRole'])->name('delete.roles');
    Route::get('/admin/roles/permission', [RoleController::class, 'AddRolesPermission'])->name('add.roles.permission');
    Route::post('/admin/role/permission/store', [RoleController::class, 'RolePermissionStore'])->name('role.permission.store');
    Route::get('/admin/roles/permission/all', [RoleController::class, 'AllRolePermission'])->name('all.roles.permission')->middleware('permission:All.User.Menu');
    Route::get('/admin/roles/permission/edit/{id}', [RoleController::class, 'AdminEditRoles'])->name('admin.edit.roles');
    Route::post('/admin/roles/permission/update/{id}', [RoleController::class, 'AdminUpdateRoles'])->name('admin.roles.update');
    Route::get('/admin/roles/permission/delete/{id}', [RoleController::class, 'AdminDeleteRoles'])->name('admin.delete.roles');
    Route::get('/all/admin', [AdminController::class, 'AllAdmin'])->name('all.admin');
    Route::get('/admin/add/admin', [AdminController::class, 'AddAdmin'])->name('add.admin');
    Route::post('/admin/store/admin', [AdminController::class, 'StoreAdmin'])->name('store.admin');
    Route::get('/admin/admin/{id}/edit', [AdminController::class, 'EditAdmin'])->name('edit.admin');
    Route::post('/admin/update/{id}', [AdminController::class, 'UpdateAdmin'])->name('update.admin');
    Route::get('/delete/admin/{id}', [AdminController::class, 'DeleteAdmin'])->name('delete.admin');
    Route::get('/profile/edit', [UserProfileController::class, 'editProfile'])->name('user.profile.edit');
    Route::post('/profile/update', [UserProfileController::class, 'updateProfile'])->name('user.profile.update');
    Route::get('/all/prefix-name', [PrefixNameController::class, 'AllPrefixName'])->name('all.prefix.name');
    Route::get('/add/prefix-name', [PrefixNameController::class, 'AddPrefixName'])->name('add.prefix.name');
    Route::post('/store/prefix-name', [PrefixNameController::class, 'StorePrefixName'])->name('store.prefix.name');
    Route::get('/edit/prefix-name/{id}', [PrefixNameController::class, 'EditPrefixName'])->name('edit.prefix.name');
    Route::post('/update/prefix-name/{id}', [PrefixNameController::class, 'UpdatePrefixName'])->name('update.prefix.name');
    Route::get('/delete/prefix-name/{id}', [PrefixNameController::class, 'DeletePrefixName'])->name('delete.prefix.name');
    Route::get('/all/position', [PositionController::class, 'AllPosition'])->name('all.position');
    Route::get('/add/position', [PositionController::class, 'AddPosition'])->name('add.position');
    Route::post('/store/position', [PositionController::class, 'StorePosition'])->name('store.position');
    Route::get('/edit/position/{id}', [PositionController::class, 'EditPosition'])->name('edit.position');
    Route::post('/update/position/{id}', [PositionController::class, 'UpdatePosition'])->name('update.position');
    Route::get('/delete/position/{id}', [PositionController::class, 'DeletePosition'])->name('delete.position');
    Route::controller(RuleCategoryController::class)->group(function () {
        Route::get('/all/rules-category', 'AllRuleCategory')->name('rule.category');
        Route::get('/add/rules-category', 'AddRuleCategory')->name('add.rule.category');
        Route::post('/store/rule-category', 'StoreRulesCategory')->name('store.rule.category');
        Route::get('/edit/rule-category/{id}', 'EditRulesCategory')->name('edit.rule.category');
        Route::post('/update/rule-category', 'UpdateRulesCategory')->name('update.rule.category');
        Route::get('/delete/rule-category/{id}', 'DeleteRulesCategory')->name('delete.rule.category');
    });
    Route::controller(RegulationCategoryController::class)->group(function () {
        Route::get('/all/regulation-category', 'AllRegulationCategory')->name('all.regulation.category');
        Route::get('/add/regulation-category', 'AddRegulationCategory')->name('add.regulation.category');
        Route::post('/store/regulation-category', 'StoreRegulationCategory')->name('store.regulation.category');
        Route::get('/edit/regulation-category/{id}', 'EditRegulationCategory')->name('edit.regulation.category');
        Route::post('/update/regulation-category', 'UpdateRegulationCategory')->name('update.regulation.category');
        Route::get('/delete/regulation-category/{id}', 'DeleteRegulationCategory')->name('delete.regulation.category');
    });
    Route::controller(RuleMeetingController::class)->group(function () {
        Route::get('/all/rules-of-meeting', 'AllRulesOfMeeting')->name('all.rule.meeting');
        Route::get('/add/rules-of-meeting', 'AddRulesOfMeeting')->name('add.rule.meeting');
        Route::post('/store/rules-of-meeting', 'StoreRulesOfMeeting')->name('store.rule.meeting');
        Route::get('/edit/rules-of-meeting/{id}', 'EditRulesOfMeeting')->name('edit.rule.meeting');
        Route::post('/update/rules-of-meeting', 'UpdateRulesOfMeeting')->name('update.rule.meeting');
        Route::post('/update/status/rule-meeting/{id}', 'UpdateStatusRulesOfMeeting')->name('update.status.rule.meeting');
        Route::get('/delete/rules-of-meeting/{id}', 'DeleteRulesOfMeeting')->name('delete.rule.meeting');
    });
    Route::controller(RegulationMeetingController::class)->group(function () {
        Route::get('/all/regulation-of-meeting', 'AllRegulationOfMeeting')->name('all.regulation.meeting');
        Route::get('/add/regulation-of-meeting', 'AddRegulationOfMeeting')->name('add.regulation.meeting');
        Route::post('/store/regulation-of-meeting', 'StoreRegulationOfMeeting')->name('store.regulation.meeting');
        Route::get('/edit/regulation-of-meeting/{id}', 'EditRegulationOfMeeting')->name('edit.regulation.meeting');
        Route::post('/update/regulation-of-meeting', 'UpdateRegulationOfMeeting')->name('update.regulation.meeting');
        Route::post('/update/status/regulation-meeting/{id}', 'UpdateStatusRegulationMeeting')->name('update.status.regulation.meeting');
        Route::get('/delete/regulation-of-meeting/{id}', 'DeleteRegulationOfMeeting')->name('delete.regulation.meeting');
    });
    Route::controller(CommitteeCategoryController::class)->group(function () {
        Route::get('/all/committee-category', 'AllCommitteeCategory')->name('all.committee.category');
        Route::get('/add/committee-category', 'AddCommitteeCategory')->name('add.committee.category');
        Route::post('/store/committee-category', 'StoreCommitteeCategory')->name('store.committee.category');
        Route::get('/edit/committee-category/{id}', 'EditCommitteeCategory')->name('edit.committee.category');
        Route::post('/update/committee-category', 'UpdateCommitteeCategory')->name('update.committee.category');
        Route::get('/delete/committee-category/{id}', 'DeleteCommitteeCategory')->name('delete.committee.category');
    });
    Route::controller(MainMeetingController::class)->group(function () {
        Route::get('/all/main-meeting', 'AllMainMeeting')->name('all.main.meeting');
        Route::get('/add/main-meeting', 'AddMainMeeting')->name('add.main.meeting');
        Route::post('/store/main-meeting', 'StoreMainMeeting')->name('store.main.meeting');
        Route::get('/edit/main-meeting/{id}', 'EditMainMeeting')->name('edit.main.meeting');
        Route::post('/update/main-meeting/{id}', 'UpdateMainMeeting')->name('update.main.meeting');
        Route::get('/delete/main-meeting/{id}', 'DeleteMainMeeting')->name('delete.main.meeting');
    });
    Route::controller(MeetingFormatController::class)->group(function () {
        Route::get('/all/meeting-format', 'AllMeetingFormat')->name('all.meeting.format');
        Route::get('/add/meeting-format', 'AddMeetingFormat')->name('add.meeting.format');
        Route::post('/store/meeting-format', 'StoreMeetingFormat')->name('store.meeting.format');
        Route::get('/edit/meeting-format/{id}', 'EditMeetingFormat')->name('edit.meeting.format');
        Route::post('/update/meeting-format', 'UpdateMeetingFormat')->name('update.meeting.format');
        Route::get('/delete/meeting-format/{id}', 'DeleteMeetingFormat')->name('delete.meeting.format');
    });
    Route::controller(MeetingTypeController::class)->group(function () {
        Route::get('/all/meeting-type', 'AllMeetingType')->name('all.meeting.type');
        Route::get('/add/meeting-type', 'AddMeetingType')->name('add.meeting.type');
        Route::post('/store/meeting-type', 'StoreMeetingType')->name('store.meeting.type');
        Route::get('/edit/meeting-type/{id}', 'EditMeetingType')->name('edit.meeting.type');
        Route::post('/update/meeting-type', 'UpdateMeetingType')->name('update.meeting.type');
        Route::get('/delete/meeting-type/{id}', 'DeleteMeetingType')->name('delete.meeting.type');
    });
    Route::controller(MeetingReportController::class)->group(function () {
        Route::get('/all/meeting-report', 'AllMeetingReport')->name('all.meeting.report');
        Route::get('/add/meeting-report', 'AddMeetingReport')->name('add.meeting.report');
        Route::post('/store/meeting-report', 'StoreMeetingReport')->name('store.meeting.report');
        Route::get('/edit/meeting-report/{id}', 'EditMeetingReport')->name('edit.meeting.report');
        Route::post('/update/meeting-report/{id}', 'UpdateMeetingReport')->name('update.meeting.report');
        Route::get('/delete/meeting-report/{id}', 'DeleteMeetingReport')->name('delete.meeting.report');
    });
    Route::controller(MeetingAgendaController::class)->group(function () {
        Route::get('/all/meeting-agenda', 'AllMeetingAgenda')->name('all.meeting.agenda');
        Route::get('/add/meeting-agenda', 'AddMeetingAgenda')->name('add.meeting.agenda');
        Route::post('/store/meeting-agenda', 'StoreMeetingAgenda')->name('store.meeting.agenda');
        Route::get('/edit/meeting-agenda/{id}', 'EditMeetingAgenda')->name('edit.meeting.agenda');
        Route::post('/update/meeting-agenda/', 'UpdateMeetingAgenda')->name('update.meeting.agenda');
        Route::post('/update/status/meeting-agenda/{id}', 'UpdateStatusMeetingAgenda')->name('update.status.meeting.agenda');
        Route::get('/delete/meeting-agenda/{id}', 'DeleteMeetingAgenda')->name('delete.meeting.agenda');
        Route::get('/add/meeting/agenda/lecture/{id}', 'AddMeetingAgendaLecture')->name('add.meeting.agenda.lecture');
        Route::post('/add/meeting/agenda/section', 'AddMeetingAgendaSection')->name('add.meeting.agenda.section');
        Route::get('/edit/meeting/agenda/section/{id}',[MeetingAgendaController::class, 'EditMeetingAgendaSection'])->name('edit.meeting.agenda.section');
        Route::post('/update/meeting/agenda/section/{id}',[MeetingAgendaController::class, 'UpdateMeetingAgendaSection'])->name('update.meeting.agenda.section');
        Route::post('/save/meeting/agenda/lecture/',[MeetingAgendaController::class, 'SaveMeetingAgendaLecture'])->name('save.meeting.agenda.lecture');
        Route::get('/edit/meeting/agenda/lecture/{id}',[MeetingAgendaController::class, 'EditMeetingAgendaLecture'])->name('edit.meeting.agenda.lecture');
        Route::post('/update/meeting/agenda/lecture',[MeetingAgendaController::class, 'UpdateMeetingAgendaLecture'])->name('update.meeting.agenda.lecture');
        Route::delete('/delete/meeting/agenda/section/{id}',[MeetingAgendaController::class, 'DeleteMeetingAgendaSection'])->name('delete.meeting.agenda.section');
        Route::get('/delete/meeting/agenda/lecture/{id}',[MeetingAgendaController::class, 'DeleteMeetingAgendaLecture'])->name('delete.meeting.agenda.lecture');
        Route::post('/save/meeting/agenda/item', [MeetingAgendaController::class, 'SaveMeetingAgendaItem'])->name('save.meeting.agenda.item');
        Route::get('/get-agenda-items/{lecture_id}', [MeetingAgendaController::class, 'GetAgendaItem'])->name('get.agenda.item');
        Route::get('/edit/get-agenda-items/{itemId}', [MeetingAgendaController::class, 'getAgendaItems'])->name('edit.get.agenda.item');
        Route::post('/update-agenda-item/{itemId}', [MeetingAgendaController::class, 'UpdateAgendaItem'])->name('update.agenda.item');
        Route::delete('/delete-agenda-item/{id}', [MeetingAgendaController::class, 'DeleteAgendaItem'])->name('delete.agenda.item');
    });
    Route::controller(MeetingController::class)->group(function () {
        Route::get('/all/meeting', 'AllMeeting')->name('all.meeting');
        Route::get('/add/meeting', 'AddMeeting')->name('add.meeting');
        Route::post('/store/meeting', 'StoreMeeting')->name('store.meeting');
        Route::get('/edit/meeting/{id}', 'EditMeeting')->name('edit.meeting');
        Route::post('/update/meeting', 'UpdateMeeting')->name('update.meeting');
        Route::get('/delete/meeting/{id}', 'DeleteMeeting')->name('delete.meeting');
    });
    Route::get('/my/meetings', [MeetingController::class, 'MyMeetings'])->name('my.meetings');
    Route::get('/meeting/details/{id}', [MeetingController::class, 'MeetingDetails'])->name('meeting.detail');
    Route::get('/meeting/section/detail/{id}', [MeetingController::class, 'sectionAgendaItemDetail'])->name('meeting.section.detail');
    Route::get('/meeting/lecture/detail/{id}', [MeetingController::class, 'lectureSectionDetail'])->name('meeting.lecture.detail');
    Route::get('/all/meeting-approval', [MeetingApprovalController::class, 'AllMeetingApproval'])->name('all.meeting.approval');
    Route::get('/meeting/approval/detail/{id}', [MeetingApprovalController::class, 'MeetingApprovalDetail'])->name('meeting.approval.detail');
    Route::post('/meeting-approval/{id}', [MeetingApprovalController::class, 'store'])->name('meeting.approval.store');
    Route::get('/meeting-approval-details/{id}', [MeetingApprovalController::class, 'getApprovalDetails'])->name('meeting.approval.details');
    Route::post('/meeting-approval/{id}/update', [MeetingApprovalController::class, 'updateApproval'])->name('meeting.approval.update');
    Route::get('/meeting-approval/edit/{id}', [MeetingApprovalController::class, 'editApproval'])->name('meeting.approval.edit');
    Route::get('/meeting/list/approval/{meeting_type_id}/{committee_id}', [MeetingApprovalListController::class, 'list'])->name('meeting.list.approval');
    Route::get('/settings/approval-deadline', [SettingsController::class, 'editApprovalDeadline'])->name('settings.edit_approval_deadline');
    Route::post('/settings/approval-deadline', [SettingsController::class, 'updateApprovalDeadline'])->name('settings.update_approval_deadline');
    Route::get('/meeting/report/summary', [MeetingReportSummaryController::class, 'index'])->name('meeting.report.summary.index');
    Route::get('/meeting/report/summary/{id}', [MeetingReportSummaryController::class, 'showSummary'])->name('meeting.report.summary');
    Route::get('/meeting/report/summary/{id}/edit', [MeetingReportSummaryController::class, 'edit'])->name('meeting.report.summary.edit');
    Route::post('/meeting/report/summary/{id}/update', [MeetingReportSummaryController::class, 'update'])->name('meeting.report.summary.update');
    Route::post('/meeting/report/{id}/admin-approve', [MeetingReportSummaryController::class, 'adminApprove']);
    Route::post('/meeting/report/{id}/admin-cancel', [MeetingReportSummaryController::class, 'adminCancel']);
    Route::get('/approved-meeting-reports', [ApprovedMeetingReportController::class, 'allApprovedByAdmin'])->name('all.approved.meeting.reports');
    Route::get('/approved-meeting-reports/{id}', [ApprovedMeetingReportController::class, 'ListApprovedByAdmin'])->name('list.approved.meeting.reports');
    Route::get('/reports/{id}/export/{type}', [ApprovedMeetingReportController::class, 'export'])->name('reports.export');
    Route::get('/meeting/export/{id}', [MeetingController::class, 'exportToWord'])->name('meeting.export.word');
    Route::post('/committee/feedback/store', [CommitteeOpinionController::class, 'store'])->name('committee.feedback.store');
    Route::get('/committee/feedback/{lectureId}', [CommitteeOpinionController::class, 'getOpinions'])->name('committee.feedback.get');
    Route::get('/committee/feedback/{lectureId}/current', [CommitteeOpinionController::class, 'getCurrentUserOpinion'])->name('committee.feedback.current');
    Route::post('/update-meeting-status/{id}', [MeetingAgendaController::class, 'updateStatus'])->name('update.meeting.status');
    Route::post('/update-committee-opinion-visibility/{id}', [MeetingController::class, 'updateCommitteeOpinionVisibility'])->name('update.committee.opinion.visibility');
    Route::get('/my/meetings', [MeetingController::class, 'MyMeetings'])->name('my.meetings');
    Route::get('/meeting/type/{meeting_type_id?}', [MeetingController::class, 'ViewMeetingType'])->name('meeting.type.view');
    Route::get('/meeting/details/{id}', [MeetingController::class, 'MeetingDetails'])->name('meeting.detail');
    Route::get('/admin/legal-database', [LegalDatabaseController::class, 'index'])->name('admin.legal.database');
    Route::get('/all/meeting/resolution', [MeetingResolutionController::class, 'AllMeetingResolution'])->name('all.meeting.resolution');
    Route::get('/add/meeting/resolution', [MeetingResolutionController::class, 'AddMeetingResolution'])->name('add.meeting.resolution');
    Route::post('/store/meeting/resolution', [MeetingResolutionController::class, 'StoreMeetingResolution'])->name('store.meeting.resolution');
    Route::get('/edit/meeting/resolution/{id}', [MeetingResolutionController::class, 'EditMeetingResolution'])->name('edit.meeting.resolution');
    Route::post('/update/meeting/resolution', [MeetingResolutionController::class, 'UpdateMeetingResolution'])->name('update.meeting.resolution');
    Route::get('/delete/meeting/resolution/{id}', [MeetingResolutionController::class, 'DeleteMeetingResolution'])->name('delete.meeting.resolution');
    Route::get('/search/meeting/resolution', [MeetingResolutionController::class, 'SearchMeetingResolution'])->name('search.meeting.resolution');
    Route::get('/search/meeting/resolution/results', [MeetingResolutionController::class, 'SearchMeetingResolutionResults'])->name('search.meeting.resolution.results');
    Route::get('/get-meeting-agenda-lectures/{section_id}', [MeetingResolutionController::class, 'GetMeetingAgendaLectures']);
    Route::get('/get/meeting/agendas', [MeetingResolutionController::class, 'GetMeetingAgendas'])->name('get.meeting.agendas');
    Route::get('/get/meeting/sections', [MeetingResolutionController::class, 'GetMeetingSections'])->name('get.meeting.sections');
    Route::get('/get/meeting/lectures', [MeetingResolutionController::class, 'GetMeetingAgendaLectures'])->name('get.meeting.lectures');
    Route::controller(MeetingResolutionTypeController::class)->group(function () {
        Route::get('/all/meeting-resolution-type', 'AllMeetingResolutionTypes')->name('all.meeting.resolution.types');
        Route::get('/add/meeting-resolution-type', 'AddMeetingResolutionType')->name('add.meeting.resolution.type');
        Route::post('/store/meeting-resolution-type', 'StoreMeetingResolutionType')->name('store.meeting.resolution.type');
        Route::get('/edit/meeting-resolution-type/{id}', 'EditMeetingResolutionType')->name('edit.meeting.resolution.type');
        Route::post('/update/meeting-resolution-type', 'UpdateMeetingResolutionType')->name('update.meeting.resolution.type');
        Route::get('/delete/meeting-resolution-type/{id}', 'DeleteMeetingResolutionType')->name('delete.meeting.resolution.type');
        Route::get('/get/meeting-resolution-types', 'GetMeetingResolutionTypes')->name('get.meeting.resolution.types');
    });
    Route::get('/meeting/resolution/types/search', [MeetingResolutionTypeController::class, 'SearchMeetingResolutionTypes'])->name('search.meeting.resolution.types');
});
Route::get('/user/login', [AdminController::class, 'UserLogin'])->name('user.login')->middleware(RedirectIfAuthenticated::class);
Route::middleware(['auth', 'roles:user'])->group(function () {
    Route::get('/user/dashboard', [UserController::class, 'UserDashboard'])->name('user.dashboard');
});
</file>

<file path="resources/views/admin/body/sidebar.blade.php">
<div class="sidebar-wrapper" data-simplebar="true">
    <div class="sidebar-header">
        <div>
            <a href=""><img src="{{ asset('backend/assets/images/logo-system-logo.png') }}" class="logo-icon"
                    alt="logo icon" style="width:239px"></a>
        </div>
        {{-- <div>
            <h4 class="logo-text">Admin</h4>
        </div> --}}
        <div class="toggle-icon ms-auto">
            {{-- <i class='bx bx-arrow-back'></i> --}}
        </div>
    </div>
    <!--navigation-->
    <ul class="metismenu" id="menu">
        <li>
            <a href="{{ route('admin.dashboard') }}">
                <div class="parent-icon"><i class='bx bx-home-alt'></i>
                </div>
                <div class="menu-title">หน้าหลัก</div>
            </a>
        </li>
        @if (Auth::user()->can('category.menu'))
            <li class="menu-label"></li>
            <li
                class="{{ request()->routeIs('all.meeting.type') || request()->routeIs('all.committee.category') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='lni lni-network'></i>
                    </div>
                    <div class="menu-title"> ประเภทการประชุม / คณะกรรมการ </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.meeting.type') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.meeting.type') }}"><i class='bx bx-radio-circle'></i>
                            จัดการประเภทการประชุม </a>
                    </li>
                    <li class="{{ request()->routeIs('all.committee.category') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.committee.category') }}"><i class='bx bx-radio-circle'></i>
                            จัดการประเภทคณะกรรมการ </a>
                    </li>
                </ul>
            </li>
            <hr>
            <li
                class="{{ request()->routeIs('rule.category') || request()->routeIs('all.rule.meeting') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='bx bx-list-check'></i>
                    </div>
                    <div class="menu-title"> ข้อบังคับ </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('rule.category') ? 'mm-active' : '' }}"> <a
                            href="{{ route('rule.category') }}"><i class='bx bx-radio-circle'></i> จัดการประเภทข้อบังคับ
                        </a>
                    </li>
                    <li class="{{ request()->routeIs('all.rule.meeting') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.rule.meeting') }}"><i class='bx bx-radio-circle'></i> จัดการข้อบังคับ
                        </a>
                    </li>
                </ul>
            </li>
            <hr>
            <li
                class="{{ request()->routeIs('all.regulation.category') || request()->routeIs('all.regulation.meeting') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='lni lni-clipboard'></i>
                    </div>
                    <div class="menu-title"> ระเบียบ </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.regulation.category') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.regulation.category') }}"><i class='bx bx-radio-circle'></i>
                            จัดการประเภทระเบียบ </a>
                    </li>
                    <li class="{{ request()->routeIs('all.regulation.meeting') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.regulation.meeting') }}"><i class='bx bx-radio-circle'></i>
                            จัดการระเบียบ </a>
                    </li>
                </ul>
            </li>
            <hr>
            {{-- <li class="">
            <a href="javascript:;" class="has-arrow">
                <div class="parent-icon"><i class='bx bx-line-chart'></i>
                </div>
                <div class="menu-title"> กฎหมาย </div>
            </a>
            <ul>
                <li class=""> <a href=""><i class='bx bx-radio-circle'></i> จัดการประเภทกฎหมาย </a>
                </li>
                <li class=""> <a href=""><i class='bx bx-radio-circle'></i> จัดการกฎหมาย </a>
                </li>
            </ul>
        </li>
        <hr> --}}
            {{-- <li class="">
            <a href="javascript:;" class="has-arrow">
                <div class="parent-icon"><i class='bx bx-line-chart'></i>
                </div>
                <div class="menu-title"> กฎหมายอื่นๆ ที่เกี่ยวข้อง </div>
            </a>
            <ul>
                <li class=""> <a href=""><i class='bx bx-radio-circle'></i> จัดการประเภทกฎหมายอื่นๆ </a>
                </li>
                <li class=""> <a href=""><i class='bx bx-radio-circle'></i> จัดการกฎหมายอื่นๆ </a>
                </li>
            </ul>
        </li>
        <hr> --}}
            <li class="{{ request()->routeIs('all.meeting.format') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='lni lni-layers'></i>
                    </div>
                    <div class="menu-title"> รูปแบบการประชุม </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.meeting.format') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.meeting.format') }}"><i class='bx bx-radio-circle'></i>
                            จัดการประเภทรูปแบบการประชุม </a>
                    </li>
                </ul>
            </li>
            <hr>
            {{-- <li>
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='bx bx-cart'></i>
                    </div>
                    <div class="menu-title"> ประชุมหลัก (อาจไม่ใช้)</div>
                </a>
                <ul>
                    <li> <a href="{{ route('all.main.meeting') }}"><i class='bx bx-radio-circle'></i> จัดการประชุมหลัก </a>
                    </li>
                </ul>
            </li>
        <hr> --}}
            <li class="{{ request()->routeIs('all.meeting.report') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='bx bx-line-chart'></i>
                    </div>
                    <div class="menu-title"> รายงานการประชุม </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.meeting.report') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.meeting.report') }}"><i class='bx bx-radio-circle'></i>
                            จัดการรายงานการประชุม </a>
                    </li>
                </ul>
            </li>
            <hr>
            <li class="{{ request()->routeIs('all.meeting.resolution') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='bx bxs-report'></i>
                    </div>
                    <div class="menu-title"> รายงานมติการประชุม </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.meeting.resolution') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.meeting.resolution') }}"><i class='bx bx-upload'></i>
                            จัดการรายงานมติการประชุม </a>
                    </li>
                    <li class=""> <a
                            href="{{ route('all.meeting.resolution.types') }}"><i class='bx bx-category'></i>
                            เพิ่ม O ประเภทคณะกรรมการของแต่ละด้าน </a>
                    </li>
                    {{-- <li class="{{ request()->routeIs('search.meeting.resolution') ? 'mm-active' : '' }}"> <a
                        href="{{ route('search.meeting.resolution') }}"><i class='bx bx-search'></i>
                        สืบค้นข้อมูลมติการประชุม </a>
                    </li> --}}
                </ul>
            </li>
            <hr>
            <li
                class="{{ request()->routeIs('all.meeting.agenda') || request()->routeIs('meeting.report.summary.index') || request()->routeIs('add.meeting.agenda') || request()->routeIs('edit.meeting.agenda') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='bx bx-comment-dots'></i>
                    </div>
                    <div class="menu-title"> ระเบียบวาระการประชุม </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.meeting.agenda') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.meeting.agenda') }}"><i class='bx bx-file'></i>
                            จัดการระเบียบวาระการประชุม </a>
                    </li>
                    <li class="{{ request()->routeIs('meeting.report.summary.index') ? 'mm-active' : '' }}">
                        <a href="{{ route('meeting.report.summary.index') }}">
                            <i class="bx bx-file"></i>
                            <span>สรุปรายงานการประชุม</span>
                        </a>
                    </li>
                    {{-- <li class="{{ request()->routeIs('add.meeting.agenda') ? 'mm-active' : '' }}"> <a href="{{ route('add.meeting.agenda') }}"><i class='bx bx-radio-circle'></i> เพิ่มระเบียบวาระการประชุม </a>
                </li> --}}
                    {{-- <li> <a href=""><i class='bx bx-radio-circle'></i> จัดการประเภทคณะกรรมการ </a>
                </li>
                <li> <a href=""><i class='bx bx-radio-circle'></i> จัดการรายงานการประชุม </a>
                </li> --}}
                </ul>
            </li>
            <hr>
            {{-- <li class="{{ request()->routeIs('my.meetings') ? 'mm-active' : '' }}">
            <a href="javascript:;" class="has-arrow">
                <div class="parent-icon"><i class='bx bx-line-chart'></i>
                </div>
                <div class="menu-title"> การประชุม </div>
            </a>
            <ul>
                <li> <a href="{{ route('all.meeting') }}"><i class='bx bx-radio-circle'></i> จัดการการประชุม </a>
                </li>
                <li class="{{ request()->routeIs('my.meetings') ? 'mm-active' : '' }}"> <a href="{{ route('my.meetings') }}"><i class='bx bx-radio-circle'></i> แสดงรายงานการประชุม </a>
                </li>
            </ul>
        </li> --}}
        @endif
        {{-- <li class="{{ request()->routeIs('meeting.section.detail') ? 'mm-active' : '' }}">
            <a href="javascript:;" class="has-arrow">
                <i class='bx bx-list-ul'></i>
                <div class="menu-title"> หมวดวาระการประชุม </div>
            </a>
            <ul>
                @php
                    $meetingAgendas = \App\Models\MeetingAgenda::where('status', 1)->get();
                @endphp
                @if ($meetingAgendas && $meetingAgendas->count() > 0)
                    @foreach ($meetingAgendas as $agenda)
                        @php
                            $meetingAgendaSections = \App\Models\MeetingAgendaSection::where('meeting_agenda_id', $agenda->id)->get();
                        @endphp
                        @if ($meetingAgendaSections && $meetingAgendaSections->count() > 0)
                            @foreach ($meetingAgendaSections as $section)
                                <li class="{{ request()->routeIs('meeting.section.detail') && request()->route('id') == $section->id ? 'mm-active' : '' }}"> <a href="{{ route('meeting.section.detail', $section->id) }}"><i class='bx bx-radio-circle'></i>{{ $section->section_title }}</a>
                                </li>
                            @endforeach
                        @endif
                    @endforeach
                @else
                    <li> <a href=""><i class='bx bx-radio-circle'></i>ไม่พบหมวดวาระการประชุม</a>
                    </li>
                @endif
            </ul>
            </a>
        </li> --}}
        <fieldset style="border: 1px solid
            <legend style="font-size: 0.9rem; text-align: center;">
                <i class='bx bx-filter-alt'></i> เลือกประเภทการประชุม
            </legend>
            <div class="meeting-type-dropdown">
                @php
                    $user = Auth::user();
                    $userCommitteeIds = [];
                    foreach ($user->meetingTypes as $type) {
                        $committeeIds = json_decode($type->pivot->committee_ids, true);
                        if (is_array($committeeIds)) {
                            $userCommitteeIds = array_merge($userCommitteeIds, $committeeIds);
                        }
                    }
                    $userCommitteeIds = array_unique($userCommitteeIds);
                    $userMeetingTypes = $user
                        ->meetingTypes()
                        ->whereHas('users', function ($query) use ($user) {
                            $query->where('users.id', $user->id);
                        })
                        ->whereExists(function ($query) use ($userCommitteeIds) {
                            $query
                                ->from('meeting_agendas')
                                ->whereColumn('meeting_types.id', 'meeting_agendas.meeting_type_id')
                                ->whereIn('meeting_agendas.committee_category_id', $userCommitteeIds);
                        })
                        ->orderBy('name')
                        ->get();
                    $selectedMeetingTypeId = session('selected_meeting_type') ?? ($userMeetingTypes->first()->id ?? null);
                @endphp
                <select class="form-select" id="meetingTypeSelect" onchange="window.location.href=this.value">
                    <option value="{{ route('meeting.type.view') }}">-- เลือกประเภทการประชุม --</option>
                    @if ($userMeetingTypes->count() > 0)
                        @foreach ($userMeetingTypes as $meetingType)
                            @php
                                $committeeIds = json_decode($meetingType->pivot->committee_ids, true) ?? [];
                                $committees = \App\Models\CommitteeCategory::whereIn('id', $committeeIds)
                                    ->pluck('name')
                                    ->implode(', ');
                            @endphp
                            <option value="{{ route('meeting.type.view', ['meeting_type_id' => $meetingType->id]) }}"
                                {{ $selectedMeetingTypeId == $meetingType->id ? 'selected' : '' }}
                                title="คณะกรรมการ: {{ $committees }}">
                                {{ Str::limit($meetingType->name, 10) }}
                            </option>
                        @endforeach
                    @endif
                </select>
            </div>
        </fieldset>
        <style>
            .meeting-type-dropdown {
                padding: 10px 15px;
                background-color: #fff;
                border-bottom: 1px solid #e9ecef;
            }
            .meeting-type-dropdown .form-select {
                width: 100%;
                padding: 8px;
                border: 1px solid #ced4da;
                border-radius: 4px;
                font-size: 14px;
                color: #6c757d;
                background-color: #fff;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .meeting-type-dropdown .form-select:hover {
                border-color: #0d6efd;
            }
            .meeting-type-dropdown .form-select:focus {
                border-color: #0d6efd;
                box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
                outline: none;
            }
            .meeting-type-dropdown .form-select option {
                padding: 8px;
            }
        </style>
        <hr>
        <li>
            <a href="{{ route('admin.legal.database') }}">
                <div class="parent-icon"><i class='bx bx-data'></i>
                </div>
                <div class="menu-title">ฐานข้อมูลด้านกฎหมาย</div>
                {{-- <span class="badge bg-info rounded-pill">ข้อมูลสำคัญ</span> --}}
            </a>
        </li>
        <!-- เพิ่มเมนูสืบค้นข้อมูลมติการประชุม (สำหรับทุกคน) -->
        {{-- <li class="{{ request()->routeIs('search.meeting.resolution') ? 'mm-active' : '' }}">
            <a href="{{ route('search.meeting.resolution') }}">
                <div class="parent-icon"><i class='bx bx-search'></i>
                </div>
                <div class="menu-title">สืบค้นข้อมูลมติการประชุม</div>
            </a>
        </li> --}}
        <li>
            <a href="{{ route('search.meeting.resolution.types') }}">
                <div class="parent-icon"><i class="bx bx-search"></i></div>
                <div class="menu-title">ค้นหามติที่ประชุม</div>
            </a>
        </li>
        <hr>
        <li class="{{ request()->routeIs('meeting.section.detail') ? 'mm-active' : '' }}">
            <a href="javascript:;" class="has-arrow">
                <i class='lni lni-comments-alt'></i>
                <div class="menu-title"> หมวดวาระการประชุม </div>
            </a>
            <ul>
                @php
                    $selectedMeetingType = $userMeetingTypes->where('id', $selectedMeetingTypeId)->first();
                    if ($selectedMeetingType) {
                        $committeeIds = json_decode($selectedMeetingType->pivot->committee_ids, true) ?? [];
                        $meetingAgendas = \App\Models\MeetingAgenda::with([
                            'meeting_type',
                            'sections.meetingAgendaLectures',
                        ])
                            ->where('status', 1)
                            ->where('meeting_type_id', $selectedMeetingType->id)
                            ->whereIn('committee_category_id', array_intersect($committeeIds, $userCommitteeIds))
                            ->orderBy('meeting_agenda_date', 'desc')
                            ->get();
                    } else {
                        $meetingAgendas = collect();
                    }
                @endphp
                @forelse ($meetingAgendas as $agenda)
                    <li class="agenda-group">
                        <a href="javascript:;" class="has-arrow">
                            <i class='bx bx-folder'></i>
                            <span class="agenda-title" title="{{ $agenda->meeting_agenda_title }}">
                                {{ $agenda->meeting_agenda_title }}
                                @php
                                    $committee = \App\Models\CommitteeCategory::find($agenda->committee_category_id);
                                @endphp
                                {{-- @if ($committee)
                                    <small class="text-muted">({{ $committee->name }})</small>
                                @endif --}}
                            </span>
                        </a>
                        <ul>
                            @foreach ($agenda->sections as $section)
                                <li
                                    class="{{ request()->routeIs('meeting.section.detail') && request()->route('id') == $section->id ? 'mm-active' : '' }}">
                                    <a href="{{ route('meeting.section.detail', $section->id) }}"
                                        class="agenda-section">
                                        <i class='bx bx-chevron-down-circle'></i>
                                        <span
                                            title="{{ $section->section_title }}">{{ $section->section_title }}</span>
                                    </a>
                                    <!-- Add sub-menu for lectures -->
                                    <ul>
                                        @foreach ($section->meetingAgendaLectures as $lecture)
                                            <li
                                                class="{{ request()->routeIs('meeting.lecture.detail') && request()->route('id') == $lecture->id ? 'mm-active' : '' }}">
                                                <a href="{{ route('meeting.lecture.detail', $lecture->id) }}"
                                                    class="agenda-lecture">
                                                    <i class='bx bx-right-arrow-alt'></i>
                                                    <span title="{{ $lecture->lecture_title }}">
                                                        {{ \Str::limit($lecture->lecture_title, 30) }}
                                                    </span>
                                                </a>
                                            </li>
                                        @endforeach
                                    </ul>
                                </li>
                            @endforeach
                        </ul>
                    </li>
                @empty
                    <li>
                        <a href="#">
                            <i class='bx bx-folder-open'></i>
                            <span>ไม่พบวาระการประชุม</span>
                        </a>
                    </li>
                @endforelse
            </ul>
        </li>
        {{-- @if ($meetingAgendas->count() > 0)
                    @foreach ($meetingAgendas as $agenda)
                        @php
                            $meetingAgendaSections = \App\Models\MeetingAgendaSection::where('meeting_agenda_id', $agenda->id)->get();
                        @endphp
                        @if ($meetingAgendaSections->count() > 0)
                            @foreach ($meetingAgendaSections as $section)
                                <li class="{{ request()->routeIs('meeting.section.detail') && request()->route('id') == $section->id ? 'mm-active' : '' }}">
                                    <a href="{{ route('meeting.section.detail', $section->id) }}">
                                        <i class='bx bx-radio-circle'></i>{{ $section->section_title }}
                                    </a>
                                </li>
                            @endforeach
                        @endif
                    @endforeach
                @else
                    <li>
                        <a href="javascript:void(0);">
                            <i class='bx bx-radio-circle'></i>ไม่พบหมวดวาระการประชุมที่คุณมีสิทธิ์เข้าถึง
                        </a>
                    </li>
                @endif
            </ul>
        </li> --}}
        {{-- @if (Auth::user()->can('university.council.menu')) --}}
        <hr>
        @if (Auth::user() && Auth::user()->can('approval.menu'))
            <li class="{{ request()->routeIs('approved.meeting.reports') ? 'mm-active' : '' }}">
                <a href="javascript:;" class="has-arrow">
                    <div class="parent-icon"><i class='bx bx-check-circle'></i></div>
                    <div class="menu-title">รายงานการประชุมวาระสืบเนื่อง</div>
                </a>
                <ul>
                    @if (Auth::check())
                        <li class="{{ request()->routeIs('all.approved.meeting.reports') ? 'mm-active' : '' }}">
                            <a href="{{ route('all.approved.meeting.reports') }}">
                                <div class="parent-icon">
                                    <i class='bx bx-check-circle'></i>
                                </div>
                                <div class="menu-title">รายงานการประชุมวาระสืบเนื่อง</div>
                            </a>
                        </li>
                    @endif
                    {{-- <li class="{{ request()->routeIs('approved.meeting.reports') ? 'mm-active' : '' }}">
                    <a href="{{ route('all.approved.meeting.reports') }}">
                        <i class='bx bx-file'></i>
                        รายงานการประชุมวาระสืบเนื่อง (รายงานที่รับรองแล้ว)
                    </a>
                </li> --}}
                </ul>
            </li>
            <hr>
            {{-- @endif --}}
            {{-- @if (Auth::user() && Auth::user()->can('approval.menu')) --}}
            <li>
                <a href="javascript:;" class="has-arrow">
                    <i class='bx bx-select-multiple'></i>
                    <div class="menu-title"> รับรองรายงานการประชุม </div>
                </a>
                <ul>
                    {{-- @php
                    $meetingAgendas = \App\Models\MeetingAgenda::where('status', 1)->get();
                @endphp
                @if ($meetingAgendas && $meetingAgendas->count() > 0)
                    @foreach ($meetingAgendas as $agenda)
                        @php
                            $meetingAgendaSections = \App\Models\MeetingAgendaSection::where('meeting_agenda_id', $agenda->id)->get();
                        @endphp
                        @if ($meetingAgendaSections && $meetingAgendaSections->count() > 0)
                            @foreach ($meetingAgendaSections as $section)
                                <li> <a href="{{ route('meeting.section.detail', $section->id) }}"><i class='bx bx-radio-circle'></i>{{ $section->section_title }}</a>
                                </li>
                            @endforeach
                        @endif
                    @endforeach
                @else
                    <li> <a href=""><i class='bx bx-radio-circle'></i>ไม่พบหมวดวาระการประชุม</a>
                    </li>
                @endif --}}
                    <li class="{{ request()->routeIs('all.meeting.approval') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.meeting.approval') }}"><i class='bx bx-pencil'></i>
                            รับรองรายงานการประชุม
                        </a></li>
                </ul>
                </a>
            </li>
            <hr>
        @endif
        @if (Auth::user()->can('category.menu'))
            <li class="menu-label">UI Elements</li>
            {{-- <li>
            <a href="javascript:;" class="has-arrow">
                <div class="parent-icon"><i class='bx bx-cart'></i>
                </div>
                <div class="menu-title">Manage Category</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>All Category </a>
                </li>
                <li> <a href=""><i class='bx bx-radio-circle'></i>All SubCategory </a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage Instructor</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>All Instructor</a>
                </li>
            </ul>
        </li> --}}
            {{-- <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage Courses</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>All Courses</a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage Coupon</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>All Coupon</a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage Setting</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>Manage SMPT</a>
                </li>
                <li> <a href=""><i class='bx bx-radio-circle'></i>Site Setting </a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage Orders</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>Pending Orders </a>
                </li>
                <li> <a href=""><i class='bx bx-radio-circle'></i>Confirm Orders </a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage Report</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>Report View </a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage Review</div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>Pending Review
                    </a>
                </li>
                <li> <a href=""><i class='bx bx-radio-circle'></i>Active Review </a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class='bx bx-bookmark-heart'></i>
                </div>
                <div class="menu-title">Manage All User </div>
            </a>
            <ul>
                <li> <a href=""><i class='bx bx-radio-circle'></i>All User </a>
                </li>
                <li> <a href=""><i class='bx bx-radio-circle'></i>All Instructor</a>
                </li>
            </ul>
        </li> --}}
            <li
                class="{{ request()->routeIs('all.permission') || request()->routeIs('all.roles') || request()->routeIs('add.roles.permission') || request()->routeIs('all.roles.permission') ? 'mm-active' : '' }}">
                <a class="has-arrow" href="javascript:;">
                    <div class="parent-icon"><i class='lni lni-protection'></i>
                    </div>
                    <div class="menu-title">Role & Permission </div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.permission') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.permission') }}"><i class='bx bx-radio-circle'></i>All Permission
                        </a>
                    </li>
                    <li class="{{ request()->routeIs('all.roles') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.roles') }}"><i class='bx bx-radio-circle'></i>All Roles </a>
                    </li>
                    <li class="{{ request()->routeIs('add.roles.permission') ? 'mm-active' : '' }}"> <a
                            href="{{ route('add.roles.permission') }}"><i class='bx bx-radio-circle'></i>Role In
                            Permission</a>
                    </li>
                    <li class="{{ request()->routeIs('all.roles.permission') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.roles.permission') }}"><i class='bx bx-radio-circle'></i>All Role In
                            Permission</a>
                    </li>
                </ul>
            </li>
            <li
                class="{{ request()->routeIs('all.admin') || request()->routeIs('all.prefix.name') || request()->routeIs('all.position') ? 'mm-active' : '' }}">
                <a class="has-arrow" href="javascript:;">
                    <div class="parent-icon"><i class="bx bx-user-voice"></i>
                    </div>
                    <div class="menu-title">จัดการสมาชิก</div>
                </a>
                <ul>
                    <li class="{{ request()->routeIs('all.admin') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.admin') }}"><i class='bx bx-radio-circle'></i>จัดการสมาชิก</a>
                    </li>
                    <li class="{{ request()->routeIs('all.prefix.name') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.prefix.name') }}"><i
                                class='bx bx-radio-circle'></i>จัดการคำนำหน้า</a>
                    </li>
                    <li class="{{ request()->routeIs('all.position') ? 'mm-active' : '' }}"> <a
                            href="{{ route('all.position') }}"><i class='bx bx-radio-circle'></i>ตำแหน่ง</a>
                    </li>
                </ul>
            </li>
            {{-- <li class="nav-item">
            <a class="nav-link" href="{{ route('settings.edit_approval_deadline') }}">
                <i class="fas fa-cog"></i>
                <span>ตั้งค่า Deadline การรับรอง</span>
            </a>
        </li> --}}
        @endif
        {{-- <li class="menu-label">Charts & Maps</li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class="bx bx-line-chart"></i>
                </div>
                <div class="menu-title">Charts</div>
            </a>
            <ul>
                <li> <a href="charts-apex-chart.html"><i class='bx bx-radio-circle'></i>Apex</a>
                </li>
                <li> <a href="charts-chartjs.html"><i class='bx bx-radio-circle'></i>Chartjs</a>
                </li>
                <li> <a href="charts-highcharts.html"><i class='bx bx-radio-circle'></i>Highcharts</a>
                </li>
            </ul>
        </li>
        <li>
            <a class="has-arrow" href="javascript:;">
                <div class="parent-icon"><i class="bx bx-map-alt"></i>
                </div>
                <div class="menu-title">Maps</div>
            </a>
            <ul>
                <li> <a href="map-google-maps.html"><i class='bx bx-radio-circle'></i>Google Maps</a>
                </li>
                <li> <a href="map-vector-maps.html"><i class='bx bx-radio-circle'></i>Vector Maps</a>
                </li>
            </ul>
        </li>
        <li>
            <a href="https://themeforest.net/user/codervent" target="_blank">
                <div class="parent-icon"><i class="bx bx-support"></i>
                </div>
                <div class="menu-title">Support</div>
            </a>
        </li> --}}
    </ul>
    <!--end navigation-->
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuItems = document.querySelectorAll('.metismenu li');
        const storedActiveMenu = localStorage.getItem('activeMenu');
        const storedActiveParent = localStorage.getItem('activeParentMenu');
        const storedScrollPosition = localStorage.getItem('sidebarScrollPosition');
        function scrollSidebarToPosition(position) {
            const simplebarContent = document.querySelector('.simplebar-content-wrapper');
            if (simplebarContent) {
                simplebarContent.scrollTo({
                    top: position,
                    behavior: 'smooth'
                });
            }
        }
        if (storedActiveMenu || storedActiveParent) {
            menuItems.forEach(item => {
                const link = item.querySelector('a');
                if (link) {
                    if (storedActiveMenu === link.getAttribute('href')) {
                        item.classList.add('mm-active');
                        setTimeout(() => {
                            const activeItem = item.getBoundingClientRect();
                            if (storedScrollPosition) {
                                scrollSidebarToPosition(parseInt(storedScrollPosition));
                            } else {
                                scrollSidebarToPosition(activeItem.top - 100);
                            }
                        }, 100);
                    }
                    if (link.classList.contains('has-arrow') && storedActiveParent === link
                        .getAttribute('href')) {
                        item.classList.add('mm-active');
                    }
                }
            });
        }
        menuItems.forEach(item => {
            const link = item.querySelector('a');
            if (link) {
                link.addEventListener('click', function(e) {
                    if (this.classList.contains('has-arrow')) {
                        localStorage.setItem('activeParentMenu', this.getAttribute('href'));
                    } else {
                        localStorage.setItem('activeMenu', this.getAttribute('href'));
                        const simplebarContent = document.querySelector(
                            '.simplebar-content-wrapper');
                        if (simplebarContent) {
                            localStorage.setItem('sidebarScrollPosition', simplebarContent
                                .scrollTop);
                        }
                        if (!item.closest('.has-arrow')) {
                            localStorage.removeItem('activeParentMenu');
                        }
                    }
                });
            }
        });
        const currentPath = window.location.pathname;
        menuItems.forEach(item => {
            const link = item.querySelector('a');
            if (link && link.getAttribute('href') === currentPath) {
                item.classList.add('mm-active');
                const parentMenuItem = item.closest('.has-arrow')?.closest('li');
                if (parentMenuItem) {
                    parentMenuItem.classList.add('mm-active');
                }
            }
        });
    });
</script>
<style>
    .recent-meetings {
        max-height: 300px;
        overflow-y: auto;
    }
    .meeting-link {
        padding: 8px 15px;
        transition: all 0.3s ease;
    }
    .meeting-link:hover {
        background: rgba(255, 255, 255, 0.05);
    }
    .meeting-title {
        font-size: 0.9rem;
        display: block;
        color:
    }
    .meeting-info small {
        font-size: 0.75rem;
        opacity: 0.7;
    }
    .view-all {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        margin-top: 5px;
        padding-top: 5px;
    }
    .recent-meetings::-webkit-scrollbar {
        width: 4px;
    }
    .recent-meetings::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
    }
    .recent-meetings::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
    }
    .recent-meetings .mm-active>a {
        background: rgba(255, 255, 255, 0.1);
        border-left: 3px solid
    }
    .mm-active {
        scroll-margin-top: 70px;
    }
</style>
<script>
    $('.meeting-title').each(function() {
        if (this.scrollWidth > this.offsetWidth) {
            $(this).attr('title', $(this).text());
        }
    });
    Smooth scroll to active item
    if ($('.recent-meetings .mm-active').length) {
        $('.recent-meetings').animate({
            scrollTop: $('.recent-meetings .mm-active').offset().top -
                $('.recent-meetings').offset().top +
                $('.recent-meetings').scrollTop()
        });
    }
</script>
</file>

</files>
